!function(l,y){l.hud||(l.hud={});(hud.component={}).chart={},hud.scene={};CanvasRenderingContext2D.prototype.sector=function(t,e,i,a,r,n){return this.beginPath(),this.moveTo(t,e),this.arc(t,e,i,a,r,n),this.closePath(),this},CanvasRenderingContext2D.prototype.ring=function(t,e,i,a,r,n,o){var s,h,l,u;if(1==arguments.length&&_.isPlainObject(t)){var c=t;t=c.x,e=c.y,i=c.innerRadius,a=c.outerRadius,r=c.startAngle||0,n=c.endAngle||2*Math.PI,o=c.anticlockwise,s=c.innerStartAngle||r,h=c.innerEndAngle||n,l=c.outerStartAngle||r,u=c.outerEndAngle||n}else l=s=r=r||0,u=h=n=n||2*Math.PI;return this.beginPath(),this.arc(t,e,i,s,h,o),this.arc(t,e,a,u,l,!o),this.closePath(),this},CanvasRenderingContext2D.prototype.circularText=function(t,e,i,a,r,n,o){var s,h=a,l=(r-n)/(t.length-1),u=parseFloat(r),c=0;for(this.save();c<t.length;)s=t.charAt(c),this.save(),this.beginPath(),this.translate(e+Math.cos(u)*h,i+Math.sin(u)*h),this.rotate(Math.PI/2+u),o?ctx.strokeText(s,0,0):this.fillText(s,0,0),u-=l,c++,this.restore();this.restore()},CanvasRenderingContext2D.prototype.circularText=function(t,e,i,a,r,n,o){var s,h=a,l=(r-n)/(t.length-1),u=parseFloat(r),c=0;for(this.save();c<t.length;)s=t.charAt(c),this.save(),this.beginPath(),this.translate(e+Math.cos(u)*h,i+Math.sin(u)*h),this.rotate(Math.PI/2+u),o?ctx.strokeText(s,0,0):this.fillText(s,0,0),u-=l,c++,this.restore();this.restore()};var x=CanvasRenderingContext2D.prototype.drawPath;CanvasRenderingContext2D.prototype.drawPath=function(t){if(x&&Array.isArray(t))return x.call(this,t);if(!t||!t.data||"path"!=t.shape)return this;var e,i;t.lineColor&&(this.strokeStyle=t.lineColor),t.lineWidth&&(this.lineWidth=t.lineWidth),"string"==typeof t.data&&(t.data=hud.util.parseVectorData(t.data)),this.beginPath();for(var a,r,n=0,o=0,s=0;s<t.data.length;s++){var h=t.data[s];switch(h.x?(e=Math.max(h.x,e||h.x),i=Math.max(h.y,i||h.y)):(e=Math.max(h.x1,e||h.x1),i=Math.max(h.y1,i||h.y1),e=Math.max(h.x2,e||h.x2),i=Math.max(h.y2,i||h.y2)),h.c){case"M":this.moveTo(h.x,h.y),n=h.x,o=h.y;break;case"m":this.moveTo(h.x+n,h.y+o),n+=h.x,o+=h.y;break;case"L":this.lineTo(h.x,h.y),n=h.x,o=h.y;break;case"l":this.lineTo(h.x+n,h.y+o),n+=h.x,o+=h.y;break;case"V":this.lineTo(n,h.y),o=h.y;break;case"v":this.lineTo(n,h.y+o),o+=h.y;break;case"h":this.lineTo(n+h.x,o),n+=h.x;break;case"H":this.lineTo(h.x,o),n=h.x;break;case"Z":case"z":this.closePath();break;case"C":this.bezierCurveTo(h.x1,h.y1,h.x2,h.y2,h.x,h.y),a=h.x2,r=h.y2,n=h.x,o=h.y;break;case"c":var l=n+h.x1,u=o+h.y1,c=n+h.x2,d=o+h.y2;a=n+h.x2,r=o+h.y2,n+=h.x,o+=h.y,this.bezierCurveTo(l,u,c,d,n,o);break;case"S":var p=2*n-a,y=2*o-r;this.bezierCurveTo(p,y,h.x2,h.y2,h.x,h.y),a=h.x2,r=h.y2,n=h.x,o=h.y;break;case"s":p=2*n-a,y=2*o-r;var f=a=n+h.x2,g=r=o+h.y2,m=h.x+n,v=h.y+o;this.bezierCurveTo(p,y,f,g,m,v),n+=h.x,o+=h.y;break;default:console.error("not support "+h.c)}}return this.stroke(),t.fill&&(this.fillStyle=t.fill,this.fill()),this},CanvasRenderingContext2D.prototype.drawText=function(t,e,i,a,r,n,o){return this.save(),r&&(this.font=r),n&&(this.textAlign=n),o&&(this.textBaseline=o),a&&(this.fillStyle=a),this.fillText(t,e,i),this.restore(),this},CanvasRenderingContext2D.prototype.polygon=function(t,e,i,a){var r,n=2*Math.PI/i;for(this.save(),this.fillStyle="rgba(255,0,0,.3)",this.strokeStyle="hsl(120,50%,50%)",this.lineWidth=1,this.translate(t,e),this.moveTo(0,-a),this.beginPath(),r=0;r<i;r++)this.rotate(n),this.lineTo(0,-a);return this.closePath(),this.restore(),this};var s=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;String.prototype.colorHex=function(){var t=this;if(/^(rgb|RGB)/.test(t)){for(var e=t.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),i="#",a=0;a<e.length;a++){var r=Number(e[a]).toString(16);"0"===r&&(r+=r),i+=r}return 7!==i.length&&(i=t),i}if(!s.test(t))return t;var n=t.replace(/#/,"").split("");if(6===n.length)return t;if(3===n.length){var o="#";for(a=0;a<n.length;a+=1)o+=n[a]+n[a];return o}},String.prototype.colorRgb=function(){var t=this.toLowerCase();if(t&&s.test(t)){if(4===t.length){for(var e="#",i=1;i<4;i+=1)e+=t.slice(i,i+1).concat(t.slice(i,i+1));t=e}var a=[];for(i=1;i<7;i+=2)a.push(parseInt("0x"+t.slice(i,i+2)));return"RGB("+a.join(",")+")"}return t},String.prototype.colorRgba=function(t){var e=this.toLowerCase();return e&&s.test(e)?this.colorRgb().toLowerCase().replace("rgb","rgba").replace(")",","+t+")"):0===e.indexOf("rgb")&&-1===e.indexOf("rgba")?e.replace("rgb","rgba").replace(")",","+t+")"):0===e.indexOf("rgba")?e.slice(0,e.lastIndexOf(",")+1)+t+")":e},String.prototype.format=function(t){var i=this;if(1<arguments.length){for(var e=[],a=0;a<arguments.length;a++)e.push(arguments[a]);t=e}if(t){if(t instanceof Array)t.forEach(function(t,e){t instanceof Object&&(t=JSON.stringify(t)),i=i.replace("{"+e+"}",t)});else{if(!(t instanceof Object))return i.replace("{}",t);for(var r in t){var n=t[r];n instanceof Object&&(n=JSON.stringify(n)),i=i.replace("{"+r+"}",n)}}}return i},String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},String.prototype.trimLeft=function(){return this.replace(/(^\s*)/g,"")},String.prototype.trimRight=function(){return this.replace(/(\s*$)/g,"")},Number.isInteger=function(t){return(0|t)===t},Function.prototype.scope=function(t){var e=this;return function(){e.apply(t,arguments)}},l.hud||(l.hud={}),hud.util={};var e=/\d%/,t=hud.util.bindingPattern_interpolate=/<%=([\s\S]+?)%>/,i=hud.util.bindingPattern_evaluate=/<%([\s\S]+?)%>/,n=hud.util.bindingPattern=new RegExp([t.source,i.source].join("|"));hud.util._debug=!0,hud.util.isDebug=function(){return hud.util._debug},hud.util.isSupportHighRes=!0,hud.util.getImage=function(t){return h.getImage(t)},hud.util.registerImage=function(t,e,i){return h.registerImage(t,e,i)},hud.util.initImage=function(t,e){return h.initImage(t,e)},hud.util.initImageInfo=function(t){return h.initImageInfo(t)},hud.util.resetZero=function(t){return h.resetZero(t)},hud.util.resetBounds=function(t){return h.resetBounds(t)},hud.util.createCanvas=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,hud.util.isSupportHighRes&&hud.util.makeHighRes(i),i},hud.util.addAttr=function(i,t,e){var a=t+"_";i[a]&&console.warn("name is repeated, name =  ",t,i),i[a]=e,Object.defineProperty(i,t,{set:function(t){var e=i[a];return i[a]=t,e},get:function(){return i[a]}})},hud.util.addProxyAttr=function(t,e,i,a){a=a||e,t[e]&&console.warn("name is repeated, name =  ",e,t),Object.defineProperty(t,e,{set:function(t){var e=i[a];return i[a]=t,e},get:function(){return i[a]}})},hud.util.getColor=function(){for(var t="0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f".split(","),e="#",i=0;i<6;i++)e+=t[Math.floor(16*Math.random())];return e},hud.util.drawPath=function(i,a){var r=this;this.v.forEach(function(t){if("path"==t.shape){t.lineColor=a.lineColor||r.defaultValue.lineColor,t.lineWidth=a.lineWidth||r.defaultValue.lineWidth,t.fill=a.fill||r.defaultValue.fill;var e=hud.util.createGradient(i,a);e&&(i.strokeStyle=e),a.shadowColor&&a.shadowBlur&&(i.shadowColor=a.shadowColor,i.shadowBlur=a.shadowBlur),i.drawPath(t)}else t.v&&(t.defaultValue={},t.defaultValue.lineColor=t.lineColor,t.defaultValue.lineWidth=t.lineWidth,t.defaultValue.fill=t.fill,hud.util.drawPath.call(t,i,t))})},hud.util.loadResource=function(t,e){try{if(localStorage.getItem(t)&&!hud.util.isDebug()){var i=localStorage.getItem(t);e&&e(i)}else{var a=new XMLHttpRequest;a.open("GET",t,!0),a.onload=function(){200<=a.status&&a.status<400&&(localStorage.setItem(t,a.responseText),e&&e(a.responseText))},a.send()}}catch(t){console.error("load font error : "+t.message,t)}},hud.util.loadCss=function(t,i){if(hud.util.isDebug()){var e=document.createElement("link");e.rel="stylesheet",document.head.appendChild(e),e.href=t,e.onload=function(){i&&i()}}else hud.util.loadResource(t,function(t){var e=document.createElement("link");e.rel="stylesheet",document.head.appendChild(e),e.textContent=t,i&&i()})},hud.util.loadJs=function(t,i){if(hud.util.isDebug()){var e=document.createElement("script");e.type="text/javascript",document.head.appendChild(e),e.src=t,e.onload=function(){i&&i()}}else hud.util.loadResource(t,function(t){var e=document.createElement("script");e.type="text/javascript",e.textContent=t,document.head.appendChild(e),i&&i()})},hud.util.o2s=function(t){try{return JSON.stringify(t)}catch(t){throw console.error(it.hud.util.i18n("utils_Stringify_fail"),obj),t}},hud.util.s2o=function(t){try{return JSON.parse(t)}catch(t){throw console.error(it.hud.util.i18n("utils_Parse_fail"),str),t}},hud.util.clone=function(t){return hud.util.s2o(hud.util.o2s(t))},hud.util.fill=function(r,n,t,o){var s,h,l={},u=[];t&&(t.forEach(function(t){var e=t.name,i="int"===t.type;l[e]=e,t.from=r[e],t.to=n[e],t.type=i?"number":t.type,t.onUpdate=function(t){r[e]=i?parseInt(t):t,r.dirty=!0};var a=hud.util.animate(t);o&&(s?(h.chain(a),h=a):h=s=a),u.push(a)}),o?s.play():u.forEach(function(t){t.play()}));for(var e in n)l[e]||(r[e]=n[e])},hud.util.updateShape=function(n,o,s,h){o=o||{},(s=s||{}).play===y&&(s.play=!0),s.dur=s.dur||1e3,Object.keys(o).forEach(function(t,e){var i=hud.util.clone(s),a=n[t],r=o[t];i.from=a,i.to=r,i.prop=t,i.target=n,0==e&&(i.onDone=h),hud.util.animate(i)})},hud.util.loop=function(t){requestAnimationFrame(function(){t&&t(),hud.util.loop(t)})},hud.util.makeHighRes=function(t){var e=t.getContext("2d");if(!this.ratio){var i=l.devicePixelRatio||1,a=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;this.ratio=i/a}var r=this.ratio;if(1!=r){var n=t.width,o=t.height,s=n*r,h=o*r;t.width=Math.round(s),t.height=Math.round(h),t.style.width=n+"px",t.style.height=o+"px",e.scale(r,r)}},hud.util.extend=function(t,e,i){twaver.Util.ext(t,e,i)},hud.util.ext=function(){$.extend.apply($,arguments)},hud.util.copy=function(e,i,a){if(a=a||{},(i=i||{})&&e)if(i instanceof Array)for(var t=0;t<i.length;t++)e[t]=i[t];else{a.filter&&a.filter(e,i);(hud.isObserver(i)?hud.observerKeys(i):Object.keys(i)).forEach(function(t){if(e[t]===y){if(a.fieldFilter&&a.fieldFilter(e,i,t))return;i[t]instanceof Array?(e[t]=[],hud.util.copy(e[t],i[t])):i[t]instanceof Function?e[t]=i[t]():i[t]instanceof Object?(e[t]={},hud.util.copy(e[t],i[t])):e[t]=i[t]}})}return e},hud.util.storeDynamicProps=function(t){var e,i,a,r;if(t)for(e in t)i=t[e],this.isString(i)&&(a=i.match(n))&&(t._patternProps=t._patternProps||{},r="with(data) { "+(a[1]?"return "+a[1]:a[2])+" }",t._patternProps[e]=new Function("shape","image","view","data",r))},hud.util.fillDynamicProps=function(t,e,i,a,r){var n,o;if(t&&t._patternProps)for(n in r=r||t,t._patternProps)o=t._patternProps[n].call(i,e,i,a,e.data),r[n]=o},hud.util.isPercent=function(t){return e.test(t)},hud.util.isPattern=function(t){return t&&this.isString(t)&&t.match(this.bindingPattern)},hud.util.isObject=function(t){return"object"==typeof t},hud.util.isArray=function(t){return t instanceof Array},hud.util.isString=function(t){return"string"==typeof t},hud.util.isFunction=function(t){return"function"==typeof t},hud.util.toArray=function(t){return hud.util.isArray(t)?t:[t]},hud.util.animate=function(i){if(i.from===y&&(i.from=0),i.to===y&&(i.to=1),i.target&&i.prop){i.target=hud.util.toArray(i.target);var a="int"===i.type;a&&delete i.type;var t=!!i.offset;t&&(i.from=0,i.to=i.offset,i.target.forEach(function(t){i.data?t._animateFrom=t.data[i.prop]:t._animateFrom=t[i.prop]})),i.onUpdate=function(e){t?i.target.forEach(function(t){i.data?t.data[i.prop]=a?parseInt(e+t._animateFrom):e+t._animateFrom:t[i.prop]=a?parseInt(e+t._animateFrom):e+t._animateFrom,i.dirty&&(t.dirty=!0)}):i.target.forEach(function(t){i.data?t.data[i.prop]=a?parseInt(e):e:t[i.prop]=a?parseInt(e):e,i.dirty&&(t.dirty=!0)})}}var e=new twaver.Animate(i);return i.play&&e.play(),e},hud.util.url=function(t){if(t=t||"",!this.rootName){var e=l.location.pathname.split("/");e.length<2?this.rootName="/":this.rootName="/"+e[1]}return this.rootName+t},hud.util.parseVectorData=function(t){return twaver.Util.parseVectorData(t)},hud.util.createGradient=function(t,e){if("radial-gradient"==e.gradientType&&e.gradientCenter&&e.gradientRadius&&e.gradientStartColor&&e.gradientEndColor){var i=e.gradientCenter.x,a=e.gradientCenter.y,r=e.gradientRadius,n=t.createRadialGradient(i,a,0,i,a,r);return n.addColorStop(0,e.gradientStartColor),n.addColorStop(1,e.gradientEndColor),n}},hud.util.rads=function(t){return Math.PI*t/180},hud.util.playCameraAnimationSimple=function(e,t,i,a,r,n){(n=n||{}).play=!0,n.dur=a,n.from=0,n.to=1;var o=e.getPosition(),s=e.getTarget(),h=t.x-o.x,l=t.y-o.y,u=t.z-o.z,c=i.x-s.x,d=i.y-s.y,p=i.z-s.z;return n.onUpdate=function(t){e.lookAt(s.x+c*t,s.y+d*t,s.z+p*t),e.setPosition(o.x+h*t,o.y+l*t,o.z+u*t)},n.onDone=r,hud.util.animate(n)};Math.PI;var f=Math.PI/180;hud.util.playCameraAnimation=function(o,t,e,i,a){t=t||o.p(),e=e||o.getTarget(),i=i||2e3;var s=mono.Utils.getVectorAngles(o.getTarget(),o.p()),r=mono.Utils.getVectorAngles(e,t),h=r[0]-s[0];180<h?h-=360:h<-180&&(h+=360);var l=r[1]-s[1];180<l?l-=360:l<-180&&(l+=360);var u=o.getTarget(),c=e,d=o.getDistance(),p=(new mono.Vec3).subVectors(t,e).length();return new twaver.Animate({from:0,to:1,repeat:1,dur:i,onPlay:function(){},onUpdate:function(t){var e=s[0]+h*t,i=s[1]+l*t,a=(new mono.Vec3).lerpVectors(u,c,t),r=d+(p-d)*t,n=new mono.Vec3;n.x=a.x+r*Math.sin(e*f)*Math.cos(i*f),n.z=a.z+r*Math.cos(e*f)*Math.cos(i*f),n.y=a.y+r*Math.sin(i*f),o.lookAt(a),o.p(n)},onDone:function(){a&&a()}}).play()},hud.util.playCamera=function(t,e,i){var a=null,r=null;a=e.p!=y?e.p:t.p().clone(),r=e.t!=y?e.t:t.getTarget().clone(),e.px!=y&&a.setX(e.px),e.py!=y&&a.setY(e.py),e.pz!=y&&a.setZ(e.pz),e.tx!=y&&r.setX(e.tx),e.ty!=y&&r.setY(e.ty),e.tz!=y&&r.setZ(e.tz),e.dpx!=y&&a.setX(a.x+e.dpx),e.dpy!=y&&a.setY(a.y+e.dpy),e.dpz!=y&&a.setZ(a.z+e.dpz),e.dtx!=y&&r.setX(r.x+e.dtx),e.dty!=y&&r.setY(r.y+e.dty),e.dtz!=y&&r.setZ(r.z+e.dtz);var n=new mono.Vec3(a.x,a.y,a.z),o=new mono.Vec3(r.x,r.y,r.z);this.playCameraAnimation(t,n,o,e.waitTime||0,e.playTime||1e3,e.holdTime||500,i)},hud.util.objectForEach=function(t,e){for(var i in t)e.call(t,t[i],i,t)},hud.util.objectMap=function(t,e){var i=[];for(var a in t){var r=e.call(t,t[a],a,t);i.push(r)}return i},hud.util.objectFilter=function(t,e){var i={};for(var a in t){e.call(t,t[a],a,t)&&(i[a]=this[a])}return i},hud.util.objectToArray=function(t){return hud.util.objectMap(t,function(t){return t})},hud.util.createLinearGradient=function(t,e,i,a){for(var r,n,o=t.createLinearGradient(e[0],e[1],e[2],e[3]),s=0;s<i.length;s++)r=i[s],n=a[s],o.addColorStop(r,n);return o},hud.util.roundFlow=function(o){if(o.shapes&&0!=o.shapes.length){o.x=o.x||0,o.y=o.y||0,o.radius=o.radius||400,o.startAngle=o.startAngle||0,o.angleGap=o.angleGap||6,o.itemHeightGap=o.itemHeightGap||30,o.equalAngle=o.equalAngle||!1;var s=function(t,e,i,a){var r,n;i=i||0,a=a||0;return 0<t&&0<e?(r=t,n=e):0<t&&e<0?(r=t,n=e-a):t<0&&0<e?(r=t-i,n=e):t<0&&e<0&&(r=t-i,n=e-a),0==t&&(r=t-i/2,n=e),0==e&&(r=t,n=e-a/2),{x:r,y:n}};if(o.equalAngle)o.shapes.forEach(function(t,e){var i=o.startAngle+e*o.angleGap,a=Math.cos(i/180*Math.PI)*o.radius,r=Math.sin(i/180*Math.PI)*o.radius,n=s(a,r,o.w,o.h);t.x=n.x+o.x,t.y=n.y+o.y});else{Math.cos(o.startAngle/180*Math.PI),o.radius;var h=Math.sin(o.startAngle/180*Math.PI)*o.radius;o.shapes.forEach(function(t,e){var i=h+e*o.itemHeightGap,a=Math.asin(i/o.radius),r=Math.cos(a)*o.radius,n=s(r,i,o.w,o.h);t.x=n.x+o.x,t.y=n.y+o.y})}}},hud.util.api=function(t,e,i,a,r){var n="/api/"+t.replace("/",".")+"/"+e;return console.log(n),$.ajax({type:"post",contentType:"application/json; charset=UTF-8",url:n,data:JSON.stringify(i),success:function(t){t.error?r?r(t.error):console.error(t,n):a&&a(t.value)},error:function(t,e,i){r?r(t,e,i):console.error(t,n)}})},hud.util.showSpinner=function(){document.getElementById("spinner").style.display="block"},hud.util.hideSpinner=function(){document.getElementById("spinner").style.display="none"},hud.util.atomic=function(t,e){return{callback:t,progress:e,count:0,index:0,inc:function(){this.count++},dec:function(){this.index++,this.index==this.count?(this.progress&&this.progress(this.index/this.count),this.callback&&this.callback()):this.index>this.count?console.warn("atomic is completed, index= "+this.index,this):this.progress&&this.progress(this.index/this.count)}}},hud.util.currentMilliseconds=function(){return(new Date).getTime()},hud.util._timerMap={},hud.util._timerId=0,hud.util.setInterval=function(t,e){var i={callback:t,interval:e},a=hud.util._timerId++;return hud.util._timerMap[a]=i,this._timerTick(a),a},hud.util._timerTick=function(e){if(hud.util._timerMap[e]){var i=hud.util._timerMap[e];i.last=i.last||hud.util.currentMilliseconds(),requestAnimationFrame(function(){if(hud.util._timerMap[e]){var t=hud.util.currentMilliseconds()-i.last;t>=i.interval&&(delete i.last,i.callback&&i.callback(t)),hud.util._timerTick(e)}})}},hud.util.clearInterval=function(t){delete hud.util._timerMap[t]};var o={};hud.util.lazyCallFun=function(t,e,i,a,r,n){t="_lazyCallFun_"+t,a=a||o,r=r||10,n&&a[t+"_time"]&&a[t+"_time"]-this.currentMilliseconds()>r&&(a[t+"_time"]=this.currentMilliseconds(),e.apply(a,i)),clearTimeout(a[t]),a[t]=setTimeout(function(){delete a[t],delete a[t+"_time"],e.apply(a,i)},r)},hud.util.getDate=function(){var t=new Date,e="";return e+=t.getFullYear()+"-",e+=this.addZeroForDateTime(t.getMonth()+1)+"-",e+=this.addZeroForDateTime(t.getDate())},hud.util.getTime=function(){var t=new Date,e="";return e+=this.addZeroForDateTime(t.getHours())+":",e+=this.addZeroForDateTime(t.getMinutes())+":",e+=this.addZeroForDateTime(t.getSeconds())},hud.util.addZeroForDateTime=function(t){return t<10?"0"+t:t+""},hud.util.isCollision=function(t,e){return!(t.x>e.x+e.w||e.x>t.x+t.w||t.y>e.y+e.h||e.y>t.y+t.h)},hud.util.resetBounds=function(t){return(t=t||{}).x=0,t.y=0,t.w=0,t.h=0,t.min={x:0,y:0},t.max={x:0,y:0},t},hud.util.copyRect=function(t,e){t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h,t.min.x=e.min.x,t.min.y=e.min.y,t.max.x=e.max.x,t.max.y=e.max.y},hud.util.collectionRect=function(t,e){var i=Math.min(t.min.x,e.min.x),a=Math.min(t.min.y,e.min.y),r=Math.max(t.max.x,e.max.x),n=Math.max(t.max.y,e.max.y);return t.x=i,t.y=a,t.w=r-i,t.h=n-a,t.min={x:i,y:a},t.max={x:r,y:n},t},hud.util.collectionRectAndPoint=function(t,e){var i=Math.min(t.min.x,e.x),a=Math.min(t.min.y,rpoint.y),r=Math.max(t.max.x,e.x),n=Math.max(t.max.y,e.y);return t.x=i,t.y=a,t.w=r-i,t.h=n-a,t.min={x:i,y:a},t.max={x:r,y:n},t},hud.util.moveRect=function(t,e,i){t.x+=e,t.y+=i,t.min.x+=e,t.min.y+=i,t.max.x+=e,t.max.y+=i},hud.util.scaleRect=function(t,e,i){return t.x*=e,t.y*=i,t.w*=e,t.h*=i,t.min.x*=e,t.min.y*=i,t.max.x*=e,t.max.y*=i,t},hud.util.growRect=function(t,e,i,a,r){a=a||1,r=r||1,t.x-=e,t.y-=i,t.w+=e+e,t.h+=i+i,t.min.x-=e,t.min.y-=i,t.max.x+=e,t.max.y+=i,t.x*=a,t.y*=r,t.w*=a,t.h*=r,t.min.x*=a,t.min.y*=r,t.max.x*=a,t.max.y*=r},hud.util.autoAdjustBounds=function(e,t,i,a,r,n){r=r||0,n=n||0,e.adjustBounds(t[i]-r,t[a]-n),!e._resizeFunction&&(e._resizeFunction=function(){e.adjustBounds(t[i]-r,t[a]-n,n,r)}),l.addEventListener("resize",function(){var t="_autoAdjustBounds_"+e._id;hud.util.lazyCallFun(t,e._resizeFunction,[],e,600)},!0)},hud.util.rotatePoint=function(t,e,i){i=i||{x:0,y:0};var a=t.x,r=t.y,n=i.x,o=i.y,s=Math.sin(e),h=Math.cos(e);return{x:(a-n)*h-(r-o)*s+n,y:(a-n)*s+(r-o)*h+o}},l.hud||(l.hud={});var g=hud.Event=function(){this._listeners={},this._shotMap={}};g.split=".",g.wildcard="*",g.prototype.on=function(t,e,i,a){if(!t)throw"type is empty";if(!e)throw"handler is empty";if(t.indexOf(g.split)<0){var r='use anonymous namespace, will add a real value. recommendeg onymous namespace  eg: on("click.a"), not on("click")';throw console.warn(r),r}this._shotMap={};for(var n,o=this._listeners,s=t.split(g.split),h=s.length,l=0;l<h-1;l++)o[n=s[l]]=o[n]||{_handlers:[]},o=o[n],l==h-2&&this._add(o,t,e,i,a);return this},g.prototype._add=function(t,e,i,a,r){t._handlers=t._handlers||[];var n=t._handlers;n.length;n.push({type:e,handler:i,scope:a,strict:r})},g.prototype.find=function(t){return this._find(this._listeners,t.split(g.split),0)},g.prototype._find=function(e,i,a,r){r=r||[];var t=i[a];if(t==g.wildcard){var n=this;Object.keys(e).forEach(function(t){"_handlers"!==t&&n._calc(e[t],i,a,r)})}else e[t]&&this._calc(e[t],i,a,r),e[g.wildcard]&&this._calc(e[g.wildcard],i,a,r);return r},g.prototype._calc=function(t,e,i,a,r){i<e.length-1?(this._appendHander(t,a),this._find(t,e,i+1,a)):this._appendHander(t,a,!0)},g.prototype._appendHander=function(e,i,a){if(e._handlers)for(var t=e._handlers,r=t.length,n=0;n<r;n++)i.push(t[n]);if(a){var o=this;Object.keys(e).forEach(function(t){"_handlers"!=t&&o._appendHander(e[t],i,a)})}},g.prototype.off=function(t,e){var i,a;this._shotMap={};for(var r,n,o,s=t.split(g.split),h=s.length,l=0;l<h;l++){if(r=s[l],!(a=(i=a||this._listeners)[r]))return;if(n=a._handlers){for(var u=0;u<n.length;u++)o=n[u],e?o.type==t&&o.handler==e&&(n.splice(u,1),u--):o.type==t&&(n.splice(u,1),u--);0==n.length&&(delete a._handlers,0==Object.keys(a).length&&delete i[r])}}for(l=0;l<h;l++){a=i=null;for(u=0;u<h-l&&(r=s[u],a=(i=a||this._listeners)[r]);u++)0==Object.keys(a).length&&delete i[r]}return this},g.prototype.emit=function(){var t;2==arguments.length?(t=arguments[1]).eventType=arguments[0]:t=arguments[0],t.eventType=t.eventType||t.type||t.name;var e,i=t.eventType;if(!i)return console.warn("event type is empty"),this;if(this._listeners[i],this._shotMap[i]?e=this._shotMap[i]:(e=this.find(i),this._shotMap[i]=e),!e)return this;for(var a=0;a<e.length;a++)if(handler=e[a],t.handler=handler.type,(!handler.strict||handler.type==i)&&(handler.handler.call(handler.scope||this,t),t._stopEvent))return this;return this},function(t){t.hud||(t.hud={}),hud.observer=function(t,e,i,a){e===y&&(e=!0);return t instanceof Array?void console.error("暂时不支持 array  observer"):(r=t,n=e,o=(o=i)||"",p(a||new g,r,n,o),(s=r).on=function(t,e){var i=this;return this[l].on(t,function(t){e&&e.call(i,t)}),this},s.off=function(t){return this[l].off(t),this},s.emit=function(t){return 2==arguments.length&&(t.type=arguments[1]),t.source=s,this[l].emit(t),this},r.toJSON=d,r);var r,n,o,s},hud.isObserver=function(t){return!!t[h]},hud.observerKeys=function(t){var e=Object.keys(t[h]);return Object.keys(t).forEach(function(t){t!==l&&t!=h&&t!=u&&"toJSON"!==t&&"on"!=t&&"off"!=t&&"emit"!=t&&e.push(t)}),e},hud.observerToJSON=d,hud.observerEnable=function(t){delete t[c]},hud.observerDisable=function(t){t[c]=!0};var h="___origin___",l="___event___",u="___path___",c="___disableName___";function d(t){return 0==arguments.length&&(t=this),hud.util.copy({},t)}function p(a,r,n,o,s){r[l]=a,r[u]=o,r[h]={},s=s||r,Object.keys(r).forEach(function(t){if(t!=h&&t!=l&&t!=u&&0!=t.indexOf("_")){var e=r[t],i=typeof e;if("function"!=i)if(function(a,r,n,o,s){r[h].hasOwnProperty(n)&&console.warn("已经添加属性的监听：name=",n,"target="+r);r[h][n]=r[n],delete r[n],Object.defineProperty(r,n,{set:function(t){var e=this[h][n];if(e!==t){if(this[h][n]=t,!this[c]){var i=o+n;a.emit({type:i,source:r,name:n,newValue:t,oldValue:e,root:s})}t&&"object"==typeof t&&p(a,t,!0,this[u]+n+".")}},get:function(){var t=this[h][n];return t}})}(a,r,t,o,s),e instanceof Array);else if(n&&"object"===i){p(a,e,n,o+t+".",s)}}})}}(l);var h=hud.imageUtil={cache:!0,isShowBorder:!1,isAutoBorderColor:!1,isShowSpaceBounds:!1,isAutoSpaceBorderColor:!1,imageMap:{}};h.getImage=function(t){return this.imageMap[t]},h.registerImage=function(e,t,i){var a=this.imageMap[e];if(a&&console.warn("register image, name is exist : "+e),"string"==typeof t){var r=this,n=t;(o=new Image).src=n,o.onload=function(){var t={_imageType:"image",imageName:e,url:n,source:o,w:o.width,h:o.height};r.imageMap[e]=t,i&&i(e,t)}}else{if(t instanceof Function)var o=this.imageMap[e]={draw:t};else if(t instanceof Array)o=this.imageMap[e]={children:t};else t.v instanceof Array&&!t.draw&&(t.draw=hud.util.drawPath),this.imageMap[e]=t;(t=this.imageMap[e])._imageName=e,h.initImage(t),i&&i(e,t)}return a},h.initImage=function(t){this.imageIterator(t,this._initImage,this)},h._initImage=function(t){t._inited||(this.initImageState(t),this.initImageInfo(t),this.resetZero(t),this.resetBounds(t),t._inited=!0)},h.initImageState=function(t){t.x=t.x||0,t.y=t.y||0,t.alpha===y&&(t.alpha=1),t.scale!==y?(t.scaleX=t.scale,t.scaleY=t.scale):(t.scale=t.scale||1,t.scaleX=t.scaleX||1,t.scaleY=t.scaleY||1),t.rotate=t.rotate||0},h.initImageInfo=function(e){e.origin=e.origin||{},h.imageIterator(e,function(t){e.w===y&&t.w!==y&&(e.w=t.w),e.h===y&&t.h!==y&&(e.h=t.h),e.origin.x===y&&t.origin&&t.origin.x!==y&&(e.origin.x=t.origin.x),e.origin.y===y&&t.origin&&t.origin.y!==y&&(e.origin.y=t.origin.y),e.margin===y&&t.margin!==y&&(e.margin=t.margin),e.borderWidth===y&&t.borderWidth!==y&&(e.borderWidth=t.borderWidth)}),e.origin.x===y&&(e.origin.x=.5),e.origin.y===y&&(e.origin.y=.5),e.w=e.w||0,e.h=e.h||0,e.visible===y&&(e.visible=!0),e.margin===y&&(e.margin=10),e.borderWidth===y&&(e.borderWidth=2),e.borderColor===y&&this.isAutoBorderColor&&(e.borderColor=hud.util.getColor()),e.spaceBorderColor===y&&this.isAutoSpaceBorderColor&&(e.spaceBorderColor=hud.util.getColor())},h.resetZero=function(t){t.tx=Math.round(t.w*t.origin.x+t.margin),t.ty=Math.round(t.h*t.origin.y+t.margin)},h.resetBounds=function(t){t._bounds=t._bounds||{},t._bounds.x=-t.tx,t._bounds.y=-t.ty,t._bounds.w=t.w+2*t.margin,t._bounds.h=t.h+2*t.margin},h.resetSpaceBounds=function(t){var e=t._state,i=t._bounds,a=hud.util.copy({},i),r={x:a.x,y:a.y},n={x:a.x+a.w,y:a.y},o={x:a.x+a.w,y:a.y+a.h},s={x:a.x,y:a.y+a.h},h={x:0,y:0};r=hud.util.rotatePoint(r,e.rotate,h),n=hud.util.rotatePoint(n,e.rotate,h),o=hud.util.rotatePoint(o,e.rotate,h),s=hud.util.rotatePoint(s,e.rotate,h);var l=Math.min(r.x,n.x,o.x,s.x),u=Math.min(r.y,n.y,o.y,s.y),c=Math.max(r.x,n.x,o.x,s.x),d=Math.max(r.y,n.y,o.y,s.y);a.x=l,a.y=u,a.w=c-l,a.h=d-u,a.x=Math.round(a.x),a.y=Math.round(a.y),a.w=Math.round(a.w),a.h=Math.round(a.h),a.min={x:a.x,y:a.y},a.max={x:a.x+a.w,y:a.y+a.h},hud.util.scaleRect(a,e.scaleX,e.scaleY),t._spaceBounds=t._spaceBounds||{min:{},max:{}},hud.util.copyRect(t._spaceBounds,a)},h.drawCacheImage=function(t,e,i){t.drawImage(e._cacheImage,i.x,i.y,i.w,i.h)},h.getCacheContext=function(t){if(!t.w||!t.h)return console.warn("image 没有定义尺寸, 无法缓存, id="+t.id," name=",t.name,t),void setTimeout(function(){t.dirty=!0},10);var e,i=t._bounds;return(e=t._cacheImage?t._cacheImage:hud.util.createCanvas(i.w,i.h)).width=i.w,e.height=i.h,e.getContext("2d").translate(t.tx,t.ty),e},h.cacheImage=function(t,e,i){if(1!=arguments.length||"string"!=typeof t||(t=this.getImage(t))){e=e||t;var a=this.getCacheContext(t);if(a){var r=a.getContext("2d");hud.util.fillDynamicProps(t,e,t,i,t),hud.observerDisable(e.data),hud.util.fillDynamicProps(t.data,e,t,i,e.data),hud.observerEnable(e.data),t.cache=!1,this.drawImageFromZero(r,t,e,i),t.cache=!0,t._cacheImage=a}}},h.cacheShape=function(t,e){var i=h.getImage(t.name);if(i){var a=this.getCacheContext(t);if(!a)return;var r=a.getContext("2d");hud.util.fillDynamicProps(i,t,i,e,i),hud.observerDisable(t.data),hud.util.fillDynamicProps(i.data,t,i,e,t.data),hud.observerEnable(t.data),h.drawImageFromZero(r,i,t,e),t._cacheImage||(t._cacheImage=a)}t.dirty=!1},h.drawShape=function(t,e,i){if(this.isShowSpaceBounds){var a=e._state._bounds;t.lineWidth=1,t.strokeStyle=e.spaceBorderColor,t.strokeRect(a.x,a.y,a.w,a.h)}var r=this.getState(e);if(this.saveState(t,r),this.isShowBorder&&e.isShowBorder&&this.drawBorder(t,e),e._cacheImage){a=e._bounds;"mouse-in"==e.hitType?e.mousemoving&&(t.save(),t.fillStyle="rgba(255,255,255,0.1)",t.fillRect(a.x,a.y,a.w,a.h),t.restore()):e.mousemoving?t.globalAlpha=.65:r.alpha!=y?t.globalAlpha=r.alpha:t.globalAlpha=1,t.drawImage(e._cacheImage,a.x,a.y,a.w,a.h)}else{var n=h.getImage(e.name);n&&h.drawImage(t,n,e,i)}this.restoreState(t,r),e.dirty=!1},h.drawBorder=function(t,e){if(e._bounds){var i=e._bounds;t.strokeStyle=e.borderColor,t.lineWidth=e.borderWidth,t.strokeRect(i.x,i.y,i.w,i.h)}},h.drawImage=function(t,e,i,a){if("image"!=e._imageType){i=i||{},hud.util.fillDynamicProps(e,i,e,a,e),hud.observerDisable(i.data),hud.util.fillDynamicProps(e.data,i,e,a,i.data),hud.observerEnable(i.data);var r=this.getState(e);this.saveState(t,r),this.drawImageFromZero(t,e,i,a),this.restoreState(t,r)}else t.drawImage(e.source,-i.tx,-i.ty)},h.drawImageFromZero=function(t,e,i,a,r){if(i=i||{},a=a||this,r=r||{},"image"!=e._imageType){if(!1!==e.visible)if(this.cache&&e.cache){if(e._cacheImage||h.cacheImage(e,e.isStatic?e:i,a),e._cacheImage){var n=e._bounds;t.drawImage(e._cacheImage,n.x,n.y,n.w,n.h)}}else this.drawImageSelfAction(t,e,i,a),this.drawImageNameAction(t,e,i,a),this.drawImageChildrenAction(t,e,i,a)}else t.drawImage(e.source,-i.tx,-i.ty)},h.drawImageSelfAction=function(t,e,i,a){"image"===e.type?t.drawImage(e.source,-i.tx,-i.ty):(e.validate&&e.validate.call(e,t,i,a),e.draw&&e.draw.call(e,t,i,a))},h.drawImageNameAction=function(t,e,i,a){if(e.name){var r=this.getImage(e.name);r?this.drawImage(t,r,i,a):console.warn("register image {} befor".format(e.name),e,i)}},h.drawImageChildrenAction=function(t,e,i,a){if(e.children)for(var r=e.children.length,n=0;n<r;n++)this.drawImage(t,e.children[n],i,a)},h.getState=function(t){if(t._state)return t._state;var e={};return e.x=t.x||0,e.y=t.y||0,e.scaleX=t.scaleX||1,e.scaleY=t.scaleY||1,e.rotate=t.rotate||t.angle||0,e.alpha=t.alpha||1,e},h.saveState=function(t,e){t.save(),e.alpha!==y&&(t.globalAlpha=e.alpha),t.translate(e.x,e.y),t.scale(e.scaleX,e.scaleY),t.rotate(e.rotate)},h.restoreState=function(t,e){t.restore()},h.isCacheable=function(t){var e=!0;return h.imageIterator(t,function(t){return!(e&=!1===t.cache)}),e},h.imageIterator=function(t,e,i){if(!e.call(i,t)){if(t.name){var a=hud.util.getImage(t.name);a&&this.imageIterator(a,e,i)}if(t.children){var r=this;t.children.forEach(function(t){r.imageIterator(t,e,i)})}}},h.inorderIterator=function(t,e,i){t.name&&((r=hud.util.getImage(t.name))&&this.inorderIterator(r,e,i));if(t.children)for(var a=t.children.length,r=0;r<a;r++)this.inorderIterator(t.children[r],e,i);e.call(i,t)},l.hud||(l.hud={});var u=hud.LayerManager=function(t){this.easyDraw=t,this.view=this.easyDraw.view,this.width=this.easyDraw.width,this.height=this.easyDraw.height,this.layerMap={},this.layerShapeMap={},this.clearColor="rgba(255, 255, 255, 0)"};u.defaultValue=0,u.prototype.init=function(){var r=this;this.easyDraw.on("resize.layer",function(t){var e=t.w,i=t.h;hud.util.lazyCallFun("resize",r.adjustBounds,[e,i],r,500)}),this.easyDraw.on("add.layer",function(t){var e=t.shape,i=e.layer||0;r.layerShapeMap[i]||(r.layerShapeMap[i]={}),(r.layerShapeMap[i][e.id]=e).visible&&r.add(i)}),this.easyDraw.on("remove.layer",function(t){var e=t.shape,i=e.layer||0;if(r.layerShapeMap[i]){var a=r.layerShapeMap[i];delete a[e.id],0==Object.keys(a)?(delete r.layerShapeMap[i],r.remove(i)):e.visible&&hud.util.lazyCallFun("layer_"+i,r.resetVisible,[i],r)}}),this.easyDraw.on("m.*.visible.layer",function(t){var e=t.originSource.layer||0;hud.util.lazyCallFun("layer_"+e,r.resetVisible,[e],r)})},u.prototype.resetVisible=function(t){var e=this.isLayerVisible(t);this.setVisible(t,e)},u.prototype.isLayerVisible=function(t){if(!this.layerShapeMap[t])return!1;var e=this.layerShapeMap[t];for(var i in e)if(e[i].visible)return!0;return!1},u.prototype.add=function(t){if(this.layerMap[t])return this.layerMap[t];var e=document.createElement("canvas");e.width=this.width,e.height=this.height,e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.value=t,e.id="layer"+t,hud.util.isSupportHighRes&&hud.util.makeHighRes(e);var i=e.getContext("2d");return h.saveState(i,this.easyDraw._state),e._visible=!0,this.add2dom(t,e),(this.layerMap[t]=e)._bounds={},this.resetBounds(e._bounds),e},u.prototype.resetBounds=function(t){hud.util.resetBounds(t)},u.prototype.remove=function(t){if(this.layerMap[t]){var e=this.layerMap[t];delete this.layerMap[t],this.view.removeChild(e)}},u.prototype.add2dom=function(t,e){for(var i=this.view.children,a=i.length,r=0;r<a;r++){var n=i[r];if(t<(parseInt(n.value)||u.defaultValue))return void this.view.insertBefore(e,n)}this.view.appendChild(e)},u.prototype.adjustBounds=function(t,e){for(var i in this.width=t,this.height=e,this.layerMap){var a=this.layerMap[i];a.width=t,a.height=e,hud.util.isSupportHighRes&&hud.util.makeHighRes(a);var r=a.getContext("2d");h.saveState(r,this.easyDraw._state),a.dirty=!0}this.render()},u.prototype.resetContent=function(t){var e=this.layerMap[t];e.width=e.width,e.getContext("2d").scale(hud.util.ratio,hud.util.ratio)},u.prototype.dirty=function(t){if(t===y)for(var t in this.layerMap)this.layerMap[t].dirty=!0;else this.layerMap[t]?this.layerMap[t].dirty=!0:this.add(t)},u.prototype.dirtyShape=function(t){var e=this.easyDraw.getLayer(t);this.dirtyRect(e,t._state._dirtyBounds||t._state._bounds),delete t._state._dirtyBounds},u.prototype.dirtyRect=function(t,e){var i=this.layerMap[t];i._bounds.dirty?hud.util.collectionRect(i._bounds,e):(hud.util.copyRect(i._bounds,e),i._bounds.dirty=!0),hud.util.lazyCallFun("dirtyRect_"+t,this._dirtyRect,[t],this,1,!0)},u.prototype._dirtyRect=function(t){var e=this.layerMap[t],i=e._bounds,a=this.getShapeInRect(i,t);if(a){var r=this.easyDraw._state;hud.util.growRect(i,2,2,r.scaleX,r.scaleY),i.x=Math.round(i.x),i.y=Math.round(i.y),i.w=Math.round(i.w),i.h=Math.round(i.h),i.dirty=!1;var n=e.getContext("2d");n.save(),n.beginPath(),n.rect(i.x,i.y,i.w,i.h),n.clip(),n.clearRect(i.x,i.y,i.w,i.h);var o=this;h.saveState(n,this.easyDraw._state);var s=this.easyDraw.allShapeMap;a.forEach(function(t){h.drawShape(n,s[t],o.easyDraw)}),h.restoreState(n),n.restore()}},u.prototype.getShapeInRect=function(t,e){if(!e||this.layerShapeMap[e]){if(e)return this._getShapeInRect(t,e);var i=[];for(var a in this.layerMap)i=i.concat(this._getShapeInRect(t,a));return i}},u.prototype._getShapeInRect=function(e,t){var i=this.layerShapeMap[t],a=Object.keys(i);if(0!=a.length){var r,n=this.easyDraw;return a.filter(function(t){return r=i[t],!!n.isVisible(r)&&(!(!r._state||!r._state._bounds)&&hud.util.isCollision(e,r._state._bounds))})}},u.prototype.setVisible=function(t,e){if(1==arguments.length){var i=(e=t)?"block":"none";for(var t in this.layerMap)this.layerMap[t].style.display=i,(this.layerMap[t]._visible=e)&&this.dirty(t)}else if(this.layerMap[t]){i=e?"block":"none";var a=this.layerMap[t];a._visible=e,a.style.display=i,e&&this.dirty(t)}else e&&this.add(t)},u.prototype.render=function(){var t,e,i,a,r,n;this.easyDraw._state._bounds;for(t in this.layerMap)if(this.layerMap[t].dirty&&this.layerMap[t]._visible&&(e=this.layerShapeMap[t])){for(n in(a=this.layerMap[t]).width=a.width,(r=a.getContext("2d")).scale(hud.util.ratio,hud.util.ratio),h.saveState(r,this.easyDraw._state),e)!(i=e[n])._parentHidden&&i.visible?h.drawShape(r,i,this.easyDraw):i.dirty=!1;this.layerMap[t].dirty=!1,h.restoreState(r)}},u.prototype.getShapeByBound=function(){};var a=hud.EasyDraw=function(t){t=t||{},this.designWidth=t.designWidth||3840,this.designHeight=t.designHeight||2160,this.width=t.width||100,this.height=t.height||100,this.view=document.createElement("div"),this.view.style.position="absolute",this.view.style.top="0px",this.view.style.left="0px",this.view.style.width="100%",this.view.style.height="100%",this.view.style.overflow="hidden",this._ready=!1,this.shapes=[],this.shapeMap={},this.allShapes=[],this.allShapeMap={},this.interactShapes=[],this.interactShapeMap={},this.clearColor="rgba(255, 255, 255, 0)",this.fps=0,this.tpf=0,this._drawCount=0,this._drawTime=0,this._state={x:0,y:0,scaleX:1,scaleY:1,angle:0,alpha:1},this.cache=!0,this.isShowBorder=!0,this.isShowImageBorder=!1,this.interact=t.interact===y||t.interact,this.scale=this.scaleX=this.scaleY=1,this.selectedGroupMap={},this.autoDrawForDirty=!0,this._relativeShapes=[],this.event=new hud.Event,this.shapePath="m.",this.layerManager=new hud.LayerManager(this),this.layerManager.init(),this.init(),this.initEvent(),this.adjustBounds(100,100),a._id&&(a._id=0),this._id=a._id++};a.prototype.getRootView=function(){return this.view},a.prototype.on=function(t,e){return this.event.on(t,e),this},a.prototype.off=function(t){return console.log("off type = "+t),this.event.off(t),this},a.prototype.emit=function(t){return 2==arguments.length?this.event.emit(t,arguments[1]):this.event.emit(t),this},a.prototype.init=function(){var t=this.width/this.designWidth,e=this.height/this.designHeight,i=Math.min(t,e);this._state.sw=t,this._state.sh=e,this._state.scale=i,this._state.scaleX=i,this._state.scaleY=i;this.width,this.designWidth,this.height,this.designHeight;this._state.x=0,this._state.y=0,this._state.w=this.designWidth*i,this._state.h=this.designHeight*i,this._state._bounds={x:0,y:0,w:this.width/i,h:this.height/i}},a.prototype.initEvent=function(){var a=this;(this.on(this.shapePath+"*.x.view",function(t){var e=t.originSource;a.updateShapeState(e,!0)}),this.on(this.shapePath+"*.y.view",function(t){var e=t.originSource;a.updateShapeState(e,!0)}),this.on(this.shapePath+"*.scaleX.view",function(t){var e=t.originSource;a.updateShapeState(e,!0)}),this.on(this.shapePath+"*.scaleY.view",function(t){var e=t.originSource;a.updateShapeState(e,!0)}),this.on(this.shapePath+"*.rotate.view",function(t){var e=t.originSource;a.updateShapeState(e,!0)}),this.on(this.shapePath+"*.alpha.view",function(t){var e=t.originSource;a.updateShapeState(e,!0)}),this.on(this.shapePath+"*.selected.view",function(t){var e=t.originSource;e.dirty=!0,a.shapeSelectedHandler(e)}),this.on(this.shapePath+"*.visible.view",function(t){var e=t.newValue,i=t.originSource;a.syncChildrenHidden(i,!e,i.syncVisible)}),this.on(this.shapePath+"*.dirty.view",function(t){if(t.newValue){var e=t.originSource;e.cache?hud.util.lazyCallFun("_dirty_shape_"+e.id,a.shapeDirtyHandler,[e],a,1,!0):a.dirty(a.getLayer(e))}}),this.on(this.shapePath+"*.scale.view",function(t){var e=t.originSource;e.scaleX=e.scaleY=t.newValue}),this.on(this.shapePath+"*.data.view",function(t){t.originSource.dirty=!0}),this.on(this.shapePath+"*.w.view",function(t){var e=t.originSource;h.resetZero(e),h.resetBounds(e),h.resetSpaceBounds(e),a.updateShapeStateBounds(e,!0),a.resetShapeCacheImage(e)}),this.on(this.shapePath+"*.h.view",function(t){var e=t.originSource;h.resetZero(e),h.resetBounds(e),h.resetSpaceBounds(e),a.updateShapeStateBounds(e,!0),a.resetShapeCacheImage(e)}),this.on(this.shapePath+"*.hor.view",function(t){var e=t.originSource;a.calcShapeAbsX(e)}),this.on(this.shapePath+"*.ver.view",function(t){var e=t.originSource;a.calcShapeAbsY(e)}),this.interact)&&((a=this).interaction=new c(a),hud.util.addProxyAttr(a,"interactionDisabled",a.interaction,"disabled"))},a.prototype.calcShapeAbsX=function(t){if(t.hor!==y&&""!==t.hor){var e,i;"string"==typeof t.hor?1==(e=t.hor.split(":")).length?(i="left",e=t.hor):(i=e[0],e=e[1]):(i="left",e=t.hor);var a=(t._parent||this)._state._bounds;"right"==i?hud.util.isPercent(e)?t.x=(100-parseFloat(e))*a.w/100:t.x=a.w-e:hud.util.isPercent(e)?t.x=parseFloat(e)*a.w/100:t.x=parseInt(e)}},a.prototype.calcShapeAbsY=function(t){if(t.ver!==y&&""!==t.ver){var e,i;"string"==typeof t.ver?1==(e=t.ver.split(":")).length?(i="top",e=t.ver):(i=e[0],e=e[1]):(i="top",e=t.ver);var a=(t._parent||this)._state._bounds;"bottom"==i?hud.util.isPercent(e)?t.y=(100-parseFloat(e))*a.h/100:t.y=a.h-e:hud.util.isPercent(e)?t.y=parseFloat(e)*a.h/100:t.y=parseInt(e)}},a.prototype.syncChildrenHidden=function(t,e,i){if(t.children)for(var a,r=t.children.length,n=0;n<r;n++)a=t.children[n],this.allShapeMap[a.id]&&(a._parentHidden=e,i&&(a.visible=!e),this.syncChildrenHidden(a,e,i));this.dirty(t)},a.prototype.syncChildrenPos=function(){for(var t,e=0;e<this._relativeShapes.length;e++)(t=this.allShapeMap[this._relativeShapes[e]])&&(this.calcShapeAbsX(t),this.calcShapeAbsY(t))},a.prototype.adjustBounds=function(t,e){t=t||100,e=e||100,this.width=t,this.height=e,this.init(),this.syncChildrenPos(),this.emit({type:"resize",w:t,h:e})},a.prototype.draw=function(){if(this._ready){var t=(new Date).getTime();this.layerManager.render(),this._drawCount++;var e=(new Date).getTime()-t;this._drawTime+=e}},a.prototype.resetShapeCacheImage=function(t){if(t._cacheImage){var e=t._bounds;t._cacheImage.width=e.w,t._cacheImage.height=e.h,hud.util.isSupportHighRes&&hud.util.makeHighRes(t._cacheImage)}},a.prototype.drawImage=function(t,e,i){h.drawImage(t,e,i,this)},a.prototype.getShapePosition=function(t,e){"string"==typeof t&&(t=this.shapeMap[t]);for(var i={x:t.x,y:t.y},a=t;a._parent;)a=a._parent,i.x=i.x/a.scaleX+a.x,i.y=i.y/a.scaleY+a.y;return e&&(i.x=i.x*this._state.scaleX+this._state.x,i.y=i.y*this._state.scaleY+this._state.y),i},a.prototype.getShapeScale=function(t,e){for(var i=t.scaleX,a=t.scaleY;t._parent;)i*=t._parent.scaleX,a*=t._parent.scaleY,t=t._parent;return e&&(i*=this._state.scaleX,a*=this._state.scaleY),{scaleX:i,scaleY:a}},a.prototype.updateShapeState=function(t,e){var i=this;this.getShapeState(t,t._state),h.resetSpaceBounds(t),this.updateShapeStateBounds(t),e&&t.children&&t.children.forEach(function(t){hud.isObserver(t)&&i.updateShapeState(t,e)}),this.dirtyShape(t)},a.prototype.updateShapeStateBounds=function(t,e){t&&t._spaceBounds&&t._state&&(t._state._dirtyBounds?hud.util.collectionRect(t._state._dirtyBounds,t._state._bounds):(t._state._dirtyBounds={min:{},max:{}},hud.util.copyRect(t._state._dirtyBounds,t._state._bounds)),hud.util.copyRect(t._state._bounds,t._spaceBounds),hud.util.moveRect(t._state._bounds,t._state.x,t._state.y),hud.util.collectionRect(t._state._dirtyBounds,t._state._bounds),e&&this.dirtyShape(t))},a.prototype.shapeListener=function(t){var e=this,i=t.source,a=t.name,r=e.getLayer(i);if(r!==y)return"dirty"==a&&t.newValue&&i.cache?(clearTimeout(i._cacheTimerId),void(i._cacheTimerId=setTimeout(function(){e.cacheShape(i),e.dirty(r)},50))):void("scale"==a&&(i.scaleX=i.scaleY=t.newValue));console.error("layer is not exist : id="+i.id,i)},a.prototype.getLayer=function(t){return t.layer!==y?t.layer:t._parent?this.getLayer(t._parent):void 0},a.prototype.initShape=function(e,t){var i=this;this.initShapeImage(e),e.interact&&(e.cache=!0,this.interactShapes.push(e),this.interactShapeMap[e.id]=e),hud.observer(e),e.on("*.view",function(t){var e=t.root||t.source;t.originSource=e,t.orginType=t.eventType,t.eventType=i.shapePath+e.id+"."+t.orginType,i.emit(t),e.type&&(t.eventType=i.shapePath+e.type+"."+e.id+"."+t.orginType,i.emit(t))}),t&&(e._parent=t),t&&(e._parentHidden=!this.isShapeVisible(t)),this._add(e),this.updateShapeState(e),e.ver===y&&e.hor===y||(this.calcShapeAbsX(e),this.calcShapeAbsY(e),this._relativeShapes.push(e.id)),e.selectedGroup&&e.selected&&this.shapeSelectedHandler(e),e.children.forEach(function(t){i.initShape(t,e)}),e.dirty=!0,this._initShapeImage(e),e.cache},a.prototype.initShapeImage=function(t){t.visible===y&&(t.visible=!0),t.selected=!!t.selected,h.initImageState(t),h.initImageInfo(t),h.resetZero(t),h.resetBounds(t),t.id=t.id||this.nextId(),t.children=t.children||[],t.data=t.data||{},t.layer=this.getLayer(t)||0,this.layerManager.dirty(t.layer),t._viewContext=this,t._state={},t._state._bounds=hud.util.resetBounds(),t.hor=t.hor===y?y:t.hor,t.ver=t.ver===y?y:t.ver,t.dirty=!1,t.name&&this._initShapeImageData(t)},a.prototype._initShapeImageData=function(i){if(i.name){var t=hud.util.getImage(i.name);if(t){h.imageIterator(t,function(t){if(t.methods)for(var e in t.methods)i[e]===y&&(i[e]=t.methods[e]);i.drawBefore==y&&t.drawBefore&&(i.drawBefore=t.drawBefore),t.data&&hud.util.copy(i.data,t.data,{filter:function(t,e){hud.util.storeDynamicProps(e)},fieldFilter:function(t,e,i){if("_patternProps"===i||hud.util.isPattern(e[i]))return!0}}),hud.util.storeDynamicProps(t)})}else console.error("image is not exist, image = ",i.name," shape.id=",i.id," shape=",i)}},a.prototype._initShapeImage=function(e){if(e.name){var t=hud.util.getImage(e.name);if(t){var i=this;h.imageIterator(t,function(t){t.init&&t.init.call(e,i,t)})}else console.error("image is not exist, image = ",e.name," shape.id=",e.id," shape=",e)}},a.prototype._destroyShapeImage=function(e){if(e.name){var t=hud.util.getImage(e.name);if(t){var i=this;h.imageIterator(t,function(t){t.destroy&&t.destroy.call(e,i,t)})}else console.error("image is not exist, image = ",e.name," shape.id=",e.id," shape=",e)}},a.prototype.find=function(i){var a=Object.keys(i);return this.allShapes.filter(function(t){for(var e=0;e<a.length;e++)if(t[a[e]]!=i[a[e]])return!1;return!0})},a.prototype.batchAdd=function(t,e){var i,a=this;return i=t.map(function(t){a.add(t,!1)}),e&&this.dirty(),i},a.prototype._add=function(t){this.allShapes.push(t),this.allShapeMap[t.id]=t,this.emit({type:"add",shape:t})},a.prototype.add=function(t,e){if(this.allShapeMap[t.id]&&(console.error("shape id repeat, id=",t.id,"  old shape = ",this.allShapeMap[t.id],"new shape ",t),this.removeById(t.id)),t.cache,this.initShape(t),t._parent){var i=t._parent;t._parentHidden=!this.isVisible(i),i.children=i.children||[],i.children.push(t)}else this.shapes.push(t),this.shapeMap[t.id]=t;return e&&this.dirty(),t},a.prototype._remove=function(t){var e=this.allShapes.indexOf(t);this.allShapes.splice(e,1),delete this.allShapeMap[t.id],this.emit("remove",{shape:t})},a.prototype.remove=function(t){return this.removeById(t.id)},a.prototype.removeById=function(t,e){var i=this.allShapeMap[t];if(i){if(this._destroyShapeImage(i),i._parent){var a=i._parent.children,r=a.indexOf(i);0<=r&&r<=a.length-1&&a.splice(r,1)}if(i.children){var n=this;i.children.forEach(function(t){n.removeById(t.id,!0)})}if(this._remove(i),this.dirty(i),this.interactShapeMap[t]){var o=this.interactShapes.indexOf(i);this.interactShapes.splice(o,1),delete this.interactShapeMap[t]}if(!e){o=this.shapes.indexOf(i);this.shapes.splice(o,1),delete this.shapeMap[t]}}},a.prototype.clear=function(){var t=this.shapes.concat();return this.shapes=[],this.shapeMap={},this.allShapeMap={},this.interactShapes=[],this.interactShapeMap={},this.dirtyAllShape(),this.dirty(),t},a.prototype.getShapeState=function(t,e){var i=e||{};if(i.x=t.x,i.y=t.y,i.scaleX=t.scaleX,i.scaleY=t.scaleY,i.rotate=t.rotate,i.alpha=t.alpha,t._parent){e=t._parent._state;i.x=e.x+e.scaleX*i.x,i.y=e.y+e.scaleY*i.y,i.scaleX*=e.scaleX,i.scaleY*=e.scaleY,i.rotate+=e.rotate,i.alpha===y&&(i.alpha=e.alpha)}return i.x=Math.round(i.x),i.y=Math.round(i.y),i},a.prototype.getShapeAxisPos=function(t,e){var i={x:t.x,y:t.y};i.x=t.x||0,i.y=t.y||0;var a=this._state;if(i.x=i.x-a.x,i.y=i.y-a.y,i.x/=a.scaleX,i.y/=a.scaleY,e){var r=1,n=1,o=this.getShapeChain(e);o.push(e),o.forEach(function(t){i.x-=t.x*r,i.y-=t.y*n,r=t.scaleX,n=t.scaleY})}return i},a.prototype.getShapeChain=function(t){for(var e=[],i=t;i._parent;)e.push(i._parent),i=i._parent;return e.reverse(),e},a.prototype.ready=function(){this._ready=!0,this.dirty()},a.prototype.isReady=function(){return this._ready},a.prototype.dirty=function(t){if(this._ready&&("object"==typeof t&&(t=this.getLayer(t)),this.layerManager.dirty(t),this.autoDrawForDirty)){var e=this;this.lastTime=this.lastTime||0,hud.util.currentMilliseconds()-this.lastTime<30||(this.lastTime=hud.util.currentMilliseconds(),setTimeout(function(){e.draw()},40))}},a.prototype.shapeDirtyHandler=function(t){h.cacheShape(t,this),this._ready&&this.isVisible(t)&&this.dirtyShape(t)},a.prototype.dirtyShape=function(t){t.clip?this.dirtyClipShape(t):this.dirty(this.getLayer(t))},a.prototype.dirtyClipShape=function(t){this.layerManager.dirtyShape(t)},a.prototype.dirtyAllShape=function(){for(var t in this.allShapeMap){this.allShapeMap[t].dirty=!0}},a.prototype.registerImage=function(t,e,i){var a=this;hud.util.registerImage(t,hud.util.url(e),function(){a.dirtyAllShape(),a.dirty()})},a.prototype.getImage=function(t){return hud.util.getImage()},a.prototype.nextId=function(){return this._id=this._id||1,this._id++},a.prototype.loadFont=function(t,e){var i=this;"string"==typeof t&&(t=[t]);var a=t.length,r=0;t.forEach(function(t){hud.util.loadCss(hud.util.url(t),function(){i.dirtyAllShape(),a==++r&&(i.dirtyAllShape(),i.dirty())})})},a.prototype.loadComponent=function(t,e){"string"==typeof t&&(t=[t]);var i=t.length,a=0;t.forEach(function(t){hud.util.loadJs(hud.util.url("/js/component/"+t+".js"),function(){i==++a&&e&&e()})})},a.prototype.hitShapeAt=function(t,e,i,a){if(t._cacheImage){var r=t._cacheImage;i=i||10,a=a||.5;var n=t._state,o=e.x-n.x,s=e.y-n.y,h=hud.util.rotatePoint({x:o,y:s},-n.rotate);o=h.x,s=h.y,o=o/n.scaleX+t.tx,s=s/n.scaleY+t.ty;var l=t._bounds;if(!(o<0||s<0||o>l.w||s>l.h)){if("mouse-in"==t.hitType)return!0;for(var u=r.getContext("2d"),c=th=a+a,d=u.getImageData(o,s,c,th),p=d.data,y=0;y<p.length;y+=4){if(i<=d.data[y+3])return!0}}}},a.prototype.isShapeVisible=function(t){for(var e=t.visible,i=t;i._parent&&(i=i._parent,e=e&&i.visible););return e},a.prototype.isVisible=function(t){return!(t._parentHidden||!t.visible)},a.prototype.getShapeAt=function(t){var e=t;if(t instanceof MouseEvent){e={x:t.clientX+t.target.parentElement.scrollLeft,y:t.clientY+t.target.parentElement.scrollTop};var i=this._state;e.x=(e.x-i.x)/i.scaleX,e.y=(e.y-i.y)/i.scaleY}for(var a=this.interactShapes.length-1;0<=a;a--){var r=this.interactShapes[a];if(this.isVisible(r)&&this.hitShapeAt(r,e))return r}},a.prototype.shapeSelectedHandler=function(t){if(t.selectedGroup){var e=t.selectedGroup;this.selectedGroupMap[e]=this.selectedGroupMap[e]||{shapes:[]};var i=this.selectedGroupMap[e];if(i.shapes=i.shapes||[],t.selected)i.muilti?i.shapes.push(t):(i.shapes.forEach(function(t){t.selected=!1}),i.shapes=[t]);else if(i.muilti){var a=i.shapes.indexOf(t);0<=a&&a<=i.shapes.length-1&&i.shapes.splice(a,1)}}},a.prototype.loop=function(){};var r,c=function(t){this.easyDraw=t,this.view=t.view,this.isMouseMove=!0,this.autoShowBorder=!0,this.eventNames=["click","mousemove","mouseup","mousedown","dblclick"],hud.util.addAttr(this,"disabled"),this.init()};function d(){}c.prototype.init=function(){var n=this;this.eventNames.forEach(function(r){n.view.addEventListener(r,function(t){if(!n.disabled){var e=r+"_handler";if(n[e]){if(!n.isMouseMove&&"mousemove"==r)return;var i=n.parseEvent(t);if(n.mousedownShape&&"mousemove"==r)n[e](n.mousedownShape,i);else{var a=n.easyDraw.getShapeAt(i);a&&"mouseup"!=r&&(t.stopPropagation(),t.stop=!0),n[e](a,i)}}else console.log("no handler :"+e)}})}),this.autoShowBorder&&(n.easyDraw.on("m.*.mouseenter.interaction",function(t){n.view.style.cursor="pointer";var e=t.originSource;e.isShowBorder=!0,e.mousemoving=!0,n.easyDraw.dirtyShape(e)}),this.easyDraw.on("m.*.mouseleave.interaction",function(t){n.view.style.cursor="default";var e=t.originSource;e.isShowBorder=!1,delete e.mousemoving,n.easyDraw.dirtyShape(e)}))},c.prototype.parseEvent=function(t){return t.targetX=t.clientX+t.target.parentElement.scrollLeft,t.targetY=t.clientY+t.target.parentElement.scrollTop,t},c.prototype.click_handler=function(t,e){if(t?this.click(t,e):this.clickBackground(e),this.lastClickShape&&this.lastClickShape===t)return clearTimeout(this.clickTimerId),this.doubleClick(t,e),void delete this.lastClickShape;if(this.hasOwnProperty("lastClickShape")&&this.lastClickShape===t)return clearTimeout(this.clickTimerId),this.doubleClickBackground(e),void delete this.lastClickShape;this.lastClickShape=t;var i=this;this.clickTimerId=t?setTimeout(function(){i.singleClick(t,e),delete i.lastClickShape},300):setTimeout(function(){i.singleClickBackground(e),delete i.lastClickShape},300)},c.prototype.clickBackground=function(t){if(t.eventType="clickBackground",this.easyDraw.clickBackground&&this.easyDraw.clickBackground(t),this.easyDraw.emit(t),this.easyDraw.selectedGroupMap)for(var e in this.easyDraw.selectedGroupMap){var i=this.easyDraw.selectedGroupMap[e];if(!i||!1!==i.allowForEmpty)if(i.shapes)i.shapes.forEach(function(t){t.selected=!1}),delete i.shapes}},c.prototype.click=function(t,e){e.eventType="click",t.click&&t.click(e),t.emit(e)},c.prototype.singleClick=function(t,e){e.eventType="singleClick",t.singleClick&&t.singleClick(e),t.emit(e)},c.prototype.singleClickBackground=function(t){t.eventType="singleClickBackground",this.easyDraw.singleClickBackground&&this.easyDraw.singleClickBackground(t),this.easyDraw.emit(t)},c.prototype.doubleClickBackground=function(t){t.eventType="doubleClickBackground",this.easyDraw.doubleClickBackground&&this.easyDraw.doubleClickBackground(t),this.easyDraw.emit(t)},c.prototype.doubleClick=function(t,e){e.eventType="doubleClick",t.doubleClick&&t.doubleClick(e),t.emit(e)},c.prototype.mousemove_handler=function(t,e){var i=this.easyDraw._state;if(this.mousemoving=!0,this.mousedownShape){this.mousedownShape._dragBegin||(this.mousedownShape._dragBegin=!0,this.mousedownShape.dragging&&this.mousedownShape.dragging(e),e.eventType="dragging",t.emit(e)),this.easyDraw.autoDrawForDirty=!1;var a=e.targetX-this.lastPoint.x,r=e.targetY-this.lastPoint.y;return this.mousedownShape.x+=a/i.scaleX,this.mousedownShape.y+=r/i.scaleY,this.lastPoint={x:e.targetX,y:e.targetY},this.mousedownShape._dragBegin&&this.mousedownShape.dragging&&this.mousedownShape.dragging(e,a,r),this.easyDraw.autoDrawForDirty=!0,void this.easyDraw.draw()}this.lastEnterShape&&this.lastEnterShape!==t&&(this.mouseleave(this.lastEnterShape,e),delete this.lastEnterShape),!this.lastEnterShape&&t&&(this.mouseenter(t,e),this.lastEnterShape=t),t&&this.mousemove(t,e)},c.prototype.mousemove=function(t,e){t&&(t.mousemove&&t.mousemove(e),t.emit(e))},c.prototype.mouseenter=function(t,e){e.eventType="mouseenter",t&&(t.mouseenter&&t.mouseenter(e),t.emit(e))},c.prototype.mouseleave=function(t,e){e.eventType="mouseleave",t&&(t.mouseleave&&t.mouseleave(e),t.emit(e))},c.prototype.mousedown_handler=function(t,e){delete this.mousemoving,t&&(t.draggable&&(this.mousedownShape=t),this.lastPoint={x:e.targetX,y:e.targetY},this.selectedHandler(t,e),t.mousedown&&t.mousedown(e),t.emit(e))},c.prototype.mouseup_handler=function(t,e){if(delete this.mousemoving,this.mousedownShape){var i=this.mousedownShape;delete this.mousedownShape,i.draggingEnd&&i.draggingEnd(e)}t&&(t.mouseup&&t.mouseup(e),t.emit(e))},c.prototype.dblclick_handler=function(t,e){e.eventType="dblClick",t?(t.dblClick&&t.dblClick(e),t.emit(e)):this.dblClickBackground(e)},c.prototype.dblClickBackground=function(t){t.eventType="dblClickBackground",this.easyDraw.dblClickBackground&&this.easyDraw.dblClickBackground(t),this.easyDraw.emit(t)},c.prototype.selectedHandler=function(t,e){t.selectable&&!this.mousemoving&&(delete this.mousemoving,t.selectedGroup?t.selected?this.easyDraw.selectedGroupMap[t.selectedGroup]&&this.easyDraw.selectedGroupMap[t.selectedGroup].muilti&&(t.selected=!1):t.selected=!0:t.selected=!t.selected)},(r=d.prototype).load=function(t,e){return this.loadData(this.decode(t,e),e)},r.loadData=function(t,e){var i,a,r,n,o=this,s=[],h=function(t){i=isNaN(i)?t.x:Math.max(t.x,i),a=isNaN(a)?t.x:Math.min(t.x,a),r=isNaN(r)?t.y:Math.max(t.y,r),n=isNaN(n)?t.y:Math.min(t.y,n)};return t.features.forEach(function(t){if(e&&t.id!=e&&t.properties.name!=e)return!0;"MultiPolygon"===t.geometry.type?t.geometry.coordinates.forEach(function(t){t.forEach(function(t){t.forEach(function(t,e){var i=0!==e?"l":"m",a=o.convertPoint(t);h(a),a.c=i,s.push(a)})})}):"Polygon"===t.geometry.type?t.geometry.coordinates.forEach(function(t){t.forEach(function(t,e){var i=0!==e?"l":"m",a=o.convertPoint(t);h(a),a.c=i,s.push(a)})}):console.log(t.geometry.type)}),{bounds:{w:i-a,h:r-n,maxX:i,minX:a,maxY:r,minY:n},data:s}},r.convertPoint=function(t){return{x:100*(t[0]-117),y:100*(31.7-t[1])}},r.decode=function(t,e){if(!t.UTF8Encoding)return t;for(var i=t.features,a=0;a<i.length;a++)for(var r=i[a].geometry,n=r.coordinates,o=r.encodeOffsets,s=0;s<n.length;s++){var h=n[s];if("Polygon"===r.type)n[s]=this.decodePolygon(h,o[s]);else if("MultiPolygon"===r.type)for(var l=0;l<h.length;l++){var u=h[l];h[l]=this.decodePolygon(u,o[s][l])}}return t.UTF8Encoding=!1,t},r.decodePolygon=function(t,e){for(var i=[],a=e[0],r=e[1],n=0;n<t.length;n+=2){var o=t.charCodeAt(n)-64,s=t.charCodeAt(n+1)-64;o=o>>1^-(1&o),s=s>>1^-(1&s),a=o+=a,r=s+=r,i.push([o/1024,s/1024])}return i},(r=function(t,e){t=t||document.createElement("canvas"),this._canvas=t,this._opt=e||{baseColor:"rgb(255,255,255)"},e.canvasBounds||(e.canvasBounds={w:230,h:120})}.prototype).getImage=function(){if(this._drawn)return this._canvas.toDataURL()},r.getCanvas=function(){if(this._drawn)return this._canvas},r.getBounds=function(){if(this._drawn)return{width:this._canvas.width,height:this._canvas.height}},r.setScale=function(t){this.scale=t},r.loadMap=function(t,e){var i=(new d).load(t,e);this.scale=Math.min(this._opt.canvasBounds.w/i.bounds.w,this._opt.canvasBounds.h/i.bounds.h),this._canvas.width=i.bounds.w*this.scale,this._canvas.height=i.bounds.h*this.scale,this.draw(i)},r.draw=function(t){var e=this._canvas.getContext("2d"),i=t.bounds;e.save(),e.strokeStyle=this._opt.baseColor.colorRgba(.6);var a=-i.minX,r=-i.minY;e.scale(this.scale,this.scale),e.translate(a,r),this.drawPath(e,t.data),e.stroke(),e.fillStyle=this._opt.baseColor.colorRgba(.4),e.fill(),e.translate(-a,-r),e.restore(),this._drawn=!0},r.drawPath=function(t,e){t.beginPath();for(var i=0;i<e.length;i++){var a=e[i];switch(a.c){case"m":t.moveTo(a.x,a.y);break;case"l":t.lineTo(a.x,a.y);break;default:console.error("not support "+a.c)}}t.closePath()}}(window);