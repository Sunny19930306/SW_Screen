!function(q,Me){function v(S,e){function i(e){var t,i,r=T?new mono.BufferNode:new mono.Entity,a=e.buffers,n=a.index,o=a.position.data,s=a.normal&&a.normal.data,l=a.color&&a.color.data,h=a.uv&&a.uv.data,c=[],u=[],f=[],p={};if(p["m.specular"]=new mono.Color(11513775),p["m.type"]="phong",p["m.normalType"]=Se.NormalTypeSmooth,p["m.anisotropy"]=16,T)n&&(r.attributes.index={array:n}),Object.keys(a).forEach(function(e){if("index"!==e){var t=a[e],i=e;"weight"===e?i="skinWeight":"joint"===e?i="skinIndex":"position0"===e?i="morphTarget0":"position1"===e?i="morphTarget1":"normal0"===e?i="morphNormal0":"normal1"===e&&(i="morphNormal1"),r.attributes[i]={array:t.data,stride:t.stride,type:t.type}}}),r.computeNodeData(),r.computeBoundingBox(),r.computeBoundingSphere();else{for(t=0,i=o.length;t<i;t+=3)r.vertices.push(new mono.Vec3(o[t],o[t+1],o[t+2]));if(s)for(t=0,i=s.length;t<i;t+=3)u.push(new mono.Vec3(s[t],s[t+1],s[t+2]));if(h)for(t=0,i=h.length;t<i;t+=2)c.push(new mono.Vec2(h[t],h[t+1]));for(t=0,i=n.length;t<i;t+=3){var d=n[t],m=n[t+1],g=n[t+2],y=s?[u[d],u[m],u[g]]:null,v=l?[f[d],f[m],f[g]]:null,x=new mono.Face3(d,m,g,y,v);r.faces.push(x),h&&r.uvs.push([c[d],c[m],c[g]])}r.onSizeChanged()}if(null!=e.material){var A=S.materials[e.material];if(A.extensions&&A.extensions.KHR_materials_common){var _=A.extensions.KHR_materials_common.values;_.ambient.length&&0!==_.ambient[0]&&0!==_.ambient[1]&&0!==_.ambient[2]&&(p["m.ambient"]=(new mono.Color).setRGB(_.ambient)),_.diffuse.length?p["m.color"]=(new mono.Color).setRGB(_.diffuse):p["m.texture.image"]=P[_.diffuse.index].url,_.transparent&&(p["m.transparent"]=!0,p["m.opacity"]=_.transparency*_.diffuse[3]),_.specular.length&&(p["m.specular"]=(new mono.Color).setRGB(_.specular))}else{var w=A.pbrMetallicRoughness;if(w){w.baseColorFactor&&(v=(new mono.Color).setRGB(w.baseColorFactor),p["m.ambient"]=v,p["m.color"]=v);var b=w.baseColorTexture;b&&(p["m.texture.image"]=P[b.index].url)}var M=A.normalTexture;M&&(p["m.normalmap.image"]=P[M.index].url,M.scale)}}else v=(new mono.Color).setRGB([.5,.5,.5,1]),p["m.color"]=v,p["m.ambient"]=v;return r.s(p),r}var r=[],o=[],P=S.textures,T=e&&e.bufferNode,n=T?new mono.BufferNode:new mono.Entity;return S.meshes.forEach(function(e){var t;1<e.primitives.length?(t=T?new mono.BufferNode:new mono.Entity,e.primitives.forEach(function(e){t.addChild(i(e))})):t=i(e.primitives[0]),r.push(t)}),S.nodes.forEach(function(e){var t,i=(t=null!=e.mesh?r[e.mesh]:T?new mono.BufferNode:new mono.Entity)._info={};e.rotation&&(i.rotation=new mono.Quat(e.rotation)),e.translation&&(i.translation=new mono.Vec3(e.translation)),e.scale&&(i.scale=new mono.Vec3(e.scale)),e.weights&&(i.weights=e.weights,t.setStyle("m.morphTargets",!0)),e.matrix&&t.setMatrix(e.matrix),e.skin&&(t._skin=e.skin,t.setStyle("m.skinning",!0),t.setStyle("m.maxBones",t._skin.joints.length)),o.push(t)}),S.scenes.forEach(function(e){e.nodes.forEach(function(e){!function t(e,i){var r=o[e],a=S.nodes[e];i?r.setParent(i):r.setParent(n),a.children&&a.children.forEach(function(e){t(e,r)})}(e)})}),o.forEach(function(e){if(e._skin){var r=e._skin;r.node=e,r.inverseBindMatrices;for(var t=r.joints=r.joints.map(function(e){return o[e]}),i=r.jointMatrixs=new Array(t.length),a=r.jointMatrix=new Float32Array(16*t.length),n=0;n<t.length;n++)i[n]=new Float32Array(a.buffer,16*n*4,16);r._jointMat=new mono.Mat4,r._inverseBindMat=new mono.Mat4,r.update=function(){var i=this;i.joints.forEach(function(e,t){r._jointMat.elements=i.jointMatrixs[t],r._inverseBindMat.elements=i.inverseBindMatrices[t],r._jointMat.multiplyMatrices(e.worldMatrix,r._inverseBindMat)})},r.update()}}),S.animations.forEach(function(t){t.channels.forEach(function(e){e.node=o[e.node],e.node._animation=t})}),n}function r(){var A,_,i={onModuleLoaded:function(){_=Date.now()-_,postMessage("init")}};self.onmessage=function(e){var t=e.data;switch(t.type){case"init":"object"==typeof WebAssembly?(_=Date.now(),importScripts(t.path+"draco_wasm_wrapper_gltf.js"),fetch(t.path+"draco_decoder_gltf.wasm").then(function(e){return e.arrayBuffer()}).then(function(e){i.wasmBinary=e,A=DracoDecoderModule(i)})):(importScripts(t.path+"draco_decoder_gltf.js"),postMessage("init"));break;case"decode":!function(s,e,t){var i=Date.now(),r=new A.DecoderBuffer;r.Init(e,e.length);var l,a,h=new A.Decoder,n=h.GetEncodedGeometryType(r);if(n===A.TRIANGULAR_MESH?(l=new A.Mesh,a=h.DecodeBufferToMesh(r,l)):(l=new A.PointCloud,a=h.DecodeBufferToPointCloud(r,l)),!a.ok()||0===a.ptr)return A.destroy(r),A.destroy(h),A.destroy(l),postMessage({error:"Draco decode error: "+a.error_msg()});A.destroy(r);var o=0;n===A.TRIANGULAR_MESH&&(o=l.num_faces());var c,u,f=l.num_points(),p={},d=[];if(Object.keys(s).forEach(function(e){var t=h.GetAttributeByUniqueId(l,s[e]);"POSITION"===e&&(c=t);var i=t.num_components(),r=f*i,a=p[e]=new Float32Array(r);d.push(a.buffer);var n=new A.DracoFloat32Array;h.GetAttributeFloatForAllPoints(l,t,n);for(var o=0;o<r;o++)a[o]=n.GetValue(o);A.destroy(n)}),n===A.TRIANGULAR_MESH){var m=new A.DracoInt32Array;if("TRIANGLE_STRIP"===t)for(u=new((g=h.GetTriangleStripsFromMesh(l,m))<=256?Uint8Array:g<=65536?Uint16Array:Uint32Array)(g),d.push(u.buffer),y=0;y<g;++y)u[y]=m.GetValue(y);else{var g=3*o;u=new(g<=256?Uint8Array:g<=65536?Uint16Array:Uint32Array)(g),d.push(u.buffer);for(var y=0;y<o;++y){h.GetFaceFromMesh(l,y,m);var v=3*y;u[v]=m.GetValue(0),u[v+1]=m.GetValue(1),u[v+2]=m.GetValue(2)}}A.destroy(m)}var x=new A.AttributeQuantizationTransform;x.InitFromAttribute(c)&&console.log("AttributeQuantizationTransform",x.range(),x.quantization_bits(),x.min_value(0),x.min_value(1),x.min_value(2)),A.destroy(x),A.destroy(h),A.destroy(l),postMessage({time:Date.now()-i,initTime:_,datas:p,indices:u},d)}(t.attributes,t.encodedData,t.mode)}}}function x(e,t,i){var r=new XMLHttpRequest;t&&(r.responseType=t),r.onreadystatechange=function(e){4===this.readyState&&(200===this.status?i(r.response):i(null,this.responseURL+" "+this.statusText))},r.open("get",e),r.send()}function m(e,t,i){var r;return"fragment"===e?r=i.createShader(i.FRAGMENT_SHADER):"vertex"===e&&(r=i.createShader(i.VERTEX_SHADER)),i.shaderSource(r,t),i.compileShader(r),i.getShaderParameter(r,i.COMPILE_STATUS)||i.isContextLost()?r:(console.log(i.getShaderInfoLog(r)),console.error(t),null)}function G(e,t,i,r){e[t]=i.r*r,e[t+1]=i.g*r,e[t+2]=i.b*r}function Y(e,t,i,r){e[t]=i.r*i.r*r,e[t+1]=i.g*i.g*r,e[t+2]=i.b*i.b*r}function o(e){var r=e,a=r._canvas;je.isNaN(r._renderInterval)&&(r._renderInterval=10),r.__timeOutFunc||(r.__timeOutFunc=function(e){var t=r._vrDisplay;if(r._animateId=(t&&t.isPresenting?t:q).requestAnimationFrame(r.__timeOutFunc),r._isPresenting){var i=r._camera;i.updateProjectionMatrix(),i.worldMatrix=i.leftVm,i.worldMatrixInverse=i.leftVmInverse,i.projectionMatrix=i.leftPm,r._gl.viewport(0,0,.5*a.width,a.height),r._dirty=!0,Ze.clear(!0,r.autoClearDepth,r.autoClearStencil,r),r.render(e),i.worldMatrix=i.rightVm,i.worldMatrixInverse=i.rightVmInverse,i.projectionMatrix=i.rightPm,r._gl.viewport(.5*a.width,0,.5*a.width,a.height),Ze.clear(!1,r.autoClearDepth,r.autoClearStencil,r),r.innerRender(i,!0),r.extendRender(i),t.submitFrame(),r._dirty=!0,i.projectionMatrix.makePerspective(r._oldCamera.fov,a.width/a.height,i.near,i.far),r._gl.viewport(0,0,a.width,a.height),Ze.clear(!0,r.autoClearDepth,r.autoClearStencil,r),r.innerRender(i,!0),r.extendRender(i)}else r.render(e)}),setTimeout(r.__timeOutFunc,r._renderInterval)}function A(e,t,i){null!=e&&("number"==typeof e?this.fromNumber(e,t,i):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function _(){return new A(null)}function l(e){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e)}function h(e,t){var i=lt[e.charCodeAt(t)];return null==i?-1:i}function g(e){var t=_();return t.fromInt(e),t}function w(e){var t,i=1;return 0!=(t=e>>>16)&&(e=t,i+=16),0!=(t=e>>8)&&(e=t,i+=8),0!=(t=e>>4)&&(e=t,i+=4),0!=(t=e>>2)&&(e=t,i+=2),0!=(t=e>>1)&&(e=t,i+=1),i}function y(e){this.m=e}function M(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function n(e,t){return e&t}function f(e,t){return e|t}function p(e,t){return e^t}function d(e,t){return e&~t}function t(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function S(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function P(){}function e(e){return e}function T(e){this.r2=_(),this.q3=_(),A.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function C(){this.i=0,this.j=0,this.S=new Array}function E(){var e;e=(new Date).getTime(),ft[pt++]^=255&e,ft[pt++]^=e>>8&255,ft[pt++]^=e>>16&255,ft[pt++]^=e>>24&255,dt<=pt&&(pt-=dt)}function z(){if(null==ut){for(E(),(ut=new C).init(ft),pt=0;pt<ft.length;++pt)ft[pt]=0;pt=0}return ut.next()}function D(){}function L(e,t){return new A(e,t)}function R(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function N(e,t){return e.distance-t.distance}function B(e,t,i,r,a){(e instanceof Se.Node||e instanceof Se.Billboard)&&function e(t,i,r,a,n){if(a||0!=n.isVisible(t)){if(t instanceof Se.Billboard){var o=i.matrixPosition;o.setFromMatrixPosition(t.worldMatrix);var s=i.ray.distanceToPoint(o),l=t.material.alignment,h=new Se.Plane(1,1);(l.x||l.y)&&(h.setPosition(l.x,l.y,0),h=Se.Utils.transformElement(h,!0)),h.setPosition(o);var c=(new Q).getScaleFromMatrix(t.worldMatrix);h.setScale(c.x,c.y,1);var u=i.direction.clone(),f=h.getPosition().clone(),p=t.material;p&&p.vertical&&(u.y=0),f.sub(u),h.lookAt(f),h.updateWorldMatrix(!0);var d=[];return e(h,i,d,!0,n),0===d.length||r.push({distance:d[0].distance,point:t._position,face:null,object:t,element:t}),r}if(t instanceof Se.Line){1;var m=(z=Math.sqrt(i.linePrecision+0))*z;if(null==(S=t).boundingSphere&&S.computeBoundingSphere(),jt.copy(S.boundingSphere),jt.applyMatrix4(t.worldMatrix),!1===i.ray.isIntersectionSphere(jt))return r;Gt.getInverse(t.worldMatrix),Xt.copy(i.ray).transform(Gt);for(var g=(P=S.vertices).length,y=new Q,v=new Q,x=t.type===Se.LineStrip?1:2,A=0;A<g-1;A+=x)Xt.distanceSqToSegment(P[A],P[A+1],v,y)>m||(s=Xt.origin.distanceTo(v))<i.near||s>i.far||r.push({distance:s,point:y.clone().applyMatrix4(t.worldMatrix),face:null,faceIndex:null,element:t,object:t});return r}if(null===t.boundingSphere&&t.computeBoundingSphere(),jt.set(t.worldMatrix.getPosition(),t.boundingSphere.radius*t.worldMatrix.getMaxScaleOnAxis()),!i.ray.isIntersectionSphere(jt))return r;var _,w,b,M,S=t,P=S.vertices,T=t.material instanceof Se.ArrayMaterial,C=!0===T?t.material.materials:null,E=t.material.side,z=i.precision;t.rotationWorldMatrix.extractRotation(t.worldMatrix),Gt.getInverse(t.worldMatrix),Xt.copy(i.ray).transform(Gt);for(var D=0,L=S.faces.length;D<L;D++){var R=S.faces[D],N=!0===T?C[R.materialIndex]:t.material,B=n.getOverLoadMaterial(t,N);if(B&&(N=B),N!==Me&&!1!==N.visible&&(!1!==S.visible||a)&&(!N.transparent||0!=N.opacity)){Yt.setFromNormalAndCoplanarPoint(R.normal,P[R.a]);var I=Xt.distanceToPlane(Yt);if(!(Math.abs(I)<z||I<0)){E=N.side;var F=Xt.direction.dot(Yt.normal);if((E===Se.DoubleSide||(E===Se.FrontSide?F<0:0<F))&&!(I<i.near||I>i.far)){Wt=Xt.at(I,Wt);var V,U=new Q,k=(R.materialIndex,!1);if(n&&0<n._selectTransparencyThreshold&&(k=1==N.transparent||0<N.alphaTest),R instanceof Se.Face3){if(_=P[R.a],w=P[R.b],b=P[R.c],!Se.Triangle.containsPoint(Wt,_,w,b))continue;U=Se.Triangle.barycoordFromPoint(Wt,_,w,b)}else{if(!(R instanceof Se.Face4))throw Error("face type not supported");_=P[R.a],w=P[R.b],b=P[R.c],M=P[R.d];var O=Se.Triangle.containsPoint(Wt,_,w,M),X=Se.Triangle.containsPoint(Wt,w,b,M);if(!O&&!X)continue;O?U=Se.Triangle.barycoordFromPoint(Wt,_,w,M):(U=Se.Triangle.barycoordFromPoint(Wt,w,b,M),V=!0)}var G=new pe,Y=U.z,W=U.x,j=U.y;if(S.uvs&&S.uvs[D]){var H=S.uvs[D];R instanceof Se.Face3?(G.x=H[0].x*W+H[1].x*j+H[2].x*Y,G.y=H[0].y*W+H[1].y*j+H[2].y*Y):V?(G.x=H[1].x*W+H[2].x*j+H[3].x*Y,G.y=H[1].y*W+H[2].y*j+H[3].y*Y):(G.x=H[0].x*W+H[1].x*j+H[3].x*Y,G.y=H[0].y*W+H[1].y*j+H[3].y*Y)}var q,Z=1;if(G=n.debugUV||G,k){if(N.opacity<n._selectTransparencyThreshold)continue;null==N.map?Z=N.opacity:n._pickingTexturePixel&&(q=N.map._image,Z=je.getPixelFromImage(q,G.x,G.y)[3]/255*(null==N.opacity?1:N.opacity)),Z<N.alphaTest?Z=0:0==N.transparent&&(Z=1)}Z<n._selectTransparencyThreshold||r.push({distance:I,point:i.ray.at(I),face:R,uv:G,faceIndex:D,element:t,object:t,side:0<F?1:-1})}}}}}}(e,t,i,r,a)}function I(e,t,i,r,a){if(e!==Me)for(var n=e.getDescendants(),o=0,s=n.length;o<s;o++)B(n[o],t,i,r,a)}function F(e){if(!Jt[e.id]){var t;if(ei=!0,(Jt[e.id]=e).finish=null==e.finish?e.delay+e.dur+e.interval:e.finish,null==e.from&&e.attr&&e.source)(t=e.attr.match(/^S[:@](.*)/i))?e.from=e.source.getStyle(t[1]):(t=e.attr.match(/^C[:@](.*)/i))?e.from=e.source.getClient(t[1]):e.from=mono.getValue(e.source,e.attr);r=(i=e).type,a=i.from,n=i.to,"number"===r?(i.from=a||0,i.to=n||0):"point"===r?(a?a.length&&(i.from={x:a[0],y:a[1]}):i.from="scale"===i.attr?{x:1,y:1}:{x:0,y:0},n?n.length&&(i.to={x:n[0],y:n[1]}):i.to="scale"===i.attr?{x:1,y:1}:{x:0,y:0}):"rect"===r?(a?a.length&&(i.from={x:a[0],y:a[1],w:a[2],h:a[3]}):i.from={x:0,y:0,w:0,h:0},n?n.length&&(i.to={x:n[0],y:n[1],w:n[2],h:n[3]}):i.to={x:0,y:0,w:0,h:0}):"color"===r&&(i.from=getColorValue(a),i.to=getColorValue(n)),i.current=i.from,V(e)}var i,r,a,n;return e}function V(e){var t=e.type,i=e.from,r=e.to;"number"===t?e.delta=r-i:"point"===t?e.delta={x:r.x-i.x,y:r.y-i.y}:"rect"===t?e.delta={x:r.x-i.x,y:r.y-i.y,w:r.w-i.w,h:r.h-i.h}:"color"===t&&(e.delta={r:r.r-i.r,g:r.g-i.g,b:r.b-i.b,a:r.a-i.a})}function U(e,t){return Jt[e.id]&&(null==t&&(t=!0),t&&O(e,e.to),e.onStop&&e.onStop(),e.time=0,e.total=0,e.start=null,e.count=0,e.started=!1,e.stopped=!1,delete Jt[e.id]),e}function k(f){Object.keys(Jt).forEach(function(e){var t,i,r,a,n,o,s,l,h=Jt[e];if(h){if(null==h.start&&(h.start=f),h.total=f-h.start,h.total>h.delay){h.time=h.total-h.delay;var c=!1;if(h.time>=h.dur&&(h.time=h.dur,c=!0),!h.stopped&&O(h,(r=(t=h).type,a=t.delta,n=t.from,o=t.time,s=t.dur,(l=ve[t.easing||"easeNone"])||(l=ve.easeNone),"number"===r?i=l(o,n,a,s):"point"===r?i={x:l(o,n.x,a.x,s),y:l(o,n.y,a.y,s)}:"rect"===r?i={x:l(o,n.x,a.x,s),y:l(o,n.y,a.y,s),w:l(o,n.w,a.w,s),h:l(o,n.h,a.h,s)}:"color"===r?i="rgba("+Math.floor(l(o,n.r,a.r,s))+","+Math.floor(l(o,n.g,a.g,s))+","+Math.floor(l(o,n.b,a.b,s))+","+Math.floor(l(o,n.a,a.a,s))+")":"set"===r?t.time&&(i=t.to):"group_set"===r&&(i=t.to[t.groupIndex]),t.current=i)),h.stopped=c,h.total>=h.finish)if(++h.count>=h.repeat)U(h,!1),h.onDone&&h.onDone();else if(h.time=0,h.total=0,h.start=null,h.stopped=!1,h.reverse){var u=h.from;h.from=h.to,h.to=u,V(h)}}!ei&&(ei=!0)}})}function O(e,t){var i;(e.started||(e.started=!0,e.onPlay&&e.onPlay()),e.filter&&(t=e.filter(t)),e.attr&&e.source)&&((i=e.attr.match(/^S[:@](.*)/i))?e.source.setStyle(i[1],t):(i=e.attr.match(/^C[:@](.*)/i))?e.source.setClient(i[1],t):mono.setValue(e.source,e.attr,t));e.onUpdate&&e.onUpdate(t)}self.Int32Array=self.Int32Array||Array,self.Float32Array=self.Float32Array||Array,Number.isNaN||(Number.isNaN=function(e){return"number"==typeof e&&isNaN(e)}),Object.create=Object.create||function(e){var t=function(){};return t.prototype=e,new t},String.prototype.includes||(String.prototype.includes=function(e,t){return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)});var X,W,H,Z,Se={version:"2.6.8",_id:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],id:function(e){e=null==e?"":e;for(var t=[],i=0;i<32;i++)t[i]=this._id[Math.floor(16*Math.random())];return t[12]="4",t[16]=this._id[3&t[16]|8],e+t.join("")},ip:function(e,i,t,r){var a=t+i;e[Se.getter(i,r)]=function(){return this[a]},e[Se.setter(i)]=function(e){var t=this[a];t!==e&&(this.setPropertyValue?this.setPropertyValue(a,e)&&(this.onPropertyChange(i,t,e),this.firePropertyChange(i,t,e)):(this[a]=e,this.onPropertyChange(i,t,e),this.firePropertyChange(i,t,e)))}},getter:function(e,t){var i=e.charAt(0).toUpperCase()+e.slice(1),r=/ble$/.test(e)||/ed$/.test(e)?"is":"get";return t&&-1!=t.indexOf(e)&&(r="is"),r+i},setter:function(e){return"set"+(e.charAt(0).toUpperCase()+e.slice(1))},getValue:function(e,t,i){var r=t.charAt(0).toUpperCase()+t.slice(1),a="get"+r,n="is"+r;return i?"boolean"===i?e[n]():(null==e[a]&&console.log("get Function "+a+" not exist"),e[a]()):e[a]?e[a]():e[n]?e[n]():e[t]},setValue:function(e,t,i){e["set"+t.charAt(0).toUpperCase()+t.slice(1)](i)},clone:function(e){if(!e)return null;var t={};for(var i in e)t[i]=e[i];return t},addMethod:function(e,t){var i=e.prototype;for(var r in t)i[r]=t[r]},classCache:{},getClass:function(e){var t=Se.classCache[e];if(!t){var i=e.split("."),r=i.length;t=q;for(var a=0;a<r;a++)t=t[i[a]];Se.classCache[e]=t}return t},newInstance:function(e){"string"==typeof e&&(e=(e=Se.getClass(e)).prototype);var t=e.constructor;if(!t)return null;var i=arguments.length,r=arguments;if(1===i)return new t;if(2===i)return new t(r[1]);if(3===i)return new t(r[1],r[2]);if(4===i)return new t(r[1],r[2],r[3]);if(5===i)return new t(r[1],r[2],r[3],r[4]);if(6===i)return new t(r[1],r[2],r[3],r[4],r[5]);if(7===i)return new t(r[1],r[2],r[3],r[4],r[5],r[6]);if(8===i)return new t(r[1],r[2],r[3],r[4],r[5],r[6],r[7]);throw"don't support args more than 7"},xml:function(e){if(q.DOMParser)return(new DOMParser).parseFromString(e,"text/xml");var t=new ActiveXObject("Microsoft.XmlDOM");return t.async=!1,t.loadXml(e),t}};"function"==typeof define?define(function(){return Se}):"object"==typeof exports&&(module.exports=Se),q&&(q.TGL=q.mono=Se),Se.extend=function(e,t,i){if(t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,(e.prototype.constructor=e).superClass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t)}var a=e.prototype;if(i){for(var n in a.getClassName=function(){return i.className},i){if("__accessor"===n)for(var o=i.__accessor,s=i.__bool,l=0;l<o.length;l++)h=o[l],Se.ip(a,h,"",s);else if("___accessor"===n)for(o=i.___accessor,l=0;l<o.length;l++){var h=o[l];Se.ip(a,h,"_",s)}a[n]=i[n]}i.constructor&&(a.newInstance=function(){return Se.newInstance(this)})}},Se.defaultEulerOrder="XYZ",String.prototype.startsWith=String.prototype.startsWith||function(e){return this.slice(0,e.length)===e},String.prototype.endsWith=String.prototype.endsWith||function(e){var t=String(e),i=this.lastIndexOf(t);return(-1<i&&i)===this.length-t.length},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},function(){for(var n=0,e=["ms","moz","webkit","o"],t=0;t<e.length&&!q.requestAnimationFrame;++t)q.requestAnimationFrame=q[e[t]+"RequestAnimationFrame"],q.cancelAnimationFrame=q[e[t]+"CancelAnimationFrame"]||q[e[t]+"CancelRequestAnimationFrame"];q.requestAnimationFrame===Me&&(q.requestAnimationFrame=function(e,t){var i=Date.now(),r=Math.max(0,16-(i-n)),a=q.setTimeout(function(){e(i+r)},r);return n=i+r,a}),q.cancelAnimationFrame=q.cancelAnimationFrame||function(e){q.clearTimeout(e)}}(),Se.CullFaceNone=0,Se.CullFaceBack=1,Se.CullFaceFront=2,Se.CullFaceFrontBack=3,Se.FrontFaceDirectionCW=0,Se.FrontFaceDirectionCCW=1,Se.BasicShadowMap=0,Se.PCFShadowMap=1,Se.PCFSoftShadowMap=2,Se.FrontSide="front",Se.BackSide="back",Se.DoubleSide="both",Se.BothSide="both",Se.NoShading=0,Se.FlatShading=1,Se.SmoothShading=2,Se.NormalTypeFlat="flat",Se.NormalTypeSmooth="smooth",Se.NoColors=0,Se.FaceColors=1,Se.VertexColors=2,Se.GradientColors=3,Se.NoBlending=0,Se.NormalBlending=1,Se.AdditiveBlending=2,Se.SubtractiveBlending=3,Se.MultiplyBlending=4,Se.CustomBlending=5,Se.AddEquation=100,Se.SubtractEquation=101,Se.ReverseSubtractEquation=102,Se.ZeroFactor=200,Se.OneFactor=201,Se.SrcColorFactor=202,Se.OneMinusSrcColorFactor=203,Se.SrcAlphaFactor=204,Se.OneMinusSrcAlphaFactor=205,Se.DstAlphaFactor=206,Se.OneMinusDstAlphaFactor=207,Se.DstColorFactor=208,Se.OneMinusDstColorFactor=209,Se.SrcAlphaSaturateFactor=210,Se.MultiplyOperation=0,Se.MixOperation=1,Se.AddOperation=2,Se.UVMapping=function(){},Se.CubeReflectionMapping=function(){},Se.CubeRefractionMapping=function(){},Se.SphericalReflectionMapping=function(){},Se.SphericalRefractionMapping=function(){},Se.RepeatWrapping="repeat",Se.ClampToEdgeWrapping="clamp",Se.MirroredRepeatWrapping="mirrored",Se.NearestFilter=1003,Se.NearestMipMapNearestFilter=1004,Se.NearestMipMapLinearFilter=1005,Se.LinearFilter=1006,Se.LinearMipMapNearestFilter=1007,Se.LinearMipMapLinearFilter=1008,Se.UnsignedByteType=1009,Se.ByteType=1010,Se.ShortType=1011,Se.UnsignedShortType=1012,Se.IntType=1013,Se.UnsignedIntType=1014,Se.FloatType=1015,Se.UnsignedShort4444Type=1016,Se.UnsignedShort5551Type=1017,Se.UnsignedShort565Type=1018,Se.AlphaFormat=1019,Se.RGBFormat=1020,Se.RGBAFormat=1021,Se.LuminanceFormat=1022,Se.LuminanceAlphaFormat=1023,Se.RGB_S3TC_DXT1_Format=2001,Se.RGBA_S3TC_DXT1_Format=2002,Se.RGBA_S3TC_DXT3_Format=2003,Se.RGBA_S3TC_DXT5_Format=2004,Se.Gradient_Linear_U=1,Se.Gradient_Linear_V=2,Se.Gradient_Linear_UV=3,Se.Gradient_Linear_NUV=4,Se.Gradient_Radial=5,Se.Gradient_Sweep=6,Se.Math={clamp:function(e,t,i){return e<t?t:i<e?i:e},isConcave:function(e,t,i){var r=i?1:-1;return(e.x*t.y-t.x*e.y)*r<0},area:function(e,t,i,r){var a=r?1:-1;return e&&t&&i?(-e.x*t.y-t.x*i.y-i.x*e.y+i.x*t.y+t.x*e.y+e.x*i.y)*a:Me},isClockwise:function(e,t,i){t=t||"x",i=i||"y";for(var r=0,a=e.length,n=0;n<a;n++){var o=e[n],s=e[n+1===a?0:n+1];r+=(s[t]-o[t])*(s[i]+o[i])}return r<0},isClockwise3:function(e,t,i){(new mono.Vec3).crossVectors(e,t),(new mono.Vec3).subVectors(t,e),(new mono.Vec3).subVectors(t,e)},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,i,r,a){return r+(e-t)*(a-r)/(i-t)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:0<e?1:0},degToRad:function(e){return e*Se.Math.__d2r},radToDeg:function(e){return e*Se.Math.__r2d},smoothstep:function(e,t,i){return e<=t?0:i<=e?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:i<=e?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},PI2:2*Math.PI,generateUUID:(W="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),H=new Array(36),Z=0,function(){for(var e=0;e<36;e++)8==e||13==e||18==e||23==e?H[e]="-":14==e?H[e]="4":(Z<=2&&(Z=33554432+16777216*Math.random()|0),X=15&Z,Z>>=4,H[e]=W[19==e?3&X|8:X]);return H.join("")})},Se.Math.__d2r=Math.PI/180,Se.Math.__r2d=180/Math.PI,Se.Quat=function(e,t,i,r){1===arguments.length&&(r=e[3],i=e[2],t=e[1],e=e[0]),this.x=e||0,this.y=t||0,this.z=i||0,this.w=r!==Me?r:1},Se.Quat.prototype={constructor:Se.Quat,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e,t){var i=Math.cos(e.x/2),r=Math.cos(e.y/2),a=Math.cos(e.z/2),n=Math.sin(e.x/2),o=Math.sin(e.y/2),s=Math.sin(e.z/2);return t===Me||"XYZ"===t?(this.x=n*r*a+i*o*s,this.y=i*o*a-n*r*s,this.z=i*r*s+n*o*a,this.w=i*r*a-n*o*s):"YXZ"===t?(this.x=n*r*a+i*o*s,this.y=i*o*a-n*r*s,this.z=i*r*s-n*o*a,this.w=i*r*a+n*o*s):"ZXY"===t?(this.x=n*r*a-i*o*s,this.y=i*o*a+n*r*s,this.z=i*r*s+n*o*a,this.w=i*r*a-n*o*s):"ZYX"===t?(this.x=n*r*a-i*o*s,this.y=i*o*a+n*r*s,this.z=i*r*s-n*o*a,this.w=i*r*a+n*o*s):"YZX"===t?(this.x=n*r*a+i*o*s,this.y=i*o*a+n*r*s,this.z=i*r*s-n*o*a,this.w=i*r*a-n*o*s):"XZY"===t&&(this.x=n*r*a-i*o*s,this.y=i*o*a-n*r*s,this.z=i*r*s+n*o*a,this.w=i*r*a+n*o*s),this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(i),this},setFromRotationMatrix:function(e){var t,i=e.elements,r=i[0],a=i[4],n=i[8],o=i[1],s=i[5],l=i[9],h=i[2],c=i[6],u=i[10],f=r+s+u;return 0<f?(t=.5/Math.sqrt(f+1),this.w=.25/t,this.x=(c-l)*t,this.y=(n-h)*t,this.z=(o-a)*t):s<r&&u<r?(t=2*Math.sqrt(1+r-s-u),this.w=(c-l)/t,this.x=.25*t,this.y=(a+o)/t,this.z=(n+h)/t):u<s?(t=2*Math.sqrt(1+s-r-u),this.w=(n-h)/t,this.x=(a+o)/t,this.y=.25*t,this.z=(l+c)/t):(t=2*Math.sqrt(1+u-r-s),this.w=(o-a)/t,this.x=(n+h)/t,this.y=(l+c)/t,this.z=.25*t),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=this.length();return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},multiply:function(e){return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e.x,r=e.y,a=e.z,n=e.w,o=t.x,s=t.y,l=t.z,h=t.w;return this.x=i*h+n*o+r*l-a*s,this.y=r*h+n*s+a*o-i*l,this.z=a*h+n*l+i*s-r*o,this.w=n*h-i*o-r*s-a*l,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quat's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( Quat ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var i=this.x,r=this.y,a=this.z,n=this.w,o=n*e.w+i*e.x+r*e.y+a*e.z;if(o<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,o=-o):this.copy(e),1<=o)return this.w=n,this.x=i,this.y=r,this.z=a,this;var s=Math.acos(o),l=Math.sqrt(1-o*o);if(Math.abs(l)<.001)return this.w=.5*(n+this.w),this.x=.5*(i+this.x),this.y=.5*(r+this.y),this.z=.5*(a+this.z),this;var h=Math.sin((1-t)*s)/l,c=Math.sin(t*s)/l;return this.w=n*h+this.w*c,this.x=i*h+this.x*c,this.y=r*h+this.y*c,this.z=a*h+this.z*c,this},toEuler:function(){var e=this.w*this.w,t=this.x*this.x,i=this.y*this.y,r=this.z*this.z;return[180/Math.PI*Math.atan2(2*(this.y*this.z+this.x*this.w),-t-i+r+e),180/Math.PI*Math.asin(-2*(this.x*this.z-this.y*this.w)),180/Math.PI*Math.atan2(2*(this.x*this.y+this.z*this.w),t-i-r+e)]},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},clone:function(){return new Se.Quat(this.x,this.y,this.z,this.w)}},Se.Quat.slerp=function(e,t,i,r){return i.copy(e).slerp(t,r)};var pe=function(e,t){this.x=e||0,this.y=t||0};pe.prototype={constructor:pe,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e){return this.x+=e.x,this.y+=e.y,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e){return this.x-=e.x,this.y-=e.y,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e):this.set(0,0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return null!=e&&e.x===this.x&&e.y===this.y},clone:function(){return new pe(this.x,this.y)}},Se.Vec2=pe;var Q=function(e,t,i){1===arguments.length&&(i=e[2],t=e[1],e=e[0]),this.x=parseFloat(e)||0,this.y=parseFloat(t)||0,this.z=parseFloat(i)||0};(Se.Vec3=Q).prototype={set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},center:function(e,t){return this.x=(e.x+t.x)/2,this.y=(e.y+t.y)/2,this.z=(e.z+t.z)/2,this},copy:function(e){return null!=this&&null!=e||console.log("TGL.Vec3.copy this : "+this+" v : "+e),this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[3]*i+a[6]*r,this.y=a[1]*t+a[4]*i+a[7]*r,this.z=a[2]*t+a[5]*i+a[8]*r,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,a=e.elements,n=1/(a[3]*t+a[7]*i+a[11]*r+a[15]);return this.x=(a[0]*t+a[4]*i+a[8]*r+a[12])*n,this.y=(a[1]*t+a[5]*i+a[9]*r+a[13])*n,this.z=(a[2]*t+a[6]*i+a[10]*r+a[14])*n,this},applyProjection:function(e){var t=this.x,i=this.y,r=this.z,a=e.elements,n=1/(a[3]*t+a[7]*i+a[11]*r+a[15]);return this.x=(a[0]*t+a[4]*i+a[8]*r+a[12])*n,this.y=(a[1]*t+a[5]*i+a[9]*r+a[13])*n,this.z=(a[2]*t+a[6]*i+a[10]*r+a[14])*n,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,a=e.x,n=e.y,o=e.z,s=e.w,l=s*t+n*r-o*i,h=s*i+o*t-a*r,c=s*r+a*i-n*t,u=-a*t-n*i-o*r;return this.x=l*s+u*-a+h*-o-c*-n,this.y=h*s+u*-n+c*-a-l*-o,this.z=c*s+u*-o+l*-n-h*-a,this},applyEuler:function(e,t){var i=Q.__q1.setFromEuler(e,t);return this.applyQuaternion(i),this},applyAxisAngle:function(e,t){var i=Q.__q1.setFromAxisAngle(e,t);return this.applyQuaternion(i),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e):(this.x=0,this.y=0,this.z=0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this},cross:function(e){var t=this.x,i=this.y,r=this.z;return this.x=i*e.z-r*e.y,this.y=r*e.x-t*e.z,this.z=t*e.y-i*e.x,this},crossVectors:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},angleTo:function(e){return Math.acos(this.dot(e)/this.length()/e.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setEulerFromRotationMatrix:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var r=e.elements,a=r[0],n=r[4],o=r[8],s=r[1],l=r[5],h=r[9],c=r[2],u=r[6],f=r[10];return t===Me||"XYZ"===t?(this.y=Math.asin(i(o)),Math.abs(o)<.99999?(this.x=Math.atan2(-h,f),this.z=Math.atan2(-n,a)):(this.x=Math.atan2(u,l),this.z=0)):"YXZ"===t?(this.x=Math.asin(-i(h)),Math.abs(h)<.99999?(this.y=Math.atan2(o,f),this.z=Math.atan2(s,l)):(this.y=Math.atan2(-c,a),this.z=0)):"ZXY"===t?(this.x=Math.asin(i(u)),Math.abs(u)<.99999?(this.y=Math.atan2(-c,f),this.z=Math.atan2(-n,l)):(this.y=0,this.z=Math.atan2(s,a))):"ZYX"===t?(this.y=Math.asin(-i(c)),Math.abs(c)<.99999?(this.x=Math.atan2(u,f),this.z=Math.atan2(s,a)):(this.x=0,this.z=Math.atan2(-n,l))):"YZX"===t?(this.z=Math.asin(i(s)),Math.abs(s)<.99999?(this.x=Math.atan2(-h,l),this.y=Math.atan2(-c,a)):(this.x=0,this.y=Math.atan2(o,f))):"XZY"===t&&(this.z=Math.asin(-i(n)),Math.abs(n)<.99999?(this.x=Math.atan2(u,l),this.y=Math.atan2(o,a)):(this.x=Math.atan2(-h,f),this.y=0)),this},setEulerFromQuaternion:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var r=e.x*e.x,a=e.y*e.y,n=e.z*e.z,o=e.w*e.w;return t===Me||"XYZ"===t?(this.x=Math.atan2(2*(e.x*e.w-e.y*e.z),o-r-a+n),this.y=Math.asin(i(2*(e.x*e.z+e.y*e.w))),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),o+r-a-n)):"YXZ"===t?(this.x=Math.asin(i(2*(e.x*e.w-e.y*e.z))),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),o-r-a+n),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),o-r+a-n)):"ZXY"===t?(this.x=Math.asin(i(2*(e.x*e.w+e.y*e.z))),this.y=Math.atan2(2*(e.y*e.w-e.z*e.x),o-r-a+n),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),o-r+a-n)):"ZYX"===t?(this.x=Math.atan2(2*(e.x*e.w+e.z*e.y),o-r-a+n),this.y=Math.asin(i(2*(e.y*e.w-e.x*e.z))),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),o+r-a-n)):"YZX"===t?(this.x=Math.atan2(2*(e.x*e.w-e.z*e.y),o-r+a-n),this.y=Math.atan2(2*(e.y*e.w-e.x*e.z),o+r-a-n),this.z=Math.asin(i(2*(e.x*e.y+e.z*e.w)))):"XZY"===t&&(this.x=Math.atan2(2*(e.x*e.w+e.y*e.z),o-r+a-n),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),o+r-a-n),this.z=Math.asin(i(2*(e.z*e.w-e.x*e.y)))),this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=r,this},toString:function(){return this.x+"_"+this.y+"_"+this.z},equals:function(e){return null!=e&&e.x===this.x&&e.y===this.y&&e.z===this.z},clone:function(){return new Q(this.x,this.y,this.z)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},rotateFromAxisAndCenter:function(e,t,i){var r=(new Se.Mat4).makeRotationAxisAndCenter(e,t,i);return this.applyMatrix4(r),this},rotationTowards:function(e,t){var i=(new Se.Mat4).rotationTowards(e,t);return this.setEulerFromRotationMatrix(i),this},constructor:Se.Vec3},Q.__q1=new Se.Quat,Se.Vec4=function(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=r!==Me?r:1},Se.Vec4.prototype={constructor:Se.Vec4,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==Me?e.w:1,this},add:function(e,t){return t!==Me?(console.warn("DEPRECATED: Vec4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return t!==Me?(console.warn("DEPRECATED: Vec4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,a=this.w,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r+n[12]*a,this.y=n[1]*t+n[5]*i+n[9]*r+n[13]*a,this.z=n[2]*t+n[6]*i+n[10]*r+n[14]*a,this.w=n[3]*t+n[7]*i+n[11]*r+n[15]*a,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(this.x=0,this.y=0,this.z=0,this.w=1),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},clone:function(){return new Se.Vec4(this.x,this.y,this.z,this.w)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,a,n=e.elements,o=n[0],s=n[4],l=n[8],h=n[1],c=n[5],u=n[9],f=n[2],p=n[6],d=n[10];if(Math.abs(s-h)<.01&&Math.abs(l-f)<.01&&Math.abs(u-p)<.01){if(Math.abs(s+h)<.1&&Math.abs(l+f)<.1&&Math.abs(u+p)<.1&&Math.abs(o+c+d-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(o+1)/2,g=(c+1)/2,y=(d+1)/2,v=(s+h)/4,x=(l+f)/4,A=(u+p)/4;return g<m&&y<m?m<.01?(i=0,a=r=.707106781):(r=v/(i=Math.sqrt(m)),a=x/i):y<g?g<.01?(r=0,a=i=.707106781):(i=v/(r=Math.sqrt(g)),a=A/r):y<.01?(r=i=.707106781,a=0):(i=x/(a=Math.sqrt(y)),r=A/a),this.set(i,r,a,t),this}var _=Math.sqrt((p-u)*(p-u)+(l-f)*(l-f)+(h-s)*(h-s));return Math.abs(_)<.001&&(_=1),this.x=(p-u)/_,this.y=(l-f)/_,this.z=(h-s)/_,this.w=Math.acos((o+c+d-1)/2),this},toString:function(){return this.x+"_"+this.y+"_"+this.z+"_"+this.w}};var K,J=function(e,t,i,r,a,n,o,s,l){this.elements=new Float32Array(9),this.set(e!==Me?e:1,t||0,i||0,r||0,a!==Me?a:1,n||0,o||0,s||0,l!==Me?l:1)};J.prototype={constructor:J,set:function(e,t,i,r,a,n,o,s,l){var h=this.elements;return h[0]=e,h[3]=t,h[6]=i,h[1]=r,h[4]=a,h[7]=n,h[2]=o,h[5]=s,h[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Mat3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:(K=new Q,function(e){for(var t=0,i=e.length;t<i;t+=3)K.x=e[t],K.y=e[t+1],K.z=e[t+2],K.applyMatrix3(this),e[t]=K.x,e[t+1]=K.y,e[t+2]=K.z;return e}),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],r=e[2],a=e[3],n=e[4],o=e[5],s=e[6],l=e[7],h=e[8];return t*n*h-t*o*l-i*a*h+i*o*s+r*a*l-r*n*s},getInverse:function(e,t){var i=e.elements,r=this.elements;r[0]=i[10]*i[5]-i[6]*i[9],r[1]=-i[10]*i[1]+i[2]*i[9],r[2]=i[6]*i[1]-i[2]*i[5],r[3]=-i[10]*i[4]+i[6]*i[8],r[4]=i[10]*i[0]-i[2]*i[8],r[5]=-i[6]*i[0]+i[2]*i[4],r[6]=i[9]*i[4]-i[5]*i[8],r[7]=-i[9]*i[0]+i[1]*i[8],r[8]=i[5]*i[0]-i[1]*i[4];var a=i[0]*r[0]+i[1]*r[3]+i[2]*r[6];if(0===a){var n="Mat3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(n);return console.warn(n),this.identity(),this}return this.multiplyScalar(1/a),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},clone:function(){var e=this.elements;return new J(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])},projectToPlane:function(e){var t=e.normalize(),i=this.elements;return i[0]=1-t.x*t.x,i[3]=-t.x*t.y,i[6]=-t.x*t.z,i[1]=-t.x*t.y,i[4]=1-t.y*t.y,i[7]=-t.y*t.z,i[2]=-t.x*t.z,i[5]=-t.z*t.y,i[8]=1-t.z*t.z,this}},Se.Mat3=J;var $,ee,te,ie=function(e,t,i,r,a,n,o,s,l,h,c,u,f,p,d,m){this.elements=new Float32Array(16),this.set(e!==Me?e:1,t||0,i||0,r||0,a||0,n!==Me?n:1,o||0,s||0,l||0,h||0,c!==Me?c:1,u||0,f||0,p||0,d||0,m!==Me?m:1)};ie.prototype={constructor:ie,set:function(e,t,i,r,a,n,o,s,l,h,c,u,f,p,d,m){var g=this.elements;if(e.length)for(var y=0;y<e.length;y++)g[y]=e[y];else g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=a,g[5]=n,g[9]=o,g[13]=s,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=f,g[7]=p,g[11]=d,g[15]=m;return this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),this},setRotationFromEuler:function(e,t){var i=this.elements,r=e.x,a=e.y,n=e.z,o=Math.cos(r),s=Math.sin(r),l=Math.cos(a),h=Math.sin(a),c=Math.cos(n),u=Math.sin(n);if(t===Me||"XYZ"===t){var f=o*c,p=o*u,d=s*c,m=s*u;i[0]=l*c,i[4]=-l*u,i[8]=h,i[1]=p+d*h,i[5]=f-m*h,i[9]=-s*l,i[2]=m-f*h,i[6]=d+p*h,i[10]=o*l}else if("YXZ"===t){var g=l*c,y=l*u,v=h*c,x=h*u;i[0]=g+x*s,i[4]=v*s-y,i[8]=o*h,i[1]=o*u,i[5]=o*c,i[9]=-s,i[2]=y*s-v,i[6]=x+g*s,i[10]=o*l}else if("ZXY"===t){g=l*c,y=l*u,v=h*c,x=h*u;i[0]=g-x*s,i[4]=-o*u,i[8]=v+y*s,i[1]=y+v*s,i[5]=o*c,i[9]=x-g*s,i[2]=-o*h,i[6]=s,i[10]=o*l}else if("ZYX"===t){f=o*c,p=o*u,d=s*c,m=s*u;i[0]=l*c,i[4]=d*h-p,i[8]=f*h+m,i[1]=l*u,i[5]=m*h+f,i[9]=p*h-d,i[2]=-h,i[6]=s*l,i[10]=o*l}else if("YZX"===t){var A=o*l,_=o*h,w=s*l,b=s*h;i[0]=l*c,i[4]=b-A*u,i[8]=w*u+_,i[1]=u,i[5]=o*c,i[9]=-s*c,i[2]=-h*c,i[6]=_*u+w,i[10]=A-b*u}else if("XZY"===t){A=o*l,_=o*h,w=s*l,b=s*h;i[0]=l*c,i[4]=-u,i[8]=h*c,i[1]=A*u+b,i[5]=o*c,i[9]=_*u-w,i[2]=w*u-_,i[6]=s*c,i[10]=b*u+A}return this},setRotationFromQuaternion:function(e){var t=this.elements,i=4===e.length,r=i?e[0]:e.x,a=i?e[1]:e.y,n=i?e[2]:e.z,o=i?e[3]:e.w,s=r+r,l=a+a,h=n+n,c=r*s,u=r*l,f=r*h,p=a*l,d=a*h,m=n*h,g=o*s,y=o*l,v=o*h;return t[0]=1-(p+m),t[4]=u-v,t[8]=f+y,t[1]=u+v,t[5]=1-(c+m),t[9]=d-g,t[2]=f-y,t[6]=d+g,t[10]=1-(c+p),this},lookAt:function(e,t,i){var r=this.elements,a=ie.__v1,n=ie.__v2,o=ie.__v3;return o.subVectors(e,t).normalize(),0===o.length()&&(o.z=1),a.crossVectors(i,o).normalize(),0===a.length()&&(o.x+=1e-4,a.crossVectors(i,o).normalize()),n.crossVectors(o,a),r[0]=a.x,r[1]=a.y,r[2]=a.z,r[4]=n.x,r[5]=n.y,r[6]=n.z,r[8]=o.x,r[9]=o.y,r[10]=o.z,this},multiply:function(e,t){return t!==Me?this.multiplyMatrices(e,t):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,a=this.elements,n=i[0],o=i[4],s=i[8],l=i[12],h=i[1],c=i[5],u=i[9],f=i[13],p=i[2],d=i[6],m=i[10],g=i[14],y=i[3],v=i[7],x=i[11],A=i[15],_=r[0],w=r[4],b=r[8],M=r[12],S=r[1],P=r[5],T=r[9],C=r[13],E=r[2],z=r[6],D=r[10],L=r[14],R=r[3],N=r[7],B=r[11],I=r[15];return a[0]=n*_+o*S+s*E+l*R,a[4]=n*w+o*P+s*z+l*N,a[8]=n*b+o*T+s*D+l*B,a[12]=n*M+o*C+s*L+l*I,a[1]=h*_+c*S+u*E+f*R,a[5]=h*w+c*P+u*z+f*N,a[9]=h*b+c*T+u*D+f*B,a[13]=h*M+c*C+u*L+f*I,a[2]=p*_+d*S+m*E+g*R,a[6]=p*w+d*P+m*z+g*N,a[10]=p*b+d*T+m*D+g*B,a[14]=p*M+d*C+m*L+g*I,a[3]=y*_+v*S+x*E+A*R,a[7]=y*w+v*P+x*z+A*N,a[11]=y*b+v*T+x*D+A*B,a[15]=y*M+v*C+x*L+A*I,this},multiplyToArray:function(e,t,i){var r=this.elements;return this.multiplyMatrices(e,t),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return e.applyProjection(this)},multiplyVector4:function(e){return e.applyMatrix4(this)},multiplyVector3Array:function(e){for(var t=ie.__v1,i=0,r=e.length;i<r;i+=3)t.x=e[i],t.y=e[i+1],t.z=e[i+2],t.applyProjection(this),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z;return e},rotateAxis:function(e){var t=this.elements,i=e.x,r=e.y,a=e.z;return e.x=i*t[0]+r*t[4]+a*t[8],e.y=i*t[1]+r*t[5]+a*t[9],e.z=i*t[2]+r*t[6]+a*t[10],e.normalize(),e},crossVector:function(e){var t=this.elements,i=new Se.Vector4;return i.x=t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12]*e.w,i.y=t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13]*e.w,i.z=t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14]*e.w,i.w=e.w?t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15]*e.w:1,i},determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],a=e[12],n=e[1],o=e[5],s=e[9],l=e[13],h=e[2],c=e[6],u=e[10],f=e[14];return e[3]*(+a*s*c-r*l*c-a*o*u+i*l*u+r*o*f-i*s*f)+e[7]*(+t*s*f-t*l*u+a*n*u-r*n*f+r*l*h-a*s*h)+e[11]*(+t*l*c-t*o*f-a*n*c+i*n*f+a*o*h-i*l*h)+e[15]*(-r*o*h-t*s*c+t*o*u+r*n*c-i*n*u+i*s*h)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},getPosition:function(e){var t=this.elements;return(e||new Q).set(t[12],t[13],t[14])},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getColumnX:function(){var e=this.elements;return ie.__v1.set(e[0],e[1],e[2])},getColumnY:function(){var e=this.elements;return ie.__v1.set(e[4],e[5],e[6])},getColumnZ:function(){var e=this.elements;return ie.__v1.set(e[8],e[9],e[10])},getInverse:function(e,t){var i=this.elements,r=e.elements,a=r[0],n=r[4],o=r[8],s=r[12],l=r[1],h=r[5],c=r[9],u=r[13],f=r[2],p=r[6],d=r[10],m=r[14],g=r[3],y=r[7],v=r[11],x=r[15];i[0]=c*m*y-u*d*y+u*p*v-h*m*v-c*p*x+h*d*x,i[4]=s*d*y-o*m*y-s*p*v+n*m*v+o*p*x-n*d*x,i[8]=o*u*y-s*c*y+s*h*v-n*u*v-o*h*x+n*c*x,i[12]=s*c*p-o*u*p-s*h*d+n*u*d+o*h*m-n*c*m,i[1]=u*d*g-c*m*g-u*f*v+l*m*v+c*f*x-l*d*x,i[5]=o*m*g-s*d*g+s*f*v-a*m*v-o*f*x+a*d*x,i[9]=s*c*g-o*u*g-s*l*v+a*u*v+o*l*x-a*c*x,i[13]=o*u*f-s*c*f+s*l*d-a*u*d-o*l*m+a*c*m,i[2]=h*m*g-u*p*g+u*f*y-l*m*y-h*f*x+l*p*x,i[6]=s*p*g-n*m*g-s*f*y+a*m*y+n*f*x-a*p*x,i[10]=n*u*g-s*h*g+s*l*y-a*u*y-n*l*x+a*h*x,i[14]=s*h*f-n*u*f-s*l*p+a*u*p+n*l*m-a*h*m,i[3]=c*p*g-h*d*g-c*f*y+l*d*y+h*f*v-l*p*v,i[7]=n*d*g-o*p*g+o*f*y-a*d*y-n*f*v+a*p*v,i[11]=o*h*g-n*c*g-o*l*y+a*c*y+n*l*v-a*h*v,i[15]=n*c*f-o*h*f+o*l*p-a*c*p-n*l*d+a*h*d;var A=r[0]*i[0]+r[1]*i[4]+r[2]*i[8]+r[3]*i[12];if(0==A){var _="Mat4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(_);return console.warn(_),this.identity(),this}return this.multiplyScalar(1/A),this},compose:function(e,t,i){var r=this.elements,a=ie.__m1,n=ie.__m2;return a.identity(),a.setRotationFromQuaternion(t),n.makeScale(i.x,i.y,i.z),this.multiplyMatrices(a,n),r[12]=e.x,r[13]=e.y,r[14]=e.z,this},decompose:function(e,t,i){var r=this.elements,a=ie.__v1,n=ie.__v2,o=ie.__v3;a.set(r[0],r[1],r[2]),n.set(r[4],r[5],r[6]),o.set(r[8],r[9],r[10]),e=e instanceof Q?e:new Q,t=t instanceof Se.Quat?t:new Se.Quat,(i=i instanceof Q?i:new Q).x=a.length(),i.y=n.length(),i.z=o.length(),e.x=r[12],e.y=r[13],e.z=r[14];var s=ie.__m1;return s.copy(this),s.elements[0]/=i.x,s.elements[1]/=i.x,s.elements[2]/=i.x,s.elements[4]/=i.y,s.elements[5]/=i.y,s.elements[6]/=i.y,s.elements[8]/=i.z,s.elements[9]/=i.z,s.elements[10]/=i.z,t.setFromRotationMatrix(s),[e,t,i]},extractPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractRotation:function(e){var t=this.elements,i=e.elements,r=ie.__v1,a=1/r.set(i[0],i[1],i[2]).length(),n=1/r.set(i[4],i[5],i[6]).length(),o=1/r.set(i[8],i[9],i[10]).length();return t[0]=i[0]*a,t[1]=i[1]*a,t[2]=i[2]*a,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,this},translate:function(e){var t,i,r,a=this.elements;return 3===e.length?(t=e[0],i=e[1],r=e[2]):(t=e.x,i=e.y,r=e.z),a[12]=a[0]*t+a[4]*i+a[8]*r+a[12],a[13]=a[1]*t+a[5]*i+a[9]*r+a[13],a[14]=a[2]*t+a[6]*i+a[10]*r+a[14],a[15]=a[3]*t+a[7]*i+a[11]*r+a[15],this},rotateX:function(e){var t=this.elements,i=t[4],r=t[5],a=t[6],n=t[7],o=t[8],s=t[9],l=t[10],h=t[11],c=Math.cos(e),u=Math.sin(e);return t[4]=c*i+u*o,t[5]=c*r+u*s,t[6]=c*a+u*l,t[7]=c*n+u*h,t[8]=c*o-u*i,t[9]=c*s-u*r,t[10]=c*l-u*a,t[11]=c*h-u*n,this},rotateY:function(e){var t=this.elements,i=t[0],r=t[1],a=t[2],n=t[3],o=t[8],s=t[9],l=t[10],h=t[11],c=Math.cos(e),u=Math.sin(e);return t[0]=c*i-u*o,t[1]=c*r-u*s,t[2]=c*a-u*l,t[3]=c*n-u*h,t[8]=c*o+u*i,t[9]=c*s+u*r,t[10]=c*l+u*a,t[11]=c*h+u*n,this},rotateZ:function(e){var t=this.elements,i=t[0],r=t[1],a=t[2],n=t[3],o=t[4],s=t[5],l=t[6],h=t[7],c=Math.cos(e),u=Math.sin(e);return t[0]=c*i+u*o,t[1]=c*r+u*s,t[2]=c*a+u*l,t[3]=c*n+u*h,t[4]=c*o-u*i,t[5]=c*s-u*r,t[6]=c*l-u*a,t[7]=c*h-u*n,this},rotateByAxis:function(e,t){var i=this.elements;if(1===e.x&&0===e.y&&0===e.z)return this.rotateX(t);if(0===e.x&&1===e.y&&0===e.z)return this.rotateY(t);if(0===e.x&&0===e.y&&1===e.z)return this.rotateZ(t);var r=e.x,a=e.y,n=e.z,o=Math.sqrt(r*r+a*a+n*n),s=(r/=o)*r,l=(a/=o)*a,h=(n/=o)*n,c=Math.cos(t),u=Math.sin(t),f=1-c,p=r*a*f,d=r*n*f,m=a*n*f,g=r*u,y=a*u,v=n*u,x=s+(1-s)*c,A=p+v,_=d-y,w=p-v,b=l+(1-l)*c,M=m+g,S=d+y,P=m-g,T=h+(1-h)*c,C=i[0],E=i[1],z=i[2],D=i[3],L=i[4],R=i[5],N=i[6],B=i[7],I=i[8],F=i[9],V=i[10],U=i[11];return i[12],i[13],i[14],i[15],i[0]=x*C+A*L+_*I,i[1]=x*E+A*R+_*F,i[2]=x*z+A*N+_*V,i[3]=x*D+A*B+_*U,i[4]=w*C+b*L+M*I,i[5]=w*E+b*R+M*F,i[6]=w*z+b*N+M*V,i[7]=w*D+b*B+M*U,i[8]=S*C+P*L+T*I,i[9]=S*E+P*R+T*F,i[10]=S*z+P*N+T*V,i[11]=S*D+P*B+T*U,this},scale:function(e){var t=this.elements,i=3===e.length,r=i?e[0]:e.x,a=i?e[1]:e.y,n=i?e[2]:e.z;return t[0]*=r,t[4]*=a,t[8]*=n,t[1]*=r,t[5]*=a,t[9]*=n,t[2]*=r,t[6]*=a,t[10]*=n,t[3]*=r,t[7]*=a,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(i,r)))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),a=1-i,n=e.x,o=e.y,s=e.z,l=a*n,h=a*o;return this.set(l*n+i,l*o-r*s,l*s+r*o,0,l*o+r*s,h*o+i,h*s-r*n,0,l*s-r*o,h*s+r*n,a*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeFrustum:function(e,t,i,r,a,n){var o=this.elements,s=2*a/(t-e),l=2*a/(r-i),h=(t+e)/(t-e),c=(r+i)/(r-i),u=-(n+a)/(n-a),f=-2*n*a/(n-a);return o[0]=s,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=l,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(e,t,i,r){var a=i*Math.tan(Se.Math.degToRad(.5*e)),n=-a,o=n*t,s=a*t;return this.makeFrustum(o,s,n,a,i,r)},perspectiveFromFieldOfView:function(e,t,i){var r=this.elements,a=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+s),h=2/(a+n);return r[0]=l,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=h,r[6]=0,r[7]=0,r[8]=-(o-s)*l*.5,r[9]=(a-n)*h*.5,r[10]=i/(t-i),r[11]=-1,r[12]=0,r[13]=0,r[14]=i*t/(t-i),r[15]=0,this},makeOrthographic:function(e,t,i,r,a,n){var o=this.elements,s=t-e,l=i-r,h=n-a,c=(t+e)/s,u=(i+r)/l,f=(n+a)/h;return o[0]=2/s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2/l,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2/h,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},clone:function(){var e=this.elements;return new ie(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])},makeRotationFromQuaternion:function(e){var t=this.elements,i=4===e.length,r=i?e[0]:e.x,a=i?e[1]:e.y,n=i?e[2]:e.z,o=i?e[3]:e.w,s=r+r,l=a+a,h=n+n,c=r*s,u=r*l,f=r*h,p=a*l,d=a*h,m=n*h,g=o*s,y=o*l,v=o*h;return t[0]=1-(p+m),t[4]=u-v,t[8]=f+y,t[1]=u+v,t[5]=1-(c+m),t[9]=d-g,t[2]=f-y,t[6]=d+g,t[10]=1-(c+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},getEulerAngles:function(){var e=(new ie).extractRotation(this).elements,t=e[0],i=e[1],r=e[2],a=e[5],n=e[6],o=e[10],s=Math.atan2(n,o),l=Math.atan2(-r,Math.sqrt(t*t+i*i)),h=Math.sin(s),c=Math.cos(s),u=Math.atan2(h*e[8]-c*e[4],c*a-h*e[9]);return new Q(s,l,u)},makeRotationAxisAndCenter:function(e,t,i){var r=Math.cos(t),a=Math.sin(t),n=1-r,o=e.x,s=e.y,l=e.z,h=n*o,c=n*s,u=i.x,f=i.y,p=i.z,d=new Float32Array(16);return d[0]=h*o+r,d[4]=h*s-a*l,d[8]=h*l+a*s,d[12]=u-u*(h*o+r)-f*(h*s-a*l)-p*(h*l+a*s),d[1]=h*s+a*l,d[5]=c*s+r,d[9]=c*l-a*o,d[13]=f-u*(h*s+a*l)-f*(c*s+r)-p*(c*l-a*o),d[2]=h*l-a*s,d[6]=c*l+a*o,d[10]=n*l*l+r,d[14]=p-u*(h*l-a*s)-f*(c*l+a*o)-p*(n*l*l+r),d[3]=0,d[7]=0,d[11]=0,d[15]=1,this.elements=d,this},rotationTowards:function(e,t){var i=Math.acos(t.dot(e)/t.length()/e.length()),r=(new Se.Vec3).crossVectors(t,e).normalize();return this.makeRotationAxis(r,-i),this},equals:function(e){if(e instanceof ie){for(var t=0;t<this.elements.length;t++)if(1e-4<Math.abs(this.elements[t]-e.elements[t]))return!1;return!0}},fromRotationTranslation:function(e,t){var i=this.elements,r=e[0],a=e[1],n=e[2],o=e[3],s=r+r,l=a+a,h=n+n,c=r*s,u=r*l,f=r*h,p=a*l,d=a*h,m=n*h,g=o*s,y=o*l,v=o*h;return i[0]=1-(p+m),i[1]=u+v,i[2]=f-y,i[3]=0,i[4]=u-v,i[5]=1-(c+m),i[6]=d+g,i[7]=0,i[8]=f+y,i[9]=d-g,i[10]=1-(c+p),i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,this},fromRotationTranslationScale:function(e,t,i){var r=e.x,a=e.y,n=e.z,o=e.w,s=this.elements,l=r+r,h=a+a,c=n+n,u=r*l,f=r*h,p=r*c,d=a*h,m=a*c,g=n*c,y=o*l,v=o*h,x=o*c,A=i.x,_=i.y,w=i.z;return s[0]=(1-(d+g))*A,s[1]=(f+x)*A,s[2]=(p-v)*A,s[3]=0,s[4]=(f-x)*_,s[5]=(1-(u+g))*_,s[6]=(m+y)*_,s[7]=0,s[8]=(p+v)*w,s[9]=(m-y)*w,s[10]=(1-(u+d))*w,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}},ie.__v1=new Q,ie.__v2=new Q,ie.__v3=new Q,ie.__m1=new ie,ie.__m2=new ie,Se.Mat4=ie,Se.Euler=function(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._order=r||Se.Euler.DefaultOrder},Se.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Se.Euler.DefaultOrder="XYZ",Se.Euler.prototype={constructor:Se.Euler,_x:0,_y:0,_z:0,_order:Se.Euler.DefaultOrder,_quaternion:Me,_updateQuaternion:function(){this._quaternion!==Me&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(e){this._x=e,this._updateQuaternion()},get y(){return this._y},set y(e){this._y=e,this._updateQuaternion()},get z(){return this._z},set z(e){this._z=e,this._updateQuaternion()},get order(){return this._order},set order(e){this._order=e,this._updateQuaternion()},set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._order=r||this._order,this._updateQuaternion(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._updateQuaternion(),this},setFromRotationMatrix:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var r=e.elements,a=r[0],n=r[4],o=r[8],s=r[1],l=r[5],h=r[9],c=r[2],u=r[6],f=r[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(i(o)),Math.abs(o)<.99999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-n,a)):(this._x=Math.atan2(u,l),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(h)),Math.abs(h)<.99999?(this._y=Math.atan2(o,f),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-c,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(u)),Math.abs(u)<.99999?(this._y=Math.atan2(-c,f),this._z=Math.atan2(-n,l)):(this._y=0,this._z=Math.atan2(s,a))):"ZYX"===t?(this._y=Math.asin(-i(c)),Math.abs(c)<.99999?(this._x=Math.atan2(u,f),this._z=Math.atan2(s,a)):(this._x=0,this._z=Math.atan2(-n,l))):"YZX"===t?(this._z=Math.asin(i(s)),Math.abs(s)<.99999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,a)):(this._x=0,this._y=Math.atan2(o,f))):"XZY"===t?(this._z=Math.asin(-i(n)),Math.abs(n)<.99999?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-h,f),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+t),this._order=t,this._updateQuaternion(),this},setFromQuaternion:function(e,t,i){function r(e){return Math.min(Math.max(e,-1),1)}var a=e.x*e.x,n=e.y*e.y,o=e.z*e.z,s=e.w*e.w;return"XYZ"===(t=t||this._order)?(this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),s-a-n+o),this._y=Math.asin(r(2*(e.x*e.z+e.y*e.w))),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s+a-n-o)):"YXZ"===t?(this._x=Math.asin(r(2*(e.x*e.w-e.y*e.z))),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s-a-n+o),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s-a+n-o)):"ZXY"===t?(this._x=Math.asin(r(2*(e.x*e.w+e.y*e.z))),this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),s-a-n+o),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s-a+n-o)):"ZYX"===t?(this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),s-a-n+o),this._y=Math.asin(r(2*(e.y*e.w-e.x*e.z))),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s+a-n-o)):"YZX"===t?(this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),s-a+n-o),this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),s+a-n-o),this._z=Math.asin(r(2*(e.x*e.y+e.z*e.w)))):"XZY"===t?(this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),s-a+n-o),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s+a-n-o),this._z=Math.asin(r(2*(e.z*e.w-e.x*e.y)))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+t),this._order=t,!1!==i&&this._updateQuaternion(),this},reorder:(te=new Se.Quat,function(e){te.setFromEuler(this),this.setFromQuaternion(te,e)}),fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==Me&&(this._order=e[3]),this._updateQuaternion(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},clone:function(){return new Se.Euler(this._x,this._y,this._z,this._order)}},Se.math={},Se.math.Plane=function(e,t){this.normal=e!==Me?e:new Q(1,0,0),this.constant=t!==Me?t:0},Se.math.Plane.prototype={constructor:Se.math.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,i){var r=Se.math.Plane.__v1.subVectors(i,t).cross(Se.math.Plane.__v2.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var i=this.distanceToPoint(e);return(t||new Q).copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(e,t){var i=this.distanceToPoint(e),r=this.distanceToPoint(t);return i<0&&0<r||r<0&&0<i},isIntersectionFace:function(e,t){var i=[];i.push(t[e.a]),i.push(t[e.b]),i.push(t[e.c]),null!=e.d&&i.push(t[e.d]);var r,a,n,o=[];for(r=0;r<i.length;r++)o.push(this.distanceToPoint(i[r]));for(r=0;r<o.length;r++)if(0==r)a=n=o[r];else{if(n=o[r],a<0&&0<n||n<0&&0<a)return"intersect";a=n}return 0<n?"in":"out"},intersectLine:function(e,t,i){var r=i||new Q,a=Se.math.Plane.__v1.subVectors(t,e),n=this.normal.dot(a);if(0==n)return 0==this.distanceToPoint(e)?r.copy(e):Me;var o=-(e.dot(this.normal)+this.constant)/n;return o<0||1<o?Me:r.copy(a).multiplyScalar(o).add(e)},coplanarPoint:function(e){return(e||new Q).copy(this.normal).multiplyScalar(-this.constant)},transform:function(e,t){t=t||(new Se.Mat3).getInverse(e).transpose();var i=Se.math.Plane.__v1.copy(this.normal).applyMatrix3(t),r=this.coplanarPoint(Se.math.Plane.__v2);return r.applyMatrix4(e),this.setFromNormalAndCoplanarPoint(i,r),this},translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new Se.math.Plane).copy(this)}},Se.math.Plane.__vZero=new Q(0,0,0),Se.math.Plane.__v1=new Q,Se.math.Plane.__v2=new Q,Se.Frustum=function(e,t,i,r,a,n){this.planes=[e!==Me?e:new Se.math.Plane,t!==Me?t:new Se.math.Plane,i!==Me?i:new Se.math.Plane,r!==Me?r:new Se.math.Plane,a!==Me?a:new Se.math.Plane,n!==Me?n:new Se.math.Plane]},Se.Frustum.prototype={set:function(e,t,i,r,a,n){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(r),o[4].copy(a),o[5].copy(n),this},setPoints:function(e){this.points=e},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,r=i[0],a=i[1],n=i[2],o=i[3],s=i[4],l=i[5],h=i[6],c=i[7],u=i[8],f=i[9],p=i[10],d=i[11],m=i[12],g=i[13],y=i[14],v=i[15];return t[0].setComponents(o-r,c-s,d-u,v-m).normalize(),t[1].setComponents(o+r,c+s,d+u,v+m).normalize(),t[2].setComponents(o+a,c+l,d+f,v+g).normalize(),t[3].setComponents(o-a,c-l,d-f,v-g).normalize(),t[4].setComponents(o-n,c-h,d-p,v-y).normalize(),t[5].setComponents(o+n,c+h,d+p,v+y).normalize(),this},intersectsObjectAccurate:function(e,t){if(0==t)return this.intersectsObject(e);var i,r,a=e.worldMatrix,n=(this.planes,e.vertices),o=[],s=n.length;for(r=0;r<s;r++)if((i=n[r].clone()).applyMatrix4(a),o.push(i),this.containsPoint(i))return!0;if(2==t)if(e instanceof Se.Line)for(r=0,s=o.length;r<s-1;r++){var l=o[r],h=o[r+1];if(this.containsLine(l,h))return!0}else{var c,u=e.faces;for(r=0,s=u.length;r<s;r++){if(c=u[r],this.containsLine(o[c.a],o[c.b]))return!0;if(this.containsLine(o[c.b],o[c.c]))return!0;if(null!=c.d){if(this.containsLine(o[c.c],o[c.d]))return!0;if(this.containsLine(o[c.d],o[c.a]))return!0}else if(this.containsLine(o[c.a],o[c.c]))return!0}}return!1},intersectsObject:function(e){var t=e.worldMatrix,i=this.planes,r=t.getPosition();if(!e.computeBoundingSphere)return!1;e.boundingSphere||e.computeBoundingSphere();for(var a=-e.boundingSphere.radius*t.getMaxScaleOnAxis(),n=0;n<6;n++)if(i[n].distanceToPoint(r)<a)return!1;return!0},intersectsSphere:function(e){for(var t=this.planes,i=e.center,r=-e.radius,a=0;a<6;a++)if(t[a].distanceToPoint(i)<r)return!1;return!0},intersectsBox:function(e){for(var t=new Q,i=new Q,r=this.planes,a=0;a<6;a++){var n=r[a];t.x=0<n.normal.x?e.min.x:e.max.x,i.x=0<n.normal.x?e.max.x:e.min.x,t.y=0<n.normal.y?e.min.y:e.max.y,i.y=0<n.normal.y?e.max.y:e.min.y,t.z=0<n.normal.z?e.min.z:e.max.z,i.z=0<n.normal.z?e.max.z:e.min.z;var o=n.distanceToPoint(t),s=n.distanceToPoint(i);if(o<0&&s<0)return!1}return!0},containsLine:function(e,t){for(var i=this.planes,r=new Q,a=0;a<6;a++)if((r=i[a].intersectLine(e,t,r))&&this.containsPoint(r))return!0;return!1},containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new Se.Frustum).copy(this)}},Se.Ray=function(e,t){this.origin=e!==Me?e:new Q,this.direction=t!==Me?t:new Q},Se.Ray.prototype={constructor:Se.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new Q).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(e){return this.origin.copy(this.at(e,Se.Ray.__v1)),this},closestPointToPoint:function(e,t){var i=t||new Q;i.subVectors(e,this.origin);var r=i.dot(this.direction);return i.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){var t=Se.Ray.__v1.subVectors(e,this.origin).dot(this.direction);return Se.Ray.__v1.copy(this.direction).multiplyScalar(t).add(this.origin),Se.Ray.__v1.distanceTo(e)},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){return 0!=e.normal.dot(this.direction)||0==e.distanceToPoint(this.origin)},distanceToPlane:function(e){var t=e.normal.dot(this.direction);return 0==t?0==e.distanceToPoint(this.origin)?0:Me:-(this.origin.dot(e.normal)+e.constant)/t},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return i===Me?Me:this.at(i,t)},transform:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this},distanceSqToSegment:function(e,t,i,r){var a,n,o,s,l=e.clone().add(t).multiplyScalar(.5),h=t.clone().sub(e).normalize(),c=.5*e.distanceTo(t),u=this.origin.clone().sub(l),f=-this.direction.dot(h),p=u.dot(this.direction),d=-u.dot(h),m=u.lengthSq(),g=Math.abs(1-f*f);if(0<=g)if(n=f*p-d,s=c*g,0<=(a=f*d-p))if(-s<=n)if(n<=s){var y=1/g;o=(a*=y)*(a+f*(n*=y)+2*p)+n*(f*a+n+2*d)+m}else n=c,o=-(a=Math.max(0,-(f*n+p)))*a+n*(n+2*d)+m;else n=-c,o=-(a=Math.max(0,-(f*n+p)))*a+n*(n+2*d)+m;else n<=-s?o=-(a=Math.max(0,-(-f*c+p)))*a+(n=0<a?-c:Math.min(Math.max(-c,-d),c))*(n+2*d)+m:n<=s?(a=0,o=(n=Math.min(Math.max(-c,-d),c))*(n+2*d)+m):o=-(a=Math.max(0,-(f*c+p)))*a+(n=0<a?c:Math.min(Math.max(-c,-d),c))*(n+2*d)+m;else n=0<f?-c:c,o=-(a=Math.max(0,-(f*n+p)))*a+n*(n+2*d)+m;return i&&i.copy(this.direction.clone().multiplyScalar(a).add(this.origin)),r&&r.copy(h.clone().multiplyScalar(n).add(l)),o},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new Se.Ray).copy(this)}},Se.Ray.__v1=new Q,Se.Ray.__v2=new Q,Se.Triangle=function(e,t,i){this.a=e!==Me?e:new Q,this.b=t!==Me?t:new Q,this.c=i!==Me?i:new Q},Se.Triangle.normal=function(e,t,i,r){var a=r||new Q;a.subVectors(i,t),Se.Triangle.__v0.subVectors(e,t),a.cross(Se.Triangle.__v0);var n=a.lengthSq();return 0<n?a.multiplyScalar(1/Math.sqrt(n)):a.set(0,0,0)},Se.Triangle.barycoordFromPoint=function(e,t,i,r,a){Se.Triangle.__v0.subVectors(r,t),Se.Triangle.__v1.subVectors(i,t),Se.Triangle.__v2.subVectors(e,t);var n=Se.Triangle.__v0.dot(Se.Triangle.__v0),o=Se.Triangle.__v0.dot(Se.Triangle.__v1),s=Se.Triangle.__v0.dot(Se.Triangle.__v2),l=Se.Triangle.__v1.dot(Se.Triangle.__v1),h=Se.Triangle.__v1.dot(Se.Triangle.__v2),c=n*l-o*o,u=a||new Q;if(0==c)return u.set(-2,-1,-1);var f=1/c,p=(l*s-o*h)*f,d=(n*h-o*s)*f;return u.set(1-p-d,d,p)},Se.Triangle.containsPoint=function(e,t,i,r){var a=Se.Triangle.barycoordFromPoint(e,t,i,r,Se.Triangle.__v3);return 0<=a.x&&0<=a.y&&a.x+a.y<=1},Se.Triangle.prototype={constructor:Se.Triangle,set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){return Se.Triangle.__v0.subVectors(this.c,this.b),Se.Triangle.__v1.subVectors(this.a,this.b),.5*Se.Triangle.__v0.cross(Se.Triangle.__v1).length()},midpoint:function(e){return(e||new Q).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return Se.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new Se.math.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return Se.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return Se.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new Se.Triangle).copy(this)},intersectLine:function(e,t){var i=this.plane().intersectLine(e,t);return null!=i&&this.containsPoint(i)}},Se.Triangle.__v0=new Q,Se.Triangle.__v1=new Q,Se.Triangle.__v2=new Q,Se.Triangle.__v3=new Q,Se.Box2=function(e,t){this.min=e!==Me?e:new pe(1/0,1/0),this.max=t!==Me?t:new pe(-1/0,-1/0)},Se.Box2.prototype={constructor:Se.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:(ee=new pe,function(e,t){var i=ee.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){var t=e||new pe;return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){var t=e||new pe;return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return(t||new pe).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return(t||new pe).copy(e).clamp(this.min,this.max)},distanceToPoint:($=new pe,function(e){return $.copy(e).clamp(this.min,this.max).sub(e).length()}),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};var re={getLogicalPoint:function(e,t){var i,r=e.getBoundingClientRect();if(le.isTouchable&&t.changedTouches&&0<t.changedTouches.length){var a=t.changedTouches[0],n=le.isAndroid?0:$touch.scrollLeft(),o=le.isAndroid?0:$touch.scrollTop();i={x:a.clientX+e.scrollLeft-r.left-n,y:a.clientY+e.scrollTop-r.top-o}}else{if(!re.isValidEvent(e,t))return null;i={x:t.clientX-r.left+e.scrollLeft,y:t.clientY-r.top+e.scrollTop}}return i},isValidEvent:function(e,t){if(!t)return!1;if(t.target===e)if(le.isFirefox){if(e.clientHeight<e.scrollHeight&&t.layerX<25)return!1;if(e.clientWidth<e.scrollWidth&&t.layerY<25)return!1}else if(t.offsetX>e.clientWidth||t.offsetY>e.clientHeight)return!1;return!0},isImage:function(e){return e&&e.nodeName&&"img"===e.nodeName.toLowerCase()},isCanvas:function(e){return e&&e.nodeName&&"canvas"===e.nodeName.toLowerCase()},createView:function(e,t){var i=document.createElement("div");return i.style.position=We.VIEW_POSITION,i.style.fontSize=We.VIEW_FONT_SIZE,i.style.fontFamily=We.VIEW_FONT_FAMILY,i.style.cursor="default",i.style.outline="none",i.style.textAlign="left",i.style.msTouchAction="none",i.tabIndex=0,t||(i.onmousedown=re.preventDefault),i.style.setProperty&&(i.style.setProperty("-khtml-user-select","none",null),i.style.setProperty("-webkit-user-select","none",null),i.style.setProperty("-moz-user-select","none",null),i.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null)),e&&(i.style.overflow=e),i},preventDefault:function(e){We.KEEP_DEFAULT_FUNCTION(e)||(e.preventDefault?e.preventDefault():e.preventManipulation?e.preventManipulation():e.returnValue=!1)},createCanvas:function(e){var t=document.createElement("canvas"),i=e.getView();return t.width=i.width,t.height=i.height,t.style.msTouchAction="none",t.style.position="absolute",t},isCtrlDown:function(e){return e.ctrlKey||e.metaKey},getScrollTop:function(e){if(!e)return 0;var t=e.scrollTop,i=e.parentElement;return t+this.getScrollTop(i)},getScrollLeft:function(e){if(!e)return 0;var t=e.scrollLeft,i=e.parentElement;return t+this.getScrollLeft(i)},debug:function(e,t){try{e.call(t)}catch(e){alert(e)}},setFocus:function(e){if(document.activeElement!==e){var t,i,r,a=document.documentElement;document.body,a&&(le.isIE||le.isOpera||a.scrollLeft||a.scrollTop)&&(t=a.scrollLeft,i=a.scrollTop,r=a),e.focus(),r&&(r.scrollLeft=t,r.scrollTop=i)}},isRightClick:function(e){var t;if(!e)e=q.event;return e.which?t=3==e.which:e.button&&(t=2==e.button),t}};Se.html=re;var ae,ne,oe,se,le=(ae={},ne=navigator.userAgent.toLowerCase(),ae.isOpera=/opera/.test(ne),ae.isIE=/msie/.test(ne)||/trident/.test(ne),ae.isFirefox=/firefox/i.test(ne),ae.isChrome=/chrome/i.test(ne),ae.isSafari=!ae.isChrome&&/safari/i.test(ne),ae.isIPhone=/iphone/.test(ne),ae.isIPod=/ipod/.test(ne),ae.isIPad=/ipad/.test(ne),ae.isAndroid=/android/i.test(ne),ae.isWebOS=/webos/i.test(ne),ae.isMSToucheable=navigator.msMaxTouchPoints&&1<navigator.msMaxTouchPoints,ae.isTouchable="ontouchend"in document||ae.isMSToucheable,ae.isIOS=ae.isIPhone||ae.isIPod||ae.isIPad,ae);Se.ua=le,oe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",se=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1),q.btoa||(q.btoa=function(e){var t,i,r,a,n,o;for(r=e.length,i=0,t="";i<r;){if(a=255&e.charCodeAt(i++),i==r){t+=oe.charAt(a>>2),t+=oe.charAt((3&a)<<4),t+="==";break}if(n=e.charCodeAt(i++),i==r){t+=oe.charAt(a>>2),t+=oe.charAt((3&a)<<4|(240&n)>>4),t+=oe.charAt((15&n)<<2),t+="=";break}o=e.charCodeAt(i++),t+=oe.charAt(a>>2),t+=oe.charAt((3&a)<<4|(240&n)>>4),t+=oe.charAt((15&n)<<2|(192&o)>>6),t+=oe.charAt(63&o)}return t}),q.atob||(q.atob=function(e){var t,i,r,a,n,o,s;for(o=e.length,n=0,s="";n<o;){for(;t=se[255&e.charCodeAt(n++)],n<o&&-1==t;);if(-1==t)break;for(;i=se[255&e.charCodeAt(n++)],n<o&&-1==i;);if(-1==i)break;s+=String.fromCharCode(t<<2|(48&i)>>4);do{if(61==(r=255&e.charCodeAt(n++)))return s;r=se[r]}while(n<o&&-1==r);if(-1==r)break;s+=String.fromCharCode((15&i)<<4|(60&r)>>2);do{if(61==(a=255&e.charCodeAt(n++)))return s;a=se[a]}while(n<o&&-1==a);if(-1==a)break;s+=String.fromCharCode((3&r)<<6|a)}return s});var he=function(){var e=!1,t=document.createElement("canvas");if(t.getContext("2d")&&(e=!0),!e)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var c=!!t.getContext("2d").getImageData,o=!!t.toDataURL,u=!!q.btoa,x=function(e){var t="";if("string"==typeof e)t=e;else for(var i=e,r=0;r<i.length;r++)t+=String.fromCharCode(i[r]);return btoa(t)},f=function(e,t){return"data:"+t+";base64,"+e},p=function(e){var t=document.createElement("img");return t.src=e,t},d=function(e,t,i,r,a){i=i||(t?t.w:e.width),r=r||(t?t.h:e.height);var n=document.createElement("canvas");n.width=i,n.height=r,n.style.width=i+"px",n.style.height=r+"px";var o=n.getContext("2d"),s=(o=n.getContext("2d"),e.style.backgroundColor);return s||(s="PNG"===a?"rgba(255,255,255,0.0)":"BMP"===a?"rgba(255,255,255,0.01)":"#FFFFFF"),o.fillStyle=s,o.fillRect(0,0,i,r),t=t||{x:0,y:0,w:e.width,h:e.height},o.drawImage(e,t.x,t.y,t.w,t.h,0,0,i,r),n};return{saveAsPNG:function(e,t,i,r,a){if(!o)return!1;var n=d(e,t,r,a,"PNG").toDataURL("image/png");return i?p(n):n},saveAsJPEG:function(e,t,i,r,a){if(!o)return!1;var n=d(e,t,r,a,"JPEG").toDataURL("image/jpeg");return 5==n.indexOf("image/jpeg")&&(i?p(n):n)},saveAsBMP:function(e,t,i,r,a){if(!c||!u)return!1;var n,o,s,l=d(e,t,r,a,"BMP"),h=function(e){var t=[],i=e.width,r=e.height;t.push(66),t.push(77);var a=i*r*3+54;t.push(a%256),a=Math.floor(a/256),t.push(a%256),a=Math.floor(a/256),t.push(a%256),a=Math.floor(a/256),t.push(a%256),t.push(0),t.push(0),t.push(0),t.push(0),t.push(54),t.push(0),t.push(0),t.push(0);var n=[];n.push(40),n.push(0),n.push(0),n.push(0);var o=i;n.push(o%256),o=Math.floor(o/256),n.push(o%256),o=Math.floor(o/256),n.push(o%256),o=Math.floor(o/256),n.push(o%256);var s=r;n.push(s%256),s=Math.floor(s/256),n.push(s%256),s=Math.floor(s/256),n.push(s%256),s=Math.floor(s/256),n.push(s%256),n.push(1),n.push(0),n.push(24),n.push(0),n.push(0),n.push(0),n.push(0),n.push(0);var l=i*r*3;n.push(l%256),l=Math.floor(l/256),n.push(l%256),l=Math.floor(l/256),n.push(l%256),l=Math.floor(l/256),n.push(l%256);for(var h=0;h<16;h++)n.push(0);var c=(4-3*i%4)%4,u=e.data,f="",p=r;do{for(var d=i*(p-1)*4,m="",g=0;g<i;g++){var y=4*g;m+=String.fromCharCode(u[d+y+2]),m+=String.fromCharCode(u[d+y+1]),m+=String.fromCharCode(u[d+y])}for(var v=0;v<c;v++)m+=String.fromCharCode(0);f+=m}while(--p);return x(t.concat(n))+x(f)}((n=l,o=parseInt(n.width),s=parseInt(n.height),n.getContext("2d").getImageData(0,0,o,s)));return i?p(f(h,"image/bmp")):f(h,"image/bmp")}}}(),ce={cache:{},g:document.createElement("canvas").getContext("2d"),getTextSize:function(e,t){ce.g.font=e||We.FONT;var i=ce.cache[ce.g.font];return i||(i=2*ce.g.measureText("e").width+4,ce.cache[ce.g.font]=i),{width:ce.g.measureText(t).width+4,height:i}}};Se.g=ce;var fe={};setTimeout,fe.bcld=function(e,t,i,r,a,n,o,s,l){var h,c,u=e/2,f=[],p=[],d={vertices:[],faces:[],uvs:[],uv2s:[]};for(c=0;c<=t;c++){var m=[],g=[],y=c/t,v=y*(i-r)+r;for(h=0;h<=a;h++){var x=h/a,A=new Q;A.x=v*Math.sin(x*s+l),A.y=-y*e+u,A.z=v*Math.cos(x*s+l),d.vertices.push(A),m.push(d.vertices.length-1),g.push(new pe(x,1-y))}f.push(m),p.push(g)}var _,w,b=(i-r)/e;for(h=0;h<a;h++)for(0!==r?(_=d.vertices[f[0][h]].clone(),w=d.vertices[f[0][h+1]].clone()):(_=d.vertices[f[1][h]].clone(),w=d.vertices[f[1][h+1]].clone()),_.setY(Math.sqrt(_.x*_.x+_.z*_.z)*b).normalize(),w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*b).normalize(),c=0;c<t;c++){var M=f[c][h],S=f[c+1][h],P=f[c+1][h+1],T=f[c][h+1],C=_.clone(),E=_.clone(),z=w.clone(),D=w.clone(),L=p[c][h].clone(),R=p[c+1][h].clone(),N=p[c+1][h+1].clone(),B=p[c][h+1].clone();d.faces.push(new Ce(M,S,T,[C,E,D],null,0)),d.uvs.push([L,R,B]),d.uv2s.push([L.clone(),R.clone(),B.clone()]),d.faces.push(new Ce(S,P,T,[E,z,D],null,0)),d.uvs.push([R,N,B]),d.uv2s.push([R.clone(),N.clone(),B.clone()])}var I=!1;if(!1===n&&0<r)for(d.vertices.push(new Q(0,u,0)),I=!0,h=0;h<a;h++){M=f[0][h],S=f[0][h+1],P=d.vertices.length-1,C=new Q(0,1,0),E=new Q(0,1,0),z=new Q(0,1,0);var F=d.vertices[M],V=d.vertices[S];L=new pe((F.x/r+1)/2,1-(F.z/r+1)/2),R=new pe((V.x/r+1)/2,1-(V.z/r+1)/2),N=new pe(.5,.5);d.faces.push(new Ce(M,S,P,[C,E,z],null,1)),d.uvs.push([L,R,N]),d.uv2s.push([L.clone(),R.clone(),N.clone()])}var U=!1;if(!1===o&&0<i)for(d.vertices.push(new Q(0,-u,0)),U=!0,h=0;h<a;h++){M=f[c][h+1],S=f[c][h],P=d.vertices.length-1,C=new Q(0,-1,0),E=new Q(0,-1,0),z=new Q(0,-1,0),F=d.vertices[M],V=d.vertices[S],L=new pe((F.x/i+1)/2,(F.z/i+1)/2),R=new pe((V.x/i+1)/2,(V.z/i+1)/2),N=new pe(.5,.5);d.faces.push(new Ce(M,S,P,[C,E,z],null,2)),d.uvs.push([L,R,N]),d.uv2s.push([L.clone(),R.clone(),N.clone()])}if(s!==2*Math.PI){!I&&d.vertices.push(new Q(0,u,0)),!U&&d.vertices.push(new Q(0,-u,0));M=f[0][0],S=f[t][0],P=d.vertices.length-1,T=d.vertices.length-2,L=new pe(0,0),R=new pe(0,1),N=new pe(1,1),B=new pe(1,0);d.faces.push(new Ce(M,P,S)),d.uvs.push([L,N,R]),d.uv2s.push([L.clone(),N.clone(),R.clone()]),d.faces.push(new Ce(T,P,M)),d.uvs.push([B,N,L]),d.uv2s.push([B.clone(),N.clone(),L.clone()]),M=f[0][a],S=f[t][a];L=new pe(0,0),R=new pe(0,1),N=new pe(1,1),B=new pe(1,0);d.faces.push(new Ce(M,S,T)),d.uvs.push([L,R,B]),d.uv2s.push([L.clone(),R.clone(),B.clone()]),d.faces.push(new Ce(S,P,T)),d.uvs.push([R,N,B]),d.uv2s.push([R.clone(),N.clone(),B.clone()])}return d},fe.buildCubeData=function(E,z,D,L,R,N,B,I){function e(e){var t,i,r,a,n,o,s,l,h,c;F=V.length;var u,f="six-each"==B||"front-other"==B||"back-other"==B||"left-other"==B||"right-other"==B||"top-other"==B||"bottom-other"==B,p=new pe(0,0),d=f?new pe(1/3,.5):new pe(1,1),m=B.split("-")[0];"six"==m?m=null:d=new pe(.5,1),"right"==e?(t="z",i="y",r="x",n=a=-1,o=E/2,s=D,l=z,h=N,c=R,p=new pe(2/3,u=0)):"left"==e?(t="z",i="y",r="x",n=-(a=1),o=-E/2,s=D,l=z,h=N,c=R,u=1):"top"==e?(t="x",i="z",r="y",o=z/2,s=E,l=D,h=L,c=N,u=2,p=new pe((n=a=1)/3,.5)):"bottom"==e?(t="x",i="z",r="y",n=-(a=1),o=-z/2,s=E,l=D,h=L,c=N,u=3,p=new pe(0,.5)):"front"==e?(t="x",i="y",r="z",n=-(a=1),o=D/2,s=E,l=z,h=L,c=R,u=4,p=new pe(1/3,0)):"back"==e&&(t="x",i="y",r="z",n=a=-1,o=-D/2,s=E,l=z,h=L,c=R,u=5,p=new pe(2/3,.5)),m&&(p=new pe(m==e?0:.5,0));var g,y,v=h+1,x=c+1;for(y=0;y<x;y++)for(g=0;g<v;g++){var A=new Q;A[t]=(g/h*s-s/2)*a+I[t],A[i]=(y/c*l-l/2)*n+I[i],A[r]=o+I[r],V.push(A)}f&&(u=0);var _=new Q;for(_[r]=0<o?1:-1,y=0;y<c;y++)for(g=0;g<h;g++){var w=g+v*y,b=g+v*(y+1),M=g+1+v*(y+1),S=g+1+v*y,P=[new pe(g/h,1-y/c),new pe(g/h,1-(y+1)/c),new pe((g+1)/h,1-(y+1)/c),new pe((g+1)/h,1-y/c)];if(f)for(var T=0;T<P.length;T++)P[T].multiply(d).add(p);var C=new Ee(w+F,b+F,M+F,S+F);C.normal.copy(_),C.vertexNormals.push(_.clone(),_.clone(),_.clone(),_.clone()),C.materialIndex=u,U.push(C),k.push([P[0],P[1],P[2],P[3]]),O.push([P[0].clone(),P[1].clone(),P[2].clone(),P[3].clone()])}}var F,V=[],U=[],k=[],O=[];return e("right"),e("left"),e("top"),e("bottom"),e("front"),e("back"),{vertices:V,faces:U,uvs:k,uv2s:O}},fe.bsd=function(e,t,i,r,a,n,o){var s,l,h=[],c=[],u=[],f=[],p=[],d=[];for(l=0;l<=i;l++){var m=[],g=[];for(s=0;s<=t;s++){var y=s/t,v=l/i,x=new Q;x.x=-e*Math.cos(r+y*a)*Math.sin(n+v*o),x.y=e*Math.cos(n+v*o),x.z=e*Math.sin(r+y*a)*Math.sin(n+v*o),h.push(x),m.push(h.length-1),g.push(new pe(y,1-v))}p.push(m),d.push(g)}for(l=0;l<i;l++)for(s=0;s<t;s++){var A=p[l][s+1],_=p[l][s],w=p[l+1][s],b=p[l+1][s+1],M=h[A].clone().normalize(),S=h[_].clone().normalize(),P=h[w].clone().normalize(),T=h[b].clone().normalize(),C=d[l][s+1].clone(),E=d[l][s].clone(),z=d[l+1][s].clone(),D=d[l+1][s+1].clone();Math.abs(h[A].y)===e?(u.push(new Ce(A,w,b,[M,P,T])),c.push([C,z,D]),f.push([C.clone(),z.clone(),D.clone()])):Math.abs(h[w].y)===e?(u.push(new Ce(A,_,w,[M,S,P])),c.push([C,E,z]),f.push([C.clone(),E.clone(),z.clone()])):(u.push(new Ce(A,_,b,[M,S,T])),c.push([C,E,D]),f.push([C.clone(),E.clone(),D.clone()]),u.push(new Ce(_,w,b,[S.clone(),P,T.clone()])),c.push([E.clone(),z,D.clone()]),f.push([E.clone(),z.clone(),D.clone()]))}return{vertices:h,faces:u,uvs:c,uv2s:f}};var ue,de,me,ge=function(e,t){var i,r,a,n,o,s,l,h={},c=e.primitive;if(c.groups)return e.groups=c.groups,void(e.groupList=c.groupList);c.groups={};var u=e.material,f=e.getMaterialMapping();for(i=0,r=c.faces.length;i<r;i++)a=c.faces[i],h[s=(n=f[n=u instanceof Se.ArrayMaterial?a.materialIndex:0])!==Me?n:-1]===Me&&(h[s]={hash:s,counter:0}),l=h[s].hash+"_"+h[s].counter,c.groups[l]===Me&&(c.groups[l]={faces3:[],faces4:[],materialIndex:n,vertices:0}),o=a instanceof Ce?3:4,65535<c.groups[l].vertices+o&&(t?c.groups[l].elementIndexUInt=!0:(h[s].counter+=1,l=h[s].hash+"_"+h[s].counter,c.groups[l]===Me&&(c.groups[l]={faces3:[],faces4:[],materialIndex:n,vertices:0}))),a instanceof Ce?c.groups[l].faces3.push(i):c.groups[l].faces4.push(i),c.groups[l].vertices+=o;for(var p in c.groupsList=[],e.groups)c.groupsList.push(e.groups[p]);e.groups=c.groups,e.groupList=c.groupsList},ye=function(e,t,i,r){var a,n,o,s,l,h,c,u,f,p,d,m,g,y,v=e,x=v,A=x.vertices,_=A.length,w=x.colors,b=w.length,M=x.sizes,S=M.length,P=r.__vertexArray,T=r.__colorArray,C=r.__normalArray,E=r.__sortArray,z=x.verticesNeedUpdate,D=(x.elementsNeedUpdate,x.normalsNeedUpdate),L=x.colorsNeedUpdate,R=x.__webglCustomAttributesList;if(S<_&&(S=_),v.sortParticles){for(_projScreenMatrixPS.copy(_projScreenMatrix),_projScreenMatrixPS.multiply(v.matrixWorld),a=0;a<_;a++)s=A[a],_vector3.copy(s),_vector3.applyProjection(_projScreenMatrixPS),E[a]=[_vector3.z,a];for(E.sort(numericalSort),a=0;a<_;a++)s=A[E[a][1]],P[l=3*a]=s.x,P[l+1]=s.y,P[l+2]=s.z;for(n=0;n<b;n++)l=3*n,c=w[E[n][1]],T[l]=c.r,T[l+1]=c.g,T[l+2]=c.b;for(o=0;o<S;o++)l=3*o,u=null==(u=M[E[o][1]])?1:u,C[l]=null==u.x?u||1:u.x,C[l+1]=0,C[l+2]=0;if(R)for(f=0,p=R.length;f<p;f++)if((y=R[f]).boundTo===Me||"vertices"===y.boundTo)if(l=0,m=y.value.length,1===y.size)for(d=0;d<m;d++)h=E[d][1],y.array[d]=y.value[h];else if(2===y.size)for(d=0;d<m;d++)h=E[d][1],g=y.value[h],y.array[l]=g.x,y.array[l+1]=g.y,l+=2;else if(3===y.size)if("c"===y.type)for(d=0;d<m;d++)h=E[d][1],g=y.value[h],y.array[l]=g.r,y.array[l+1]=g.g,y.array[l+2]=g.b,l+=3;else for(d=0;d<m;d++)h=E[d][1],g=y.value[h],y.array[l]=g.x,y.array[l+1]=g.y,y.array[l+2]=g.z,l+=3;else if(4===y.size)for(d=0;d<m;d++)h=E[d][1],g=y.value[h],y.array[l]=g.x,y.array[l+1]=g.y,y.array[l+2]=g.z,y.array[l+3]=g.w,l+=4}else{if(z)for(a=0;a<_;a++)s=A[a],P[l=3*a]=s.x,P[l+1]=s.y,P[l+2]=s.z;if(L)for(n=0;n<b;n++)c=w[n],T[l=3*n]=c.r,T[l+1]=c.g,T[l+2]=c.b;if(D)for(o=0;o<S;o++)u=null==M[o]?1:M[o],C[l=3*o]=null==u.x?u||1:u.x,C[l+1]=0,C[l+2]=0;if(R)for(f=0,p=R.length;f<p;f++)if((y=R[f]).needsUpdate&&(y.boundTo===Me||"vertices"===y.boundTo))if(m=y.value.length,l=0,1===y.size)for(d=0;d<m;d++)y.array[d]=y.value[d];else if(2===y.size)for(d=0;d<m;d++)g=y.value[d],y.array[l]=g.x,y.array[l+1]=g.y,l+=2;else if(3===y.size)if("c"===y.type)for(d=0;d<m;d++)g=y.value[d],y.array[l]=g.r,y.array[l+1]=g.g,y.array[l+2]=g.b,l+=3;else for(d=0;d<m;d++)g=y.value[d],y.array[l]=g.x,y.array[l+1]=g.y,y.array[l+2]=g.z,l+=3;else if(4===y.size)for(d=0;d<m;d++)g=y.value[d],y.array[l]=g.x,y.array[l+1]=g.y,y.array[l+2]=g.z,y.array[l+3]=g.w,l+=4}if((z||v.sortParticles)&&(i.bindBuffer(i.ARRAY_BUFFER,r.__webglVertexBuffer),i.bufferData(i.ARRAY_BUFFER,P,t)),(L||v.sortParticles)&&(i.bindBuffer(i.ARRAY_BUFFER,r.__webglColorBuffer),i.bufferData(i.ARRAY_BUFFER,T,t)),(D||v.sortParticles)&&(i.bindBuffer(i.ARRAY_BUFFER,r.__webglNormalBuffer),i.bufferData(i.ARRAY_BUFFER,C,t)),R)for(f=0,p=R.length;f<p;f++)((y=R[f]).needsUpdate||v.sortParticles)&&(i.bindBuffer(i.ARRAY_BUFFER,y.buffer),i.bufferData(i.ARRAY_BUFFER,y.array,t))};fe.buildGroupBufferData=function(e,t,i,r,a,n,o,s){a._type;var l,h,c,u,f,p,d,m,g,y,v,x,A,_,w,b,M,S,P,T,C,E,z,D,L=a.isVertexColor(),R=a.needUV(),N=s.needSmoothNormal(t,a),B=0,I=0,F=0,V=0,U=0,k=0,O=0,X=0,G=0,Y=o.__vertexArray,W=o.__uvArray,j=o.__uv2Array,H=o.__normalArray,q=o.__colorArray,Z=o.__webglCustomAttributesList,Q=o.__faceArray,K=o.__lineArray,J=t,$=J.verticesNeedUpdate,ee=J.elementsNeedUpdate,te=J.uvsNeedUpdate,ie=J.normalsNeedUpdate,re=J.colorsNeedUpdate,ae=J.vertices,ne=e.faces3,oe=e.faces4,se=J.faces,le=J.colors,he=J.uvs,ce=J.uv2s;if(J.colors,null!=o._vao&&(o._vao.dirty=!0),$){for(l=0,h=ne.length;l<h;l++)y=ae[(c=se[ne[l]]).a],v=ae[c.b],x=ae[c.c],Y[I]=y.x,Y[I+1]=y.y,Y[I+2]=y.z,Y[I+3]=v.x,Y[I+4]=v.y,Y[I+5]=v.z,Y[I+6]=x.x,Y[I+7]=x.y,Y[I+8]=x.z,I+=9;for(l=0,h=oe.length;l<h;l++)y=ae[(c=se[oe[l]]).a],v=ae[c.b],x=ae[c.c],A=ae[c.d],Y[I]=y.x,Y[I+1]=y.y,Y[I+2]=y.z,Y[I+3]=v.x,Y[I+4]=v.y,Y[I+5]=v.z,Y[I+6]=x.x,Y[I+7]=x.y,Y[I+8]=x.z,Y[I+9]=A.x,Y[I+10]=A.y,Y[I+11]=A.z,I+=12;n.bindBuffer(n.ARRAY_BUFFER,o.__webglVertexBuffer),n.bufferData(n.ARRAY_BUFFER,Y,i),o.__vertexArray=Y}if(re&&L){for(l=0,h=ne.length;l<h;l++)p=(c=se[ne[l]]).vertexColors,le&&0<le.length&&(p[0]=le[c.a],p[1]=le[c.b],p[2]=le[c.c]),d=c.color,3===p.length&&L===Se.VertexColors?(_=p[0],w=p[1],b=p[2]):b=w=_=d,q[X]=_.r,q[X+1]=_.g,q[X+2]=_.b,q[X+3]=w.r,q[X+4]=w.g,q[X+5]=w.b,q[X+6]=b.r,q[X+7]=b.g,q[X+8]=b.b,X+=9;for(l=0,h=oe.length;l<h;l++)p=(c=se[oe[l]]).vertexColors,d=c.color,4===p.length&&L===Se.VertexColors?(_=p[0],w=p[1],b=p[2],M=p[3]):M=b=w=_=d,q[X]=_.r,q[X+1]=_.g,q[X+2]=_.b,q[X+3]=w.r,q[X+4]=w.g,q[X+5]=w.b,q[X+6]=b.r,q[X+7]=b.g,q[X+8]=b.b,q[X+9]=M.r,q[X+10]=M.g,q[X+11]=M.b,X+=12;0<X&&(n.bindBuffer(n.ARRAY_BUFFER,o.__webglColorBuffer),n.bufferData(n.ARRAY_BUFFER,q,i))}if(ie){for(l=0,h=ne.length;l<h;l++)if(u=(c=se[ne[l]]).vertexNormals,f=c.normal,3===u.length&&N)for(S=0;S<3;S++)T=u[S],H[k]=T.x,H[k+1]=T.y,H[k+2]=T.z,k+=3;else for(S=0;S<3;S++)H[k]=f.x,H[k+1]=f.y,H[k+2]=f.z,k+=3;for(l=0,h=oe.length;l<h;l++)if(u=(c=se[oe[l]]).vertexNormals,f=c.normal,4===u.length&&N)for(S=0;S<4;S++)T=u[S],null==H&&console.log("normal array is null"),H[k]=T.x,H[k+1]=T.y,H[k+2]=T.z,k+=3;else for(S=0;S<4;S++)H[k]=f.x,H[k+1]=f.y,H[k+2]=f.z,k+=3;n.bindBuffer(n.ARRAY_BUFFER,o.__webglNormalBuffer),n.bufferData(n.ARRAY_BUFFER,H,i),o.__normalArray=H}if(te&&he&&R){for(l=0,h=ne.length;l<h;l++)if((m=he[ne[l]])!==Me)for(S=0;S<3;S++)C=m[S],W[F]=C.x,W[F+1]=C.y,F+=2;for(l=0,h=oe.length;l<h;l++)if((m=he[oe[l]])!==Me)for(S=0;S<4;S++)C=m[S],W[F]=C.x,W[F+1]=C.y,F+=2;0<F&&(n.bindBuffer(n.ARRAY_BUFFER,o.__webglUVBuffer),n.bufferData(n.ARRAY_BUFFER,W,i),o.uvArray=W)}if(te&&ce&&R){for(l=0,h=ne.length;l<h;l++)if((g=ce[ne[l]])!==Me)for(S=0;S<3;S++)E=g[S],j[V]=E.x,j[V+1]=E.y,V+=2;for(l=0,h=oe.length;l<h;l++)if((g=ce[oe[l]])!==Me)for(S=0;S<4;S++)E=g[S],j[V]=E.x,j[V+1]=E.y,V+=2;0<V&&(n.bindBuffer(n.ARRAY_BUFFER,o.__webglUV2Buffer),n.bufferData(n.ARRAY_BUFFER,j,i))}if(ee){for(l=0,h=ne.length;l<h;l++)Q[U]=B,Q[U+1]=B+1,Q[U+2]=B+2,U+=3,K[O]=B,K[O+1]=B+1,K[O+2]=B,K[O+3]=B+2,K[O+4]=B+1,K[O+5]=B+2,O+=6,B+=3;for(l=0,h=oe.length;l<h;l++)Q[U]=B,Q[U+1]=B+1,Q[U+2]=B+3,Q[U+3]=B+1,Q[U+4]=B+2,Q[U+5]=B+3,U+=6,K[O]=B,K[O+1]=B+1,K[O+2]=B,K[O+3]=B+3,K[O+4]=B+1,K[O+5]=B+2,K[O+6]=B+2,K[O+7]=B+3,O+=8,B+=4;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,Q,i),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,K,i),o.__lineArray=K}if(Z)for(S=0,P=Z.length;S<P;S++)if((D=Z[S]).__original.needsUpdate){if(G=0,1===D.size){if(D.boundTo===Me||"vertices"===D.boundTo){for(l=0,h=ne.length;l<h;l++)c=se[ne[l]],D.array[G]=D.value[c.a],D.array[G+1]=D.value[c.b],D.array[G+2]=D.value[c.c],G+=3;for(l=0,h=oe.length;l<h;l++)c=se[oe[l]],D.array[G]=D.value[c.a],D.array[G+1]=D.value[c.b],D.array[G+2]=D.value[c.c],D.array[G+3]=D.value[c.d],G+=4}else if("faces"===D.boundTo){for(l=0,h=ne.length;l<h;l++)z=D.value[ne[l]],D.array[G]=z,D.array[G+1]=z,D.array[G+2]=z,G+=3;for(l=0,h=oe.length;l<h;l++)z=D.value[oe[l]],D.array[G]=z,D.array[G+1]=z,D.array[G+2]=z,D.array[G+3]=z,G+=4}}else if(2===D.size){if(D.boundTo===Me||"vertices"===D.boundTo){for(l=0,h=ne.length;l<h;l++)c=se[ne[l]],y=D.value[c.a],v=D.value[c.b],x=D.value[c.c],D.array[G]=y.x,D.array[G+1]=y.y,D.array[G+2]=v.x,D.array[G+3]=v.y,D.array[G+4]=x.x,D.array[G+5]=x.y,G+=6;for(l=0,h=oe.length;l<h;l++)c=se[oe[l]],y=D.value[c.a],v=D.value[c.b],x=D.value[c.c],A=D.value[c.d],D.array[G]=y.x,D.array[G+1]=y.y,D.array[G+2]=v.x,D.array[G+3]=v.y,D.array[G+4]=x.x,D.array[G+5]=x.y,D.array[G+6]=A.x,D.array[G+7]=A.y,G+=8}else if("faces"===D.boundTo){for(l=0,h=ne.length;l<h;l++)y=z=D.value[ne[l]],x=v=z,D.array[G]=y.x,D.array[G+1]=y.y,D.array[G+2]=v.x,D.array[G+3]=v.y,D.array[G+4]=x.x,D.array[G+5]=x.y,G+=6;for(l=0,h=oe.length;l<h;l++)y=z=D.value[oe[l]],A=x=v=z,D.array[G]=y.x,D.array[G+1]=y.y,D.array[G+2]=v.x,D.array[G+3]=v.y,D.array[G+4]=x.x,D.array[G+5]=x.y,D.array[G+6]=A.x,D.array[G+7]=A.y,G+=8}}else if(3===D.size){var ue;if(ue="c"===D.type?["r","g","b"]:["x","y","z"],D.boundTo===Me||"vertices"===D.boundTo){for(l=0,h=ne.length;l<h;l++)c=se[ne[l]],y=D.value[c.a],v=D.value[c.b],x=D.value[c.c],D.array[G]=y[ue[0]],D.array[G+1]=y[ue[1]],D.array[G+2]=y[ue[2]],D.array[G+3]=v[ue[0]],D.array[G+4]=v[ue[1]],D.array[G+5]=v[ue[2]],D.array[G+6]=x[ue[0]],D.array[G+7]=x[ue[1]],D.array[G+8]=x[ue[2]],G+=9;for(l=0,h=oe.length;l<h;l++)c=se[oe[l]],y=D.value[c.a],v=D.value[c.b],x=D.value[c.c],A=D.value[c.d],D.array[G]=y[ue[0]],D.array[G+1]=y[ue[1]],D.array[G+2]=y[ue[2]],D.array[G+3]=v[ue[0]],D.array[G+4]=v[ue[1]],D.array[G+5]=v[ue[2]],D.array[G+6]=x[ue[0]],D.array[G+7]=x[ue[1]],D.array[G+8]=x[ue[2]],D.array[G+9]=A[ue[0]],D.array[G+10]=A[ue[1]],D.array[G+11]=A[ue[2]],G+=12}else if("faces"===D.boundTo){for(l=0,h=ne.length;l<h;l++)y=z=D.value[ne[l]],x=v=z,D.array[G]=y[ue[0]],D.array[G+1]=y[ue[1]],D.array[G+2]=y[ue[2]],D.array[G+3]=v[ue[0]],D.array[G+4]=v[ue[1]],D.array[G+5]=v[ue[2]],D.array[G+6]=x[ue[0]],D.array[G+7]=x[ue[1]],D.array[G+8]=x[ue[2]],G+=9;for(l=0,h=oe.length;l<h;l++)y=z=D.value[oe[l]],A=x=v=z,D.array[G]=y[ue[0]],D.array[G+1]=y[ue[1]],D.array[G+2]=y[ue[2]],D.array[G+3]=v[ue[0]],D.array[G+4]=v[ue[1]],D.array[G+5]=v[ue[2]],D.array[G+6]=x[ue[0]],D.array[G+7]=x[ue[1]],D.array[G+8]=x[ue[2]],D.array[G+9]=A[ue[0]],D.array[G+10]=A[ue[1]],D.array[G+11]=A[ue[2]],G+=12}else if("faceVertices"===D.boundTo){for(l=0,h=ne.length;l<h;l++)y=(z=D.value[ne[l]])[0],v=z[1],x=z[2],D.array[G]=y[ue[0]],D.array[G+1]=y[ue[1]],D.array[G+2]=y[ue[2]],D.array[G+3]=v[ue[0]],D.array[G+4]=v[ue[1]],D.array[G+5]=v[ue[2]],D.array[G+6]=x[ue[0]],D.array[G+7]=x[ue[1]],D.array[G+8]=x[ue[2]],G+=9;for(l=0,h=oe.length;l<h;l++)y=(z=D.value[oe[l]])[0],v=z[1],x=z[2],A=z[3],D.array[G]=y[ue[0]],D.array[G+1]=y[ue[1]],D.array[G+2]=y[ue[2]],D.array[G+3]=v[ue[0]],D.array[G+4]=v[ue[1]],D.array[G+5]=v[ue[2]],D.array[G+6]=x[ue[0]],D.array[G+7]=x[ue[1]],D.array[G+8]=x[ue[2]],D.array[G+9]=A[ue[0]],D.array[G+10]=A[ue[1]],D.array[G+11]=A[ue[2]],G+=12}}else if(4===D.size)if(D.boundTo===Me||"vertices"===D.boundTo){for(l=0,h=ne.length;l<h;l++)c=se[ne[l]],y=D.value[c.a],v=D.value[c.b],x=D.value[c.c],D.array[G]=y.x,D.array[G+1]=y.y,D.array[G+2]=y.z,D.array[G+3]=y.w,D.array[G+4]=v.x,D.array[G+5]=v.y,D.array[G+6]=v.z,D.array[G+7]=v.w,D.array[G+8]=x.x,D.array[G+9]=x.y,D.array[G+10]=x.z,D.array[G+11]=x.w,G+=12;for(l=0,h=oe.length;l<h;l++)c=se[oe[l]],y=D.value[c.a],v=D.value[c.b],x=D.value[c.c],A=D.value[c.d],D.array[G]=y.x,D.array[G+1]=y.y,D.array[G+2]=y.z,D.array[G+3]=y.w,D.array[G+4]=v.x,D.array[G+5]=v.y,D.array[G+6]=v.z,D.array[G+7]=v.w,D.array[G+8]=x.x,D.array[G+9]=x.y,D.array[G+10]=x.z,D.array[G+11]=x.w,D.array[G+12]=A.x,D.array[G+13]=A.y,D.array[G+14]=A.z,D.array[G+15]=A.w,G+=16}else if("faces"===D.boundTo){for(l=0,h=ne.length;l<h;l++)y=z=D.value[ne[l]],x=v=z,D.array[G]=y.x,D.array[G+1]=y.y,D.array[G+2]=y.z,D.array[G+3]=y.w,D.array[G+4]=v.x,D.array[G+5]=v.y,D.array[G+6]=v.z,D.array[G+7]=v.w,D.array[G+8]=x.x,D.array[G+9]=x.y,D.array[G+10]=x.z,D.array[G+11]=x.w,G+=12;for(l=0,h=oe.length;l<h;l++)y=z=D.value[oe[l]],A=x=v=z,D.array[G]=y.x,D.array[G+1]=y.y,D.array[G+2]=y.z,D.array[G+3]=y.w,D.array[G+4]=v.x,D.array[G+5]=v.y,D.array[G+6]=v.z,D.array[G+7]=v.w,D.array[G+8]=x.x,D.array[G+9]=x.y,D.array[G+10]=x.z,D.array[G+11]=x.w,D.array[G+12]=A.x,D.array[G+13]=A.y,D.array[G+14]=A.z,D.array[G+15]=A.w,G+=16}else if("faceVertices"===D.boundTo){for(l=0,h=ne.length;l<h;l++)y=(z=D.value[ne[l]])[0],v=z[1],x=z[2],D.array[G]=y.x,D.array[G+1]=y.y,D.array[G+2]=y.z,D.array[G+3]=y.w,D.array[G+4]=v.x,D.array[G+5]=v.y,D.array[G+6]=v.z,D.array[G+7]=v.w,D.array[G+8]=x.x,D.array[G+9]=x.y,D.array[G+10]=x.z,D.array[G+11]=x.w,G+=12;for(l=0,h=oe.length;l<h;l++)y=(z=D.value[oe[l]])[0],v=z[1],x=z[2],A=z[3],D.array[G]=y.x,D.array[G+1]=y.y,D.array[G+2]=y.z,D.array[G+3]=y.w,D.array[G+4]=v.x,D.array[G+5]=v.y,D.array[G+6]=v.z,D.array[G+7]=v.w,D.array[G+8]=x.x,D.array[G+9]=x.y,D.array[G+10]=x.z,D.array[G+11]=x.w,D.array[G+12]=A.x,D.array[G+13]=A.y,D.array[G+14]=A.z,D.array[G+15]=A.w,G+=16}n.bindBuffer(n.ARRAY_BUFFER,D.buffer),n.bufferData(n.ARRAY_BUFFER,D.array,i)}r&&fe.deleteGroupBufferData(e)},fe.buildLineBufferData=function(e,t,i,r){var a,n,o,s,l,h,c,u,f,p,d,m,g=e,y=g.vertices,v=g.colors,x=g.lineDistances,A=y.length,_=v.length,w=x.length,b=r.__vertexArray,M=r.__colorArray,S=r.__lineDistanceArray,P=g.verticesNeedUpdate,T=g.colorsNeedUpdate,C=g.lineDistancesNeedUpdate,E=g.__webglCustomAttributesList;if(P){for(a=0;a<A;a++)s=y[a],b[l=3*a]=s.x,b[l+1]=s.y,b[l+2]=s.z;i.bindBuffer(i.ARRAY_BUFFER,r.__webglVertexBuffer),i.bufferData(i.ARRAY_BUFFER,b,t)}if(T){for(n=0;n<_;n++)h=v[n],M[l=3*n]=h.r,M[l+1]=h.g,M[l+2]=h.b;i.bindBuffer(i.ARRAY_BUFFER,r.__webglColorBuffer),i.bufferData(i.ARRAY_BUFFER,M,t)}if(C){for(o=0;o<w;o++)S[o]=x[o];i.bindBuffer(i.ARRAY_BUFFER,r.__webglLineDistanceBuffer),i.bufferData(i.ARRAY_BUFFER,S,t)}if(E)for(c=0,u=E.length;c<u;c++)if((m=E[c]).needsUpdate&&(m.boundTo===Me||"vertices"===m.boundTo)){if(l=0,p=m.value.length,1===m.size)for(f=0;f<p;f++)m.array[f]=m.value[f];else if(2===m.size)for(f=0;f<p;f++)d=m.value[f],m.array[l]=d.x,m.array[l+1]=d.y,l+=2;else if(3===m.size)if("c"===m.type)for(f=0;f<p;f++)d=m.value[f],m.array[l]=d.r,m.array[l+1]=d.g,m.array[l+2]=d.b,l+=3;else for(f=0;f<p;f++)d=m.value[f],m.array[l]=d.x,m.array[l+1]=d.y,m.array[l+2]=d.z,l+=3;else if(4===m.size)for(f=0;f<p;f++)d=m.value[f],m.array[l]=d.x,m.array[l+1]=d.y,m.array[l+2]=d.z,m.array[l+3]=d.w,l+=4;i.bindBuffer(i.ARRAY_BUFFER,m.buffer),i.bufferData(i.ARRAY_BUFFER,m.array,t)}},fe.buildLineBufferData=function(e,t,i,r){var a,n,o,s,l,h,c,u,f,p,d,m,g=e,y=g.vertices,v=g.colors,x=g.lineDistances,A=y.length,_=v.length,w=x.length,b=r.__vertexArray,M=r.__colorArray,S=r.__lineDistanceArray,P=g.verticesNeedUpdate,T=g.colorsNeedUpdate,C=g.lineDistancesNeedUpdate,E=g.__webglCustomAttributesList;if(P){for(a=0;a<A;a++)s=y[a],b[l=3*a]=s.x,b[l+1]=s.y,b[l+2]=s.z;i.bindBuffer(i.ARRAY_BUFFER,r.__webglVertexBuffer),i.bufferData(i.ARRAY_BUFFER,b,t)}if(T){for(n=0;n<_;n++)h=v[n],M[l=3*n]=h.r,M[l+1]=h.g,M[l+2]=h.b;i.bindBuffer(i.ARRAY_BUFFER,r.__webglColorBuffer),i.bufferData(i.ARRAY_BUFFER,M,t)}if(C){for(o=0;o<w;o++)S[o]=x[o];i.bindBuffer(i.ARRAY_BUFFER,r.__webglLineDistanceBuffer),i.bufferData(i.ARRAY_BUFFER,S,t)}if(E)for(c=0,u=E.length;c<u;c++)if((m=E[c]).needsUpdate&&(m.boundTo===Me||"vertices"===m.boundTo)){if(l=0,p=m.value.length,1===m.size)for(f=0;f<p;f++)m.array[f]=m.value[f];else if(2===m.size)for(f=0;f<p;f++)d=m.value[f],m.array[l]=d.x,m.array[l+1]=d.y,l+=2;else if(3===m.size)if("c"===m.type)for(f=0;f<p;f++)d=m.value[f],m.array[l]=d.r,m.array[l+1]=d.g,m.array[l+2]=d.b,l+=3;else for(f=0;f<p;f++)d=m.value[f],m.array[l]=d.x,m.array[l+1]=d.y,m.array[l+2]=d.z,l+=3;else if(4===m.size)for(f=0;f<p;f++)d=m.value[f],m.array[l]=d.x,m.array[l+1]=d.y,m.array[l+2]=d.z,m.array[l+3]=d.w,l+=4;i.bindBuffer(i.ARRAY_BUFFER,m.buffer),i.bufferData(i.ARRAY_BUFFER,m.array,t)}},fe.deleteGroupBufferData=function(e){delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray},fe.getMaterial=function(e,t){var i=e.material;return i instanceof Se.ArrayMaterial?(t>i.materials.length-1&&(t=i.materials.length-1),i.materials[t]):i},Se.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase(),i=this;return i.faces[t]=i.faces[t]||{},i.faces[t][e.cssFontWeight]=i.faces[t][e.cssFontWeight]||{},i.faces[t][e.cssFontWeight][e.cssFontStyle]=e,i.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(e){var t,i=this.getFace(),r=this.size/i.resolution,a=0,n=String(e).split(""),o=n.length,s=[];for(t=0;t<o;t++){var l=new Se.Path,h=this.extractGlyphPoints(n[t],i,r,a,l);a+=h.offset,s.push(h.path)}var c,u,f=a/2;for(t=0;t<o;t++)for(l=s[t],u=0;u<l.actions.length;u++){var p=l.actions[u].args;for(c=0;c<p.length;c++)c%3==0&&(p[c]-=f)}return{paths:s,offset:f}},extractGlyphPoints:function(e,t,i,r,a,n){var o,s,l,h,c,u,f,p,d,m,g,y,v,x,A,_,w,b,M=[],S=t.glyphs[e]||t.glyphs["?"];if(S){if(S.o)for(c=(h=S._cachedOutline||(S._cachedOutline=S.o.split(" "))).length,f=u=i,o=0;o<c;)switch(h[o++]){case"m":p=h[o++]*u+r,d=h[o++]*f-0,a.moveTo(p,d,0);break;case"l":p=h[o++]*u+r,d=h[o++]*f-0,a.lineTo(p,d,0);break;case"q":if(m=h[o++]*u+r,g=h[o++]*f-0,x=h[o++]*u+r,A=h[o++]*f-0,a.quadraticCurveTo(x,A,0,m,g,0),b=M[M.length-1])for(y=b.x,v=b.y,s=1,l=this.divisions;s<=l;s++)P=s/l,Se.Shape.Utils.b2(P,y,x,m),Se.Shape.Utils.b2(P,v,A,g);break;case"b":if(m=h[o++]*u+r,g=h[o++]*f-0,x=h[o++]*u+r,A=h[o++]*-f-0,_=h[o++]*u+r,w=h[o++]*-f-0,a.bezierCurveTo(m,g,0,x,A,0,_,w,0),b=M[M.length-1])for(y=b.x,v=b.y,s=1,l=this.divisions;s<=l;s++){var P=s/l;Se.Shape.Utils.b3(P,y,x,_,m),Se.Shape.Utils.b3(P,v,A,w,g)}}return{offset:S.ha*i,path:a}}}},Se.FontUtils.generateShapes=function(e,t){var i=(t=t||{}).size!==Me?t.size:100,r=t.curveSegments!==Me?t.curveSegments:4,a=t.font!==Me?t.font:"helvetiker",n=t.weight!==Me?t.weight:"normal",o=t.style!==Me?t.style:"normal";Se.FontUtils.size=i,Se.FontUtils.divisions=r,Se.FontUtils.face=a,Se.FontUtils.weight=n,Se.FontUtils.style=o;for(var s=Se.FontUtils.drawText(e).paths,l=[],h=0,c=s.length;h<c;h++)Array.prototype.push.apply(l,s[h].toShapes());return l},ue=Se.FontUtils,de=function(e){for(var t=e.length,i=0,r=t-1,a=0;a<t;r=a++)i+=e[r].x*e[a].y-e[a].x*e[r].y;return.5*i},me=function(e,t,i,r,a,n){var o,s,l,h,c,u,f,p,d,m,g,y,v,x,A;if(s=e[n[t]].x,l=e[n[t]].y,h=e[n[i]].x,c=e[n[i]].y,u=e[n[r]].x,(h-s)*((f=e[n[r]].y)-l)-(c-l)*(u-s)<1e-10)return!1;for(m=u-h,g=f-c,y=s-u,v=l-f,x=h-s,A=c-l,o=0;o<a;o++)if(o!==t&&o!==i&&o!==r&&(p=e[n[o]].x,-1e-10<=m*((d=e[n[o]].y)-c)-g*(p-h)&&-1e-10<=y*(d-f)-v*(p-u)&&-1e-10<=x*(d-l)-A*(p-s)))return!1;return!0},ue.Triangulate=function(e,t){var i=e.length;if(i<3)return null;var r,a,n,o=[],s=[],l=[];if(0<de(e))for(a=0;a<i;a++)s[a]=a;else for(a=0;a<i;a++)s[a]=i-1-a;var h=i,c=2*h;for(a=h-1;2<h;){if(c--<=0)return console.log("Warning, unable to triangulate polygon!"),t?l:o;if(h<=(r=a)&&(r=0),h<=(a=r+1)&&(a=0),h<=(n=a+1)&&(n=0),me(e,r,a,n,h,s)){var u,f,p,d,m;for(u=s[r],f=s[a],p=s[n],o.push([e[u],e[f],e[p]]),l.push([s[r],s[a],s[n]]),m=(d=a)+1;m<h;d++,m++)s[d]=s[m];c=2*--h}}return t?l:o},ue.Triangulate.area=de,self._typeface_js={faces:Se.FontUtils.faces,loadFace:Se.FontUtils.loadFace},Se.typeface_js=self._typeface_js;var ve={easeNone:function(e,t,i,r){return i*e/r+t},easeIn:function(e,t,i,r){return i*(e/=r)*e+t},easeOut:function(e,t,i,r){return-i*(e/=r)*(e-2)+t},easeBoth:function(e,t,i,r){return(e/=r/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},easeInStrong:function(e,t,i,r){return i*(e/=r)*e*e*e+t},easeOutStrong:function(e,t,i,r){return-i*((e=e/r-1)*e*e*e-1)+t},easeBothStrong:function(e,t,i,r){return(e/=r/2)<1?i/2*e*e*e*e+t:-i/2*((e-=2)*e*e*e-2)+t},elasticIn:function(e,t,i,r,a,n){var o;return 0===e?t:1==(e/=r)?t+i:(n||(n=.3*r),!a||a<Math.abs(i)?(a=i,o=n/4):o=n/(2*Math.PI)*Math.asin(i/a),-a*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*(2*Math.PI)/n)+t)},elasticOut:function(e,t,i,r,a,n){var o;return 0===e?t:1==(e/=r)?t+i:(n||(n=.3*r),!a||a<Math.abs(i)?(a=i,o=n/4):o=n/(2*Math.PI)*Math.asin(i/a),a*Math.pow(2,-10*e)*Math.sin((e*r-o)*(2*Math.PI)/n)+i+t)},elasticBoth:function(e,t,i,r,a,n){var o;return 0===e?t:2==(e/=r/2)?t+i:(n||(n=r*(.3*1.5)),!a||a<Math.abs(i)?(a=i,o=n/4):o=n/(2*Math.PI)*Math.asin(i/a),e<1?a*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*(2*Math.PI)/n)*-.5+t:a*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*(2*Math.PI)/n)*.5+i+t)},backIn:function(e,t,i,r,a){return a===Me&&(a=1.70158),e===r&&(e-=.001),i*(e/=r)*e*((a+1)*e-a)+t},backOut:function(e,t,i,r,a){return void 0===a&&(a=1.70158),i*((e=e/r-1)*e*((a+1)*e+a)+1)+t},backBoth:function(e,t,i,r,a){return void 0===a&&(a=5.70158),(e/=r/2)<1?i/2*(e*e*((1+(a*=1.525))*e-a))+t:i/2*((e-=2)*e*((1+(a*=1.525))*e+a)+2)+t},bounceIn:function(e,t,i,r){return i-ve.bounceOut(r-e,0,i,r)+t},bounceOut:function(e,t,i,r){return(e/=r)<1/2.75?i*(7.5625*e*e)+t:e<2/2.75?i*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?i*(7.5625*(e-=2.25/2.75)*e+.9375)+t:i*(7.5625*(e-=2.625/2.75)*e+.984375)+t},bounceBoth:function(e,t,i,r){return e<r/2?.5*ve.bounceIn(2*e,0,i,r)+t:.5*ve.bounceOut(2*e-r,0,i,r)+.5*i+t}},xe=function(){if(this._as=[],1===arguments.length){var e=arguments[0];if(e instanceof xe&&(e=e._as),e instanceof Array)for(var t=e.length,i=0;i<t;i++)this._as.push(e[i]);else null!=e&&this._as.push(e)}else if(1<arguments.length)for(t=arguments.length,i=0;i<t;i++)this._as.push(arguments[i])};Se.List=xe,Se.extend(Se.List,Object,{size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(e,t){return t===Me?this._as.push(e):this._as.splice(t,0,e)},addAll:function(e){if(e instanceof xe&&(e=e._as),e instanceof Array)for(var t=e.length,i=0;i<t;i++)this._as.push(e[i]);else this._as.push(e)},get:function(e){return this._as[e]},remove:function(e){var t=this._as.indexOf(e);return 0<=t&&t<this._as.length&&this.removeAt(t),t},removeAt:function(e){return this._as.splice(e,1)[0]},set:function(e,t){return this._as[e]=t},clear:function(){return this._as.splice(0,this._as.length)},contains:function(e){return 0<=this.indexOf(e)},indexOf:function(e){return this._as.indexOf(e)},forEach:function(e,t){for(var i=this._as.length,r=0;r<i;r++){var a=this._as[r];t?e.call(t,a):e(a)}},forEachReverse:function(e,t){for(var i=this._as.length-1;0<=i;i--){var r=this._as[i];t?e.call(t,r):e(r)}},toArray:function(e,t){if(e){for(var i=[],r=this._as.length,a=0;a<r;a++){var n=this._as[a];t?e.call(t,n)&&i.push(n):e(n)&&i.push(n)}return i}return this._as.concat()},toList:function(e,t){if(e){for(var i=new xe,r=this._as.length,a=0;a<r;a++){var n=this._as[a];t?e.call(t,n)&&i.add(n):e(n)&&i.add(n)}return i}return new xe(this)},sort:function(e){return e?this._as.sort(e):this._as.sort(),this},toString:function(){return this._as.toString()}}),Se.ImageCache=function(){};var Ae=Se.ImageCache;Ae.AlarmBillboardImage=new Image,Ae.AlarmBillboardImage.src="data:image/png;base64,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",Ae.Logo=new Image,Ae.Logo.src="data:image/png;base64,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",Se.ImageUtils={},Se.ImageUtils.registerDefaultImage=function(e){null!=e.src?Ae.Logo.src=e.src:Ae.Logo.src=e},Se.ImageUtils.registerAlarmImage=function(e){null!=e.src?Ae.AlarmBillboardImage.src=e.src:Ae.AlarmBillboardImage.src=e},Ae.ssaoNormalImage=new Image,Ae.ssaoNormalImage.src="data:image/png;base64,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",Ae.ssaoNormalImage.loaded=!0,Se.EventDispatcher=function(){this.listeners={}},Se.extend(Se.EventDispatcher,null,{constructor:Se.EventDispatcher,addEventListener:function(e,t){this.listeners[e]===Me&&(this.listeners[e]=[]),-1===this.listeners[e].indexOf(t)&&this.listeners[e].push(t)},removeEventListener:function(e,t){var i=this.listeners[e].indexOf(t);-1!==i&&this.listeners[e].splice(i,1)},dispatchEvent:function(e){var t=this.listenters[e.type];if(t!=Me){e.target=this;for(var i=0;i<t.length;i++)t[i].call(this,e)}},contains:function(e,t){if(this._ls)for(var i,r=0,a=this._ls.size();r<a;r++)if(e===(i=this._ls.get(r)).l&&t===i.s)return!0;return!1},add:function(e,t,i){if(null!=e){var r={l:e,s:t,a:i};this._ls||(this._ls=new xe),this._f?(this._addPendings||(this._addPendings=new xe),this._addPendings.add(r)):r.a?this._ls.add(r,0):this._ls.add(r)}else console.error("TGL.EventDispatcher#add:listener is null")},remove:function(e,t){this._ls&&(this._f?(this._removePendings||(this._removePendings=new xe),this._removePendings.add({l:e,s:t})):this._remove(e,t))},_remove:function(e,t){for(var i,r=0,a=this._ls.size();r<a;r++)if((i=this._ls.get(r)).l===e&&i.s===t)return void this._ls.removeAt(r)},fire:function(e){if(this._ls){var t,i,r=this._ls.size();for(this._f=!0,t=0;t<r;t++)(i=this._ls.get(t)).s?i.l.call(i.s,e):i.l(e);if(this._f=!1,this._removePendings){for(r=this._removePendings.size(),t=0;t<r;t++)i=this._removePendings.get(t),this._remove(i.l,i.s);delete this._removePendings}if(this._addPendings){for(r=this._addPendings.size(),t=0;t<r;t++)(i=this._addPendings.get(t)).a?this._ls.add(i,0):this._ls.add(i);delete this._addPendings}}}}),Se.PropertyChangeDispatcher=function(){this._dispatcher=new Se.EventDispatcher},Se.extend(Se.PropertyChangeDispatcher,Object,{addPropertyChangeListener:function(e,t,i){this._dispatcher.add(e,t,i)},removePropertyChangeListener:function(e,t){this._dispatcher.remove(e,t)},firePropertyChange:function(e,t,i){if(t==i)return!1;var r={property:e,oldValue:t,newValue:i,source:this};return this._dispatcher.fire(r),this.onPropertyChanged(r),!0},onPropertyChanged:function(e){}}),Se.Texture=function(e,t,i,r,a,n,o,s,l){Se.PropertyChangeDispatcher.call(this),this.id=Se.TextureIdCount++,this.name="",null!=e&&this.setImage(e),this.mipmaps=[],this.mapping=t!==Me?t:new Se.UVMapping,this.wrapS=i!==Me?i:Se.RepeatWrapping,this.wrapT=r!==Me?r:Se.RepeatWrapping,this.magFilter=a!==Me?a:Se.LinearFilter,this.minFilter=n!==Me?n:Se.LinearMipMapLinearFilter,this.anisotropy=l!==Me?l:1,this.format=o!==Me?o:Se.RGBAFormat,this.type=s!==Me?s:Se.UnsignedByteType,this.repeatX=1,this.repeatY=1,this.offsetX=0,this.offsetY=0,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!1,this.flipX=!1,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},Se.extend(Se.Texture,Se.PropertyChangeDispatcher,{getUniqueCode:function(){if(re.isImage(this._image)||"string"==typeof this._image||je.isArray(this._image))return this._imageSrc+" "+this.format+" "+this.type+"  "+this.wrapS+" "+this.wrapT+" "+this.magFilter+" "+this.minFilter+" "+this.flipY+" "+this.flipX+this.anisotropy;if(re.isCanvas(this._image)){var e=this._image;return e.__uniqueCode||(e.__uniqueCode=Se.id("texture")),e.__uniqueCode+" "+this.format+" "+this.type+" "+this.wrapS+" "+this.wrapT+" "+this.magFilter+" "+this.minFilter+" "+this.flipY+" "+this.flipX+this.anisotropy}},resetValue:function(){this.name="",this._image=null,this.mipmaps=[],this.mapping=new Se.UVMapping,this.wrapS=Se.RepeatWrapping,this.wrapT=Se.RepeatWrapping,this.magFilter=Se.LinearFilter,this.minFilter=Se.LinearMipMapLinearFilter,this.anisotropy=1,this.format=Se.RGBAFormat,this.type=Se.UnsignedByteType,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!1,this.flipX=!1,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},clone:function(e,t){return e===Me&&(e=new Se.Texture),null==t||t?e.setImage(this._image):e._image=this._image,e._imageSrc=this._imageSrc,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.flipX=this.flipX,e.unpackAlignment=this.unpackAlignment,e},onloadTexture:function(){},setImageSrc:function(e){if("string"==typeof e)this._imageSrc=e;else if(je.isArray(e)){for(var t="",i=0;i<e.length;i++)"string"==typeof e[i]?t+=e:t+=e[i].src;this._imageSrc=t}else this._imageSrc=e.src},loadAllImages:function(t,i){for(var r=t.length,a=0,n=this,e=0;e<r;e++)!function(e){e.onload=function(){e.loaded=!0,e.onload=null,++a==r&&(n.onloadTexture(),n.firePropertyChange("image",i,n._image),t.loaded=!0)}}(t[e])},setImage:function(t){if(o=this._image,je.isArray(t)){for(var e,i="",r=[],a=0;a<t.length;a++)"string"==typeof t[a]?(i+=t,e=new Image,t[a].startsWith("data:image")||(e.crossOrigin="use-credentials"),e.src=t[a],r.push(e)):(i+=t[a].src,r.push(t[a]));this._imageSrc=i,this.loadAllImages(r,o),this._image=r}else if("string"==typeof t){if(this._image&&this._image.src===t)return;this._imageSrc=t;var n=new Image;t.startsWith("data:image")||(n.crossOrigin="use-credentials"),n.src=t,((s=this)._image=n).onload=function(e){n.loaded=!0,n.onload=null,s.onloadTexture(),s.firePropertyChange("image",o,n)}}else{if(this._image===t)return;this._imageSrc=t.src;var o=this._image;if(re.isCanvas(t)&&(t.loaded=!0),t&&!t.loaded){var s=this,l=(s._image=t).onload;t.onload=function(e){l&&l.call(null,e),t.loaded=!0,t.onload=null,s.onloadTexture(),s.firePropertyChange("image",o,t)}}else this._image=t,this.firePropertyChange("image",o,t)}},getImage:function(){return this._image},dispose:function(){this.firePropertyChange("disposed",!1,!0)}}),Se.TextureIdCount=0,Se.PixelsTexture=function(e,t,i,r,a,n,o,s,l,h,c){Se.Texture.call(this,null,n,o,s,l,h,r,a,c),this.image={data:e,width:t,height:i}},Se.PixelsTexture.prototype=Object.create(Se.Texture.prototype),Se.PixelsTexture.prototype.clone=function(){var e=new Se.PixelsTexture;return Se.Texture.prototype.clone.call(this,e),e},Se.CompressedTexture=function(e,t,i,r,a,n,o,s,l){Se.Texture.call(this,null,t,i,r,a,n,o,s,l),this.image={width:0,height:0},this.flipY=!0,this.generateMipmaps=!1,this.anisotropy=16,this.setImage(e)},Se.CompressedTexture.prototype.getUniqueCode=function(){if(re.isImage(this._image)||"string"==typeof this._image||je.isArray(this._image))return this._imageSrc+" "+this.type+"  "+this.wrapS+" "+this.wrapT+" "+this.magFilter+" "+this.minFilter+" "+this.flipY+" "+this.flipX+this.anisotropy;if(re.isCanvas(this._image)){var e=this._image;return e.__uniqueCode||(e.__uniqueCode=Se.id("texture")),e.__uniqueCode+" "+this.type+" "+this.wrapS+" "+this.wrapT+" "+this.magFilter+" "+this.minFilter+" "+this.flipY+" "+this.flipX+this.anisotropy}},Se.CompressedTexture.prototype=Object.create(Se.Texture.prototype),Se.CompressedTexture.prototype.clone=function(){var e=new Se.CompressedTexture(this._image);return Se.Texture.prototype.clone.call(this,e),e},Se.CompressedTexture.prototype.setImage=function(e){var t=this._image;if(t!=e){this._imageSrc=e,this._image=e;var i=this,r=function(){i.loaded=!0,i.firePropertyChange("image",t,e),r=null},a=function(){console.error("LoadCompressedTexture Fail:"+e),a=null};Se.TextureUtils.loadCompressedTexture(e,this.mapping,r,a,this)}},Se.CompressedTexture.isDDSTexture=function(e){return!!e&&"string"==typeof e&&e.toLowerCase().endsWith(".dds")};var _e,we,be={pools:{},useTimes:{},size:0,setTexture:function(e,t){be.size++,be.pools[e]=t},getTexture:function(e){return be.pools[e]},useTexture:function(e){if(e){var t=e.id,i=be.useTimes[t]||0;i++,be.useTimes[t]=i}},unUseTexture:function(e){if(e){var t=e.id,i=be.useTimes[t]||0;if(i--,(be.useTimes[t]=i)<=0){var r=e.getUniqueCode();for(var a in delete be.pools[r],be.pools)if(be.pools[a]==e){delete be.pools[a];break}be.size--,e.dispose()}}},clear:function(){this.pools={},this.useTimes={},this.size=0}};Se.TexturePool=be,Se.TexturePool.TestTexture=new Se.Texture,Se.SerializationSettings=function(){var e=Se.SerializationSettings;this.isDataBoxSerializable=e.isDataBoxSerializable,this.isStyleSerializable=e.isStyleSerializable,this.isClientSerializable=e.isClientSerializable,this.encodeURI=e.encodeURI,this._pm=Se.clone(e._pm),this._sm=Se.clone(e._sm),this._cm=Se.clone(e._cm)},(we=Se.SerializationSettings).isDataBoxSerializable=!0,we.isStyleSerializable=!0,we.isClientSerializable=!0,we.encodeURI=!0,we._pm={},we._sm={},we._cm={},we.setPropertyType=function(e,t){we._pm[e]=t},we.getPropertyType=function(e){return we._pm[e]},we.setStyleType=function(e,t){we._sm[e]=t},we.getStyleType=function(e){return we._sm[e]},we.setClientType=function(e,t){we._cm[e]=t},we.getClientType=function(e){return we._cm[e]},Se.extend(Se.SerializationSettings,Object,{setPropertyType:function(e,t){this._pm[e]=t},getPropertyType:function(e){return this._pm[e]},setStyleType:function(e,t){this._sm[e]=t},getStyleType:function(e){return this._sm[e]},setClientType:function(e,t){this._cm[e]=t},getClientType:function(e){return this._cm[e]}}),Se.Styles={_m:{},setStyle:function(e,t){return null==t?delete Se.Styles._m[e]:Se.Styles._m[e]=t,Se.Styles},getStyle:function(e){return Se.Styles._m[e]}},Se.Styles.MaterailType="S:m.type",Se.Styles.NormalType="S:m.normalType",Se.Styles.PREFIX_STYLE="S:",(_e=function(e,t){Se.SerializationSettings.setPropertyType(e,t)})("combos","data.list"),_e("name","cdata"),_e("toolTip","cdata"),_e("parent","data"),_e("fromNode","data"),_e("toNode","data"),_e("alarmState","alarmstate"),_e("vertices","list.vec3"),_e("faces","serializeabe.list"),_e("uvs","list.vec2"),_e("position","vec3"),_e("rotation","vec3"),_e("scale","vec3"),_e("location","point"),_e("materialSize","number"),_e("color","color"),_e("ambient","color"),_e("diffuse","color"),_e("specular","color"),_e("intensity","number"),_e("distance","number"),_e("type","number"),_e("startClosed","boolean"),_e("endClosed","boolean"),_e("curveSegments","number"),_e("amount","number"),_e("vertical","boolean"),_e("repeat","number"),_e("centralized","boolean"),_e("visible","boolean"),(_e=function(e,t,i){null==i&&(i=null!=t?t instanceof Se.Vec2?"vec2":t instanceof Se.Vec3?"vec3":typeof t:"string"),Se.Styles.setStyle(e,t),Se.SerializationSettings.setStyleType(e,i)})("select.style","border"),_e("select.width",1),_e("select.color",65280),_e("select.offset",0),_e("outer.width",1),_e("outer.offset",0),_e("outer.color",null,"color"),_e("m.type","basic"),_e("m.color",16777215,"color"),_e("m.side","front"),_e("m.alphaTest",0),_e("m.polygonOffset",!1),_e("m.polygonOffsetFactor",0),_e("m.polygonOffsetUnits",0),_e("m.wireframe",!1),_e("m.wireframeLinewidth",1),_e("m.wireframeLinecolor",16777215,"color"),_e("m.wireframeLineopacity",1),_e("m.clipPlane",null,"vec4"),_e("m.gradient",{}),_e("m.gradientType",1),_e("m.transparent",!1),_e("m.opacity",1),_e("m.visible",!0),_e("m.depthTest",!0),_e("m.depthMask",!0),_e("m.alignment",new Se.Vec2(0,0)),_e("m.linewidth",1),_e("m.texture.image",null),_e("m.texture.offset",new Se.Vec2(0,0)),_e("m.texture.repeat",new Se.Vec2(1,1)),_e("m.texture.wrapS",Se.RepeatWrapping),_e("m.texture.wrapT",Se.RepeatWrapping),_e("m.texture.flipX",!1),_e("m.texture.flipY",!1),_e("m.normalmap.image",null),_e("m.envmap.image",null),_e("m.specularmap.image",null),_e("right.m.type","basic"),_e("left.m.type","basic"),_e("top.m.type","basic"),_e("bottom.m.type","basic"),_e("front.m.type","basic"),_e("back.m.type","basic"),_e("side.m.type","basic"),_e("alarm.billboard.scale",null),_e("alarm.billboard.position","top"),_e("alarm.billboard.vertical",!1),_e("annotation.class","tgl_annotation"),Se.extend(Se.Styles,Object,{}),Se.BoundingBox=function(e,t){this.min=e!==Me?e:new Q(1/0,1/0,1/0),this.max=t!==Me?t:new Q(-1/0,-1/0,-1/0)},Se.BoundingBox.prototype={constructor:Se.BoundingBox,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,r=e.length;i<r;i++)(t=e[i]).x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y),t.z<this.min.z?this.min.z=t.z:t.z>this.max.z&&(this.max.z=t.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(e,t){var i=Se.BoundingBox.__v1.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=0,this.max.x=this.max.y=this.max.z=0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new Q).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new Q).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e){return new Q((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){return(t||new Q).copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return Se.BoundingBox.__v1.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){var t=e||new Se.BoundingSphere;return t.center=this.center(),t.radius=.5*this.size(Se.BoundingBox.__v0).length(),t},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},transform:function(e){var t=[Se.BoundingBox.__v0.set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Se.BoundingBox.__v0.set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Se.BoundingBox.__v1.set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Se.BoundingBox.__v2.set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Se.BoundingBox.__v3.set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Se.BoundingBox.__v4.set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Se.BoundingBox.__v5.set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Se.BoundingBox.__v6.set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Se.BoundingBox.__v7.set(this.max.x,this.max.y,this.max.z).applyMatrix4(e)];return this.makeEmpty(),this.setFromPoints(t),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new Se.BoundingBox).copy(this)}},Se.BoundingBox.__v0=new Q,Se.BoundingBox.__v1=new Q,Se.BoundingBox.__v2=new Q,Se.BoundingBox.__v3=new Q,Se.BoundingBox.__v4=new Q,Se.BoundingBox.__v5=new Q,Se.BoundingBox.__v6=new Q,Se.BoundingBox.__v7=new Q,Se.BoundingSphere=function(e,t){this.center=e!==Me?e:new Q,this.radius=t!==Me?t:0},Se.BoundingSphere.prototype={constructor:Se.BoundingSphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromCenterAndPoints:function(e,t){for(var i=0,r=0,a=t.length;r<a;r++){var n=e.distanceToSquared(t[r]);i=Math.max(i,n)}return this.center=e,this.radius=Math.sqrt(i),this},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsBoundingSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var i=this.center.distanceToSquared(e),r=t||new Q;return r.copy(e),i>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){var t=e||new Se.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},transform:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new Se.BoundingSphere).copy(this)}},Se.Primitive=function(e,t){e=e||{},this.data=e,this.vertices=e.vertices,this.faces=e.faces,this.uvs=e.uvs,this.uv2s=e.uv2s,this.colors=e.colors||[],this.uniqueCode=t},Se.extend(Se.Primitive,Object,{clone:function(e){if(e){var t,i={vertices:[]};for(t=0;t<this.vertices.length;t++)i.vertices.push(this.vertices[t].clone());for(i.faces=[],t=0;t<this.faces.length;t++)i.faces.push(this.faces[t].clone());for(i.uvs=[],t=0;t<this.uvs.length;t++){for(var r=this.uvs[t],a=[],n=0;n<r.length;n++)a.push(r[n].clone);i.uvs.push(a)}for(i.uv2s=[],t=0;t<this.uv2s.length;t++)i.uv2s.push(this.uv2s[t].clone());return new Se.Primitive(i)}return new Se.Primitvie(this.data)}}),Se.PrimitiveCache={_cache:{},_useCount:{},getPrimitive:function(e){return e?Se.PrimitiveCache._cache[e]:null},setPrimitive:function(e,t){e&&(Se.PrimitiveCache._cache[e]=t)},usePrimitive:function(e){var t=Se.PrimitiveCache._useCount[e]||0;t++,Se.PrimitiveCache._useCount[e]=t},unUsePrimitive:function(e){var t=Se.PrimitiveCache._useCount[e]||0;--t<=0&&delete Se.PrimitiveCache._useCount[e]}},Se.PrimitiveGroupCache={},Se.Color=function(e){return e!==Me&&this.set(e),this},Se.extend(Se.Color,Object,{r:1,g:1,b:1,getUniqueCode:function(){return""+this.r+this.g+this.b},set:function(e){switch(typeof e){case"number":this.setHex(e);break;case"string":this.setStyle(e)}},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return e.length&&(i=e[2],t=e[1],e=e[0]),this.r=e,this.g=t,this.b=i,this},setHSV:function(e,t,i){var r,a,n,o,s;return 0===i?this.r=this.g=this.b=0:(n=i*(1-t),o=i*(1-t*(a=6*e-(r=Math.floor(6*e)))),s=i*(1-t*(1-a)),0===r?(this.r=i,this.g=s,this.b=n):1===r?(this.r=o,this.g=i,this.b=n):2===r?(this.r=n,this.g=i,this.b=s):3===r?(this.r=n,this.g=o,this.b=i):4===r?(this.r=s,this.g=n,this.b=i):5===r&&(this.r=i,this.g=n,this.b=o)),this},setStyle:function(e){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(e))return t=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(e),this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this;if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(e))return t=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(e),this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this;if(/^\#([0-9a-f]{6})$/i.test(e))return t=/^\#([0-9a-f]{6})$/i.exec(e),this.setHex(parseInt(t[1],16)),this;if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}return/^(\w+)$/i.test(e)?(this.setHex(Se.ColorKeywords[e]),this):void 0},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},getHSV:function(e){var t,i,r=this.r,a=this.g,n=this.b,o=Math.max(Math.max(r,a),n),s=Math.min(Math.min(r,a),n),l=o;if(s===o)i=t=0;else{var h=o-s;i=h/o,t=r===o?(a-n)/h:a===o?2+(n-r)/h:4+(r-a)/h,(t/=6)<0&&(t+=1),1<t&&(t-=1)}return e===Me&&(e={h:0,s:0,v:0}),e.h=t,e.s=i,e.v=l,e},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},clone:function(){return(new Se.Color).setRGB(this.r,this.g,this.b)},toString:function(){return this.getStyle()}}),Se.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Se.Data=function(e){if(Se.PropertyChangeDispatcher.call(this),this._childList=new xe,this._childMap={},this._clientMap={},e===Me||null===e)this._id=Se.id("E");else if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)this._id=e;else{for(var t in e)if("clients"===t)for(var i in e.clients)this._clientMap[i]=e.clients[i];else"styles"===t?this.s(e.styles):null!=e[t]&&("id"===t?this._id=e[t]:this[Se.setter(t)]&&this[Se.setter(t)](e[t]));null==this._id&&(this._id=Se.id("E"))}},Se.extend(Se.Data,Se.PropertyChangeDispatcher,{___accessor:["name"],constructor:Se.Data,getId:function(){return this._id},onAlarmChange:function(){},onPropertyChange:function(e,t,i){},setGroupId:function(e){if(this._groupId!==e){var t=this._groupId;this._groupId=e,this.firePropertyChange("groupId",t,e)}},getGroupId:function(){return this._groupId},hasChildren:function(){return 0<this._childList.size()},getChildren:function(){return this._childList},isDescendantOf:function(e){if(!e)return!1;if(!e.hasChildren())return!1;for(var t=this._parent;t;){if(e===t)return!0;t=t.getParent()}return!1},getParent:function(){return this._parent},getRoot:function(){var e=this._parent;return e&&null==e._parent?e:e&&null!=e._parent?e.getRoot(e):arguments[0]},setParent:function(e){if(!(this._isUpdatingParent||this._parent===e||this===e||e&&e.isDescendantOf(this))){var t=this._parent;this._parent=e,this._isUpdatingParent=!0,t&&t.removeChild(this),e&&e.addChild(this),delete this._isUpdatingParent,this.firePropertyChange("parent",t,e),this.onParentChanged(t,e)}},onParentChanged:function(e,t){},addChild:function(e,t){return t===Me&&(t=this._childList.size()),!(!e||e===this||this._childMap[e.getId()]||this.isDescendantOf(e)||(e.getParent()&&e.getParent().removeChild(e),(t<0||t>this._childList.size())&&(t=this._childList.size()),this._childList.add(e,t),(this._childMap[e._id]=e).setParent(this),this.firePropertyChange("children",null,e),this.onChildAdded(e,t),0))},onChildAdded:function(e,t){},clearChildren:function(){if(null!=this._childList&&0<this._childList.size()){var t=this;this._childList.toList().forEach(function(e){t.removeChild(e)})}},removeChild:function(e){if(!e)return!1;if(!this._childMap[e._id])return!1;var t=this._childList.remove(e);return delete this._childMap[e._id],this.firePropertyChange("children",e,null),e.setParent(null),this.onChildRemoved(e,t),!0},onChildRemoved:function(e,t){},c:function(e){if(e)for(var t in e)this.setClient(t,e[t])},setClient:function(e,t){if(null==e)return this;null==this._clientMap&&(this._clientMap=new Object);var i=this._clientMap[e];return i===t||(null==t?delete this._clientMap[e]:this._clientMap[e]=t,this._clientMap[e]=t,this.firePropertyChange("C:"+e,i,t),this.onClientChanged(e,i,t)),this},getClient:function(e){return this._clientMap[e]},onClientChanged:function(e,t,i){},setPropertyValue:function(e,t){if(this[e]===t)return!1;var i=this[e];return i instanceof Se.Color&&null!=t?(i=i.clone(),t instanceof Se.Color?this[e].copy(t):this[e].set(t)):this[e]=t,!0}});var Pe=1;Se.Element=function(e){var t=this._pickingId=Pe++;this._pickingColor=[(t>>24&255)/255,(t>>16&255)/255,(t>>8&255)/255,(255&t)/255],this.styleMap={},this._visible=!0,this._selected=!1,this._selectable=!0,this._editable=!0,this.editing=!1,this.up=new Q(0,1,0),this._position=new Q(0,0,0),this._rotation=new Q(0,0,0),this._scale=new Q(1,1,1),this.eulerOrder=Se.defaultEulerOrder,this.rotationAutoUpdate=!0,this.matrix=new ie,this.worldMatrix=new ie,this.rotationWorldMatrix=new ie,this.matrixAutoUpdate=!1,this.worldMatrixNeedsUpdate=!0,this.quaternion=new Se.Quat,this.useQuaternion=!1,this._sizeFixed=!1,this._fixedSize=108,this.castShadow=!0,this.receiveShadow=!0,this.frustumCulled=!0,this._vector=new Q,this.renderDepth=null,this._attachId="",this._groupId=null,this.editTransformToParent=!1,this._alarmState=new Se.AlarmState(this),Se.Data.call(this,e)},Se.Element.__m1=new ie,Se.ElementIdCount=0,Se.extend(Se.Element,Se.Data,{IStyle:!0,___accessor:["visible","selected","selectable","editable","sizeFixed"],constructor:Se.Element,getAlarmState:function(){return this._alarmState},onAlarmChange:function(e,t){var i=this._alarmState.getHighestNativeAlarmSeverity();i?this.setStyle("m.alarmColor",new Se.Color(i.color)):this.setStyle("m.alarmColor",null)},getDefaultInstance:function(){return this.constructor.defaultInstance===Me&&(this.constructor.defaultInstance=new this.constructor),this.constructor.defaultInstance},onParentChanged:function(e,t){this.updateWorldMatrix(!0,!1)},onChildAdded:function(e,t){e.updateWorldMatrix(!0,!1)},onChildRemoved:function(e,t){e.updateWorldMatrix(!0,!1)},generatePrimitiveKey:function(){return null},serializeProperty:function(){},clear:function(e){},getSelectStyle:function(){return this.getStyle("select.style")},isSpaceChangedProperty:function(e){return"scale"===e||"position"===e||"rotation"===e},isStyleEquals:function(e,t,i){return null==t&&null==i||t===i},setStyle:function(e,t){if(null==e)return this;null==this.styleMap&&(this.styleMap={});var i=this.styleMap[e];return this.isStyleEquals(e,i,t)||(null==t?delete this.styleMap[e]:this.styleMap[e]=t,this.onStyleChanged(e,i,t),this.firePropertyChange(Se.Styles.PREFIX_STYLE+e,i,t)),this},c:function(e){if(e)for(var t in e)this.setClient(t,e[t])},s:function(e){if(null==e)return this;null==this.styleMap&&(this.styleMap={});var t,i,r,a={},n={};for(t in e)i=e[t],r=this.styleMap[t],this.isStyleEquals(t,r,i)||(null==i?delete this.styleMap[t]:this.styleMap[t]=i,n[t]=r,this.isMaterialStyle(t)&&(a[t]=[i,r]));for(t in this.onMaterialStylesChanged(a),e)this.firePropertyChange(Se.Styles.PREFIX_STYLE+t,n[t],this.styleMap[t]);return this},getStyle:function(e,t,i){var r;return null==i&&(i=!0),null!=this.styleMap&&(r=this.styleMap[e]),t&&(r=this.getCloneObject(r)),null==r&&i&&(r=this.getDefaultStyle(e,t)),r},getCloneObject:function(e){if(null==e)return null;if(Se.Utils.isArray(e)){for(var t=[],i=0;i<e.length;i++)t.push(this.getCloneObject(e[i]));return t}return e.clone?e.clone():e},getSideIndexMapping:function(){},setMaterialStyle:function(e,t){},setMaterialStyles:function(e){var t,r,a,n;for(var o in e){if(o.startsWith("m."))t=o.substr(o.indexOf(".")+1);else if(this.getSideIndexMapping()&&this.isSideStyle(a)){var s=a.substr(0,a.indexOf("."));if(this.getSideMaterialIndex(s)!=i)continue;t=(a=a.substr(a.indexOf(".")+1)).substr(o.indexOf(".")+1)}else o.startsWith("alarm.billboard.")&&(n=!0);null==(r=e[o][0])?r=Se.Styles.getStyle(o):je.isArray(r)&&(r=r[i]),this._A97(this.material,t,r)}n&&this._alarmBillboard&&this._setAlarmBillboardPositionAndSize(this._alarmBillboard)},onMaterialStylesChanged:function(e){this.setMaterialStyles(e)},isMaterialStyle:function(e){return!!e.startsWith("m.")||!(!this.getSideIndexMapping()||!this.isSideStyle(e))},onStyleChanged:function(e,t,i){if(e.startsWith("m."))this.setMaterialStyle(e,i);else if(this.getSideIndexMapping()&&this.isSideStyle(e)){var r=e.substr(0,e.indexOf("."));e=e.substr(e.indexOf(".")+1);var a=this.getSideMaterialIndex(r);this.setMaterialStyle(e,i,a)}else e.startsWith("alarm.billboard.")&&this._alarmBillboard&&this._setAlarmBillboardPositionAndSize(this._alarmBillboard)},textureMapping:{texture:"map",texture1:"map1",texture2:"map2",textureb:"blendMap",texturebp:"bumpMap",lightMap:"lightMap",lightmap:"lightMap",normalmap:"normalMap",envmap:"envMap",specularmap:"specularMap"},_A97:function(e,t,i){if(t.startsWith("texture.")||t.startsWith("texture1.")||t.startsWith("texture2.")||t.startsWith("textureb.")||t.startsWith("texturen.")||t.startsWith("texturebp.")||t.startsWith("lightmap")||t.startsWith("envmap")||t.startsWith("normalmap")||t.startsWith("specularmap")){var r=t.substr(0,t.indexOf(".")),a=t.substr(t.indexOf(".")+1);if("offset"===a||"repeat"===a)return void e.setPropertyValue(a,this.getCloneObject(i));var n=this.textureMapping[r],o=e[n],s=Se.TexturePool.TestTexture;if("image"===a){var l=i;if(t.startsWith("envmap")&&je.isArray(l))for(var h=0;h<l.length;h++)if(null==l[h]){l=null;break}null==o&&null!=l?(s.resetValue(),s._image=l,s.setImageSrc(l),c=s.getUniqueCode(),null==(u=Se.TexturePool.getTexture(c))&&(u=this.createTexture(l),Se.TexturePool.setTexture(c,u)),e.setMap(u,n)):null==l?e.setMap(null,n):(o.clone(s,!1),s._image=l,s.setImageSrc(l),c=s.getUniqueCode(),(u=Se.TexturePool.getTexture(c))===o||(null==u&&(u=this.createTexture(l),o.clone(u,!1),u.setImage(l),Se.TexturePool.setTexture(c,u)),e.setMap(u,n)))}else if(null!=o){o.clone(s,!1),s[a]=this.getCloneObject(i);var c=s.getUniqueCode(),u=Se.TexturePool.getTexture(c);u!=o&&(null==u&&(u=this.createTexture(o._image),o.clone(u),u[a]=i),e.setMap(u,n))}}else"type"===t&&e.setType?e.setType(i):e.setPropertyValue(t,this.getCloneObject(i))},createTexture:function(e){return Se.CompressedTexture.isDDSTexture(e)?new Se.CompressedTexture(e):new Se.Texture(e)},getDefaultStyle:function(e,t){if(null==e)return null;if(e.startsWith("m.")){var i=[],r=e.substr(e.indexOf(".")+1);if(this.material.materials){var a=this.material.materials;for(a=a||[this.material],u=0;u<a.length;u++)if(m=a[u],r.startsWith("texture.")||r.startsWith("texture1.")||r.startsWith("texture2.")||r.startsWith("textureb.")||r.startsWith("texturen.")||r.startsWith("texturebp.")||r.startsWith("lightmap")||r.startsWith("envmap")||r.startsWith("normalmap")||r.startsWith("specularmap")){var n=r.substr(0,r.indexOf(".")),o=r.substr(r.indexOf(".")+1),s=(r.substr(r.indexOf(".")+1),m[this.textureMapping[n]]);if(s)if("image"===o)if(je.isArray(s._image)){var l=[];i.push(l);for(var h=0;h<s._image.length;h++)l.push(s._image[h].src)}else i.push(s._image.src);else"offset"===o||"repeat"===o?i.push(m[o]):i.push(m.map[o]);else i.push(Se.Styles.getStyle(e))}else d=Se.Styles.getStyle(e),i.push(null==d?m[r]:d)}t&&(i=this.getCloneObject(i));for(var c=!0,u=0;u<i.length;u++)if(0!=i.indexOf(i[u])){c=!1;break}return c?i[0]:i}if(this.isSideStyle(e)){var f=e.substr(0,e.indexOf(".")),p=(r=(e=e.substr(e.indexOf(".")+1)).substr(e.indexOf(".")+1),this.getSideMaterialIndex(f));if(null!=p){var d,m=this.material.materials[p];return r.startsWith("texture.")?m.map&&(d="texture.image"===r?m.map._image.src:m.map[r]):d=m[r],t&&(d=this.getCloneObject(d)),d}}return Se.Styles.getStyle(e)},isSideStyle:function(e){if(-1===e.indexOf("."))return!1;var t=this.getSideIndexMapping();return!!t&&t[e.substr(0,e.indexOf("."))]!==Me},setUp:function(e,t,i){var r;if(3===arguments.length){if(this.up.x===e&&this.up.y===t&&this.up.z===i)return;r=new Q(e,t,i)}else{if(this.up.x===e.x&&this.up.y===e.y&&this.up.z===e.z)return;r=e}var a=this.up;this.up=r,this.onUpChanged(a,r),this.firePropertyChange("up",a,r)},getUp:function(){return this.up},onUpChanged:function(e,t){},checkNumber:function(e,t,i,r){je.isNaN(e)&&console.error(r+",x is not a number"),je.isNaN(t)&&console.error(r+",y is not a number"),je.isNaN(i)&&console.error(r+",z is not a number")},invalidateTexture:function(e){var t,i,r,a=this.material;if(null!=e&&a instanceof Se.ArrayMaterial){if("string"==typeof e){var n=this.getSideIndexMapping();if(null!=n&&(e=n[e]),null==e)return}if("number"!=typeof e)return;r=a instanceof Se.ArrayMaterial?a.materials[e]:materail,this._dirtyMaterialTexture(r)}else if(a instanceof Se.ArrayMaterial)for(i=a.materials,t=0;t<i.length;t++)r=i[t],this._dirtyMaterialTexture(r);else this._dirtyMaterialTexture(a)},_dirtyMaterialTexture:function(e){null!=e&&(e.map instanceof Se.Texture&&this._dirtyTexture(e.map),e.lightMap instanceof Se.Texture&&this._dirtyTexture(e.lightMap))},_dirtyTexture:function(e){var t=e._image;e.firePropertyChange("image",null,t)},p:function(e,t,i){if(0===arguments.length)return this.getPosition();3===arguments.length?this.setPosition(e,t,i):this.setPosition(e)},checkPosition:function(e){return!0},setPosition:function(e,t,i){var r;if(3===arguments.length){if(this._position.x===e&&this._position.y===t&&this._position.z===i)return;this.checkNumber(e,t,i,"setPosition"),r=new Q(e,t,i)}else{if(this._position.x===e.x&&this._position.y===e.y&&this._position.z===e.z)return;if(!(e instanceof Q))throw"Element.setPosition : position is not instanceof TGL.Vec3";r=e}if(this.checkPosition(r)){var a=this._position;this._position=r,this.updateWorldMatrix(!0,!1),this.firePropertyChange("position",a,r)}},getPosition:function(e){return e==Me&&(e=!0),e?this._position.clone():this._position},setPositionX:function(e){if(this._position.x!==e){this.checkNumber(e,0,0,"setPositionX");var t=this._position.x,i=this._position.clone();if(i.x=e,!this.checkPosition(i))return!1;this._position.x=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionX",t,e)}},setX:function(e){this.setPositionX(e)},getPositionX:function(){return this._position.x},getX:function(){return this.getPositionX()},setPositionY:function(e){if(this._position.y!==e){this.checkNumber(0,e,0,"setPositionY");var t=this._position.y,i=this._position.clone();if(i.y=e,!this.checkPosition(i))return!1;this._position.y=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionY",t,e)}},setY:function(e){this.setPositionY(e)},getPositionY:function(){return this._position.y},getY:function(){return this.getPositionY()},setPositionZ:function(e){if(this._position.z!==e){this.checkNumber(0,0,e,"setPositionZ");var t=this._position.z,i=this._position.clone();if(i.z=e,!this.checkPosition(i))return!1;this._position.z=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionZ",t,e)}},setZ:function(e){this.setPositionZ(e)},getPositionZ:function(){return this._position.z},getZ:function(){return this.getPositionZ()},setScale:function(e,t,i){var r;if(3===arguments.length){if(this._scale.x===e&&this._scale.y===t&&this._scale.z===i)return;this.checkNumber(e,t,i,"setScale"),r=new Q(e,t,i)}else{if(this._scale.x===e.x&&this._scale.y===e.y&&this._scale.z===e.z)return;if(!(e instanceof Q))throw"Element.setScale : scale is not instanceof TGL.Vec3";r=e}var a=this._scale;r.x=r.x||1,r.y=r.y||1,r.z=r.z||1,this._scale=r,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scale",a,r)},getScale:function(e){return e==Me&&(e=!0),e?this._scale.clone():this._scale},setScaleX:function(e){if(this._scale.x!==e){this.checkNumber(e,0,0,"setScalX");var t=this._scale.x;this._scale.x=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleX",t,e)}},getScaleX:function(){return this._scale.x},setScaleY:function(e){if(this._scale.y!==e){this.checkNumber(0,e,0,"setScaleY");var t=this._scale.y;this._scale.y=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleY",t,e)}},getScaleY:function(){return this._scale.y},setScaleZ:function(e){if(this._scale.z!==e){this.checkNumber(0,0,e,"setScaleZ");var t=this._scale.z;this._scale.z=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleZ",t,e)}},getScaleZ:function(){return this._scale.z},setRotation:function(e,t,i){var r;if(3===arguments.length){if(this._rotation.x===e&&this._rotation.y===t&&this._rotation.z===i)return;this.checkNumber(e,t,i,"setRotation"),r=new Q(e,t,i)}else{if(this._rotation.x===e.x&&this._rotation.y===e.y&&this._rotation.z===e.z)return;if(!(e instanceof Q))throw"Element.setRotation : rotation is not instanceof TGL.Vec3";r=e}var a=this._rotation;this._rotation=r,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotation",a,r)},getRotation:function(e){return e==Me&&(e=!0),e?this._rotation.clone():this._rotation},setRotationX:function(e){if(this._rotation.x!==e){this.checkNumber(e,0,0,"setRotationX");var t=this._rotation.x;this._rotation.x=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationX",t,e)}},getRotationX:function(){return this._rotation.x},setRotationY:function(e){if(this._rotation.y!==e){this.checkNumber(0,e,0,"setRotationY");var t=this._rotation.y;this._rotation.y=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationY",t,e)}},getRotationY:function(){return this._rotation.y},setRotationZ:function(e){if(this._rotation.z!==e){this.checkNumber(0,0,e,"setRotationZ");var t=this._rotation.z;this._rotation.z=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationZ",t,e)}},getRotationZ:function(){return this._rotation.z},applyMatrix:function(e){var t=this.matrix.clone();this.matrix.multiplyMatrices(e,this.matrix),this._scale.getScaleFromMatrix(this.matrix);var i=(new ie).extractRotation(this.matrix);this._rotation.setEulerFromRotationMatrix(i,this.eulerOrder),this._position.getPositionFromMatrix(this.matrix),this.updateWorldMatrix(!0,!1),this.firePropertyChange("matrix",t,this.matrix)},setMatrix:function(e){var t=this.matrix.clone();this.matrix.copy(e),this._scale.getScaleFromMatrix(this.matrix);var i=(new ie).extractRotation(this.matrix);this._rotation.setEulerFromRotationMatrix(i,this.eulerOrder),this._position.getPositionFromMatrix(this.matrix),this.updateWorldMatrix(!0,!1),this.firePropertyChange("matrix",t,this.matrix)},translate:function(e,t){this.matrix.rotateAxis(t),this.setPosition(this._position.clone().add(t.multiplyScalar(e)))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},rotateFromAxis:function(e,t,i){t=t.clone().applyMatrix4(this.matrix),e=e.clone().normalize().applyMatrix4((new ie).extractRotation(this.matrix));var r=(new ie).makeRotationAxisAndCenter(e,i,t);this.applyMatrix(r)},rotateFromWorldAxis:function(e,t){var i=new ie;i.makeRotationAxis(e.normalize(),t),i.multiply(this.matrix),this.matrix=i;var r=(new ie).extractRotation(this.matrix),a=new Q;a.setEulerFromRotationMatrix(r,this.eulerOrder),this.setRotation(a)},getEulerAngles:function(){return this.matrix.getEulerAngles()},rotateFromWorldXAxis:function(e){this.rotateFromWorldAxis(new Q(1,0,0),e)},rotateFromWorldYAxis:function(e){this.rotateFromWorldAxis(new Q(0,1,0),e)},rotateFromWorldZAxis:function(e){this.rotateFromWorldAxis(new Q(0,0,1),e)},getRelativeTransform:function(e){if(e instanceof Se.Element){var t=(new ie).getInverse(e.matrix.clone()),i=(new ie).multiplyMatrices(t,this.matrix.clone());return{position:(new Q).getPositionFromMatrix(i),rotation:(new Q).setEulerFromRotationMatrix(i),scale:(new Q).getScaleFromMatrix(i),matrix:i}}return null},localToWorld:function(e){return null==this._parent?e:e.clone().applyMatrix4(this._parent.worldMatrix)},localToWorld2:function(e){return e.clone().applyMatrix4(this.worldMatrix)},getWorldPosition:function(){return this.worldMatrix.getPosition()},direction:function(e){var t=e.applyMatrix4((new ie).extractRotation(this.worldMatrix));return t.normalize(),t},frontDirection:function(){var e=new Q(0,0,1);return(e=e.applyMatrix4((new ie).extractRotation(this.worldMatrix))).normalize(),e},worldPosition:function(e,t){return t=0<t?t:e.length(),this.worldMatrix.getPosition().add(this.direction(e).multiplyScalar(t))},frontWorldPosition:function(e){return e=0<e?e:1,this.worldMatrix.getPosition().add(this.frontDirection().multiplyScalar(e))},worldToLocal:function(e){return e.clone().applyMatrix4(Se.Element.__m1.getInverse(this.worldMatrix))},lookAt:function(e,t){this.matrix.lookAt(e,this._position,t||this.up),this.rotationAutoUpdate&&(!1===this.useQuaternion?this._rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1])),this.worldMatrixNeedsUpdate=!0},iterator:function(t){t(this),this._childList&&this._childList.forEach(function(e){e.iterator(t)})},getChildByName:function(e,t){for(var i=0,r=this.children.length;i<r;i++){var a=this.children[i];if(a.name===e)return a;if(!0===t&&(a=a.getChildByName(e,t))!==Me)return a}return Me},getDescendants:function(e){e===Me&&(e=[]);var t=this.getChildren().toArray();Array.prototype.push.apply(e,t);for(var i=0,r=t.length;i<r;i++)t[i].getDescendants(e);return e},fixSize:function(e){if(this._sizeFixed){this.updateWorldMatrix();var t=new Q,i=new Q;t.getPositionFromMatrix(this.worldMatrix),e.updateWorldMatrix(),i.getPositionFromMatrix(e.worldMatrix),scale=t.distanceTo(i)/this._fixedSize,0===scale&&(scale=1e-5),this.setScale(scale,scale,scale)}},updateMatrix:function(){this.matrix.setPosition(this._position),!1===this.useQuaternion?this.matrix.setRotationFromEuler(this._rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),1===this._scale.x&&1===this._scale.y&&1===this._scale.z||this.matrix.scale(this._scale),this.worldMatrixNeedsUpdate=!0},updateWorldMatrix:function(t,e){if(e=e==Me||e,!0===this.matrixAutoUpdate&&this.updateMatrix(),!0===this.worldMatrixNeedsUpdate||!0===t){!1===this.matrixAutoUpdate&&this.updateMatrix();var i=this.worldMatrix.clone();this._parent==Me?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this._parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0,i.equals(this.worldMatrix)||(e&&this.firePropertyChange("worldMatrix",i,this.worldMatrix),this.updateCameraMatrix&&this.updateCameraMatrix(!1))}this._childList.forEach(function(e){e.updateWorldMatrix(t)})},cloneCallback:function(e){},clonePrefab:function(t){var i=new mono.Entity;for(var e in t===Me&&(t=!0),i.name=this.name,null==i.up&&(i.up=new Q(0,1,0)),i.up.copy(this.up),i._position.copy(this._position),i._rotation.copy(this._rotation),i.eulerOrder=this.eulerOrder,i._scale.copy(this._scale),i.renderDepth=this.renderDepth,i.rotationAutoUpdate=this.rotationAutoUpdate,i.matrix.copy(this.matrix),i.worldMatrix.copy(this.worldMatrix),i.rotationWorldMatrix.copy(this.rotationWorldMatrix),i.matrixAutoUpdate=this.matrixAutoUpdate,i.worldMatrixNeedsUpdate=this.worldMatrixNeedsUpdate,i.quaternion.copy(this.quaternion),i.useQuaternion=this.useQuaternion,i._visible=this._visible,i.castShadow=this.castShadow,i.receiveShadow=this.receiveShadow,i.frustumCulled=this.frustumCulled,i.styleMap=i.styleMap||{},t&&this._childList&&this._childList.forEach(function(e){i.addChild(e.clonePrefab(t))}),i.vertices=this.vertices,i.faces=this.faces,i.uvs=this.uvs,i.uv2s=this.uv2s,this.primitive&&(i.primitive=this.primitive,i.data=this.primitive.data,i.computed=!0),this.styleMap)i.styleMap[e]=this.getCloneObject(this.styleMap[e]);if(null!=this._clientMap)for(var r in this._clientMap)i.setClient(r,this._clientMap[r]);if(i.material=this.material,this.material instanceof Se.ArrayMaterial){i.material=new Se.ArrayMaterial,i.material.materials=[];for(var a=0;a<this.material.materials.length;a++)i.material.materials.push(this.material.materials[a])}return i.materialSize=this.getMaterialSize?this.getMaterialSize():1,i.boundingBox=this.boundingBox,i},createCloneObject:function(){return this.constructor?object=new this.constructor:object=new Se.Element,object},clone:function(t,i,r){if("boolean"==typeof t&&(r=i,i=t,t=Me),t==Me&&(t=this.createCloneObject()),r===Me&&(r=!0),t.name=this.name,null==t.up&&(t.up=new Q(0,1,0)),t.up.copy(this.up),t._position.copy(this._position),t._rotation.copy(this._rotation),t.eulerOrder=this.eulerOrder,t._scale.copy(this._scale),t.renderDepth=this.renderDepth,t.rotationAutoUpdate=this.rotationAutoUpdate,t.matrix.copy(this.matrix),t.worldMatrix.copy(this.worldMatrix),t.rotationWorldMatrix.copy(this.rotationWorldMatrix),t.matrixAutoUpdate=this.matrixAutoUpdate,t.worldMatrixNeedsUpdate=this.worldMatrixNeedsUpdate,t.quaternion.copy(this.quaternion),t.useQuaternion=this.useQuaternion,t._visible=this._visible,t.castShadow=this.castShadow,t.receiveShadow=this.receiveShadow,t.frustumCulled=this.frustumCulled,t.styleMap=t.styleMap||{},r&&this._childList&&this._childList.forEach(function(e){t.addChild(e.clone(i,r))}),this.constructor){var e=this.constructor.prototype.__accessor,a=this.constructor.prototype.__bool;if(e&&0<e.length)for(c=0;c<e.length;c++){var n=e[c],o=Se.getter(n,a),s=Se.setter(n);"vertices"===n?t.vertices=this.vertices:"faces"===n?t.faces=this.faces:t[s]&&t[s](this[o]())}}if(i&&this.vertices){var l=t,h=this.vertices;l.vertices=[],l.faces=[],l.uvs=[];for(var c=0,u=h.length;c<u;c++)l.vertices.push(h[c].clone());var f=this.faces;for(c=0,u=f.length;c<u;c++)l.faces.push(f[c].clone());var p=this.uvs;for(c=0,u=p.length;c<u;c++){for(var d=p[c],m=[],g=0,y=d.length;g<y;g++)m.push(new Se.Vec2(d[g].x,d[g].y));l.uvs.push(m)}}for(var v in this.styleMap)t.setStyle(v,this.getCloneObject(this.styleMap[v]));if(null!=this._clientMap)for(var x in this._clientMap)t.setClient(x,this._clientMap[x]);return t.cloneCallback(i),t}}),Se.Annotation=function(e,t,i){Se.Element.call(this,i),this._label=e,this._text=t,this._cameraPosition=null},Se.extend(Se.Annotation,Se.Element,{___accessor:["label","text","cameraPosition"]}),Se.Node=function(e){this.name="",this.computed=!1,this.selectionData=null,this.renderGroup=[],this.primitive=null,this.vertices=[],this.faces=[],this.uvs=[],this.uv2s=[],this.colors=this.colors||[],this.normals=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1,this.computeNodeData(),this._alarmBillboard=null,Se.Element.call(this,e)},Se.extend(Se.Node,Se.Element,{__accessor:["vertices","faces","uvs","linkAgent"],__SizePropeties:[],setUpdateFlags:function(e){this.verticesNeedUpdate=e,this.elementsNeedUpdate=e,this.uvsNeedUpdate=e,this.normalsNeedUpdate=e,this.colorsNeedUpdate=e},getLinks:function(){return this._links},getFromLinks:function(){return this._fromLinks},getToLinks:function(){return this._toLinks},_addFromLink:function(e){this._allLinks||(this._allLinks=new xe),this._fromLinks||(this._fromLinks=new xe),this._allLinks.add(e),this._fromLinks.add(e),this._resetLinkSet()},_addToLink:function(e){this._allLinks||(this._allLinks=new xe),this._toLinks||(this._toLinks=new xe),this._allLinks.add(e),this._toLinks.add(e),this._resetLinkSet()},_removeFromLink:function(e){this._allLinks.remove(e),this._fromLinks.remove(e),0===this._allLinks.size()&&delete this._allLinks,0===this._fromLinks.size()&&delete this._fromLinks,this._resetLinkSet()},_removeToLink:function(e){this._allLinks.remove(e),this._toLinks.remove(e),0===this._allLinks.size()&&delete this._allLinks,0===this._toLinks.size()&&delete this._toLinks,this._resetLinkSet()},_resetLinkSet:function(){var t;(delete this._loopedLinks,this._allLinks&&0!==this._allLinks.size())?(this._allLinks.forEach(function(e){e.isLooped()&&(t||(t={}),t[e._id]||(this._loopedLinks||(this._loopedLinks=new xe),this._loopedLinks.add(e),t[e._id]=e))},this),t?(this._links=new xe,this._allLinks.forEach(function(e){t[e._id]?!1!==t[e._id]&&(t[e._id]=!1,this._links.add(e)):this._links.add(e)},this)):this._links=this._allLinks):delete this._links},onAlarmChange:function(e,t){Se.Element.prototype.onAlarmChange.call(this,e,t);var r=this;setTimeout(function(){var e=r._alarmState.getPropagateSeverity();e||(e=r._alarmState.getHighestNativeAlarmSeverity());var t=r._parent,i=!1;null!=t&&t._alarmState&&t._alarmState.getPropagateSeverity()||(i=!0),e&&i?(null==r._alarmBillboard&&r.setAlarmBillboard(new Se.Billboard),r.setAlarmBillboardImageAndColor(r._alarmBillboard,e)):r.setAlarmBillboard(null)},10)},setAlarmBillboardImageAndColor:function(e,t){e.setStyle("m.texture.image",Se.ImageCache.AlarmBillboardImage),e.setStyle("m.color",t.color),e.setStyle("m.alignment",Se.BillboardAlignment.bottomCenter)},_setAlarmBillboardPositionAndSize:function(e){var t=this.getStyle("alarm.billboard.position"),i=this.getBoundingBox(),r=i.min,a=i.max,n=i.center(),o=i.size();"topLeft"===t?e._position.set(r.x,a.y,n.z+1):"topRight"===t?e._position.set(a.x,a.y,n.z+1):"topBack"===t?e._position.set(n.x,a.y,r.z-1):"topFront"===t?e._position.set(n.x,a.y,a.z+1):e._position.set(n.x,a.y,n.z+1);var s=this.getStyle("alarm.billboard.scale");s instanceof Q?e._scale.copy(s):e._scale.set(o.x/2,o.x/2,1);var l=this.getStyle("alarm.billboard.vertical");e.setStyle("m.vertical",l)},getLinkOffset:function(e){return new mono.Vec3(0,0,0)},getLinkExtend:function(e){return new mono.Vec3(0,0,0)},clearLinkOrthogonal:function(e,t){return!1},clearLinkExtend:function(e,t){return!1},setAlarmBillboard:function(e){if(this._alarmBillboard!=e){var t=this._alarmBillboard;e?((this._alarmBillboard=e).setParent(this),e.setClient("alarmBillboard",!0),this._setAlarmBillboardPositionAndSize(e)):(this._alarmBillboard.setParent(null),delete this._alarmBillboard),this.firePropertyChange("alarmBillboard",t,e)}},needUpdate:function(){return this.verticesNeedUpdate||this.elementsNeedUpdate||this.uvsNeedUpdate||this.normalsNeedUpdate||this.colorsNeedUpdate},getVerticesWithChildren:function(t,i){function e(e){e.applyMatrix4(t),i.push(e)}if(null==i&&(i=[]),null==t&&(t=new ie),this instanceof Se.Node){if(null!=this.vertices&&0!=this.vertices.length){var r=this.getBoundingBox(),a=r.min,n=r.max;e(a.clone()),e(n.clone()),e(new Q(a.x,a.y,n.z)),e(new Q(a.x,n.y,a.z)),e(new Q(n.x,a.y,a.z)),e(new Q(n.x,n.y,a.z)),e(new Q(n.x,a.y,n.z)),e(new Q(a.x,n.y,n.z))}for(var o=0;o<(this._childList?this._childList.size():0);o++){var s=this._childList.get(o),l=new ie;l.multiplyMatrices(t,s.matrix.clone()),s.getVerticesWithChildren&&s.getVerticesWithChildren(l,i)}}return i},getBoundingBoxWithChildren:function(e){var t=this.getVerticesWithChildren();if(e)for(var i=0;i<e.length;i++){var r=e[i];if(r.getParent()===this.getParent()&&r!==this){var a=(new ie).getInverse(this.matrix.clone()),n=(new ie).multiplyMatrices(a,r.matrix.clone());t=t.concat(r.getVerticesWithChildren(n))}}var o=new Se.BoundingBox;return o.setFromPoints(t),o},getWorldBoundingBox:function(){for(var e=[],t=0;t<this.vertices.length;t++){var i=this.vertices[t].clone();i.applyMatrix4(this.worldMatrix),e.push(i)}var r=new Se.BoundingBox;return r.setFromPoints(e),r},getBoundingBox:function(){return null==this.boundingBox&&this.computeBoundingBox(),this.boundingBox},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Se.BoundingBox),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Se.BoundingSphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},createPropagateAlarmCube:function(e){if(null==this.boundingBox&&this.computeBoundingBox(),e._attachId=this._id,null==this.propagateAlarmData){var t=this.getStyle("outer.offset"),i=this.boundingBox.min,r=this.boundingBox.max;e.width=r.x-i.x+t,e.height=r.y-i.y+t,e.depth=r.z-i.z+t,e.computed=!1,e.computeNodeData(),this.propagateAlarmData=e.data,ge(e,!0),this.propagateAlarmData.primitive=e.primitive,this.propagateAlarmData.groups=e.groups;for(var a=(new Q).center(i,r),n=0;n<e.vertices.length;n++)e.vertices[n].add(a);this.propagateAlarmData.vertices=e.vertices}else{var o=this.propagateAlarmData;e.primitive=o.primitive,e.data=o,e.vertices=o.vertices,e.uvs=o.uvs,e.faces=o.faces,e.groups=o.groups}this.updateMatrix(!0),e._position.copy(this._position),e._scale.copy(this._scale),e._rotation.copy(this._rotation),e.useQuaternion=this.useQuaternion,e.quaternion=this.quaternion,e.worldMatrix=this.worldMatrix,e._parent=this.getParent(),e.updateMatrix(!0);var s=e.material;s.wireframeLinewidth=this.getStyle("outer.width");var l=this.getAlarmState().getPropagateSeverity();return s.wireframeLinecolor.set(l.color),e},createCanvasSelectionCube:function(){return null==this._csc&&(this._csc=new Le,this._csc.material=new Se.EntityMaterial,this._csc.material.wireframe=!0),this.createSelectionCube(this._csc),this._csc},createSelectionCube:function(e){if(null==this.boundingBox&&this.computeBoundingBox(),e._attachId=this._id+"_selection",null==this.selectionData){var t=this.getStyle("select.offset"),i=this.boundingBox.min,r=this.boundingBox.max,a=(new Q).center(i,r);e.width=r.x-i.x+t,e.height=r.y-i.y+t,e.depth=r.z-i.z+t,e.offset=a,e.computed=!1,e.computeNodeData(),this.selectionData=e.data,ge(e,!0),this.selectionData.primitive=e.primitive,this.selectionData.groups=e.groups,this.selectionData.vertices=e.vertices}else{var n=this.selectionData;e.primitive=n.primitive,e.data=n,e.vertices=n.vertices,e.uvs=n.uvs,e.faces=n.faces,e.groups=n.groups}this.updateMatrix(!0),e._position.copy(this._position),e._scale.copy(this._scale),e._rotation.copy(this._rotation),e.useQuaternion=this.useQuaternion,e.quaternion=this.quaternion,e.worldMatrix=this.worldMatrix,e._parent=this.getParent(),e.updateMatrix(!0);var o=e.material;return o.wireframeLinewidth=this.getStyle("select.width"),o.color.set(this.getStyle("select.color")),o.wireframeLinecolor.set(this.getStyle("select.color")),e},mergeVertices:function(){var e,t,i,r,a,n,o,s={},l=[],h=[],c=Math.pow(10,4);for(this.__tmpVertices=Me,null==this.vertices&&console.log("vertices is null"),i=0,r=this.vertices.length;i<r;i++)e=this.vertices[i],s[t=[Math.round(e.x*c),Math.round(e.y*c),Math.round(e.z*c)].join("_")]===Me?(s[t]=i,l.push(this.vertices[i]),h[i]=l.length-1):h[i]=h[s[t]];var u=[];for(i=0,r=this.faces.length;i<r;i++)if((a=this.faces[i])instanceof Ce){a.a=h[a.a],a.b=h[a.b],a.c=h[a.c],n=[a.a,a.b,a.c];for(var f=-1,p=0;p<3;p++)if(n[p]==n[(p+1)%3]){f=p,u.push(i);break}}else if(a instanceof Ee){a.a=h[a.a],a.b=h[a.b],a.c=h[a.c],a.d=h[a.d],n=[a.a,a.b,a.c,a.d];for(f=-1,p=0;p<4;p++)n[p]==n[(p+1)%4]&&(0<=f&&u.push(i),f=p);if(0<=f){n.splice(f,1);var d=new Ce(n[0],n[1],n[2],a.normal,a.color,a.materialIndex);(o=this.uvs[i])&&o.splice(f,1),a.vertexNormals&&0<a.vertexNormals.length&&(d.vertexNormals=a.vertexNormals,d.vertexNormals.splice(f,1)),a.vertexColors&&0<a.vertexColors.length&&(d.vertexColors=a.vertexColors,d.vertexColors.splice(f,1)),this.faces[i]=d}}for(i=u.length-1;0<=i;i--);var m=this.vertices.length-l.length;return this.vertices=l,m},computeVertexNormals:function(e){var t,i,r,a,n,o;if(this.__tmpVertices===Me){for(this.__tmpVertices=new Array(this.vertices.length),o=this.__tmpVertices,t=0,i=this.vertices.length;t<i;t++)o[t]=new Se.Vec3;for(r=0,a=this.faces.length;r<a;r++)(n=this.faces[r]).vertexNormals=[new Se.Vec3,new Se.Vec3,new Se.Vec3]}else for(o=this.__tmpVertices,t=0,i=this.vertices.length;t<i;t++)o[t].set(0,0,0);if(e){var s,l,h,c=new Se.Vec3,u=new Se.Vec3;for(new Se.Vec3,new Se.Vec3,new Se.Vec3,r=0,a=this.faces.length;r<a;r++)n=this.faces[r],s=this.vertices[n.a],l=this.vertices[n.b],h=this.vertices[n.c],c.subVectors(h,l),u.subVectors(s,l),c.cross(u),o[n.a].add(c),o[n.b].add(c),o[n.c].add(c),n.d!=Me&&o[n.d].add(c)}else for(r=0,a=this.faces.length;r<a;r++)o[(n=this.faces[r]).a].add(n.normal),o[n.b].add(n.normal),o[n.c].add(n.normal);for(t=0,i=this.vertices.length;t<i;t++)o[t].normalize();for(r=0,a=this.faces.length;r<a;r++)(n=this.faces[r]).vertexNormals[0].copy(o[n.a]),n.vertexNormals[1].copy(o[n.b]),n.vertexNormals[2].copy(o[n.c]),n.d!=Me&&(n.vertexNormals[3]=o[n.d].clone())},computeCentroids:function(){var e,t,i;for(e=0,t=this.faces.length;e<t;e++)(i=this.faces[e]).centroid=i.centroid||new Q,null==i.centroid&&console.log("fdasfdsa"),i.centroid.set||(i.centroid=new Q),i.centroid.set(0,0,0),i instanceof Ce?(i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.divideScalar(3)):i instanceof Ee&&(i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.add(this.vertices[i.d]),i.centroid.divideScalar(4))},computeFaceNormals:function(){var e,t,i,r,a,n,o=new Q,s=new Q;for(e=0,t=this.faces.length;e<t;e++)i=this.faces[e],r=this.vertices[i.a],a=this.vertices[i.b],n=this.vertices[i.c],o.subVectors(n,a),s.subVectors(r,a),o.cross(s),o.normalize(),i.normal.copy||(i.normal=new Q),i.normal.copy(o)},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,r=t.length;i<r;i++)0<i&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeVertex:function(){},computePrimitive:function(){},generalteGroup:function(){},getMatetial:function(){return this.material},computeNodeMaterial:function(e){},cacheNodeMaterial:function(e){},needComputeVertexNormal:function(){return!0},needComputeLineDistance:function(){return!1},computeNodeData:function(e){if(!1===this.computed){var t=this.generatePrimitiveKey();this._attachId&&(t+="_"+this._attachId);var i=Se.PrimitiveCache.getPrimitive(t),r=!1;if(i)this.primitive&&Se.PrimitiveCache.unUsePrimitive(i),this.computeNodeMaterial(i);else{var a=this.computeData();if(this.needComputeVertexNormal()&&(Se.Node.prototype.mergeVertices.call(a),Se.Node.prototype.computeFaceNormals.call(a),Se.Node.prototype.computeVertexNormals.call(a,!0)),(null==a.uv2s||0==a.uv2s.length)&&(a.uv2s=[],null!=a.uvs&&0<a.uvs.length))for(var n=0;n<a.uvs.length;n++){for(var o=[],s=a.uvs[n],l=0;l<s.length;l++)o.push(s[l].clone());a.uv2s.push(o)}i=new Se.Primitive(a,t),Se.PrimitiveCache.setPrimitive(t,i),this.cacheNodeMaterial(i),r=!0}return Se.PrimitiveCache.usePrimitive(i),this.primitive=i,this.data=i.data,this.vertices=i.vertices,this.faces=i.faces,this.uvs=i.uvs,this.uv2s=i.uv2s,this.colors=i.colors,this.needComputeLineDistance()&&(this.computeLineDistances(),this.data.lineDistances=this.lineDistances),this.computed=!0,r}},computeData:function(){var e={vertices:[],faces:[],uv2s:[],uvs:[]};return this.vertices=e.vertices,this.uvs=e.uvs,this.faces=e.faces,this.data=e},setMaterial:function(e,t,i){var r=t.getUniqueCode?t.getUniqueCode():null,a=Ut.getMaterial(r);a?(this.material.materials[e]=a,Ut.useMaterial(a)):(this.material.materials[e]=t,Ut.setMaterial(r,t),Ut.useMaterial(t)),Ut.unUseMaterial(i)},onMaterialMapping:function(){this.groups=Me},getMaterialSize:function(){return this.materialSize||1},startBatch:function(){this.batch=!0},endBatch:function(){this.materialMappingChanges!==Me&&(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",this.materialMappingChanges[0],this.materialMappingChanges[1]),this.materialMappingChanges=Me),this.batch=!1},compareAndSetMaterial:function(e,t,i){this.setMaterial(i,t,e)},cloneStyle:function(e){if(this.getClassName()==e.getClassName()){for(var t=this.getMaterialMapping(),i=0;i<this.getMaterialSize();i++){var r=this.material.materials[i],a=e.material.materials[i];this.compareAndSetMaterial(r,a,i)}var n=this.getMaterialMapping();Se.Utils.isSame(t,n)||(this.batch?this.materialMappingChanges=[t,n]:(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",t,n)))}else console.warn("ApplyStyle fail, the source with not the same class")},_considerArray:function(e,t){if(e.startsWith("envmap.image")){var i=!1;if(je.isArray(t))for(var r=0;r<t.length;r++)if(je.isArray(t[r])){i=!0;break}return i}return je.isArray(t)},setMaterialStyles:function(e){for(var t,i,r,a,n,o=this.getMaterialMapping(),s=(o=this.getMaterialMapping(),0);s<this.getMaterialSize();s++){r=(i=this.material.materials[s]).clone();var l=!1;for(var h in e){if(h.startsWith("m."))a=h.substr(h.indexOf(".")+1);else if(this.getSideIndexMapping()&&this.isSideStyle(h)){var c=h.substr(0,h.indexOf("."));if(this.getSideMaterialIndex(c)!=s)continue;a=(n=h.substr(h.indexOf(".")+1)).substr(n.indexOf(".")+1)}null==(t=e[h][0])?t=Se.Styles.getStyle(h):this._considerArray(a,t)&&(t=t[s]),this._A97(r,a,t),l=!0}l&&this.compareAndSetMaterial(i,r,s)}this.changeMapping(o)},setMaterialStyle:function(e,t,i){var r,a,n,o,s=e;if(e.startsWith("m.")&&(s=e.substr(e.indexOf(".")+1)),null==i&&!Se.Utils.isArray(t)){var l=[];for(f=0;f<this.getMaterialSize();f++)l.push(t);t=this.styleMap[e]=l}var h=!1;if(s.startsWith("envmap.image")&&t&&je.isArray(t))for(f=0;f<t.length;f++){if(je.isArray(t[f])){h=!1;break}h=!0}if(c=this.getMaterialMapping(),null!=i||Se.Utils.isArray(t)&&!h){if(Se.Utils.isArray(t))for(r=t,f=0;f<this.getMaterialSize();f++)a=r[f],o=(n=this.material.materials[f]).clone(),null==a&&(a=Se.Styles.getStyle(e)),this._A97(o,s,a),this.compareAndSetMaterial(n,o,f);else if(null!=i){var c=this.getMaterialMapping();o=(n=this.material.materials[i]).clone(),this._A97(o,s,t),this.compareAndSetMaterial(n,o,i),this.synchronizeIndexStyle(e,i,t)}}else for(var u=[],f=0;f<this.getMaterialSize();f++)!0!==u[f]&&(a=t,o=(n=this.material.materials[f]).clone(),null==a&&(a=Se.Styles.getStyle(e)),this._A97(o,s,a),this.compareAndSetMaterial(n,o,f));this.changeMapping(c)},changeMapping:function(e){var t=this.getMaterialMapping();Se.Utils.isSame(e,t)||(this.batch?this.materialMappingChanges=[e,t]:(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",e,t)))},synchronizeSideStyle:function(e,t,i){var r=this.getMaterialIndexSide(t);r&&null!=this.styleMap[r+"."+e]&&(this.styleMap[r+"."+e]=i)},synchronizeIndexStyle:function(e,t,r){var a=this.styleMap[e];if(null==a&&(a=this.getStyle(e),this.styleMap[e]=a),Se.Utils.isArray(a))a[t]=r;else{var n=[];for(i=0;i<this.getMaterialSize();i++)n.push(a);n[t]=r,this.styleMap[e]=n}},getDefaultMaterial:function(e,t){return e?e instanceof Se.ArrayMaterial?0===e.materials.length?Ut.DefaultMaterial:(t>=e.materials.length&&(t=e.materials.length-1),e.materials[t]):e:Ut.DefaultMaterial},createMaterial:function(e){var t=new Se.ArrayMaterial;this.material=t;for(var i=this.getMaterialSize(),r=0;r<i;r++)this.setMaterial(r,this.getDefaultMaterial(e,r))},onPropertyChange:function(e,t,i){this.changeProperty=e,this.oldGroups=this.groups;var r=this.isSizeChangedProperty(e);r&&this.onSizeChanged(),r&&this.onMaterialMapping(),r&&this.firePropertyChange("materialMapping",0,1)},onSizeChanged:function(){this.computed=!1,this.computeNodeData(),this.computeCentroids(),this.computeFaceNormals(),this.computeBoundingBox(),this.selectionData=null,this.boundingSphere=null,this.changeProperty=null},isSizeChangedProperty:function(e){return-1!==this.__SizePropeties.indexOf(e)||"vertices"==e||"faces"==e||"uvs"==e},isGroupChangedProperty:function(e){},getMaterialMapping:function(){var e={},t=this.material.materials;for(var i in t)e[i]=t.indexOf(t[i]);return e},getSideMaterialIndex:function(e){var t=this.getSideIndexMapping();if(t)return t[e]},getMaterialIndexSide:function(e){var t=this.getIndexSideMapping();if(t)return t[e]},getIndexSideMapping:function(){var e,t,i=this.getSideIndexMapping();if(i&&!this.IndexSideMapping)for(e in this.IndexSideMapping={},i)t=i[e],this.IndexSideMapping[t]=e;return this.IndexSideMapping},getSideIndexMapping:function(){},disposeMaterial:function(){},getMaterial:function(){return this.material}});var Te=function(e,t,i){this.normal=e instanceof Se.Vec3?e:new Se.Vec3,this.vertexNormals=e instanceof Array?e:[],this.color=t instanceof Se.Color?t:new Se.Color,this.vertexColors=t instanceof Array?t:[],this.materialIndex=i||0,this.centroid=new Se.Vec3,this.needVertexNormal=!1};(Se.Face=Te).prototype={constructor:Se.Face,subClone:function(){},clone:function(){var e,t,i=this.subClone();for(i.normal.copy(this.normal),i.color.copy(this.color),i.centroid.copy(this.centroid),i.materialIndex=this.materialIndex,e=0,t=this.vertexNormals.length;e<t;e++)i.vertexNormals.push(this.vertexNormals[e]);for(e=0,t=this.vertexColors.length;e<t;e++)i.vertexColors.push(this.vertexColors[e]);return i}};var Ce=function(e,t,i,r,a,n){Se.Face.call(this,r,a,n),this.a=e,this.b=t,this.c=i};(Se.Face3=Ce).prototype=Object.create(Se.Face.prototype),Ce.prototype.constructor=Se.Face3,Ce.prototype.subClone=function(){return new Ce(this.a,this.b,this.c)},Ce.prototype.vertexCount=3,Ce.prototype.serializeJsonValue=function(){return{a:this.a,b:this.b,c:this.c}};var Ee=function(e,t,i,r,a,n,o){Se.Face.call(this,a,n,o),this.a=e,this.b=t,this.c=i,this.d=r};(Se.Face4=Ee).prototype=Object.create(Se.Face.prototype),Ee.prototype.constructor=Se.Face4,Ee.prototype.subClone=function(){return new Ee(this.a,this.b,this.c,this.d)},Ee.prototype.splitToFace3s=function(){return[new Ce(this.a,this.b,this.d,this.normal,this.color,this.materialIndex),new Ce(this.d,this.b,this.c,this.normal,this.color,this.materialIndex)]},Ee.prototype.vertexCount=4,Ee.prototype.serializeJsonValue=function(){return{a:this.a,b:this.b,c:this.c,d:this.d}},Se.Entity=function(e,t){e instanceof Se.ArrayMaterial?(this.material=e,this.materialSize=this.material.materials.length||1):e instanceof Se.Material?(this.material=e,this.materialSize=1):e&&(this.materialSize=e),this.materialSize=this.materialSize||1,this.createMaterial(this.material),t!=Me&&null==this._id&&(this._id=t),Se.Node.call(this,this._id),this.groups=null},Se.extend(Se.Entity,Se.Node,{constructor:Se.Entity,className:"TGL.Entity",__accessor:["computeVertexNormal"],__SizePropeties:["computeVertexNormal"],setUpdateFlags:function(e){this.verticesNeedUpdate=e,this.elementsNeedUpdate=e,this.uvsNeedUpdate=e,this.normalsNeedUpdate=e,this.colorsNeedUpdate=e,this.buffersNeedUpdate=e},cloneCallback:function(e){e&&"TGL.Entity"===this.className&&(this.computed=!1,this.computeNodeData())},needComputeVertexNormal:function(){return this.computeVertexNormal},computeData:function(){return{vertices:this.vertices,faces:this.faces,uvs:this.uvs,uv2s:this.uv2s}},createCloneObject:function(){return this.constructor===Se.Entity?new Se.Entity(this.materialSize):Se.Element.prototype.createCloneObject.call(this)},getMaterialSize:function(){return this.materialSize},setMaterialSize:function(e){"number"==typeof e&&(this.materialSize=e,this.createMaterial(this.material))},calculateNormals:function(e,t){for(var i=[],r=0;r<e.length;r+=3)i[r+0]=0,i[r+1]=0,i[r+2]=0;for(r=0;r<t.length;r+=3){var a=[],n=[],o=[];a[0]=e[3*t[r+2]+0]-e[3*t[r+1]+0],a[1]=e[3*t[r+2]+1]-e[3*t[r+1]+1],a[2]=e[3*t[r+2]+2]-e[3*t[r+1]+2],n[0]=e[3*t[r]+0]-e[3*t[r+1]+0],n[1]=e[3*t[r]+1]-e[3*t[r+1]+1],n[2]=e[3*t[r]+2]-e[3*t[r+1]+2],o[0]=a[1]*n[2]-a[2]*n[1],o[1]=a[2]*n[0]-a[0]*n[2],o[2]=a[0]*n[1]-a[1]*n[0];for(var s=0;s<3;s++)i[3*t[r+s]+0]=i[3*t[r+s]+0]+o[0],i[3*t[r+s]+1]=i[3*t[r+s]+1]+o[1],i[3*t[r+s]+2]=i[3*t[r+s]+2]+o[2]}for(r=0;r<e.length;r+=3){var l=[];l[0]=i[r+0],l[1]=i[r+1],l[2]=i[r+2];var h=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]);0==h&&(h=1),l[0]=l[0]/h,l[1]=l[1]/h,l[2]=l[2]/h,i[r+0]=l[0],i[r+1]=l[1],i[r+2]=l[2]}return new Float32Array(i)}});var ze,De,Le=function(){var e,t,i,r,a,n,o,s,l;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(e=(o=arguments[0]).width,t=o.height,i=o.depth,r=o.segmentsW,a=o.segmentsH,n=o.segmentsD,l=o.wrapMode,s=o.id):arguments[0]instanceof Se.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],i=arguments[3],r=arguments[4],a=arguments[5],n=arguments[6],l=arguments[7]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4],n=arguments[5],l=arguments[6],s=arguments[7]),this.width=e||1,this.height=t||1,this.depth=i||1,this.segmentsW=r||1,this.segmentsH=a||1,this.segmentsD=n||1,this.wrapMode=(l||"").toLowerCase(),this.materialSize=null==this.wrapMode||""==this.wrapMode?6:1,this.offset=new Q(0,0,0),this._id=s,Se.Entity.call(this)};Se.Cube=Le,Se.extend(Se.Cube,Se.Entity,{__accessor:["width","height","depth","wrapMode"],__SizePropeties:["width","height","depth","wrapMode"],className:"TGL.Cube",getUVs:function(){return this.uvs},setPropertyValue:function(e,t){if(this[e]===t)return!1;if(this[e]=t,"wrapMode"===e){var i=this.wrapMode,r="six-each"==i||"front-other"==i||"back-other"==i||"left-other"==i||"right-other"==i||"top-other"==i||"bottom-other"==i,a=null==this.wrapMode||""==this.wrapMode?6:1;this.setMaterialSize(a),r||(this[e]="")}return!0},getLinkOffset:function(e){e.length(),e.normalize();var t=e.x/this.getWidth(),i=e.y/this.getHeight(),r=e.z/this.getDepth(),a=Math.max(Math.abs(t),Math.abs(i),Math.abs(r));return a==Math.abs(t)?new Q(this.getWidth()/2*(t<0?-1:1),0,0):a==Math.abs(i)?new Q(0,this.getHeight()/2*(i<0?-1:1),0):new Q(0,0,this.getDepth()/2*(r<0?-1:1))},getLinkExtend:function(e){var t=this.worldMatrix.clone();return t=(new mono.Mat4).extractRotation(t),this.getLinkOffset(e.applyMatrix4((new ie).getInverse(t)))},computeData:function(){var e=fe.buildCubeData(this.width,this.height,this.depth,this.segmentsW,this.segmentsH,this.segmentsD,this.wrapMode,this.offset||new Q(0,0,0));return this.vertices=e.vertices,this.uvs=e.uvs,this.faces=e.faces,this.data=e},getSideIndexMapping:function(){return this.wrapMap?null:Se.Cube.SideIndexMapping},generatePrimitiveKey:function(){return"cube_"+this.width+"_"+this.height+"_"+this.depth+"_"+this.segmentsW+"_"+this.segmentsH+"_"+this.segmentsD+"_"+(this.material instanceof Se.ArrayMaterial?1:0)+"_"+this.wrapMode+"_"+this.offset.x+"_"+this.offset.y+"_ "+this.offset.z+"_"+Se.Utils.toString(this.getMaterialMapping())},serialize:function(e){var t=e;1!==this.width&&t.serializeSimple("p","width",this.width,"number"),1!==this.height&&t.serializeSimple("p","height",this.height,"number"),1!==this.depth&&t.serializeSimple("p","depth",this.depth,"number"),1!==this.widthSegemtns&&t.serializeSimple("p","widthSegemtns",this.widthSegemtns,"number"),1!==this.heightSegments&&t.serializeSimple("p","heightSegments",this.heightSegments,"number"),1!==this.depthSegments&&t.serializeSimple("p","depthSegments",this.depthSegments,"number"),Se.Element.serialize.call(this,t)}}),Le.SideIndexMapping={right:0,left:1,top:2,bottom:3,front:4,back:5},Se.Sphere=function(){var e,t,i,r,a,n,o;if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var s=arguments[0];e=s.radius,t=s.segmentsW,i=s.segmentsH,r=s.longitudeStart,a=s.longitudeLength,n=s.latitudeStart,this._id=s.id}else arguments[0]instanceof Se.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],i=arguments[3],r=arguments[4],a=arguments[5],n=arguments[6],o=arguments[7]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4],n=arguments[5],o=arguments[6]);this.radius=e||50,this.segmentsW=Math.max(3,Math.floor(t)||22),this.segmentsH=Math.max(2,Math.floor(i)||15),this.longitudeStart=r!==Me?r:0,this.longitudeLength=a!==Me?a:2*Math.PI,this.latitudeStart=n!==Me?n:0,this.latitudeLength=o!==Me?o:Math.PI,this.materialSize=1,Se.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Se.extend(Se.Sphere,Se.Entity,{constructor:Se.Sphere,__accessor:["radius","segmentsW","segmentsH","latitudeStart","latitudeLength","longitudeStart","longitudeLength"],__SizePropeties:["radius","segmentsW","segmentsH","latitudeStart","latitudeLength","longitudeStart","longitudeLength"],className:"TGL.Sphere",computeData:function(){var e=fe.bsd(this.radius,this.segmentsW,this.segmentsH,this.longitudeStart,this.longitudeLength,this.latitudeStart,this.latitudeLength);return this.vertices=e.vertices,this.uvs=e.uvs,this.faces=e.faces,this.data=e},generatePrimitiveKey:function(){return"sphere_"+this.radius+"_"+this.segmentsW+"_"+this.segmentsH+"_"+this.longitudeStart+"_"+this.longitudeLength+"_"+this.latitudeStart+"_"+this.latitudeLength},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Se.BoundingSphere(new Se.Vec3,this.radius))},getLinkOffset:function(e){return e.length(),e.normalize(),e.multiplyScalar(this.radius)},serialize:function(e){var t=e;50!==this.radius&&t.serializeSimple(wt,"radius",this.radius,"number"),24!==this.widthSegments&&t.serializeSimple(wt,"widthSegments",this.widthSegments,"number"),18!==this.heightSegments&&t.serializeSimple(wt,"heightSegments",this.heightSegments,"number"),0!==this.phiStart&&t.serializeSimple(wt,"phiStart",this.phiStart,"number"),this.phiLength!==2*Math.PI&&t.serializeSimple(wt,"phiLength",this.phiLength,"number"),0!==this.thetaStart&&t.serializeSimple(wt,"thetaStart",this.thetaStart,"number"),this.thetaLength!==Math.PI&&t.serializeSimple(wt,"thetaLength",this.thetaLength,"number")}}),Se.Plane=function(){var e,t,i,r;arguments[0]instanceof Se.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],i=arguments[3],r=arguments[4]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3]),this.width=e||5,this.height=t||5,this.segmentsW=i||1,this.segmentsH=r||1,this.vertices=[],this.faces=[],this.uvs=[],this.uv2s=[],this.materialSize=1,this.computeData=function(){var e,t,i=this.width/2,r=this.height/2,a=this.segmentsW,n=this.segmentsH,o=a+1,s=n+1,l=this.width/a,h=this.height/n,c=new Se.Vec3(0,0,1),u={vertices:[],faces:[],uvs:[]};for(t=0;t<s;t++)for(e=0;e<o;e++){var f=e*l-i,p=t*h-r;u.vertices.push(new Se.Vec3(f,-p,0))}for(t=0;t<n;t++)for(e=0;e<a;e++){var d=e+o*t,m=e+o*(t+1),g=e+1+o*(t+1),y=e+1+o*t,v=new Se.Vec2(e/a,1-t/n),x=new Se.Vec2(e/a,1-(t+1)/n),A=new Se.Vec2((e+1)/a,1-(t+1)/n),_=new Se.Vec2((e+1)/a,1-t/n),w=new Se.Face4(d,m,g,y);w.normal.copy(c),w.vertexNormals.push(c.clone(),c.clone(),c.clone(),c.clone()),u.faces.push(w),u.uvs.push([v,x,A,_])}return u},Se.Entity.call(this),this.computeCentroids()},Se.extend(Se.Plane,Se.Entity,{constructor:Se.Plane,className:"TGL.Plane",__accessor:["width","height","segmentsW","segmentsH"],__SizePropeties:["width","height","segmentsW","segmentsH"],clone:function(){var e=new Se.Plane(this.material,this.width,this.height,this.segmentsW,this.segmentsH);return this.superClass.clone.call(this,e),e},getSelectStyle:function(){var e=this.getStyle("select.style");return"outline.normal"!=e&&"outline"!=e||(e="outline.wireframe"),e}}),Se.Cylinder=function(){var e,t,i,r,a,n,o,s,l;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(options=arguments[0],e=options.radiusTop,t=options.radiusBottom,i=options.height,r=options.segmentsR,a=options.segmentsH,n=options.openTop,o=options.openBottom,s=options.arcLength,l=options.arcStart,this._id=options.id):arguments[0]instanceof Se.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],i=arguments[3],r=arguments[4],a=arguments[5],n=arguments[6],o=arguments[7],s=arguments[8],l=arguments[9]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4],n=arguments[5],o=arguments[6],s=arguments[7],l=arguments[8]),this.radiusTop=e=e!==Me?e:20,this.radiusBottom=t=t!==Me?t:20,this.height=i=i!==Me?i:100,this.segmentsR=r=r||20,this.segmentsH=a=a||1,this.openTop=n!==Me&&n,this.openBottom=o!=Me&&o,this.arcLength=s!==Me?s:2*Math.PI,this.arcStart=l!==Me?l:0,this.materialSize=3,Se.Entity.call(this),this.computeNodeData(),this.computeCentroids(),this.computeFaceNormals()},Se.extend(Se.Cylinder,Se.Entity,{constructor:Se.Cylinder,__accessor:["radiusTop","radiusBottom","height","segmentsR","segmentsH","openTop","openBottom","arcLength","arcStart"],__bool:["openTop","openBottom"],__SizePropeties:["radiusTop","radiusBottom","height","segmentsR","segmentsH","openTop","openBottom","arcLength","arcStart"],className:"TGL.Cylinder",computeData:function(){return fe.bcld(this.height,this.segmentsH,this.radiusBottom,this.radiusTop,this.segmentsR,this.openTop,this.openBottom,this.arcLength,this.arcStart)},getLinkOffset:function(e){var t=e.length();e.normalize();var i=e.x,r=e.y,a=e.z,n=Math.sqrt(i*i+a*a),o=0<r?this.radiusTop:this.radiusBottom;return Math.abs(r/n)>this.height/2/o&&0<t?new Q(0,this.height/2*(0<r?1:-1),0):new Q(i,0,a).normalize().multiplyScalar((this.radiusTop+this.radiusBottom)/2)},getLinkExtend:function(e){var t=this.worldMatrix.clone();return t=(new mono.Mat4).extractRotation(t),this.getLinkOffset(e.applyMatrix4((new ie).getInverse(t)))},clearLinkOrthogonal:function(e,t,i,r){r=r||0;var a=this.getHeight()/2+r,n=(this.radiusTop+this.radiusBottom)/2+r;return"orthogonal.x"==i||"orthogonal.x.n"==i?!(Math.abs(e.y-t.y)>a||Math.abs(e.z-t.z)>n):"orthogonal.y"==i||"orthogonal.y.n"==i?!(Math.abs(e.x-t.x)>n||Math.abs(e.z-t.z)>n):("orthogonal.z"==i||"orthogonal.z.n"==i)&&!(Math.abs(e.y-t.y)>a||Math.abs(e.z-t.z)>n)},clearLinkExtend:function(e,t){if("extend.x"===t);else if("extend.y"===t&&e>this.getHeight()/2)return!0;return!1},getSideIndexMapping:function(){return Se.Cylinder.SideIndexMapping},generatePrimitiveKey:function(){return"cylinder_"+this.height+"_"+this.segmentsH+"_"+this.radiusTop+"_"+this.radiusBottom+"_"+this.segmentsR+"_"+this.openTop+"_"+this.openBottom+"_"+this.arcLength+"_"+this.arcStart+Se.Utils.toString(this.getMaterialMapping())},needComputeVertexNormal:function(){return!1}}),Se.Cylinder.SideIndexMapping={side:0,top:1,bottom:2},Se.Circle=function(){var e,t,i,r;4===arguments.length?(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3]):(this.material=arguments[0],e=arguments[1],t=arguments[2],i=arguments[3],r=arguments[4]),this.radius=e=e||50,this.segments=t=t!==Me?Math.max(3,t):8,this.thetaStart=i=i!==Me?i:0,this.thetaLength=r=r!==Me?r:2*Math.PI,this.materialSize=1,Se.Entity.call(this),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new Se.BoundingSphere(new Se.Vec3,e)},Se.extend(Se.Circle,Se.Entity,{clone:function(){var e=new Se.Circle(this.material,this.radius,this.segments,this.thetaStart,this.thetaLength);return this.constructor.superClass.clone.call(this,e),e},computeData:function(){var e,t=this.segments,i=[],r=new Se.Vec3,a=new Se.Vec2(.5,.5),n={vertices:[],faces:[],uvs:[],uv2s:[]};for(n.vertices.push(r),i.push(a),e=0;e<=t;e++){var o=new Se.Vec3,s=this.thetaStart+e/t*this.thetaLength;o.x=this.radius*Math.cos(s),o.y=this.radius*Math.sin(s),n.vertices.push(o),i.push(new Se.Vec2((o.x/this.radius+1)/2,(o.y/this.radius+1)/2))}var l=new Se.Vec3(0,0,1);for(e=1;e<=t;e++){var h=e,c=e+1;n.faces.push(new Se.Face3(h,c,0,[l,l,l])),n.uvs.push([i[e],i[e+1],a])}return n}}),Se.Torus=function(){var e,t,i,r,a;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(options=arguments[0],e=options.radius,t=options.tube,i=options.segmentsR,r=options.segmentsT,a=options.arc,this._id=options.id):arguments[0]instanceof Se.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],i=arguments[3],r=arguments[4],a=arguments[5]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4]),this.materialSize=1,this.radius=e||100,this.tube=t||40,this.segmentsR=i||8,this.segmentsT=r||6,this.arc=a||2*Math.PI,Se.Entity.call(this),this.computeNodeData(),this.computeCentroids()},Se.extend(Se.Torus,Se.Entity,{__accessor:["radius","tube","segmentsR","segmentsT","arc"],__SizePropeties:["radius","tube","segmentsR","segmentsT","arc"],className:"TGL.Torus",generatePrimitiveKey:function(){return"torus_"+this.radius+"_"+this.tube+"_"+this.segmentsR+"_"+this.segmentsT+"_"+this.arc},computeData:function(){for(var e=new Se.Vec3,t=[],i=[],r={vertices:[],faces:[],uvs:[],uv2s:[]},a=0;a<=this.segmentsR;a++)for(l=0;l<=this.segmentsT;l++){var n=l/this.segmentsT*this.arc,o=a/this.segmentsR*Math.PI*2;e.x=this.radius*Math.cos(n),e.y=this.radius*Math.sin(n);var s=new Se.Vec3;s.x=(this.radius+this.tube*Math.cos(o))*Math.cos(n),s.y=(this.radius+this.tube*Math.cos(o))*Math.sin(n),s.z=this.tube*Math.sin(o),r.vertices.push(s),t.push(new Se.Vec2(l/this.segmentsT,a/this.segmentsR)),i.push(s.clone().sub(e).normalize())}for(a=1;a<=this.segmentsR;a++)for(var l=1;l<=this.segmentsT;l++){var h=(this.segmentsT+1)*a+l-1,c=(this.segmentsT+1)*(a-1)+l-1,u=(this.segmentsT+1)*(a-1)+l,f=(this.segmentsT+1)*a+l,p=new Se.Face3(h,c,f,[i[h],i[c],i[f]]);p.normal.add(i[h]),p.normal.add(i[c]),p.normal.add(i[f]),p.normal.normalize(),r.faces.push(p),r.uvs.push([t[h].clone(),t[c].clone(),t[f].clone()]),(p=new Se.Face3(c,u,f,[i[c],i[u],i[f]])).normal.add(i[c]),p.normal.add(i[u]),p.normal.add(i[f]),p.normal.normalize(),r.faces.push(p),r.uvs.push([t[c].clone(),t[u].clone(),t[f].clone()])}return r}}),Se.Arrow=function(){var e,t,i,r,a;arguments[0]instanceof Se.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],i=arguments[3],r=arguments[4],a=arguments[5]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4]),this.materialSize=1,this.tailHeight=e||100,this.tailRadius=t||20,this.headHeight=i||20,this.headRadius=r||30,this.radiusSegments=a||30,Se.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Se.extend(Se.Arrow,Se.Entity,{constructor:Se.Arrow,className:"TGL.Arrow",computeData:function(){var e=this.tailHeight,t=this.tailRadius,i=this.headHeight,r=this.headRadius,a=this.radiusSegments;this.headRadius<this.tailRadius&&(this.headRadius=this.tailRadius);var n,o,s=e+i,l=s/2,h=[],c=[],u=[],f=[];for(o=0;o<=2;o++){var p=[],d=[],m=(g=o/2)*r;for(n=0;n<=a;n++)y=n/a,(v=new Se.Vec3).x=m*Math.sin(y*Math.PI*2),v.y=-g*i+l,v.z=m*Math.cos(y*Math.PI*2),this.vertices.push(v),p.push(this.vertices.length-1),d.push(new Se.Vec2(y,1-g));h.push(p),u.push(d)}for(this.vertices.push(new Se.Vec3(0,l-i,0)),o=0;o<=2;o++){p=[],d=[];var g=o/2;m=t;for(n=0;n<=a;n++){var y=n/a,v=new Se.Vec3;v.x=m*Math.sin(y*Math.PI*2),v.y=-g*e+l-i,v.z=m*Math.cos(y*Math.PI*2),this.vertices.push(v),p.push(this.vertices.length-1),d.push(new Se.Vec2(y,1-g))}c.push(p),f.push(d)}for(this.vertices.push(new Se.Vec3(0,-l,0)),R=this.headRadius/s,n=0;n<a;n++)for(D=this.vertices[h[0][n]].clone(),L=this.vertices[h[0][n+1]].clone(),D.setY(Math.sqrt(D.x*D.x+D.z*D.z)*R).normalize(),L.setY(Math.sqrt(L.x*L.x+L.z*L.z)*R).normalize(),o=0;o<2;o++){var x=h[o][n],A=h[o+1][n],_=h[o+1][n+1],w=h[o][n+1],b=D.clone(),M=D.clone(),S=L.clone(),P=L.clone(),T=u[o][n].clone(),C=u[o+1][n].clone(),E=u[o+1][n+1].clone(),z=u[o][n+1].clone();this.faces.push(new Se.Face3(x,A,w,[b,M,P])),this.uvs.push([T,C,z]),this.faces.push(new Se.Face3(A,_,w,[M,S,P])),this.uvs.push([C,E,z])}for(n=0;n<a;n++){x=h[o][n+1],A=h[o][n],_=h.length-1,b=new Se.Vec3(0,-1,0),M=new Se.Vec3(0,-1,0),S=new Se.Vec3(0,-1,0),T=u[o][n+1].clone(),C=u[o][n].clone(),E=new Se.Vec2(C.u,1);this.faces.push(new Se.Face3(x,A,_,[b,M,S])),this.uvs.push([T,C,E])}var D,L,R=0;for(n=0;n<a;n++)for(D=this.vertices[c[1][n]].clone(),L=this.vertices[c[1][n+1]].clone(),D.setY(Math.sqrt(D.x*D.x+D.z*D.z)*R).normalize(),L.setY(Math.sqrt(L.x*L.x+L.z*L.z)*R).normalize(),o=0;o<2;o++){x=c[o][n],A=c[o+1][n],_=c[o+1][n+1],w=c[o][n+1],b=D.clone(),M=D.clone(),S=L.clone(),P=L.clone(),T=u[o][n].clone(),C=u[o+1][n].clone(),E=u[o+1][n+1].clone(),z=u[o][n+1].clone();this.faces.push(new Se.Face3(x,A,w,[b,M,P])),this.uvs.push([T,C,z]),this.faces.push(new Se.Face3(A,_,w,[M,S,P])),this.uvs.push([C,E,z])}for(n=0;n<a;n++){x=c[o][n+1],A=c[o][n],_=c.length-1,b=new Se.Vec3(0,-1,0),M=new Se.Vec3(0,-1,0),S=new Se.Vec3(0,-1,0),T=f[o][n+1].clone(),C=f[o][n].clone(),E=new Se.Vec2(C.u,1);this.faces.push(new Se.Face3(x,A,_,[b,M,S])),this.uvs.push([T,C,E])}return this}}),Se.BufferNode=function(){this.name="",this.attributes={},this.dynamic=!1,this.offsets=[],this.boundingBox=null,this.boundingSphere=null,this.mode="TRIANGLES",arguments[0]instanceof Se.Material?this.material=arguments[0]:this.material=new mono.EntityMaterial,Se.Element.call(this)},Se.extend(Se.BufferNode,Se.Element,{constructor:Se.BufferNode,computeNodeData:function(){if(!this.computed){if(!this.attributes.position)return;var e=this.attributes.index;if(e&&e.array){this.offsets=[{index:0,start:0,count:e.array.length}];var t,i=e.array.BYTES_PER_ELEMENT;t=1===i?5121:2===i?5123:5125,e.element_type=t,e.element_size=i}this.computed=!0}},setMaterialStyle:function(e,t){e=e.substr(e.indexOf(".")+1),this._A97(this.material,e,t)},_applyMatrix:function(e){var t,i;this.attributes.position&&(t=this.attributes.position.array),this.attributes.normal&&(i=this.attributes.normal.array),t!==Me&&(e.multiplyVec3Array(t),this.verticesNeedUpdate=!0),i!==Me&&((new Se.Matrix3).getNormalMatrix(e).multiplyVec3Array(i),this.normalizeNormals(),this.normalsNeedUpdate=!0)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Se.BoundingBox);var e=this.attributes.position&&this.attributes.position.array;if(e){var t,i,r,a=this.boundingBox;3<=e.length&&(a.min.x=a.max.x=e[0],a.min.y=a.max.y=e[1],a.min.z=a.max.z=e[2]);for(var n=3,o=e.length;n<o;n+=3)t=e[n],i=e[n+1],r=e[n+2],t<a.min.x?a.min.x=t:t>a.max.x&&(a.max.x=t),i<a.min.y?a.min.y=i:i>a.max.y&&(a.max.y=i),r<a.min.z?a.min.z=r:r>a.max.z&&(a.max.z=r)}e!==Me&&0!==e.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:(ze=new Se.BoundingBox,De=new Se.Vec3,function(){null===this.boundingSphere&&(this.boundingSphere=new Se.BoundingSphere);var e=this.attributes.position&&this.attributes.position.array;if(e){for(var t=this.boundingSphere.center,i=[],r=0,a=e.length;r<a;r+=3)De.set(e[r],e[r+1],e[r+2]),i.push(De);ze.setFromPoints(i),ze.center(t);var n=0;for(r=0,a=e.length;r<a;r+=3)De.set(e[r],e[r+1],e[r+2]),n=Math.max(n,t.distanceToSquared(De));this.boundingSphere.radius=Math.sqrt(n)}}),computeVertexNormals:function(){if(this.attributes.position){var e,t,i,r,a=this.attributes.position.array.length;if(this.attributes.normal===Me)this.attributes.normal={itemSize:3,array:new Float32Array(a)};else for(e=0,t=this.attributes.normal.array.length;e<t;e++)this.attributes.normal.array[e]=0;var n,o,s,l,h,c,u=this.attributes.position&&this.attributes.position.array,f=this.attributes.normal.array,p=new Se.Vec3,d=new Se.Vec3,m=new Se.Vec3,g=new Se.Vec3,y=new Se.Vec3;if(this.attributes.index){var v=this.attributes.index.array,x=this.offsets;for(i=0,r=x.length;i<r;++i){var A=x[i].start,_=x[i].count,w=x[i].index;for(t=(e=A)+_;e<t;e+=3)n=w+v[e],o=w+v[e+1],s=w+v[e+2],l=u[3*n],h=u[3*n+1],c=u[3*n+2],p.set(l,h,c),l=u[3*o],h=u[3*o+1],c=u[3*o+2],d.set(l,h,c),l=u[3*s],h=u[3*s+1],c=u[3*s+2],m.set(l,h,c),g.subVectors(m,d),y.subVectors(p,d),g.cross(y),f[3*n]+=g.x,f[3*n+1]+=g.y,f[3*n+2]+=g.z,f[3*o]+=g.x,f[3*o+1]+=g.y,f[3*o+2]+=g.z,f[3*s]+=g.x,f[3*s+1]+=g.y,f[3*s+2]+=g.z}}else for(e=0,t=u.length;e<t;e+=9)l=u[e],h=u[e+1],c=u[e+2],p.set(l,h,c),l=u[e+3],h=u[e+4],c=u[e+5],d.set(l,h,c),l=u[e+6],h=u[e+7],c=u[e+8],m.set(l,h,c),g.subVectors(m,d),y.subVectors(p,d),g.cross(y),f[e]=g.x,f[e+1]=g.y,f[e+2]=g.z,f[e+3]=g.x,f[e+4]=g.y,f[e+5]=g.z,f[e+6]=g.x,f[e+7]=g.y,f[e+8]=g.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e,t,i,r,a=this.attributes.normal.array,n=0,o=a.length;n<o;n+=3)e=a[n],t=a[n+1],i=a[n+2],r=1/Math.sqrt(e*e+t*t+i*i),a[n]*=r,a[n+1]*=r,a[n+2]*=r},clone:function(){var e=new Se.BufferNode,t=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var i in this.attributes){for(var r=this.attributes[i],a=r.array,n={itemSize:r.itemSize,numItems:r.numItems,array:null},o=0,s=t.length;o<s;o++){var l=t[o];if(a instanceof l){n.array=new l(a);break}}e.attributes[i]=n}for(o=0,s=this.offsets.length;o<s;o++){var h=this.offsets[o];e.offsets.push({start:h.start,index:h.index,count:h.count})}return e}}),Se.Particle=function(e,t,i){var r;1===arguments.length&&e instanceof Object&&!Array.isArray(e)&&(r=e,this._id=r.id),Se.Node.call(this,this._id),this.material=new Se.ParticleMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.frustumCulled=!1,this.vertices=(r?r.vertices:e)||[],this.colors=(r?r.colors:t)||[],this.sizes=(r?r.sizes:i)||[],this.setUpdateFlags(!0)},Se.extend(Se.Particle,Se.Node,{clone:function(e){return e===Me&&(e=new Se.Particle(this.material)),e.sortParticles=this.sortParticles,e.frustumCulled=this.frustumCulled,Se.Element.prototype.clone.call(this,e),e},needUpdate:function(){return!1},setUpdateFlags:function(e){this.verticesNeedUpdate=e,this.dirtyColors=e,this.normalsNeedUpdate=e},setMaterialStyle:function(e,t){e=e.substr(e.indexOf(".")+1),this._A97(this.material,e,t)},setMaterialStyles:function(e){Se.Element.prototype.setMaterialStyles.call(this,e)}}),Se.Line=function(e){this.material=new Se.LineMaterial({color:16777215}),Se.Node.call(this,e),this.type=this.type!==Me?this.type:Se.LineStrip},Se.LineStrip=0,Se.LinePieces=1,Se.extend(Se.Line,Se.Node,{className:"TGL.Line",__accessor:["vertices","type","colors"],__SizePropeties:["vertices","type","colors"],clone:function(e){return e===Me&&(e=new Se.Line(this.material,this.type)),Se.Element.prototype.clone.call(this,e,!0),e},onPropertyChange:function(e,t,i){},setMaterialStyle:function(e,t){e=e.substr(e.indexOf(".")+1),this._A97(this.material,e,t)},setMaterialStyles:function(e){Se.Element.prototype.setMaterialStyles.call(this,e)}}),Se.Line.createEllipse=function(e,t,i,r,a,n,o){"number"==typeof e?(o=n,n=a,a=r,r=i,i=t,t=e,e=new Se.Line):null==e&&(e=new Se.Line);for(var s=new Se.EllipseCurve(0,0,t,i,a,n,o),l=[],h=r||50,c=0;c<=h;c++){var u=s.getPoint(c/h);l.push(u)}return e.setVertices(l),e},Se.Line.createHelix=function(e,t,i,r,a,n){"number"==typeof e?(n=a,a=r,r=i,i=t,t=e,e=new Se.Line):null==e&&(e=new Se.Line);var o=[],s=n||50;a=a||1;for(var l,h,c,u,f=0;f<=s;f++)l=(i*f+t*(s-f))/s,c=a*Math.PI*2*f/s,h=r*(.5-f/s),u=new Q(l*Math.sin(c),h,l*Math.cos(c)),o.push(u);return e.setVertices(o),e},Se.Line.createRectangle=function(e,t,i,r){"number"==typeof e?(r=i||1,i=t,t=e,e=new Se.Line):null==e&&(e=new Se.Line);var a=r||50,n=2*(t+i)/a,o=[];if(n>Math.min(t,i))o.push(new Q(-t/2,-i/2,0)),o.push(new Q(-t/2,i/2,0)),o.push(new Q(t/2,i/2,0)),o.push(new Q(t/2,-i/2,0)),o.push(new Q(-t/2,-i/2,0));else for(var s,l=-t/2,h=-i/2,c=0;c<=a;c++)l==-t/2&&h<i/2?h+n<=i/2?h+=n:(o.push(new Q(-t/2,i/2,0)),o.push(new Q(-t/2,i/2,0)),l+=h+n-i/2,h=i/2):h==i/2&&l<=t/2?l+n<=t/2?l+=n:(o.push(new Q(t/2,i/2,0)),o.push(new Q(t/2,i/2,0)),h-=l+n-t/2,l=t/2):l==t/2&&-i/2<h?-i/2<=h-n?h-=n:(o.push(new Q(t/2,-i/2,0)),o.push(new Q(t/2,-i/2,0)),l-=-i/2-h+n,h=-i/2):h==-i/2&&-t/2<=l&&(-t/2<=l-n?l-=n:(h+=-t/2-l+n,l=-t/2)),s=new Q(l,h,0),o.push(s);return e.setVertices(o),e},Se.Line.createNurbs=function(e,t,i,r,a){if("[object Array]"===toString.apply(e)?(a=r,r=i,i=t,t=e,e=new Se.Line):null==e&&(e=new Se.Line),a){var n=e.material;n.skyY=a.skyY||0,n.horizonY=a.horizonY||0,n.earthY=a.earthY||0,n.skyColor=a.skyColor||new mono.Color(16777215),n.horizonColor=a.horizonColor||new mono.Color(16777215),n.earthColor=a.earthColor||new mono.Color(16777215)}i>t.length-1&&(console.log("max degree is :",t.length-1),i=t.length-1);for(var o=[],s=0;s<=i;s++)o.push(0);s=0;for(var l=t.length;s<l;s++){var h=(s+1)/(l-i);o.push(mono.Math.clamp(h,0,1))}var c=new mono.NurbsCurve(i,o,t);return e.setVertices(c.getPoints(t.length*r)),e},Se.Line.createDottedLine=function(e,t,i,r){e instanceof Array?(i=t,t=e,e=new Se.Line):null==e&&(e=new Se.Line);for(var a=[],n=t[0],o=1;o<t.length;o++){var s=t[o],l=(r=s.distanceTo(n)/(i[0]+i[1])||20,n.x),h=n.y,c=n.z,u=(s.x-l)/r,f=(s.y-h)/r,p=(s.z-c)/r,d=i[0]/(i[0]+i[1]),m=u*d,g=f*d,y=p*d;a.push(new mono.Vec3(l,h,c));for(var v=0;v<r;v++){var x=l+v*u,A=h+v*f,_=c+v*p;a.push(new mono.Vec3(x,A,_));x=l+v*u+m,A=h+v*f+g,_=c+v*p+y;a.push(new mono.Vec3(x,A,_))}n=s}return e.setVertices(a),e},Se.LineX=function(){var e,t,i;if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var r=arguments[0];e=r.points,t=r.colors,i=r.lineWidth,this._id=r.id||this._id}else e=arguments[0],t=arguments[1],i=arguments[2];this.material=new Se.LineXMaterial({color:16777215}),this.points=e||[],this.colors=t||[],this.lineWidth=i||1,Se.Entity.call(this,this.material,this._id)};var Re=function(e,t,i){if(t=t||[],null==e)return t;i=i||20,e instanceof Se.Curve||console.error(" TGL.LineX#makeSegment:TGL.Curve required");for(var r=0;r<i;r++)t.push(e.getPointAt(r/i));return t},Ne=function(e,t,i){if(null==e||e.actions.length<2)return null;for(var r,a=[],n=e.curves,o=n.length,s=0;s<o;s++)(r=n[s])instanceof Se.LineCurve3?a.push(r.v1):r instanceof Se.Curve&&Re(r,a,t),s==o-1&&a.push(r.v2);return i.push(a),i};Se.LineX.createLineXFromPathAndColors=function(e,t,i,r){var a=[];return e&&e.actions?Ne(e,r,a):e instanceof Array&&e.forEach(function(e){Ne(e,r,a)}),t=t||[],i=i||1,r=r||20,new Se.LineX(a,t,i)},Se.extend(Se.LineX,Se.Entity,{__accessor:["points","colors","lineWidth"],__SizePropeties:["points","colors","lineWidth"],computeData:function(){for(var e,t=this.points,i=this.colors,r={vertices:[],verticesPrev:[],verticesNext:[],offset:[],faces:[],uvs:[]},a=function(e){var t=[],i=!0,r=[];return e.forEach(function(e){e instanceof Array?(i=!0,t.push(e)):(i&&(i=!1,r=[],t.push(r)),r.push(e))}),t}(t),n=0,o=this.lineWidth,s=0;s<a.length;s++){var l=a[s],h=o;o instanceof Array&&(h=s<(e=o.length)-1?o[s]:o[e-1]),this._computeOnePath(l,i,r,h,n),n+=2*l.length}return r},_computeOnePath:function(a,e,t,i,r){var n=e.length;0!=n&&(t.colors=[]);var o=a.length,s=t.vertices,l=t.verticesPrev,h=t.verticesNext,c=[],u=t.offset,f=t.faces,p=[0],d=0;!function(){for(var e=1;e<o;e++){var t=a[e],i=a[e-1],r=new Q(t.x,t.y,t.z).distanceTo(new Q(i.x,i.y,i.z));d+=r,p.push(d)}}();for(var m=[],g=0;g<o;g++){var y=a[g],v=new Q(y.x,y.y,y.z);if(s.push(v),s.push(v.clone()),m.push(v),m.push(v.clone()),u.push(i/2),u.push(-i/2),c.push(new mono.Vec2(p[g]/d,0)),c.push(new mono.Vec2(p[g]/d,1)),t.colors){var x=e[Math.floor(g*n/o)];x instanceof Se.Color||(x=new Se.Color(x)),t.colors.push(x),t.colors.push(x.clone())}}for(g=0;g<o;g++){var A=2<=(b=2*g)?b-2:0,_=b<o-2?b+2:2*o-1;v=m[A];l.push(v.clone()),l.push(v.clone()),v=m[_],h.push(v.clone()),h.push(v.clone())}var w=o-1;for(g=0;g<w;g++){var b=2*g,M=b+r,S=new Ce(M,M+1,M+2);S.materialIndex=0,t.uvs.push([c[b],c[b+1],c[b+2]]),f.push(S),S=new Ce(M+2,M+1,M+3),t.uvs.push([c[b+2],c[b+1],c[b+3]]),S.materialIndex=0,f.push(S)}},getPointAt:function(e){null==e&&console.error("LineX#getPointAt method need one argument:percent"),(e=e||0)<0?e=0:1<e&&(e=1);var t=this.lineDistances.length;if(0==t&&console.error("There is  no data in lineDistances"),0==e)return this.vertices[0].clone();if(1==e)return this.vertices[t-1].clone();var i=this.lineDistances[t-1];0==i&&console.error("Total length is zero");for(var r=null,a=0;a<t;a+=2){var n=this.lineDistances[a]/i,o=a+2<t?a+2:a,s=this.lineDistances[o]/i;if(n<=e&&e<s){var l=this.vertices[a],h=this.vertices[o],c=h.clone().sub(l).length();if(0!=c){var u=(e-n)*i/c;r=(new Q).lerpVectors(l,h,u);break}r=l.clone(),console.error("There are two same points")}}return r},needComputeVertexNormal:function(){return!1},needComputeLineDistance:function(){return!0}}),Se.PathLine=function(){var e,t,i;if(1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof Se.Path)){var r=arguments[0];e=r.path,t=r.segments,i=r.type,this._id=r.id||this._id}else e=arguments[0],t=arguments[1],i=arguments[2],this._id=arguments[3];Se.Line.call(this,{vertices:[],colors:[],type:i,id:this._id}),this.segments=t||20,this.setPath(e)},Se.extend(Se.PathLine,Se.Line,{constructor:Se.PathLine,className:"TGL.PathLine",__accessor:["path","segments"],__SizePropeties:["path","segments"],onPropertyChange:function(){this.computeNodeData()},computeNodeData:function(){this.computeData()},adjustPath:function(e){return e},computeData:function(){var e=this.path;if(e){var t,i,r,a,n=(e=this.adjustPath(e)).curves.length,o=e.curves,s=[],l=e.getLength(),h=0,c=this.segments;for(m=0;m<n;m++){if(r=(i=o[m]).getLength(),i instanceof Se.LineCurve3){var u=h/l,f=(r+h)/l;s.push(u),s.push(f)}else for(a=0<m?1:0;a<=c;a++){var p=(r*a/c+h)/l;s.push(p)}h+=r}for(var d=[],m=0;m<s.length;m++)t=s[m],pos=e.getPointAt(t),d.push(pos);return this.vertices=d,[]}}}),Se.Polyhedron=function(){function p(e){var t=e.normalize().clone();t.index=m.vertices.push(t)-1;var i,r=n(e)/2/Math.PI+.5,a=(i=e,Math.atan2(-i.y,Math.sqrt(i.x*i.x+i.z*i.z))/Math.PI+.5);return t.uv=new Se.Vec3(r,1-a),t}function d(e,t,i){var r=new Se.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]);r.centroid.add(e).add(t).add(i).divideScalar(3),m.faces.push(r);var a=n(r.centroid);m.uvs.push([o(e.uv,e,a),o(t.uv,t,a),o(i.uv,i,a)])}function n(e){return Math.atan2(e.z,-e.x)}function o(e,t,i){return i<0&&1===e.x&&(e=new Se.Vec3(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new Se.Vec3(i/2/Math.PI+.5,e.y)),e.clone()}var e,t,i,r;arguments[0]instanceof Se.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],i=arguments[3],r=arguments[4]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3]),this.materialSize=1,Se.Entity.call(this),i=i||1,r=r||0;for(var m=this,a=0,s=e.length;a<s;a++)p(new Se.Vec3(e[a][0],e[a][1],e[a][2]));var l=this.vertices,h=[];for(a=0,s=t.length;a<s;a++){var c=l[t[a][0]],u=l[t[a][1]],f=l[t[a][2]];h[a]=new Se.Face3(c.index,u.index,f.index,[c.clone(),u.clone(),f.clone()])}for(a=0,s=h.length;a<s;a++)!function(e,t){for(var i=Math.pow(2,t),r=(Math.pow(4,t),p(m.vertices[e.a])),a=p(m.vertices[e.b]),n=p(m.vertices[e.c]),o=[],s=0;s<=i;s++){o[s]=[];for(var l=p(r.clone().lerp(n,s/i)),h=p(a.clone().lerp(n,s/i)),c=i-s,u=0;u<=c;u++)o[s][u]=0==u&&s==i?l:p(l.clone().lerp(h,u/c))}for(s=0;s<i;s++)for(u=0;u<2*(i-s)-1;u++){var f=Math.floor(u/2);u%2==0?d(o[s][f+1],o[s+1][f],o[s][f]):d(o[s][f+1],o[s+1][f+1],o[s+1][f])}}(h[a],r);for(a=0,s=this.uvs.length;a<s;a++){var g=this.uvs[a],y=g[0].x,v=g[1].x,x=g[2].x,A=Math.max(y,Math.max(v,x)),_=Math.min(y,Math.min(v,x));.9<A&&_<.1&&(y<.2&&(g[0].x+=1),v<.2&&(g[1].x+=1),x<.2&&(g[2].x+=1))}for(a=0,s=this.vertices.length;a<s;a++)this.vertices[a].multiplyScalar(i);this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new Se.BoundingSphere(new Se.Vec3,i)},Se.extend(Se.Polyhedron,Se.Entity,{}),Se.Octahedron=function(e,t,i){Se.Polyhedron.call(this,e,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],t,i)},Se.extend(Se.Octahedron,Se.Polyhedron,{clone:function(){return new Se.Octahedron(this.material,this.radius,this.detail)}}),Se.Axis=function(e){var t=e&&e.size||1,i=[],r=[];i.push(new Se.Vec3,new Se.Vec3(t,0,0),new Se.Vec3,new Se.Vec3(0,t,0),new Se.Vec3,new Se.Vec3(0,0,t)),r.push(new Se.Color(16711680),new Se.Color(16711680),new Se.Color(65280),new Se.Color(65280),new Se.Color(255),new Se.Color(255));var a=new Se.LineMaterial({vertexColors:Se.VertexColors,depthTest:!1,depthMask:!1});Se.Line.call(this,{vertices:i,colors:r,type:Se.LinePieces,size:t}),this.material=a,this.xAxisText=this.makeAxisText("X",16711680),this.yAxisText=this.makeAxisText("Y",65280),this.zAxisText=this.makeAxisText("Z",255),this.xAxisText.setParent(this),this.yAxisText.setParent(this),this.zAxisText.setParent(this),this.xAxisText.setPosition(t,0,0),this.yAxisText.setPosition(0,t,0),this.zAxisText.setPosition(0,0,t),this._sizeFixed=!0},Se.extend(Se.Axis,Se.Line,{showAxisText:function(e){this.xAxisText._visible=e,this.yAxisText._visible=e,this.zAxisText._visible=e},setSize:function(e){this.vertices[1].x=e,this.vertices[3].y=e,this.vertices[5].z=e},fixSize:function(e){Se.Element.prototype.fixSize.call(this,e),this._scale.x,this._scale.y,this._scale.z,this.xAxisText.setScale(3,3,1),this.yAxisText.setScale(3,3,1),this.zAxisText.setScale(3,3,1)},makeAxisText:function(e,t){var i=Se.BillboardAlignment.topLeft,r=document.createElement("canvas"),a=r.getContext("2d");a.font="Bold 36px Arial",t instanceof Se.Color||(t=new Se.Color(t));var n=a.measureText(e).width;r.width=je.nextPowerOfTwo(n),r.height=je.nextPowerOfTwo(2*a.measureText("e").width+4),a.fillStyle="rgba("+255*t.r+", "+255*t.g+", "+255*t.b+", 1.0)",a.fillText(e,0,10);var o=new Se.Texture(r),s=new Se.BillboardMaterial({map:o,useScreenCoordinates:!1,alignment:i,depthTest:!1,depthMask:!1}),l=new Se.Billboard;return l.material=s,l}}),Se.Curve=function(){},Se.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},Se.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},Se.Curve.prototype.getPoints=function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPoint(t/e));return i},Se.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPointAt(t/e));return i},Se.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},Se.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,r=[],a=this.getPoint(0),n=0;for(r.push(0),i=1;i<=e;i++)n+=(t=this.getPoint(i/e)).distanceTo(a),r.push(n),a=t;return this.cacheArcLengths=r},Se.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},Se.Curve.prototype.getUtoTmapping=function(e,t){var i,r=this.getLengths(),a=0,n=r.length;i=t||e*r[n-1];for(var o,s=0,l=n-1;s<=l;)if((o=r[a=Math.floor(s+(l-s)/2)]-i)<0)s=a+1;else{if(!(0<o)){l=a;break}l=a-1}if(r[a=l]==i)return a/(n-1);var h=r[a],c=(a+(i-h)/(r[a+1]-h))/(n-1);return c},Se.Curve.prototype.getTangent=function(e){var t=e-1e-4,i=e+1e-4;t<0&&(t=0),1<i&&(i=1);var r=this.getPoint(t);return this.getPoint(i).clone().sub(r).normalize()},Se.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},Se.Curve.Utils={tangentQuadraticBezier:function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},tangentCubicBezier:function(e,t,i,r,a){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*a},tangentSpline:function(e,t,i,r,a){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,i,r,a){var n=.5*(i-e),o=.5*(r-t),s=a*a;return(2*t-2*i+n+o)*(a*s)+(-3*t+3*i-2*n-o)*s+n*a+t}},Se.Curve.create=function(e,t){return e.prototype=Object.create(Se.Curve.prototype),e.prototype.getPoint=t,e},Se.LineCurve=function(e,t){this.v1=e,this.v2=t},Se.LineCurve.prototype=Object.create(Se.Curve.prototype),Se.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},Se.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},Se.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},Se.LineCurve3=function(e,t){this.v1=e,this.v2=t,this.getPoint=function(e){var t=new Se.Vec3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}},Se.extend(Se.LineCurve3,Se.Curve,{}),Se.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},Se.CurvePath.prototype=Object.create(Se.Curve.prototype),Se.CurvePath.prototype.add=function(e){this.curves.push(e)},Se.CurvePath.prototype.checkConnection=function(){},Se.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Se.LineCurve3(t,e))},Se.CurvePath.prototype.getPoint=function(e){for(var t,i=e*this.getLength(),r=this.getCurveLengths(),a=0;a<r.length;){if(r[a]>=i){var n=1-(r[a]-i)/(t=this.curves[a]).getLength();return t.getPointAt(n)}a++}return null},Se.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},Se.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],i=0,r=this.curves.length;for(e=0;e<r;e++)i+=this.curves[e].getLength(),t.push(i);return this.cacheLengths=t},Se.CurvePath.prototype.getBoundingBox=function(){var e,t,i,r,a,n,o=this.getPoints();e=t=Number.NEGATIVE_INFINITY,r=a=Number.POSITIVE_INFINITY;var s,l,h,c,u=o[0]instanceof Se.Vec3;for(c=u?new Se.Vec3:new Se.Vec2,l=0,h=o.length;l<h;l++)(s=o[l]).x>e?e=s.x:s.x<r&&(r=s.x),s.y>t?t=s.y:s.y<a&&(a=s.y),u&&(s.z>i?i=s.z:s.z<n&&(n=s.z)),c.add(s);var f={minX:r,minY:a,maxX:e,maxY:t,centroid:c.divideScalar(h)};return u&&(f.maxZ=i,f.minZ=n),f},Se.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},Se.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},Se.CurvePath.prototype.createGeometry=function(e){for(var t=new Se.Entity,i=0;i<e.length;i++)t.vertices.push(new Se.Vec3(e[i].x,e[i].y,e[i].z||0));return t},Se.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},Se.CurvePath.prototype.getTransformedPoints=function(e,t){var i,r,a=this.getPoints(e);for(t||(t=this.bends),i=0,r=t.length;i<r;i++)a=this.getWrapPoints(a,t[i]);return a},Se.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i,r,a=this.getSpacedPoints(e);for(t||(t=this.bends),i=0,r=t.length;i<r;i++)a=this.getWrapPoints(a,t[i]);return a},Se.CurvePath.prototype.getWrapPoints=function(e,t){var i,r,a,n,o,s,l=this.getBoundingBox();for(i=0,r=e.length;i<r;i++){n=(a=e[i]).x,o=a.y,s=n/l.maxX,s=t.getUtoTmapping(s,n);var h=t.getPoint(s),c=t.getTangent(s);c.set(-c.y,c.x).multiplyScalar(o),a.x=h.x+c.x,a.y=h.y+c.y}return e},Se.EllipseCurve=function(e,t,i,r,a,n,o){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=a||0,this.aEndAngle=n||2*Math.PI,this.aClockwise=o},Se.EllipseCurve.prototype=Object.create(Se.Curve.prototype),Se.EllipseCurve.prototype.getPoint=function(e){var t,i=this.aEndAngle-this.aStartAngle;i<0&&(i+=2*Math.PI),i>2*Math.PI&&(i-=2*Math.PI),t=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-i):this.aStartAngle+e*i;var r=this.aX+this.xRadius*Math.cos(t),a=this.aY+this.yRadius*Math.sin(t);return new Se.Vec3(r,a,0)},Se.ArcCurve=function(e,t,i,r,a,n){Se.EllipseCurve.call(this,e,t,i,i,r,a,n)},Se.ArcCurve.prototype=Object.create(Se.EllipseCurve.prototype),Se.NurbsCurve=function(e,t,i){this.degree=e||3,this.knots=t||[],this.ctrlPoints=[];for(var r=0;r<i.length;++r){var a=i[r];this.ctrlPoints[r]=new Se.Vec4(a.x,a.y,a.z,a.w)}},Se.NurbsCurve.prototype=Object.create(Se.Curve.prototype),Se.NurbsCurve.prototype.constructor=Se.NurbsCurve,Se.NurbsCurve.prototype.getPoint=function(e){var t=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=Se.NurbsUtils.calcBSplinePoint(this.degree,this.knots,this.ctrlPoints,t);return 1!=i.w&&i.divideScalar(i.w),new Se.Vec3(i.x,i.y,i.z)},Se.NurbsCurve.prototype.getTangent=function(e){var t=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=Se.NurbsUtils.calcNURBSDerivatives(this.degree,this.knots,this.ctrlPoints,t,1)[1].clone();return i.normalize(),i},Se.NurbsSurface=function(e,t,i){this.degreeU=e,this.degreeV=t,this.knotsU=this.calculateKnots(e,i.length),this.knotsV=this.calculateKnots(t,i[0].length),this.ctlPoints=[];for(var r=i.length,a=i[0].length,n=0;n<r;++n){this.ctlPoints[n]=[];for(var o=0;o<a;++o){var s=i[n][o];this.ctlPoints[n][o]=new Se.Vec4(s.x,s.y,s.z,s.w)}}},Se.NurbsSurface.prototype={constructor:Se.NurbsSurface,calculateKnots:function(e,t){for(var i=[],r=0;r<=e;r++)i.push(0);for(r=0;r<t;r++){var a=(r+1)/(t-e);i.push(mono.Math.clamp(a,0,1))}return i},getPoint:function(e,t){var i=this.knotsU[0]+e*(this.knotsU[this.knotsU.length-1]-this.knotsU[0]),r=this.knotsV[0]+t*(this.knotsV[this.knotsV.length-1]-this.knotsV[0]);return Se.NurbsUtils.calcSurfacePoint(this.degreeU,this.degreeV,this.knotsU,this.knotsV,this.ctlPoints,i,r)}},Se.Surface=function(i,e,t,r){this.parameters={func:function(e,t){return i.getPoint(e,t)},slices:e,stacks:t},this.ctrlCond=r,this.material=new Se.SurfaceMaterial,Se.Entity.call(this)},Se.extend(Se.Surface,Se.Entity,{constructor:Se.Surface,className:"TGL.Surface",createMaterial:function(e){a=new Se.ArrayMaterial,this.material=a;for(var t=this.ctrlCond,i=this.getMaterialSize(),r=0;r<i;r++){var a=this.getDefaultMaterial(e,r);t&&(a.skyY=t.skyY||0,a.horizonY=t.horizonY||0,a.earthY=t.earthY||0,a.skyColor=t.skyColor||new mono.Color(16777215),a.horizonColor=t.horizonColor||new mono.Color(16777215),a.earthColor=t.earthColor||new mono.Color(16777215)),this.setMaterial(r,a)}},setMaterial:function(e,t,i){var r=t.getUniqueCode?t.getUniqueCode():null,a=Ut.getMaterial(r);a?(this.material.materials[e]=a,Ut.useMaterial(a)):(this.material.materials[e]=t,Ut.setMaterial(r,t),Ut.useMaterial(t)),Ut.unUseMaterial(i)},computeData:function(){for(var e,t,i,r,a={faces:[],uvs:[],vertices:[]},n=this.parameters.stacks,o=this.parameters.slices,s=this.parameters.func,l=o+1,h=[],c=0;c<=n;c++){var u=c/n;for(j=0;j<=o;j++){var f=j/o,p=s(f,u);h.push(new pe(f,u)),a.vertices.push(new Q(p.x,p.y,p.z))}}for(c=0;c<n;c++)for(j=0;j<o;j++){e=c*l+j,t=c*l+j+1,i=(c+1)*l+j+1,r=(c+1)*l+j;var d=new Ee(e,t,i,r),m=a.vertices[e].clone().sub(a.vertices[t].clone()),g=a.vertices[r].clone().sub(a.vertices[t].clone()),y=m.cross(g).normalize();d.normal.copy(y),a.faces.push(d),a.uvs.push([h[e],h[t],h[i],h[r]])}return a}}),Se.LensFlare=function(e){var t,i,r,a,n,o;1===arguments.length&&e instanceof Object&&!Array.isArray(e)?(options=e,t=options.texture,i=options.size,r=options.distance,a=options.blending,n=options.color,o=options.opacity,options.id):e instanceof Se.Material?(this.material=e,t=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4],n=arguments[5],o=arguments[6]):(t=e,i=arguments[1],r=arguments[2],a=arguments[3],n=arguments[4],o=arguments[5],arguments[6]),this.texture=t||null,this.size=i||-1,this.distance=r||0,this.blending=a||Se.NormalBlending,this.color=n||new Se.Color(16777215),this.opacity=o||1,this.material||(this.material=new Se.Material),this.lensFlares=[],Se.Node.apply(this,arguments),this.positionScreen=new Q,this.customUpdateCallback=Me,this.texture&&this.add(this.texture,this.size,this.distance,this.blending,this.color)},Se.extend(Se.LensFlare,Se.Node,{isLensFlare:!0,add:function(e,t,i,r,a,n){t===Me&&(t=-1),i===Me&&(i=0),n===Me&&(n=1),a===Me&&(a=new Se.Color(16777215)),r===Me&&(r=Se.NormalBlending),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:0,opacity:n,color:a,blending:r})},updateLensFlares:function(){var e,t,i=this.lensFlares.length,r=2*-this.positionScreen.x,a=2*-this.positionScreen.y;for(e=0;e<i;e++)(t=this.lensFlares[e]).x=this.positionScreen.x+r*t.distance,t.y=this.positionScreen.y+a*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},copy:function(e){Cube.prototype.copy.call(this,e),this.positionScreen.copy(e.positionScreen),this.customUpdateCallback=e.customUpdateCallback;for(var t=0,i=e.lensFlares.length;t<i;t++)this.lensFlares.push(e.lensFlares[t]);return this}}),Se.Path=function(e){Se.CurvePath.call(this),this.actions=[],this.points=[],e&&this.fromPoints(e)},Se.extend(Se.Path,Se.CurvePath,{constructor:Se.Path,className:"TGL.Path",serializeJsonValue:function(){return{actions:this.actions,class:"TGL.Path"}},deserializeJsonValue:function(e){var t,i,r,a;for(a=0;a<e.actions.length;a++)t=(i=e.actions[a]).action,r=i.args,this[t].apply(this,r)}}),Se.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"curveTo",BEZIER_CURVE_TO:"bCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},Se.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y,e[0].z);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y,e[t].z)},Se.Path.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.lineTo(e.x,e.y,e.z)},Se.Path.prototype.reverse=function(){var e,t,i,r,a,n=new Se.Path,o=this.actions.length;for(e=o-1;0<=e;e--){if(i=(t=this.actions[e].args).length,e===o-1&&n.moveTo(t[i-3],t[i-2],t[i-1]),null!=r)switch(a){case Se.PathActions.MOVE_TO:n.moveTo(t[i-3],t[i-2],t[i-1]);break;case Se.PathActions.LINE_TO:n.lineTo(t[i-3],t[i-2],t[i-1]);break;case Se.PathActions.QUADRATIC_CURVE_TO:n.quadraticCurveTo(r[0],r[1],r[2],t[i-3],t[i-2],t[i-1]);break;case Se.PathActions.BEZIER_CURVE_TO:n.bezierCurveTo(r[3],r[4],r[5],r[0],r[1],r[2],t[i-3],t[i-2],t[i-1])}r=t,a=this.actions[e].action}return n},Se.Path.prototype.moveTo=function(e,t,i){e=e||0,t=t||0,i=i||0;var r=Array.prototype.slice.call(arguments);this.actions.push({action:Se.PathActions.MOVE_TO,args:r}),this.points.push(new Q(e,t,i))},Se.Path.prototype.lineTo=function(e,t,i){e=e||0,t=t||0,i=i||0,this.actions&&1===this.actions.length&&(r=this.actions[0].args)[0]===e&&r[1]===t&&r[2]===i&&(console.log("TGL.Path:lineTo the same point of moveTo"),e+=.01);var r=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,n=a[a.length-3],o=a[a.length-2],s=a[a.length-1],l=new Se.LineCurve3(new Se.Vec3(n,o,s),new Se.Vec3(e,t,i));this.curves.push(l),this.actions.push({action:Se.PathActions.LINE_TO,args:r}),this.points.push(new Q(e,t,i))},Se.Path.prototype.quadraticCurveTo=function(e,t,i,r,a,n){e=e||0,t=t||0,i=i||0,r=r||0,a=a||0,n=n||0,this.actions&&1===this.actions.length&&(o=this.actions[0].args)[0]===r&&o[1]===a&&o[2]===n&&(console.log("TGL.Path:quadraticCurveTo the same point of moveTo"),r=.01);var o=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,l=s[s.length-3],h=s[s.length-2],c=s[s.length-1],u=new Se.QuadraticBezierCurve3(new Se.Vec3(l,h,c),new Se.Vec3(e,t,i),new Se.Vec3(r,a,n));this.curves.push(u),this.actions.push({action:Se.PathActions.QUADRATIC_CURVE_TO,args:o}),this.points.push(new Q(r,a,n))},Se.Path.prototype.curveTo=Se.Path.prototype.quadraticCurveTo,Se.Path.prototype.bezierCurveTo=function(e,t,i,r,a,n,o,s,l){var h=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,u=c[c.length-3],f=c[c.length-2],p=c[c.length-1],d=new Se.CubicBezierCurve3(new Se.Vec3(u,f,p),new Se.Vec3(e,t,i),new Se.Vec3(r,a,n),new Se.Vec3(o,s,l));this.curves.push(d),this.actions.push({action:Se.PathActions.BEZIER_CURVE_TO,args:h}),this.points.push(new Q(o,s,l))},Se.Path.prototype.isClockwise=function(){if(this.points.length<2)return Me;if(this.points.length<3){var e=this.points[0];return this.points[1].x>e.x}return Se.Math.isClockwise(this.points)},Se.Path.prototype.bCurveTo=Se.Path.prototype.bezierCurveTo,Se.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,r=i[i.length-2],a=i[i.length-1],n=[new Se.Vec2(r,a)];Array.prototype.push.apply(n,e);var o=new Se.SplineCurve(n);this.curves.push(o),this.actions.push({action:Se.PathActions.CSPLINE_THRU,args:t})},Se.Path.prototype.arc=function(e,t,i,r,a,n){var o=this.actions[this.actions.length-1].args,s=o[o.length-3],l=o[o.length-2];this.absarc(e+s,t+l,i,r,a,n)},Se.Path.prototype.absarc=function(e,t,i,r,a,n){this.absellipse(e,t,i,i,r,a,n)},Se.Path.prototype.ellipse=function(e,t,i,r,a,n,o){var s=this.actions[this.actions.length-1].args,l=s[s.length-3],h=s[s.length-2];this.absellipse(e+l,t+h,i,r,a,n,o)},Se.Path.prototype.absellipse=function(e,t,i,r,a,n,o){var s=Array.prototype.slice.call(arguments),l=new Se.EllipseCurve(e,t,i,r,a,n,o);this.curves.push(l);var h=l.getPoint(1);s.push(h.x),s.push(h.y),this.actions.push({action:Se.PathActions.ELLIPSE,args:s})},Se.Path.prototype.toArray=function(){var e,t=this.actions.length,i=[];for(e=0;e<t;e++){var r=this.actions[e];"moveTo"===r.action?(i.push("m"),i.push(r.args[0]),i.push(r.args[1]),i.push(r.args[2])):"lineTo"===r.action?(i.push("l"),i.push(r.args[0]),i.push(r.args[1]),i.push(r.args[2])):"curveTo"===r.action&&(i.push("c"),i.push(r.args[0]),i.push(r.args[1]),i.push(r.args[2]),i.push(r.args[3]),i.push(r.args[4]),i.push(r.args[5]))}return i},Se.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var i=[],r=0;r<e;r++)i.push(this.getPoint(r/e));return i},Se.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var i,r,a,n,o,s,l,h,c,u,f,p,d,m,g,y,v,x,A,_,w,b,M=[];for(i=0,r=this.actions.length;i<r;i++)switch(a=this.actions[i],n=a.action,o=a.args,n){case Se.PathActions.MOVE_TO:case Se.PathActions.LINE_TO:M.push(new Se.Vec3(o[0],o[1],o[2]));break;case Se.PathActions.QUADRATIC_CURVE_TO:for(s=o[3],l=o[4],h=o[5],p=o[0],d=o[1],m=o[2],0<M.length?(g=(x=M[M.length-1]).x,y=x.y,v=x.z):(g=(x=this.actions[i-1].args)[x.length-3],y=x[x.length-2],v=x[x.length-1]),A=1;A<=e;A++)_=A/e,w=Se.Shape.Utils.b2(_,g,p,s),b=Se.Shape.Utils.b2(_,y,d,l),tz=Se.Shape.Utils.b2(_,v,m,h),M.push(new Se.Vec3(w,b,tz));break;case Se.PathActions.BEZIER_CURVE_TO:for(s=o[6],l=o[7],h=o[8],p=o[0],d=o[1],m=o[2],c=o[3],u=o[4],f=o[5],0<M.length?(g=(x=M[M.length-1]).x,y=x.y,v=x.z):(g=(x=this.actions[i-1].args)[x.length-3],y=x[x.length-2],v=x[x.length-1]),A=1;A<=e;A++)_=A/e,w=Se.Shape.Utils.b3(_,g,p,c,s),b=Se.Shape.Utils.b3(_,y,d,u,l),tz=Se.Shape.Utils.b3(_,v,m,f,h),M.push(new Se.Vec3(w,b,tz));break;case Se.PathActions.CSPLINE_THRU:x=this.actions[i-1].args;var S=[new Se.Vec2(x[x.length-2],x[x.length-1])],P=e*o[0].length;S=S.concat(o[0]);var T=new Se.SplineCurve(S);for(A=1;A<=P;A++)M.push(T.getPointAt(A/P));break;case Se.PathActions.ARC:var C=o[0],E=o[1],z=o[2],D=o[3],L=o[4],R=!!o[5],N=L-D,B=2*e;for(A=1;A<=B;A++)_=A/B,R||(_=1-_),I=D+_*N,w=C+z*Math.cos(I),b=E+z*Math.sin(I),M.push(new Se.Vec3(w,b));break;case Se.PathActions.ELLIPSE:C=o[0],E=o[1];var I,F=o[2],V=o[3];D=o[4],L=o[5],R=!!o[6],N=L-D,B=2*e;for(A=1;A<=B;A++)_=A/B,R||(_=1-_),I=D+_*N,w=C+F*Math.cos(I),b=E+V*Math.sin(I),M.push(new Se.Vec3(w,b))}var U=M[M.length-1];return Math.abs(U.x-M[0].x)<1e-10&&Math.abs(U.y-M[0].y)<1e-10&&M.splice(M.length-1,1),t&&M.push(M[0]),M},Se.Path.prototype.toShapes=function(e){var t,i,r,a,n,o=[],s=new Se.Path;for(t=0,i=this.actions.length;t<i;t++)n=(r=this.actions[t]).args,(a=r.action)==Se.PathActions.MOVE_TO&&0!=s.actions.length&&(o.push(s),s=new Se.Path),s[a].apply(s,n);if(0!=s.actions.length&&o.push(s),0==o.length)return[];var l,h,c,u=[];if(1==o.length)return h=o[0],(c=new Se.Shape).actions=h.actions,c.curves=h.curves,u.push(c),u;var f=!Se.Shape.Utils.isClockWise(o[0].getPoints());if(f=e?!f:f)for(c=new Se.Shape,t=0,i=o.length;t<i;t++)h=o[t],l=Se.Shape.Utils.isClockWise(h.getPoints()),(l=e?!l:l)?(c.actions=h.actions,c.curves=h.curves,u.push(c),c=new Se.Shape):c.holes.push(h);else{for(c=Me,t=0,i=o.length;t<i;t++)h=o[t],l=Se.Shape.Utils.isClockWise(h.getPoints()),(l=e?!l:l)?(c&&u.push(c),(c=new Se.Shape).actions=h.actions,c.curves=h.curves):c.holes.push(h);u.push(c)}return u},Se.Shape=function(){Se.Path.apply(this,arguments),this.holes=[]},Se.Shape.prototype=Object.create(Se.Path.prototype),Se.Shape.prototype.extrude=function(e){return new Se.ShapeNode(this,e)},Se.Shape.prototype.makeGeometry=function(e){return new Se.ShapeGeometry(this,e)},Se.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},Se.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},Se.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},Se.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},Se.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},Se.Shape.Utils={removeHoles:function(e,t){var i,r,a,n,o,s,l,h,c,u,f,p,d,m,g,y,v=e.concat(),x=v.concat(),A=[];for(o=0;o<t.length;o++){for(l=t[o],Array.prototype.push.apply(x,l),h=Number.POSITIVE_INFINITY,s=0;s<l.length;s++){f=l[s];var _=[];for(u=0;u<v.length;u++)p=v[u],c=f.distanceToSquared(p),_.push(c),c<h&&(h=c,a=s,n=u)}i=0<=n-1?n-1:v.length-1,r=0<=a-1?a-1:l.length-1;var w=[l[a],v[n],v[i]],b=Se.FontUtils.Triangulate.area(w),M=[l[a],l[r],v[n]],S=Se.FontUtils.Triangulate.area(M),P=n,T=a;a+=-1,(n+=1)<0&&(n+=v.length),n%=v.length,a<0&&(a+=l.length),a%=l.length,i=0<=n-1?n-1:v.length-1,r=0<=a-1?a-1:l.length-1,w=[l[a],v[n],v[i]];var C=Se.FontUtils.Triangulate.area(w);M=[l[a],l[r],v[n]],b+S>C+Se.FontUtils.Triangulate.area(M)&&(a=T,(n=P)<0&&(n+=v.length),n%=v.length,a<0&&(a+=l.length),a%=l.length,i=0<=n-1?n-1:v.length-1,r=0<=a-1?a-1:l.length-1),d=v.slice(0,n),m=v.slice(n),g=l.slice(a),y=l.slice(0,a);var E=[l[a],v[n],v[i]],z=[l[a],l[r],v[n]];A.push(E),A.push(z),v=d.concat(g).concat(y).concat(m)}return{shape:v,isolatedPts:A,allpoints:x}},triangulateShape:function(e,t){var i,r,a,n,o,s,l=Se.Shape.Utils.removeHoles(e,t),h=l.shape,c=l.allpoints,u=l.isolatedPts,f=Se.FontUtils.Triangulate(h,!1),p={};for(i=0,r=c.length;i<r;i++)p[o=c[i].x+":"+c[i].y]!==Me&&console.log("Duplicate point",o),p[o]=i;for(i=0,r=f.length;i<r;i++)for(n=f[i],a=0;a<3;a++)(s=p[o=n[a].x+":"+n[a].y])!==Me&&(n[a]=s);for(i=0,r=u.length;i<r;i++)for(n=u[i],a=0;a<3;a++)(s=p[o=n[a].x+":"+n[a].y])!==Me&&(n[a]=s);return f.concat(u)},isClockWise:function(e){return Se.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,r){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,r)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,r,a){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,r)+this.b3p3(e,a)}},Se.CubicBezierCurve3=Se.Curve.create(function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r},function(e){var t,i,r;return t=Se.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=Se.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),r=Se.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new Se.Vec3(t,i,r)}),Se.QuadraticBezierCurve3=Se.Curve.create(function(e,t,i){this.v0=e,this.v1=t,this.v2=i},function(e){var t,i,r;return t=Se.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),i=Se.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),r=Se.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new Se.Vec3(t,i,r)}),Se.PathNode=function(e,t,i,r,a,n,o,s,l,h){var c;this.materialSize=1,this.closed=!1,1===arguments.length&&e instanceof Object&&!(e instanceof Se.Path)?(c=e,this.path=c.path,this.segments=c.segments||20,this.radius=c.radius||1,this.segmentsR=c.segmentsR||8,this.shape=c.shape,this.startCap=c.startCap||"plain",this.endCap=c.endCap||"plain",this.arc=c.arc!=Me?c.arc:2*Math.PI,this.arcStart=c.arcStart!=Me?c.arcStart:0,this.cutSurface=c.cutSurface||"none",this.startCapR=c.startCapR,this.endCapR=c.endCapR,this.startCapSize=c.startCapSize,this.endCapSize=c.endCapSize,this.binormal=c.binormal,this.startCapExtend=c.startCapExtend===Me?1:c.startCapExtend,this.endCapExtend=c.endCapExtend===Me?1:c.endCapExtend,this._id=c.id):(this.path=e,this.segments=t||20,this.radius=i||1,this.segmentsR=r||8,this.shape=o,this.startCap=a||"plain",this.endCap=n||"plain",this.arc=s!=Me?s:2*Math.PI,this.arcStart=l!=Me?l:0,this.cutSurface=h||"none"),this.shape instanceof Array&&(this.segmentsR=this.shape.length),this.startCapSize=this.startCapSize||1,this.endCapSize=this.endCapSize||1,this.segmentsCap=20,this.arc===2*Math.PI&&(this.cutSurface="none"),Se.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Se.extend(Se.PathNode,Se.Entity,{constructor:Se.PathNode,className:"TGL.PathNode",__accessor:["path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","binormal"],__SizePropeties:["path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","binormal"],getCrossSectionPoint:function(){},needComputeVertexNormal:function(){return!0},adjustPath:function(e,t,i){t=t||this.radius,i=i||this._adjustTimes||2;var r,a,n,o,s,l,h,c,u,f,p=new Se.Path,d=new Q,m=new Q,g=new Q,y=new Q,v=e.actions.length;for(f=0;f<v;f++)if(a=e.actions[f],o=f+1===v?null:e.actions[f+1],n=a.args,"moveTo"===a.action)p.moveTo(n[0],n[1],n[2]);else if("lineTo"===a.action)if(o&&"lineTo"===o.action){if(r=e.actions[f-1].args,s=o.args,l=new Q(r[0],r[1],r[2]),h=new Q(n[0],n[1],n[2]),c=new Q(s[0],s[1],s[2]),d.subVectors(h,l),m.subVectors(h,c),0==m.length()){e.actions.splice(f,1),f-=1,v-=1;continue}d.angleTo(m),u=Math.min(d.length()/2,m.length()/2),u=Math.min(t*i,u),g.addVectors(h,d.normalize().multiplyScalar(-u)),y.addVectors(h,m.normalize().multiplyScalar(-u)),p.lineTo(g.x,g.y,g.z),p.curveTo(h.x,h.y,h.z,y.x,y.y,y.z)}else p.lineTo(n[0],n[1],n[2]);else"quadraticCurveTo"===a.action&&p.curveTo(n[0],n[1],n[2],n[3],n[4],n[5]);return p},_resetPath:function(){return this.path},getPointAt:function(e){return this._realPath?this._realPath.getPoint(e):null},getTangentAt:function(e){if(this._realPath){var t=this._realPath.getPoint(e),i=this._realPath.getPoint(e-.001);return t.sub(i).normalize()}return null},computeData:function(){this.grid=[],this.startGrid=[],this.endGrid=[];var e,t,i,r,a,n,o,s,l,h,c,u,f,p,d=this.segmentsCap,m=new Se.Vec3,g={faces:[],uvs:[],vertices:[]};if(null==this.path)return g;var y=this._resetPath(),v=this.startCap,x=this.endCap,A=this.cutSurface;this._realPath=y,1==this._autoAjust&&(y=this.adjustPath(y));var _,w,b=y.curves.length,M=y.curves,S=[],P=y.getLength(),T=0,C=this.segments;for(s=0;s<b;s++){if(w=(_=M[s]).getLength(),_ instanceof Se.LineCurve3){var E=(.001*w+T)/P,z=(.999*w+T)/P;S.push(E),S.push(z)}else{var D=.998*w;for(J=0;J<=C;J++){var L=(.001*w+D*J/C+T)/P;S.push(L)}}T+=w}var R=this.frenetFrames(y,S,this.closed,this.binormal),N=R.tangents,B=R.normals,I=R.binormals;this.tangents=N,this.normals=B,this.binormals=I;var F,V,U,k,O=0,X=S.length-1,G=X+1,Y=0,W=0;for(s=0;s<G;s++){if(this.grid[s]=[],fe=S[s],o=y.getPointAt(fe),e=N[s],t=B[s],i=I[s],"none"!==v&&0===s)if("round"===v||"arrow"===v){Y+=this.radius*this.startCapSize;for(var j=o.clone().add(e.clone().multiplyScalar(-this.radius*this.startCapSize)),H=0;H<=d;H++){for(this.startGrid[H]=[],K=H/d*Math.PI/2,Z="round"===v?j.clone().add(e.clone().multiplyScalar(this.radius*this.startCapSize*(1-Math.cos(K)))):j.clone().add(e.clone().multiplyScalar(this.radius*this.startCapSize*H/d)),J=0;J<this.segmentsR;J++)r=J/this.segmentsR*this.arc+this.arcStart,"round"===v?(a=-this.radius*Math.cos(r)*Math.sin(K),n=this.radius*Math.sin(r)*Math.sin(K)):(a=-this.radius*Math.cos(r)*H/d,n=this.radius*Math.sin(r)*H/d,a*=this.startCapR||1.3,n*=this.startCapR||1.3),(Q=Z.clone()).x+=a*t.x+n*i.x,Q.y+=a*t.y+n*i.y,Q.z+=a*t.z+n*i.z,this.startGrid[H][J]=g.vertices.push(Q)-1;"center"===A&&(this.startGrid[H][this.segmentsR]=g.vertices.push(Z.clone())-1)}}else O=g.vertices.push(o);for(J=0;J<this.segmentsR;J++){if(F=J/(this.segmentsR-1),this.shape instanceof Array)a=-this.shape[J].x,n=this.shape[J].y;else if(this.shape instanceof Se.Path){var q=this.shape.getPointAt(F);a=-q.x,n=-q.y}else r=J/this.segmentsR*this.arc+this.arcStart,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);m.copy(o),m.x+=a*t.x+n*i.x,m.y+=a*t.y+n*i.y,m.z+=a*t.z+n*i.z,this.grid[s][J]=(V=m.x,U=m.y,k=m.z,g.vertices.push(new Se.Vec3(V,U,k))-1)}if("center"===A&&(this.grid[s][this.segmentsR]=g.vertices.push(o.clone())-1),"none"!==x&&s===G-1)if("round"===x||"arrow"===x){W+=this.radius*this.endCapSize;var Z,Q;for(j=o.clone().add(e.clone().multiplyScalar(this.radius*this.endCapSize)),H=0;H<=d;H++){this.endGrid[H]=[];var K=(1-H/d)*Math.PI/2;Z="round"===x?j.clone().add(e.clone().multiplyScalar(-this.radius*this.endCapSize*(1-Math.cos(K)))):j.clone().add(e.clone().multiplyScalar(-this.radius*this.endCapSize*(1-H/d)));for(var J=0;J<this.segmentsR;J++)r=J/this.segmentsR*this.arc+this.arcStart,"round"===x?(a=-this.radius*Math.cos(r)*Math.sin(K),n=this.radius*Math.sin(r)*Math.sin(K)):(a=-this.radius*Math.cos(r)*(1-H/d),n=this.radius*Math.sin(r)*(1-H/d),a*=this.endCapR||1.3,n*=this.endCapR||1.3),(Q=Z.clone()).x+=a*t.x+n*i.x,Q.y+=a*t.y+n*i.y,Q.z+=a*t.z+n*i.z,this.endGrid[H][J]=g.vertices.push(Q)-1;"center"===A&&(this.endGrid[H][this.segmentsR]=g.vertices.push(Z)-1)}}else g.vertices.push(o)}var $=this.segmentsR,ee=this.segmentsR;this.arc!==2*Math.PI&&("center"===A?($++,ee++):"none"===A&&$--);var te=this.arc/Math.PI/2,ie=y.getLength(),re=ie+Y+W,ae=Y/re,ne=ae,oe=ie/re,se=ae+oe,le=W/re;if("none"!==v)if("plain"===v)for(J=c=0;J<this.segmentsR;J++)h=(J+1)%this.segmentsR,u=this.grid[0][J],_=this.grid[0][h],g.faces.push(new Se.Face3(c,u,_)),r=J/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r),he=new pe(.5,.5),r=J/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r),ce=new pe((a/this.radius+1)/2,(n/this.radius+1)/2),r=h/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r),ue=new pe((a/this.radius+1)/2,(n/this.radius+1)/2),g.uvs.push([he,ce,ue]);else for(s=0;s<=d;s++)for(J=0;J<$;J++)l=s+1,h=(J+1)%ee,c=this.startGrid[s][J],l===d+1?(u=this.grid[0][J],_=this.grid[0][h]):(u=this.startGrid[l][J],_=this.startGrid[l][h]),f=this.startGrid[s][h],J>=this.segmentsR-1?(fe=(H=this.segmentsR-1)/this.segmentsR*te,$===this.segmentsR?(he=new Se.Vec2(s/d*ae+0,fe),ce=new Se.Vec2((s+1)/d*ae+0,fe),ue=new Se.Vec2((s+1)/d*ae+0,1),p=new Se.Vec2(s/d*ae+0,1)):J>this.segmentsR-1?(he=new Se.Vec2(s/d*ae+0,(1+fe)/2),ce=new Se.Vec2((s+1)/d*ae+0,(1+fe)/2),ue=new Se.Vec2((s+1)/d*ae+0,1),p=new Se.Vec2(s/d*ae+0,1)):(he=new Se.Vec2(s/d*ae+0,fe),ce=new Se.Vec2((s+1)/d*ae+0,fe),ue=new Se.Vec2((s+1)/d*ae+0,(1+fe)/2),p=new Se.Vec2(s/d*ae+0,(1+fe)/2))):(he=new Se.Vec2(s/d*ae+0,J/this.segmentsR*te),ce=new Se.Vec2((s+1)/d*ae+0,J/this.segmentsR*te),ue=new Se.Vec2((s+1)/d*ae+0,(J+1)/this.segmentsR*te),p=new Se.Vec2(s/d*ae+0,(J+1)/this.segmentsR*te)),0!==s&&(g.faces.push(new Se.Face3(c,u,f,O-1)),g.uvs.push([he,ce,p])),g.faces.push(new Se.Face3(u,_,f,O-1)),g.uvs.push([ce.clone(),ue,p.clone()]);for(s=0;s<X;s++)for(J=0;J<$;J++)l=this.closed?(s+1)%X:s+1,h=(J+1)%ee,c=this.grid[s][J],u=this.grid[l][J],_=this.grid[l][h],f=this.grid[s][h],J>=this.segmentsR-1?(fe=(H=this.segmentsR-1)/this.segmentsR*te,$===this.segmentsR?(he=new Se.Vec2(S[s]*oe+ne,fe),ce=new Se.Vec2(S[s+1]*oe+ne,fe),ue=new Se.Vec2(S[s+1]*oe+ne,1),p=new Se.Vec2(S[s]*oe+ne,1)):J>this.segmentsR-1?(he=new Se.Vec2(S[s]*oe+ne,(fe+1)/2),ce=new Se.Vec2(S[s+1]*oe+ne,(fe+1)/2),ue=new Se.Vec2(S[s+1]*oe+ne,1),p=new Se.Vec2(S[s]*oe+ne,1)):(he=new Se.Vec2(S[s]*oe+ne,fe),ce=new Se.Vec2(S[s+1]*oe+ne,fe),ue=new Se.Vec2(S[s+1]*oe+ne,(fe+1)/2),p=new Se.Vec2(S[s]*oe+ne,(fe+1)/2))):(he=new Se.Vec2(S[s]*oe+ne,J/this.segmentsR*te),ce=new Se.Vec2(S[s+1]*oe+ne,J/this.segmentsR*te),ue=new Se.Vec2(S[s+1]*oe+ne,(J+1)/this.segmentsR*te),p=new Se.Vec2(S[s]*oe+ne,(J+1)/this.segmentsR*te)),g.faces.push(new Se.Face3(c,u,f)),g.uvs.push([he,ce,p]),g.faces.push(new Se.Face3(u,_,f)),g.uvs.push([ce.clone(),ue,p.clone()]);if("none"!==x)if(c=g.vertices.length-1,b=this.grid.length,"plain"===x)for(J=0;J<this.segmentsR;J++){h=(J+1)%this.segmentsR,u=this.grid[b-1][J],_=this.grid[b-1][h],g.faces.push(new Se.Face3(c,_,u)),r=J/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);var he=new pe(.5,.5);r=J/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);var ce=new pe((a/this.radius+1)/2,(n/this.radius+1)/2);r=h/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);var ue=new pe((a/this.radius+1)/2,(n/this.radius+1)/2);g.uvs.push([he,ue,ce])}else for(s=-1;s<d;s++)for(J=0;J<$;J++){if(l=s+1,h=(J+1)%ee,-1===s?(c=this.grid[b-1][J],f=this.grid[b-1][h]):(c=this.endGrid[s][J],f=this.endGrid[s][h]),u=this.endGrid[l][J],_=this.endGrid[l][h],J>=this.segmentsR-1){var fe=(H=this.segmentsR-1)/this.segmentsR*te;$===this.segmentsR?(he=new Se.Vec2(s/d*le+se,fe),ce=new Se.Vec2((s+1)/d*le+se,fe),ue=new Se.Vec2((s+1)/d*le+se,1),p=new Se.Vec2(s/d*le+se,1)):J>this.segmentsR-1?(he=new Se.Vec2(s/d*le+se,(1+fe)/2),ce=new Se.Vec2((s+1)/d*le+se,(1+fe)/2),ue=new Se.Vec2((s+1)/d*le+se,1),p=new Se.Vec2(s/d*le+se,1)):(he=new Se.Vec2(s/d*le+se,fe),ce=new Se.Vec2((s+1)/d*le+se,fe),ue=new Se.Vec2((s+1)/d*le+se,(1+fe)/2),p=new Se.Vec2(s/d*le+se,(1+fe)/2))}else he=new Se.Vec2(s/d*le+se,J/this.segmentsR*te),ce=new Se.Vec2((s+1)/d*le+se,J/this.segmentsR*te),ue=new Se.Vec2((s+1)/d*le+se,(J+1)/this.segmentsR*te),p=new Se.Vec2(s/d*le+se,(J+1)/this.segmentsR*te);g.faces.push(new Se.Face3(c,u,f)),g.uvs.push([he,ce,p]),g.faces.push(new Se.Face3(u,_,f)),g.uvs.push([ce.clone(),ue,p.clone()])}return g},frenetFrames:function(e,t,i,r){new Se.Vec3;var a,n,o,s,l,h,c,u=new Se.Vec3,f=(new Se.Vec3,[]),p=[],d=[],m=new Se.Vec3,g=new Se.Mat4,y=t.length-1+1,v=[];for(v.tangents=f,v.normals=p,v.binormals=d,h=0;h<y;h++){c=t[h];var x=e.getTangentAt(c);f[h]=new Se.Vec3(x.x,x.y,x.z?x.z:0),f[h].normalize()}for(p[0]=new Se.Vec3,d[0]=new Se.Vec3,n=Number.MAX_VALUE,o=Math.abs(f[0].x),s=Math.abs(f[0].y),l=Math.abs(f[0].z),s<=n&&(n=s,u.set(0,1,0)),o<=n&&(n=o,u.set(1,0,0)),l<=n&&u.set(0,0,1),r&&(u=r.clone()),m.crossVectors(f[0],u).normalize(),p[0].crossVectors(f[0],m),d[0].crossVectors(f[0],p[0]),h=1;h<y;h++)p[h]=p[h-1].clone(),d[h]=d[h-1].clone(),m.crossVectors(f[h-1],f[h]),1e-4<m.length()&&(m.normalize(),a=Math.acos(Se.Math.clamp(f[h-1].dot(f[h]),-1,1)),p[h].applyMatrix4(g.makeRotationAxis(m,a))),d[h].crossVectors(f[h],p[h]);if(i)for(a=Math.acos(Se.Math.clamp(p[0].dot(p[y-1]),-1,1)),a/=y-1,0<f[0].dot(m.crossVectors(p[0],p[y-1]))&&(a=-a),h=1;h<y;h++)p[h].applyMatrix4(g.makeRotationAxis(f[h],a*h)),d[h].crossVectors(f[h],p[h]);return v}}),Se.PathCube=function(e,t,i,r,a){var n;1===arguments.length&&e instanceof Object&&!(e instanceof Se.Path)?(n=e,this.path=n.path,this.width=n.width||50,this.height=n.height||100,this.curveSegements=n.curveSegements||32,this.repeat=n.repeat||20,this._id=n.id):(this.path=e,this.width=t||50,this.height=i||100,this.curveSegements=r||32,this.repeat=a||20),this.materialSize=6,Se.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Se.PathCube.SideIndexMapping={bottom:0,outside:1,inside:2,top:3,aside:4,zside:5},Se.extend(Se.PathCube,Se.Entity,{__accessor:["path","width","height","curveSegements","repeat"],__SizePropeties:["path","width","height","curveSegements","repeat"],constructor:Se.PathCube,className:"TGL.PathCube",getSideIndexMapping:function(){return Se.PathCube.SideIndexMapping},computeData:function(){var e={vertices:[],faces:[],uvs:[],uv2s:[]};if(null==this.path)return e;var t,i=this.computePoints(this.path,this.width,this.curveSegements),r=i[0],a=i[1],n=r.length,o=i[2],s=this.height,l=this.repeat,h=[],c=[],u=[],f=[],p=this.path.isClockwise();for(this.innerPoints=this.clonePoints(r),this.outerPoints=this.clonePoints(a),t=0;t<n;t++)this.exchangeYZ(r[t]),this.exchangeYZ(a[t]),h[t]=e.vertices.push(r[t])-1,c[t]=e.vertices.push(a[t])-1,u[t]=e.vertices.push(r[t].clone().setY(s))-1,f[t]=e.vertices.push(a[t].clone().setY(s))-1;var d=o?n:n-1;for(t=0;t<d;t++)this.generateTop(e,t,n,u,f,!0,l),this.generateBottom(e,t,n,h,c,l),this.generateSideWall(e,t,n,f,c,!0,l,p),this.generateSideWall(e,t,n,u,h,!1,l,p);return o||(this.generateEnd(e,u,h,c,f,l,!0),this.generateEnd(e,u,h,c,f,l,!1)),this.clockwise=p,e},clonePoints:function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].clone());return t},getInsidePoints:function(){return this.clockwise?this.innerPoints:this.outerPoints},generateEnd:function(e,t,i,r,a,n,o){var s,l,h,c,u,f,p,d,m,g,y,v,x,A,_,w,b,M,S,P=o?0:i.length-1;s=t[P],l=i[P],h=r[P],c=a[P],w=e.vertices[s],b=e.vertices[l],M=e.vertices[h],S=e.vertices[c],u=w.x,f=w.y,p=w.z,d=b.x,m=b.y,g=b.z,y=M.x,v=M.y,_=M.z,x=S.x,A=S.y,dz=S.z;var T=Math.abs(p-_),C=Math.abs(u-y);o?(e.faces.push(new Se.Face3(s,l,c,null,null,4)),T<C?e.uvs.push([new Se.Vec2(u/n,f/n),new Se.Vec2(d/n,m/n),new Se.Vec2(x/n,A/n)]):e.uvs.push([new Se.Vec2(p/n,f/n),new Se.Vec2(g/n,m/n),new Se.Vec2(dz/n,A/n)]),e.uv2s.push([new pe(0,1),new pe(0,0),new pe(1,1)]),e.faces.push(new Se.Face3(l,h,c,null,null,4)),T<C?e.uvs.push([new Se.Vec2(d/n,m/n),new Se.Vec2(y/n,v/n),new Se.Vec2(x/n,A/n)]):e.uvs.push([new Se.Vec2(g/n,m/n),new Se.Vec2(_/n,v/n),new Se.Vec2(dz/n,A/n)]),e.uv2s.push([new pe(0,0),new pe(1,0),new pe(1,1)])):(e.faces.push(new Se.Face3(l,s,c,null,null,5)),T<C?e.uvs.push([new Se.Vec2(d/n,m/n),new Se.Vec2(u/n,f/n),new Se.Vec2(x/n,A/n)]):e.uvs.push([new Se.Vec2(g/n,m/n),new Se.Vec2(p/n,f/n),new Se.Vec2(dz/n,A/n)]),e.uv2s.push([new pe(0,0),new pe(0,1),new pe(1,1)]),e.faces.push(new Se.Face3(h,l,c,null,null,5)),T<C?e.uvs.push([new Se.Vec2(y/n,v/n),new Se.Vec2(d/n,m/n),new Se.Vec2(x/n,A/n)]):e.uvs.push([new Se.Vec2(_/n,v/n),new Se.Vec2(g/n,m/n),new Se.Vec2(dz/n,A/n)]),e.uv2s.push([new pe(1,0),new pe(0,0),new pe(1,1)]))},generateSideWall:function(e,t,i,r,a,n,o,s){var l,h,c,u,f,p,d,m,g,y,v,x,A,_,w,b,M,S,P,T;b=(t+1)%i,l=r[t],h=a[t],c=a[b],u=r[b],M=e.vertices[l],S=e.vertices[h],P=e.vertices[c],T=e.vertices[u],f=M.x,p=M.y,d=M.z,m=S.x,g=S.y,y=S.z,v=P.x,x=P.y,w=P.z,A=T.x,_=T.y,dz=T.z;var C,E=Math.abs(d-w),z=Math.abs(f-v);n?(C=s?1:2,e.faces.push(new Se.Face3(l,h,u,null,null,C)),E<z?e.uvs.push([new Se.Vec2(f/o,p/o),new Se.Vec2(m/o,g/o),new Se.Vec2(A/o,_/o)]):e.uvs.push([new Se.Vec2(d/o,p/o),new Se.Vec2(y/o,g/o),new Se.Vec2(dz/o,_/o)]),e.uv2s.push([new pe(0,1),new pe(0,0),new pe(1,1)]),e.faces.push(new Se.Face3(h,c,u,null,null,C)),E<z?e.uvs.push([new Se.Vec2(m/o,g/o),new Se.Vec2(v/o,x/o),new Se.Vec2(A/o,_/o)]):e.uvs.push([new Se.Vec2(y/o,g/o),new Se.Vec2(w/o,x/o),new Se.Vec2(dz/o,_/o)]),e.uv2s.push([new pe(0,0),new pe(1,0),new pe(1,1)])):(C=s?2:1,e.faces.push(new Se.Face3(h,l,u,null,null,C)),E<z?e.uvs.push([new Se.Vec2(m/o,g/o),new Se.Vec2(f/o,p/o),new Se.Vec2(A/o,_/o)]):e.uvs.push([new Se.Vec2(y/o,g/o),new Se.Vec2(d/o,p/o),new Se.Vec2(dz/o,_/o)]),e.uv2s.push([new pe(0,0),new pe(0,1),new pe(1,1)]),e.faces.push(new Se.Face3(c,h,u,null,null,C)),E<z?e.uvs.push([new Se.Vec2(v/o,x/o),new Se.Vec2(m/o,g/o),new Se.Vec2(A/o,_/o)]):e.uvs.push([new Se.Vec2(w/o,x/o),new Se.Vec2(y/o,g/o),new Se.Vec2(dz/o,_/o)]),e.uv2s.push([new pe(1,0),new pe(0,0),new pe(1,1)]))},generateBottom:function(e,t,i,r,a,n){this.generateTop(e,t,i,r,a,!1,n)},generateTop:function(e,t,i,r,a,n,o){var s,l,h,c,u,f,p,d,m,g,y,v,x,A,_,w;v=(t+1)%i,s=r[t],l=a[t],h=a[v],c=r[v],x=e.vertices[s],A=e.vertices[l],_=e.vertices[h],w=e.vertices[c],u=x.x,x.y,f=x.z,p=A.x,A.y,d=A.z,m=_.x,_.y,y=_.z,g=w.x,w.y,dz=w.z,n?(e.faces.push(new Se.Face3(s,l,c,null,null,3)),e.uvs.push([new Se.Vec2(u/o,f/o),new Se.Vec2(p/o,d/o),new Se.Vec2(g/o,dz/o)]),e.uv2s.push([new pe(0,1),new pe(0,0),new pe(1,1)]),e.faces.push(new Se.Face3(l,h,c,null,null,3)),e.uvs.push([new Se.Vec2(p/o,d/o),new Se.Vec2(m/o,y/o),new Se.Vec2(g/o,dz/o)]),e.uv2s.push([new pe(0,0),new pe(1,0),new pe(1,1)])):(e.faces.push(new Se.Face3(l,s,c,null,null,0)),e.uvs.push([new Se.Vec2(p/o,d/o),new Se.Vec2(u/o,f/o),new Se.Vec2(g/o,dz/o)]),e.uv2s.push([new pe(0,0),new pe(0,1),new pe(1,1)]),e.faces.push(new Se.Face3(h,l,c,null,null,0)),e.uvs.push([new Se.Vec2(m/o,y/o),new Se.Vec2(p/o,d/o),new Se.Vec2(g/o,dz/o)]),e.uv2s.push([new pe(1,0),new pe(0,0),new pe(1,1)]))},exchangeYZ:function(e){var t=e.y;e.y=e.z,e.z=-t},addPoints:function(e,t,i,r,a){t.multiplyScalar(.5),i.push((new Se.Vec3).subVectors(e,t)),r.push((new Se.Vec3).addVectors(e,t))},computeCurvePoint:function(e,t,i,r,a,n,o,s,l){var h,c,f,p,d=r?0:1,m=new Se.Vec3,g=s;if(e){c=e.getTangentAt(1),f=t.getTangentAt(0),concave=Se.Math.isConcave(c,f,!1),f.multiplyScalar(-1),angle=c.angleTo(f),p=Math.sin(angle/2),h=t.getPoint(0),p=0==p?.1:p;var y=concave?i/p:-i/p;1==p?m.crossVectors(f,new Q(0,0,1)).normalize().multiplyScalar(y):m.addVectors(c,f).normalize().multiplyScalar(y),this.addPoints(h,m,n,o,l)}else f=t.getTangentAt(d),h=t.getPoint(d),m.crossVectors(f,new Se.Vec3(0,0,1)).normalize().multiplyScalar(i),this.addPoints(h,m,n,o,l);if(!(t instanceof Se.LineCurve3)&&a){var v=g+1;for(j=0;j<v-2;j++)u=j/(v-1),f=t.getTangentAt(u),h=t.getPointAt(u),m.crossVectors(f,new Se.Vec3(0,0,1)).normalize().multiplyScalar(i),j*t.getLength()/g>i/Math.abs(p)&&this.addPoints(h,m,n,o,l)}},computePoints:function(e,t,i){new Se.Vec3;var r,a,n,o=e.isClockwise(),s=e.curves[0].getPoint(0),l=e.curves[e.curves.length-1].getPoint(1);n=s.equals(l),a=e.curves.length;var h=[],c=[];for(new Se.Path,e.getLength(),r=0;r<a;r++){var u=r-1;n&&-1===u&&(u=a-1);var f=e.curves[u],p=e.curves[r];this.computeCurvePoint(f,p,t,!0,!0,h,c,i,o),r!==a-1||n||this.computeCurvePoint(null,p,t,!1,!1,h,c,i,o)}return[h,c,n]}}),Se.ShapeNode=function(e,t,i,r,a){if(null==e)return e=[],this.materialSize=3,void Se.Entity.call(this);var n;if(!(1===arguments.length&&e instanceof Object)||e instanceof Se.Shape||e instanceof Se.Path&&!Array.isArray(e))this.options={curveSegments:t,amount:i,vertical:r,zMinusHalfAmount:this.zMinusHalfAmount,repeat:a||20};else{if(null==(e=(n=e).path))return e=[],this.materialSize=3,void Se.Entity.call(this);t=n.curveSegments,i=n.amount,r=n.vertical,a=n.repeat,this.options={curveSegments:n.curveSegments,amount:n.amount,vertical:n.vertical,zMinusHalfAmount:this.zMinusHalfAmount,repeat:n.repeat||20},this._id=n.id}var o=[];e instanceof Se.Path?(o=e.toShapes(),this.path=e):o=e,this.curveSegments=t,this.amount=i,this.vertical=r,this.repeat=a||20,o=o instanceof Array?o:[o],this.shapes=o,this.shapebb=o[o.length-1].getBoundingBox(),this.materialSize=3,Se.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Se.ShapeNode.SideIndexMapping={bottom:0,side:1,top:2},Se.extend(Se.ShapeNode,Se.Entity,{constructor:Se.ShapeNode,className:"TGL.ShapeNode",__accessor:["path","curveSegments","amount","vertical","repeat"],__bool:["vertical"],__SizePropeties:["path","curveSegments","amount","vertical","repeat"],computeData:function(){return this.options={curveSegments:this.curveSegments,amount:this.amount,vertical:this.vertical,zMinusHalfAmount:this.zMinusHalfAmount,repeat:this.repeat||20},this.addShapes(this.path,this.options)},getSideIndexMapping:function(){return Se.ShapeNode.SideIndexMapping},addShapes:function(e,t){var i,r={vertices:[],uvs:[],uv2s:[],faces:[]};if(!(i=e instanceof Se.Path?e.toShapes():e))return r;for(var a=i.length,n=0;n<a;n++){var o=i[n];this.addShape(o,t,r)}var s=new Se.BoundingBox;s.setFromPoints(r.vertices);var l=(s.max.y-s.min.y)/2;if(t.zMinusHalfAmount)for(h=0;h<r.vertices.length;h++)r.vertices[h].y-=l;if(t.vertical)for(var h=0;h<r.vertices.length;h++){var c=r.vertices[h].y;r.vertices[h].y=r.vertices[h].z,r.vertices[h].z=-c}return r}}),Se.ShapeNode.prototype.addShape=function(c,u,f){function e(e,t,i){return t||console.log("die"),t.clone().multiplyScalar(i).add(e)}function t(e,t,i){return r=e,a=t,n=i,u=Se.ShapeNode.__v1,f=Se.ShapeNode.__v2,p=Se.ShapeNode.__v3,d=Se.ShapeNode.__v4,m=Se.ShapeNode.__v5,g=Se.ShapeNode.__v6,u.set(r.x-a.x,r.y-a.y),f.set(r.x-n.x,r.y-n.y),o=u.normalize(),s=f.normalize(),p.set(-o.y,o.x),d.set(s.y,-s.x),m.copy(r).add(p),g.copy(r).add(d),m.equals(g)?d.clone():(m.copy(a).add(p),g.copy(n).add(d),l=o.dot(d),h=g.sub(m).dot(d),0===l&&(console.log("Either infinite or no solutions!"),0===h?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),(c=h/l)<0?function(e,t,i){var r=Math.atan2(t.y-e.y,t.x-e.x),a=Math.atan2(i.y-e.y,i.x-e.x);a<r&&(a+=2*Math.PI);var n=(r+a)/2,o=-Math.cos(n),s=-Math.sin(n);return new Se.Vec2(o,s)}(r,a,n):o.multiplyScalar(c).add(m).sub(r).clone());var r,a,n,o,s,l,h,c,u,f,p,d,m,g}function r(e){for(var t=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY,n=e;n<f.uvs.length;n++)for(var o=f.uvs[n],s=0;s<o.length;s++)(u=o[s]).x>r&&(r=u.x),u.y>a&&(a=u.y),u.x<t&&(t=u.x),u.y<i&&(i=u.y);var l=r-t,h=a-i;for(n=e;n<f.uvs.length;n++){o=f.uvs[n];var c=[];for(s=0;s<o.length;s++){var u=o[s];c.push(new pe((u.x-t)/l,(u.y-i)/h))}f.uv2s.push(c)}}function i(e,t){var i,r;for(j=e.length;0<=--j;){(r=(i=j)-1)<0&&(r=e.length-1);var a=0,n=w+2*x;for(a=0;a<n;a++){var o=G*a,s=G*(a+1);l(t+i+o,t+r+o,t+r+s,t+i+s,e,a,n,i,r)}}}function a(e,t,i){f.vertices.push(new Se.Vec3(e,t,i-(g?m/2:0)))}function n(e,t,i,r){e+=z,t+=z,i+=z;var a,n=r?0:2;Se.Math.isClockwise([f.vertices[e],f.vertices[t],f.vertices[i]]),f.faces.push(new Se.Face3(e,t,i,null,null,n)),a=r?P.generateBottomUV(f,c,u,e,t,i):P.generateTopUV(f,c,u,e,t,i),f.uvs.push(a)}function l(e,t,i,r,a,n,o,s,l){var h;e+=z,t+=z,i+=z,r+=z,Se.Math.isClockwise([f.vertices[e],f.vertices[t],f.vertices[r]]),f.faces.push(new Se.Face3(e,t,r,null,null,S)),f.faces.push(new Se.Face3(t,i,r,null,null,S)),h=P.generateSideWallUV(f,c,a,u,e,t,i,r,n,o,s,l),f.uvs.push([h[0],h[1],h[3]]),f.uvs.push([h[1],h[2],h[3]])}var o,s,h,p,d,m=u.amount!==Me?u.amount:100,g=u.zMinusHalfAmount!==Me&&u.zMinusHalfAmount,y=u.bevelThickness!==Me?u.bevelThickness:6,v=u.bevelSize!==Me?u.bevelSize:y-2,x=u.bevelSegments!==Me?u.bevelSegments:3,A=u.bevelEnabled!==Me&&u.bevelEnabled,_=u.curveSegments!==Me?u.curveSegments:12,w=u.steps!==Me?u.steps:1,b=u.extrudePath,M=!1,S=(u.material,u.extrudeMaterial||1),P=u.UVGenerator!==Me?u.UVGenerator:Se.ShapeNode.WorldUVGenerator;P.repeat=u.repeat,P.amount=m,this.shapebb,b&&(o=b.getSpacedPoints(w),A=!(M=!0),s=u.frames!==Me?u.frames:Se.PathNode.prototype.frenetFrames(b,w,!1),h=new Se.Vec3,p=new Se.Vec3,d=new Se.Vec3),A||(v=y=x=0);var T,C,E,z=f.vertices.length,D=c.extractPoints(_),L=D.shape,R=D.holes,N=!Se.Shape.Utils.isClockWise(L);if(N){for(L=L.reverse(),C=0,E=R.length;C<E;C++)T=R[C],Se.Shape.Utils.isClockWise(T)&&(R[C]=T.reverse());N=!1}var B=Se.Shape.Utils.triangulateShape(L,R),I=L;for(C=0,E=R.length;C<E;C++)T=R[C],L=L.concat(T);for(var F,V,U,k,O,X,G=L.length,Y=B.length,W=(I.length,Math.PI,[]),j=0,H=I.length,q=H-1,Z=j+1;j<H;j++,q++,Z++)q===H&&(q=0),Z===H&&(Z=0),I[j],I[q],I[Z],W[j]=t(I[j],I[q],I[Z]);var Q,K,J=[],$=W.concat();for(C=0,E=R.length;C<E;C++){for(T=R[C],Q=[],j=0,q=(H=T.length)-1,Z=j+1;j<H;j++,q++,Z++)q===H&&(q=0),Z===H&&(Z=0),Q[j]=t(T[j],T[q],T[Z]);J.push(Q),$=$.concat(Q)}for(F=0;F<x;F++){for(k=y*(1-(U=F/x)),V=v*Math.sin(U*Math.PI/2),j=0,H=I.length;j<H;j++)a((O=e(I[j],W[j],V)).x,O.y,-k);for(C=0,E=R.length;C<E;C++)for(T=R[C],Q=J[C],j=0,H=T.length;j<H;j++)a((O=e(T[j],Q[j],V)).x,O.y,-k)}for(V=v,j=0;j<G;j++)O=A?e(L[j],$[j],V):L[j],M?(p.copy(s.normals[0]).multiplyScalar(O.x),h.copy(s.binormals[0]).multiplyScalar(O.y),d.copy(o[0]).add(p).add(h),a(d.x,d.y,d.z)):a(O.x,O.y,0);for(K=1;K<=w;K++)for(j=0;j<G;j++)O=A?e(L[j],$[j],V):L[j],M?(p.copy(s.normals[K]).multiplyScalar(O.x),h.copy(s.binormals[K]).multiplyScalar(O.y),d.copy(o[K]).add(p).add(h),a(d.x,d.y,d.z)):a(O.x,O.y,m/w*K);for(F=x-1;0<=F;F--){for(k=y*(1-(U=F/x)),V=v*Math.sin(U*Math.PI/2),j=0,H=I.length;j<H;j++)a((O=e(I[j],W[j],V)).x,O.y,m+k);for(C=0,E=R.length;C<E;C++)for(T=R[C],Q=J[C],j=0,H=T.length;j<H;j++)O=e(T[j],Q[j],V),M?a(O.x,O.y+o[w-1].y,o[w-1].x+k):a(O.x,O.y,m+k)}!function(){var e=f.uvs.length;if(A){var t=0,i=G*t;for(j=0;j<Y;j++)n((X=B[j])[2]+i,X[1]+i,X[0]+i,!0);for(i=G*(t=w+2*x),j=0;j<Y;j++)n((X=B[j])[0]+i,X[1]+i,X[2]+i,!1)}else{for(j=0;j<Y;j++)n((X=B[j])[2],X[1],X[0],!0);for(j=0;j<Y;j++)n((X=B[j])[0]+G*w,X[1]+G*w,X[2]+G*w,!1)}r(e)}(),function(){var e=f.uvs.length,t=0;for(i(I,t),t+=I.length,C=0,E=R.length;C<E;C++)i(T=R[C],t),t+=T.length;r(e)}()},Se.ShapeNode.WorldUVGenerator={generateTopUV:function(e,t,i,r,a,n){var o=e.vertices[r].x,s=e.vertices[r].y,l=e.vertices[a].x,h=e.vertices[a].y,c=e.vertices[n].x,u=e.vertices[n].y;return[new Se.Vec2(o/this.repeat,s/this.repeat),new Se.Vec2(l/this.repeat,h/this.repeat),new Se.Vec2(c/this.repeat,u/this.repeat)]},generateBottomUV:function(e,t,i,r,a,n){return this.generateTopUV(e,t,i,r,a,n)},uv:function(e,t,i){return new pe(Math.sqrt(e*e+t*t)/this.repeat,(1-i)/this.repeat)},generateSideWallUV:function(e,t,i,r,a,n,o,s,l,h,c,u){var f=e.vertices[a].x,p=e.vertices[a].y,d=e.vertices[a].z,m=e.vertices[n].x,g=e.vertices[n].y,y=e.vertices[n].z,v=e.vertices[o].x,x=e.vertices[o].y,A=e.vertices[o].z,_=e.vertices[s].x,w=e.vertices[s].y,b=e.vertices[s].z;return Math.abs(p-g)<Math.abs(f-m)?[new Se.Vec2(f/this.repeat,(this.amount-d)/this.repeat),new Se.Vec2(m/this.repeat,(this.amount-y)/this.repeat),new Se.Vec2(v/this.repeat,(this.amount-A)/this.repeat),new Se.Vec2(_/this.repeat,(this.amount-b)/this.repeat)]:[new Se.Vec2(p/this.repeat,(this.amount-d)/this.repeat),new Se.Vec2(g/this.repeat,(this.amount-y)/this.repeat),new Se.Vec2(x/this.repeat,(this.amount-A)/this.repeat),new Se.Vec2(w/this.repeat,(this.amount-b)/this.repeat)]}},Se.ShapeNode.__v1=new Se.Vec2,Se.ShapeNode.__v2=new Se.Vec2,Se.ShapeNode.__v3=new Se.Vec2,Se.ShapeNode.__v4=new Se.Vec2,Se.ShapeNode.__v5=new Se.Vec2,Se.ShapeNode.__v6=new Se.Vec2,Se.TextNode=function(e,t,i,r,a,n,o){var s;1===arguments.length&&e instanceof Object&&!Array.isArray(e)?(e=(s=e).text,this.font=s.font||"helvetiker",this.size=s.size||150,this.weight=s.weight||"normal",this.fontStyle=s.fontStyle||"normal",this.height=s.height||50,this._id=s.id,this.curveSegments=s.curveSegments):(this.font=r||"helvetiker",this.size=t||150,this.weight=a||"normal",this.fontStyle=n||"normal",this.height=i||50,this.curveSegments=o);var l={size:this.size,height:this.height,font:this.font,weight:this.weight,style:this.fontStyle,curveSegments:this.curveSegments||30,bevelEnabled:!1,zMinusHalfAmount:!0};this.text=e;var h=Se.FontUtils.generateShapes(e,l);l.amount=l.height!==Me?l.height:50,l.bevelThickness===Me&&(l.bevelThickness=10),l.bevelSize===Me&&(l.bevelSize=8),l.bevelEnabled===Me&&(l.bevelEnabled=!1),Se.ShapeNode.call(this,h,l.curveSegments,this.height,!1,50,!0)},Se.extend(Se.TextNode,Se.ShapeNode,{constructor:Se.TextNode,className:"TGL.TextNode",__accessor:["text","size","height","font","weight","fontStyle"],__SizePropeties:["text","size","height","font","weight","fontStyle"],computeData:function(){var e={size:this.size,height:this.height,font:this.font,weight:this.weight,style:this.fontStyle,curveSegments:this.curveSegments||30,bevelEnabled:!1,zMinusHalfAmount:!0},t={curveSegments:this.curveSegments,amount:this.height,vertical:!1,zMinusHalfAmount:!0,repeat:20},i=Se.FontUtils.generateShapes(this.text,e);return Se.ShapeNode.prototype.addShapes.call(this,i,t)}}),Se.LatheNode=function(e,t,i,r,a,n){var o;this.materialSize=3,1===arguments.length&&e instanceof Object&&!(e instanceof Se.Path)?(o=e,this.path=o.path,this.segmentsH=o.segmentsH||64,this.segmentsR=o.segmentsR||20,this.arc=o.arc!=Me?o.arc:2*Math.PI,this.startClosed=o.startClosed,this.endClosed=o.endClosed,this._id=o.id):(this.path=e,this.segmentsH=t||64,this.segmentsR=i||20,this.arc=r!=Me?r:2*Math.PI,this.startClosed=a,this.endClosed=n),Se.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Se.extend(Se.LatheNode,Se.Entity,{constructor:Se.LatheNode,className:"TGL.LatheNode",__accessor:["path","segmentsH","segmentsR","arc","startClosed","endClosed"],__SizePropeties:["path","segmentsH","segmentsR","arc","startClosed","endClosed"],computeData:function(){function e(e){var t=e.x,i=e.z,r=(1+(0===i?t/Math.abs(t):t/Math.abs(i)))/2;r=Se.Math.clamp(r,0,1);var a=(1+(0===t?i/Math.abs(i):i/Math.abs(t)))/2;return a=Se.Math.clamp(a,0,1),new Se.Vec2(r,a)}var t={};if((t={}).faces=[],t.uvs=[],t.vertices=[],null==this.path)return t;var i,r,n,o,s,l,h,u=[],f=this.path,p=this.segmentsH,d=this.segmentsR;for(Se.Shape.Utils.isClockWise(f.getPoints())||(f=f.reverse()),r=0;r<=p;r++){for(i=f.getPoint(r/p),u[r]=[],o=Math.abs(i.x),s=i.y,this.startClosed&&0===r&&t.vertices.push(new Se.Vec3(0,s,0)),n=0;n<d;n++)h=n/d*this.arc,l=new Se.Vec3(o*Math.cos(h),s,o*Math.sin(h)),u[r][n]=t.vertices.push(l)-1;this.endClosed&&r===p&&t.vertices.push(new Se.Vec3(0,s,0))}var m=this.arc==2*Math.PI;if(this.startClosed)for(n=a=0;n<(m?d:d-1);n++)jp=(n+1)%d,b=u[0][n],c=u[0][jp],uva=new Se.Vec2(.5,.5),uvb=e(t.vertices[b]),uvc=e(t.vertices[c]),t.faces.push(new Se.Face3(a,b,c)),t.uvs.push([uva,uvb,uvc]);for(r=0;r<p;r++)for(n=0;n<(m?d:d-1);n++)ip=r+1,jp=(n+1)%d,a=u[r][n],b=u[ip][n],c=u[ip][jp],_t=u[r][jp],uva=new Se.Vec2(r/p,n/d),uvb=new Se.Vec2((r+1)/p,n/d),uvc=new Se.Vec2((r+1)/p,(n+1)/d),uvd=new Se.Vec2(r/p,(n+1)/d),t.faces.push(new Se.Face3(a,b,_t)),t.uvs.push([uva,uvb,uvd]),t.faces.push(new Se.Face3(b,c,_t)),t.uvs.push([uvb.clone(),uvc,uvd.clone()]);if(this.endClosed)for(a=t.vertices.length-1,n=0;n<(m?d:d-1);n++)jp=(n+1)%d,b=u[u.length-1][n],c=u[u.length-1][jp],uva=new Se.Vec2(0,0),uvb=new Se.Vec2(1,n/d),uvc=new Se.Vec2(1,(n+1)/d),t.faces.push(new Se.Face3(a,b,c)),t.uvs.push([uva,uvb,uvc]);return t}}),Se.CurvePlane=function(e,t,i,r){this.pathH=e,this.pathV=t,this.segmentsH=i||20,this.segmentsV=r||20,Se.Entity.call(this)},Se.extend(Se.CurvePlane,Se.Entity,{constructor:Se.CurvePlane,className:"TGL.CurvePlane",computeData:function(){var e={faces:[],uvs:[],vertices:[]};if(null==this.pathV||null==this.pathH)return e;var t,i,r,a,n,o,s,l,h,c=this.pathV,u=this.pathH,f=this.segmentsV,p=this.segmentsH,d=f+1,m=p+1;for(this.grid=[],t=0;t<m;t++){this.grid[t]=[];var g=u.getPointAt(t/m);for(i=0;i<d;i++){var y=c.getPointAt(i/d);this.grid[t][i]=e.vertices.push(new Q(g.x,y.y,g.z+y.z))-1}}for(t=0;t<p;t++)for(i=0;i<f;i++)r=this.grid[t][i],a=this.grid[t][i+1],n=this.grid[t+1][i+1],o=this.grid[t+1][i],s=new pe(t/m,i/d),l=new pe(t/m,(i+1)/d),uvc=new pe((t+1)/m,(i+1)/d),h=new pe((t+1)/m,i/d),e.faces.push(new Ce(r,n,a)),e.uvs.push([s,uvc,l]),e.faces.push(new Ce(r,o,n)),e.uvs.push([s.clone(),h.clone(),uvc]);return e}}),Se.ComboNode=function(e,t,i,r,a){if(1===arguments.length&&e instanceof Object&&!Array.isArray(e)){var n=e;this.combos=n.combos||[],this.operators=n.operators,this.centralized=i,this.names=a,this._id=n.id}else this.combos=e||[],this.operators=t,this.centralized=i,this._id=r,this.names=a;this.csgs=[],Se.Entity.call(this)},Se.extend(Se.ComboNode,Se.Entity,{constructor:Se.ComboNode,className:"TGL.ComboNode",__accessor:["combos","operators","centralized","names"],__SizePropeties:["combos","operators","centralized"],getOffsetPosition:function(){return this._offsetPosition},getSideIndexMapping:function(){var e,t,i,r,a=this.combos,n=this.names||[],o={},s=0;if(a&&a.length)for(i=0;i<a.length;i++){e=a[i],(t=n[i])||((r=e.getClassName())&&0<r.indexOf(".")&&(r=r.substr(r.lastIndexOf(".")+1)),t=(t=r+""+i).toLowerCase());var l=e.getSideIndexMapping();if(l)for(var h in l)o[t+"-"+h]=s++;else o[t]=s++}return o},computeData:function(){this.csgs=[];var e={vertices:[],faces:[],uvs:[],uv2s:[]};if(!this.combos)return e;if(null==this.operators||0==this.operators.length){var t=je.mergeElements(this.combos);if(this.materialSize=t.material.materials.length,this.material=t.material,this.orgMaterial=t.material,e={vertices:t.vertices,faces:t.faces,uvs:t.uvs,uv2s:t.uv2s||[]},this.centralized&&e.vertices){for((s=new Se.BoundingBox).setFromPoints(e.vertices),l=s.center(),i=0;i<e.vertices.length;i++)(h=e.vertices[i]).sub(l);this._offsetPosition=l}return e}this.operators=this.operators||[];var i,r,a,n,o=this.combos.length;for(i=0;i<o;i++)this.csgs.push(new Se.CSG(this.combos[i]));for(i=0;i<o;i++)null==r?r=this.csgs[i]:"+"===(a=this.operators[i-1])||a==Me?r=r.union(this.csgs[i]):"-"===a?r=r.substract(this.csgs[i]):"^"===a&&(r=r.intersect(this.csgs[i]));if(!r)return e;if(n=r.toMesh(),"centralized"==this.changeProperty&&null!=this.material||(this.materialSize=n.material.materials.length,this.material=n.material,this.orgMaterial=n.material),e={vertices:n.vertices,faces:n.faces,uvs:n.uvs,uv2s:n.uv2s},this.centralized&&e.vertices){var s=new Se.BoundingBox;s.setFromPoints(e.vertices);var l=s.center();for(i=0;i<e.vertices.length;i++){var h=e.vertices[i];h.sub(l)}this._offsetPosition=l}return n=Me,e},refreshStyleMap:function(){for(var e=this.combos,t=this.styleMap,i=0,r=0;r<e.length;r++){var a=e[r],n=a.getMaterailSize();for(s in a.styleMap)for(var o=t[s]||(t[s]=[]),l=a.styleMap[s],h=0;h<n;h++)o[i+h]=je.isArray(l)?l[h]:l;i+=n}},computeNodeMaterial:function(e){this.material=e.material,this.materialSize=e.materialSize},cacheNodeMaterial:function(e){e.material=this.material,e.materialSize=this.materialSize},needComputeVertexNormal:function(){return!0},generatePrimitiveKey:function(){return null},changeMapping:function(e){var t=this.getMaterialMapping();Se.Utils.isSame(e,t)||(this.batch?this.materialMappingChanges=[e,t]:(this.onMaterialMapping(),this.firePropertyChange("materialMapping",e,t)))},isStyleEquals:function(e,t,i){return!1},getSelectStyle:function(){var e=this.getStyle("select.style");return"outline.normal"!=e&&"outline"!=e||(e="outline.wireframe"),e},onMaterialMapping:function(){this.groups=Me,this.primitive.groups=Me}}),Se.Terrain=function(e){if(e=e||{},this._id=e.id,this.width=e.width,this.depth=e.depth,this.segmentsW=e.segmentsW||30,this.segmentsD=e.segmentsD||30,this.heightMap=e.heightMap,this.heightUnit=e.heightUnit||1,this.maxHeight=e.maxHeight||255,this.minHeight=e.minHeight||0,this.baseLayerHeight=e.baseLayerHeight||0,"string"==typeof this.heightMap?(this.image=new Image,this.image.src=this.heightMap):re.isCanvas(this.heightMap)?this.canvas=this.heightMap:re.isImage(this.heightMap)&&(this.image=this.heightMap),this.image){var i=this;this.image.onload=function(e){var t=document.createElement("canvas");t.width=i.image.width,t.height=i.image.height,t.getContext("2d").drawImage(i.image,0,0),i.canvas=t,i.computed=!1,i.computeNodeData(),i.firePropertyChange("width",0,1)}}this.materialSize=2,Se.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},Se.extend(Se.Terrain,Se.Entity,{constructor:Se.Terrain,className:"TGL.Terrain",__accessor:["width","depth","segmentsW","segmentsD","heightMap","heightUnit","maxHeight","minHeight","baseLayerHeight","smooth"],__SizePropeties:["width","depth","segmentsW","segmentsD","heightMap","heightUnit","maxHeight","minHeight","baseLayerHeight","smooth"],__bool:["smooth"],computeLayerData:function(e,t,i){var r,a,n=this.width/2,o=this.depth/2,s=i?this.segmentsW:1,l=i?this.segmentsD:1,h=s+1,c=l+1,u=this.width/s,f=this.depth/l,p=new Se.Vec3(0,0,1),d=e.vertices.length;for(a=0;a<c;a++)for(r=0;r<h;r++){var m,g=r*u-n,y=a*f-o;m=i?i.call(this,r/h,a/c):this.baseLayerHeight*this.heightUnit,e.vertices.push(new Se.Vec3(g,m,y))}for(a=0;a<l;a++)for(r=0;r<s;r++){var v=r+h*a+d,x=r+h*(a+1)+d,A=r+1+h*(a+1)+d,_=r+1+h*a+d,w=new Se.Vec2(r/s,1-a/l),b=new Se.Vec2(r/s,1-(a+1)/l),M=new Se.Vec2((r+1)/s,1-(a+1)/l),S=new Se.Vec2((r+1)/s,1-a/l);if(i)(P=new Se.Face3(v,x,_)).materialIndex=t,e.faces.push(P),e.uvs.push([w,b,S]),(P=new Se.Face3(x,A,_)).materialIndex=t,e.faces.push(P),e.uvs.push([b.clone(),M,S.clone()]);else{var P=new Se.Face4(v,x,A,_);P.normal.copy(p),P.vertexNormals.push(p.clone(),p.clone(),p.clone(),p.clone()),P.materialIndex=t,e.faces.push(P),e.uvs.push([w,b,M,S])}}},computeData:function(){var e={vertices:[],faces:[],uvs:[]};return this.computeLayerData(e,0),this.computeLayerData(e,1,this.getHeight),e},getFaceNormal:function(e,t){this.computeFaceNormals();var i=this.segmentsW*e,r=this.segmentsD*t,a=Math.floor(i),n=Math.floor(r),o=n*this.segmentsW+a;o=2*o+1,a!=Math.round(i)&&n!=Math.round(r)&&o++;var s=this.faces[o];return this.vertices[s.a],this.vertices[s.b],this.vertices[s.c],s.normal.clone()},setHeightMap:function(e){if(this.heightMap=e,"string"==typeof this.heightMap?(this.image=new Image,this.image.src=this.heightMap):re.isCanvas(this.heightMap)?this.canvas=this.heightMap:re.isImage(this.heightMap)&&(this.image=this.heightMap),this.image){var i=this;if(this.image.width){var t=document.createElement("canvas");t.width=i.image.width,t.height=i.image.height,t.getContext("2d").drawImage(i.image,0,0),i.canvas=t,i.computed=!1,i.computeNodeData(),i.firePropertyChange("width",0,1)}else this.image.onload=function(e){var t=document.createElement("canvas");t.width=i.image.width,t.height=i.image.height,t.getContext("2d").drawImage(i.image,0,0),i.canvas=t,i.computed=!1,i.computeNodeData(),i.firePropertyChange("width",0,1)}}},getHeight:function(e,t){if(null==this.canvas)return 0;var i=this.canvas;if(null==this.heightData){for(var r=i.width*i.height,a=new Float32Array(r),n=0;n<r;n++)a[n]=0;for(var o=i.getContext("2d").getImageData(0,0,i.width,i.height).data,s=0,l=(n=0,o.length);n<l;n+=4){var h=o[n]+o[n+1]+o[n+2];a[s++]=h/3}this.heightData=a}var c=e*i.width,u=t*i.height,f=Math.floor(c),p=Math.floor(u),d=[],m=[];d.push(f),c!=f&&d.push(f+1),m.push(p),u!=p&&m.push(p+1);var g,y=d.length*m.length,v=0;for(n=0;n<d.length;n++)for(s=0;s<m.length;s++)g=m[s]*i.width+d[n],v+=this.heightData[g];return v/=y,(v=Se.Math.clamp(v,this.minHeight,this.maxHeight))*this.heightUnit},getSideIndexMapping:function(){return Se.Terrain.SideIndexMapping},refreshUniforms:function(e){e.heightUnit&&(e.heightUnit.value=this.heightUnit)}}),Se.Terrain.SideIndexMapping={layer0:0,layer1:1},Se.Link=function(e,t,i){if(1===arguments.length&&e instanceof Object&&!Array.isArray(e)){var r=e;e=r.fromNode,t=r.toNode,this._id=r.id}else this._id=i;Se.Line.call(this),this.setFromNode(e),this.setToNode(t),this._editable=!1},Se.extend(Se.Link,Se.Line,{className:"TGL.Link",___accessor:["linkType","extend","controls"],__SizePropeties:["fromNode","toNode","linkType","extend","controls"],setFromNode:function(e){if(this._fromNode!=e){var t=this._fromNode;this._fromNode=e,this.onPropertyChange(),this.firePropertyChange("fromNode",t,e),this._fromNode=e,t&&(t._removeFromLink(this),t.removePropertyChangeListener(this.handleNodePropertyChange)),this._fromNode&&(this._fromNode._addFromLink(this),this._fromNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getFromNode:function(){return this._fromNode},setToNode:function(e){if(this._toNode!=e){var t=this._toNode;this._toNode=e,this.onPropertyChange(),this.firePropertyChange("toNode",t,e),t&&(t.removePropertyChangeListener(this.handleNodePropertyChange),t._removeToLink(this)),this._toNode&&(this._toNode._addToLink(this),this._toNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getToNode:function(){return this._toNode},isLooped:function(){return this._fromNode===this._toNode&&null!=this._fromNode&&null!=this._toNode},handleNodePropertyChange:function(e){if(e.property.startsWith("position")||"worldMatrix"==e.property){var t=this.vertices;this.onPropertyChange(),this.firePropertyChange("vertices",t,this.vertices)}},computeNodeData:function(){this.computeData()},updateMatrix:function(){},updateWorldMatrix:function(){},computeData:function(){if(null!=this._fromNode&&null!=this._toNode){null==this._extend&&(this._extend=0);var e=this._fromNode.worldMatrix.getPosition(),t=this._toNode.worldMatrix.getPosition(),i=[];if(i.push(e.clone()),"orthogonal.x"==this._linkType){var r=Math.max(e.x,t.x),a=new Q(r+this._extend,e.y,e.z);i.push(a),a=new Q(r+this._extend,t.y,t.z),i.push(a)}else if("orthogonal.x.n"==this._linkType){var n=Math.min(e.x,t.x);a=new Q(n-this._extend,e.y,e.z);i.push(a),a=new Q(n-this._extend,t.y,t.z),i.push(a)}else if("orthogonal.y"==this._linkType){var o=Math.max(e.y,t.y);a=new Q(e.x,o+this._extend,e.z);i.push(a),a=new Q(t.x,o+this._extend,t.z),i.push(a)}else if("orthogonal.y.n"==this._linkType){var s=Math.min(e.y,t.y);a=new Q(e.x,s-this._extend,e.z);i.push(a),a=new Q(t.x,s-this._extend,t.z),i.push(a)}else if("orthogonal.z"==this._linkType){var l=Math.max(e.z,t.z);a=new Q(e.x,e.y,l+this._extend);i.push(a),a=new Q(t.x,t.y,l+this._extend),i.push(a)}else if("orthogonal.z.n"==this._linkType){var h=Math.min(e.z,t.z);a=new Q(e.x,e.y,h-this._extend);i.push(a),a=new Q(t.x,t.y,h-this._extend),i.push(a)}else if("control"==this._linkType){var c=this._controls;if(c&&0<c.length)for(var u=0;u<c.length;u++)c[u]instanceof Q&&i.push(c[u].clone())}i.push(t.clone()),this.vertices=i}},onPropertyChange:function(){this.vertices=this.vertices||[],this.computeData(),this.computeBoundingBox(),this.selectionData=null,this.boundingSphere=null}}),Se.PathLink=function(e,t,i){if(1===arguments.length&&e instanceof Object&&!Array.isArray(e)){var r=e;e=r.fromNode,t=r.toNode,this._id=r.id}else this._id=i;Se.PathNode.call(this),this._autoAjust=!0,this.setFromNode(e),this.setToNode(t)},Se.PathLink.allLinkTypes=["extend.x","extend.y","extend.z","extend.x.n","extend.y.n","extend.z.n","orthogonal.x","orthogonal.y","orthogonal.z","orthogonal.x.n","orthogonal.y.n","orthogonal.z.n","flex.x","flex.y","flex.z","flex.yz","flex.xz","flex.xy"],Se.extend(Se.PathLink,Se.PathNode,{className:"TGL.PathLink",___accessor:["linkType","extend","controls","fromOffset","toOffset"],__SizePropeties:["fromOffset","toOffset","path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","fromNode","toNode","linkType","extend","controls"],setFromNode:function(e){if(this._fromNode!=e){var t=this._fromNode;this._fromNode=e,this._dirtyPath=!0,this.onPropertyChange("fromNode",t,e),this.firePropertyChange("fromNode",t,e),this._fromNode=e,t&&(t._removeFromLink(this),t.removePropertyChangeListener(this.handleNodePropertyChange)),this._fromNode&&(this._fromNode._addFromLink(this),this._fromNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getFromNode:function(){return this._fromNode},setToNode:function(e){if(this._toNode!=e){var t=this._toNode;this._toNode=e,this.onPropertyChange("toNode",t,e),this.firePropertyChange("toNode",t,e),t&&(t.removePropertyChangeListener(this.handleNodePropertyChange),t._removeToLink(this)),this._toNode&&(this._toNode._addToLink(this),this._toNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getToNode:function(){return this._toNode},isLooped:function(){return this._fromNode===this._toNode&&null!=this._fromNode&&null!=this._toNode},handleNodePropertyChange:function(e){var t=e.source,i=e.property;if(i.startsWith("position")||i.startsWith("rotation")||i.startsWith("scale")||"worldMatrix"==i||"linkAgent"===i||t.isSizeChangedProperty(i)||"parent"===i){this.vertices,this._dirtyPath=!0;var r=this;We.PATH_LINK_COMPUTE_DELAY?setTimeout(function(){r._computePath()},10):r._computePath()}},_resetPath:function(){if(this.path){if("arrow"!==this.endCap)return this.path;if(1<this.endCapExtend*this.endCapR)return this.path;var e,t,i,r=this.path,a=new Se.Path,n=r.actions.length,o=null;for(t=0;t<n-1;t++)i=(e=r.actions[t]).args,o=new Se.Vec3(i[0],i[1],i[2]),"moveTo"===e.action?a.moveTo(i[0],i[1],i[2]):"lineTo"===e.action?a.lineTo(i[0],i[1],i[2]):"quadraticCurveTo"===e.action&&(a.curveTo(i[0],i[1],i[2],i[3],i[4],i[5]),o=new Se.Vec3(i[3],i[4],i[5]));if(t=n-1,i=(e=r.actions[t]).args,"lineTo"===e.action){var s,l=new Se.Vec3(i[0],i[1],i[2]),h=(new Q).subVectors(l,o).normalize();n=this.radius*this.endCapSize;s=(new Q).subVectors(l,o).length()<n?o.add(h.multiplyScalar(.1)):l.clone().sub(h.multiplyScalar(n)),a.lineTo(s.x,s.y,s.z)}return a}},_getNodeOffset:function(e,t,i){t=e.worldToLocal(t.clone()),i=e.worldToLocal(i.clone());var r=(new Q).subVectors(i,t),a=r.length(),n=e.getLinkOffset(r);return n&&n.length()>a&&n.normalize().multiplyScalar(a-.1),n||new Q(0,0,0)},updateMatrix:function(){},updateWorldMatrix:function(e,t){},onPropertyChange:function(e,t,i){"fromNode"!==e&&"toNode"!==e&&"linkType"!==e&&"extend"!==e&&"controls"!==e&&"fromOffset"!==e&&"toOffset"!==e||(this._dirtyPath=!0),Se.Node.prototype.onPropertyChange.call(this,e,t,i)},computeData:function(){return this._computePath(),Se.PathNode.prototype.computeData.call(this)},_clearFromNodeExtend:function(e,t,i){},_flex:function(e,t,i,r,a){e=e.substr(e.indexOf(".")+1);for(var n,o=["x","y","z"],s=new Q,l=new Q,h=0;h<3;h++)s[n=o[h]]=n===e?r[n]:t[n],l[n]=n===e?r[n]:i[n];a.push(s,l)},_flex2:function(e,t,i,r){var a=["x","y","z"],n=(e=e.substr(e.indexOf(".")+1))[0],o=e[1];if(t[n]!=i[n]){for(var s=new mono.Vec3,l=0;l<a.length;l++)s[a[l]]=a[l]==n?i[a[l]]:t[a[l]];r.push(s)}if(t[o]!=i[o]){var h=new mono.Vec3;for(l=0;l<a.length;l++)h[a[l]]=a[l]==n||a[l]==o?i[a[l]]:t[a[l]];r.push(h)}},_orthogonal:function(e,t,i,r){e=e.substr(e.indexOf(".")+1);var a,n=!1,o=["x","y","z"],s=new Q,l=0;e.endsWith(".n")&&(n=!0,e=e[0]);for(var h=n?t[e]:i[e],c=0;c<o.length;c++)(a=o[c])!==e&&t[a]==i[a]&&l++;if(2!==l){for(c=0;c<o.length;c++)s[a=o[c]]=a!==e?h:n?i[a]:t[a];r.push(s)}},_removeSamePoint:function(e){},computeLoopPath:function(e){var t=new mono.Path;return t.moveTo(e.x,e.y,e.z),t.lineTo(e.x,e.y+200,e.z),t.lineTo(e.x+200,e.y+200,e.z),t.lineTo(e.x+200,e.y,e.z),t.lineTo(e.x,e.y,e.z),this.setPath(t),t},_computePath:function(){if(this._dirtyPath&&(this._dirtyPath=!1,null!=this._fromNode&&null!=this._toNode)){null==this._extend&&(this._extend=0);var e=this._fromNode.getLinkAgent()||this._fromNode,t=this._toNode.getLinkAgent()||this._toNode,i=e.localToWorld2(new Q(0,0,0)),r=t.localToWorld2(new Q(0,0,0));if(e==t)return this.computeLoopPath(i,r);if(!i.equals(r)){var a=[],n=this.radius*this.endCapSize;if(this._linkType&&this._linkType.startsWith("extend")){var o,s,l,h;if("extend.x"===this._linkType){o=new Q(1,0,0);i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.max(i.x,r.x)+this._extend+n+.1,s=new Q(h,i.y,i.z),l=new Q(h,r.y,r.z)}else if("extend.y"===this._linkType){o=new Q(0,1,0);i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.max(i.y,r.y)+this._extend+n+.1,s=new Q(i.x,h,i.z),l=new Q(r.x,h,r.z)}else if("extend.z"===this._linkType){o=new Q(0,0,1);i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.max(i.z,r.z)+this._extend+n+.1,s=new Q(i.x,i.y,h),l=new Q(r.x,r.y,h)}else if("extend.x.n"===this._linkType){o=new Q(-1,0,0);i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.min(i.x,r.x)-this._extend-n-.1,s=new Q(h,i.y,i.z),l=new Q(h,r.y,r.z)}else if("extend.y.n"===this._linkType){o=new Q(0,-1,0);i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.min(i.y,r.y)-this._extend-n-.1,s=new Q(i.x,h,i.z),l=new Q(r.x,h,r.z)}else if("extend.z.n"===this._linkType){o=new Q(0,0,-1);i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.min(i.z,r.z)-this._extend-n-.1,s=new Q(i.x,i.y,h),l=new Q(r.x,r.y,h)}s?a.push(i,s,l,r):a.push(i,r)}else{if(a.push(i),"orthogonal.x"===this._linkType)if(i.y==r.y&&i.z==r.z);else{var c=r.x,u=new Q(c,i.y,i.z);a.push(u)}else if("orthogonal.x.n"===this._linkType){c=i.x,u=new Q(c,r.y,r.z);a.push(u)}else if("orthogonal.y"===this._linkType){var f=r.y;u=new Q(i.x,f,i.z);a.push(u)}else if("orthogonal.y.n"===this._linkType){f=i.y,u=new Q(r.x,f,r.z);a.push(u)}else"orthogonal.z"===this._linkType?(u=new Q(i.x,i.y,r.z),a.push(u)):"orthogonal.z.n"===this._linkType&&(u=new Q(r.x,r.y,i.z),a.push(u));var p=new Q(i.x+r.x,i.y+r.y,i.z+r.z).multiplyScalar(.5);if("flex.x"!==this._linkType&&"flex.y"!==this._linkType&&"flex.z"!==this._linkType||this._flex(this._linkType,i,r,p,a),"flex.yz"!==this._linkType&&"flex.zy"!==this._linkType&&"flex.xy"!==this._linkType&&"flex.yx"!==this._linkType&&"flex.xz"!==this._linkType&&"flex.zx"!==this._linkType||this._flex2(this._linkType,i,r,a),"control"===this._linkType){var d=this.getControls();je.isArray(d)&&(a=a.concat(d))}a.push(r),y=a.length;var m=this._getNodeOffset(e,a[0].clone(),a[1].clone()),g=this._getNodeOffset(t,a[y-1].clone(),a[y-2].clone());i=e.localToWorld2(m),r=t.localToWorld2(g),a[0]=i,a[y-1]=r}var y=a.length,v=this.getFromOffset(),x=this.getToOffset();v&&a[0].add(v),x&&a[y-1].add(x);for(var A,_=new Se.Path,w=0;w<y;w++)A=a[w],0===w?_.moveTo(A.x,A.y,A.z):_.lineTo(A.x,A.y,A.z);return this.setPath(_),_}this.setPath(null)}}}),mono.LoadingManager=function(e,t,i){var r=this,a=0,n=0;this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){n++},this.itemEnd=function(e){a++,r.onProgress!==Me&&r.onProgress(e,a,n),a===n&&r.onLoad!==Me&&r.onLoad()}},mono.DefaultLoadingManager=new mono.LoadingManager,mono.ImageLoader=function(e){this.manager=e!==Me?e:mono.DefaultLoadingManager},mono.ImageLoader.prototype={constructor:mono.ImageLoader,load:function(t,i,r,a){var n=this,e=document.createElement("img");return i!==Me&&e.addEventListener("load",function(e){n.manager.itemEnd(t),i(this)},!1),r!==Me&&e.addEventListener("progress",function(e){r(e)},!1),a!==Me&&e.addEventListener("error",function(e){a(e)},!1),this.crossOrigin!==Me&&(e.crossOrigin=this.crossOrigin),e.src=t,n.manager.itemStart(t),e},loadFile:function(e,t,i,r){var a=this,n=new FileReader;t!==Me&&(n.onload=function(){t(n.result),a.manager.itemEnd(e.name)}),i!==Me&&n.addEventListener("progress",function(e){i(e)},!1),r!==Me&&n.addEventListener("error",function(e){r(e)},!1),n.readAsDataURL(e),a.manager.itemStart(e.name)},setCrossOrigin:function(e){this.crossOrigin=e}},mono.XHRLoader=function(e){this.manager=e!==Me?e:mono.DefaultLoadingManager},mono.XHRLoader.prototype={constructor:mono.XHRLoader,load:function(t,i,r,a){var n=this,e=new XMLHttpRequest;i!==Me&&e.addEventListener("load",function(e){i(e.target.responseText),n.manager.itemEnd(t)},!1),r!==Me&&e.addEventListener("progress",function(e){r(e)},!1),a!==Me&&e.addEventListener("error",function(e){a(e)},!1),this.crossOrigin!==Me&&(e.crossOrigin=this.crossOrigin),e.open("GET",t,!0),e.send(null),n.manager.itemStart(t)},loadFile:function(e,t,i,r){if(e){var a=this,n=new FileReader;t!==Me&&(n.onload=function(){t(n.result),a.manager.itemEnd(e.name)}),i!==Me&&n.addEventListener("progress",function(e){i(e)},!1),r!==Me&&n.addEventListener("error",function(e){r(e)},!1),n.readAsText(e),a.manager.itemStart(e.name)}},setCrossOrigin:function(e){this.crossOrigin=e}},mono.MTLLoader=function(e,t,i){this.baseUrl=e,this.options=t,this.crossOrigin=i},mono.extend(mono.MTLLoader,null,{constructor:mono.MTLLoader,load:function(e,t,i,r){var a=this,n=new mono.XHRLoader;n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(a.parse(e))})},loadFile:function(e,t,i,r){var a=this;(new mono.XHRLoader).loadFile(e,function(e){t(a.parse(e))})},loadText:function(e,t){t(this.parse(e))},parse:function(e){var t=e.split("\n"),i={},r=/\s+/,a={};this.baseUrl||(this.baseUrl={});for(var n=0;n<t.length;n++){var o=t[n];if(0!==(o=o.trim()).length&&"#"!==o.charAt(0)){var s=o.indexOf(" "),l=0<=s?o.substring(0,s):o;l=l.toLowerCase();var h=0<=s?o.substring(s+1):"";if(h=h.trim(),"newmtl"===l)i={name:h},a[h]=i;else if(i)if("ka"===l||"kd"===l||"ks"===l){var c=h.split(r,3);i[l]=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])]}else if("map_kd"===l||"map_ka"===l){var u=h,f=h;if(0<h.indexOf(".")){h=h.substring(0,h.lastIndexOf(".")).toLowerCase();var p={};if(/\-s/.test(h)&&(p=(d=/\-s( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/).exec(h),h=(m=h.split(p[0]))[m.length-1].trim(),f=(g=u.split(p[0]))[g.length-1].trim()),/\-t/.test(h)){var d=/\-t( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;p=d.exec(h);var m=h.split(p[0]);h=m[m.length-1].trim();var g=u.split(p[0]);f=g[g.length-1].trim()}}this.baseUrl[h]||(this.baseUrl[h]=f),i[l]=u}else i[l]=h}}var y=new mono.MTLLoader.MaterialCreator(this.baseUrl,this.options);return y.setMaterials(a),y}}),mono.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:mono.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:mono.RepeatWrapping},mono.extend(mono.MTLLoader.MaterialCreator,mono.EventDispatcher,{constructor:mono.MTLLoader.MaterialCreator,setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var i in e){var r=e[i],a={};for(var n in t[i]=a,r){var o=!0,s=r[n],l=n.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[1]&&(o=!1);break;case"d":this.options&&this.options.invertTransparency&&(s=1-s)}o&&(a[l]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return this.materials[e]===Me&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this.materialsInfo[e],i={name:e,side:this.side};for(var r in t){var a=t[r];switch(r.toLowerCase()){case"kd":i.diffuse=(new mono.Color).setRGB(a[0],a[1],a[2]);break;case"ka":i.ambient=(new mono.Color).setRGB(a[0],a[1],a[2]);break;case"ks":i.specular=(new mono.Color).setRGB(a[0],a[1],a[2]);break;case"map_kd":if("string"==typeof this.baseUrl)i.map={},i.map.img=this.baseUrl+a,i.map.wrapS=this.wrap,i.map.wrapT=this.wrap;else if("object"==typeof this.baseUrl&&0<a.indexOf(".")){a=a.substring(0,a.lastIndexOf(".")).toLowerCase();var n={};if(/\-s/.test(a)&&(n=(o=/\-s( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/).exec(a),a=(s=a.split(n[0]))[s.length-1].trim(),n.repeatR=parseInt(n[1]),n.repeatC=parseInt(n[2])),/\-t/.test(a)){var o=/\-t( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;n=o.exec(a);var s=a.split(n[0]);a=s[s.length-1].trim(),n.repeatR=parseInt(n[1]),n.repeatC=parseInt(n[2])}this.baseUrl[a]&&(i.map={},i.map.img=this.baseUrl[a],i.map.wrapS=this.wrap,i.map.wrapT=this.wrap,i.map.repeatR=n.repeatR||1,i.map.repeatC=n.repeatC||1)}break;case"ns":i.shininess=a;break;case"d":a<1&&(i.transparent=!0,i.opacity=a)}}return i.diffuse&&(i.ambient||(i.ambient=i.diffuse),i.color=i.diffuse),this.materials[e]=i,this.materials[e]},loadTexture:function(e,t,i,r){if(/\.dds$/i.test(e))n=mono.ImageUtils.loadCompressedTexture(e,t,i,r);else{var a=new Image,n=new mono.Texture(a,t),o=new mono.ImageLoader;o.crossOrigin=this.crossOrigin,o.load(e,function(e){n.image=mono.MTLLoader.ensurePowerOfTwo_(e),n.needsUpdate=!0,i&&i(n)})}return n}}),mono.MTLLoader.ensurePowerOfTwo_=function(e){if(!mono.MTLLoader.isPowerOfTwo_(e.width)||!mono.MTLLoader.isPowerOfTwo_(e.height)){var t=document.createElement("canvas");return t.width=mono.MTLLoader.nextHighestPowerOfTwo_(e.width),t.height=mono.MTLLoader.nextHighestPowerOfTwo_(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t}return e},mono.MTLLoader.isPowerOfTwo_=function(e){return 0==(e&e-1)},mono.MTLLoader.nextHighestPowerOfTwo_=function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},mono.OBJMTLLoader=function(){},mono.extend(mono.OBJMTLLoader,mono.MTLLoader,{constructor:mono.OBJMTLLoader,load:function(c,e,u,f,t,i){var p=this;new mono.MTLLoader(u).load(e,function(e){var h=e;h.preload();var t=new mono.XHRLoader(p.manager);t.setCrossOrigin(this.crossOrigin),t.load(c,function(e){var t=p.parse(e),i="";!u&&0<c.lastIndexOf("/")&&(i=c.substring(0,c.lastIndexOf("/")+1));for(var r=0;r<t._childList._as.length;r++){var a=t._childList._as[r];if(a.mname){var n=h.create(a.mname);p.setGeometryStyle(a,n,i)}for(var o=0;o<a._childList._as.length;o++){var s=a._childList._as[o];if(s.mname){var l=h.create(s.mname);p.setGeometryStyle(s,l,i)}}}f(t)})})},setGeometryStyle:function(e,t,i){var r={};if(t.map){i?this.loadTexture(e,i+t.map.img):this.loadTexture(e,t.map.img);var a=t.map.repeatR,n=t.map.repeatC;a&&n&&(r["m.texture.repeat"]=new mono.Vec2(a,n),r["m.texture.wrapS"]=Se.RepeatWrapping,r["m.texture.wrapT"]=Se.RepeatWrapping)}r["m.ambient"]=t.ambient,r["m.specular"]=t.specular,r["m.color"]=t.color,t.transparent&&(r["m.transparent"]=!0,r["m.opacity"]=t.opacity),e.s(r)},loadBase64:function(e,t,c,u,i,r){var f=this,a=mono.base64decode(t),p=mono.base64decode(e);new mono.MTLLoader(c).loadText(a,function(e){var t=e;t.preload();var i=f.parse(p),r="";!c&&0<url.lastIndexOf("/")&&(r=url.substring(0,url.lastIndexOf("/")+1));for(var a=0;a<i._childList._as.length;a++){var n=i._childList._as[a];if(n.mname){var o=t.create(n.mname);f.setGeometryStyle(n,o,r)}for(var s=0;s<n._childList._as.length;s++){var l=n._childList._as[s];if(l.mname){var h=t.create(l.mname);f.setGeometryStyle(l,h,r)}}}u(i)})},loadFiles:function(t,e,i,h,r,a){var c=this;new mono.MTLLoader(i).loadFile(e,function(e){var l=e;l.preload(),new mono.XHRLoader(c.manager).loadFile(t,function(e){for(var t=c.parse(e),i=0;i<t._childList._as.length;i++){var r=t._childList._as[i];if(r.mname){var a=l.create(r.mname);c.setGeometryStyle(r,a)}for(var n=0;n<r._childList._as.length;n++){var o=r._childList._as[n];if(o.mname){var s=l.create(o.mname);c.setGeometryStyle(o,s)}}}h(t)})})},loadTexture:function(t,e){"string"==typeof e?t.setStyle("m.texture.image",e):t&&e&&(new mono.ImageLoader).loadFile(e,function(e){t.setStyle("m.texture.image",e)})},parse:function(e,t){function i(e,t,i){return new mono.Vec3(e,t,i)}function n(e,t,i,r,a){return new mono.Face3(e,t,i,r,null,a)}function r(e,t){if(0<d.length&&(p.vertices=d,0<y.length&&(p.setMaterialSize(y.length),p.setStyle("m.normalType",Se.NormalTypeSmooth)),p.computed=!1,p.computeCentroids(),p.computeFaceNormals(),p.computeBoundingSphere(),0<p.faces.length)){var i=p._name;f.addChild(p),(p=new mono.Entity)._name=i,p.setStyle("m.type","phong"),0}e!==Me&&(p._name=e),p.setClient("name",e),p.setClient("bid",e),t!==Me&&(p.mname=t)}function o(e,t,i,r,a){r===Me?p.faces.push(n(parseInt(e)-(c+1),parseInt(t)-(c+1),parseInt(i)-(c+1))):p.faces.push(n(parseInt(e)-(c+1),parseInt(t)-(c+1),parseInt(i)-(c+1),[m[parseInt(r[0])-1].clone(),m[parseInt(r[1])-1].clone(),m[parseInt(r[2])-1].clone()],a))}function s(e,t,i){p.uvs.push([g[parseInt(e)-1].clone(),g[parseInt(t)-1].clone(),g[parseInt(i)-1].clone()])}function a(e,t,i){var r=0<y.length?y.indexOf(v):0;if(e[3]===Me)o(e[0],e[1],e[2],i,r),t!==Me&&0<t.length&&s(t[0],t[1],t[2]);else{if(i!==Me&&0<i.length)if(4<i.length)for(var a=1,n=i.length-1;a<n;a++)o(e[0],e[a],e[a+1],[i[0],i[a],i[a+1]],r);else o(e[0],e[1],e[3],[i[0],i[1],i[3]],r),o(e[1],e[2],e[3],[i[1],i[2],i[3]],r);else if(4<e.length)for(a=1,n=e.length-1;a<n;a++)o(e[0],e[a],e[a+1]);else o(e[0],e[1],e[3]),o(e[1],e[2],e[3]);if(t!==Me&&0<t.length)if(4<t.length)for(a=1,n=t.length-1;a<n;a++)s(t[0],t[a],t[a+1]);else s(t[0],t[1],t[3]),s(t[1],t[2],t[3])}}var l,h,c=0,u=new mono.Entity,f=u,p=new mono.Entity;p.setStyle("m.type","phong");for(var d=[],m=[],g=[],y=[],v=0,x=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,A=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,_=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,w=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,b=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,M=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))*/,S=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,P=/s( +(\d))?/,T=e.split("\n"),C=0;C<T.length;C++){var E,z=T[C];if(0!==(z=z.trim()).length&&("#"!==z.charAt(0)||"o"==z.charAt(2)))if(null!==(E=x.exec(z)))d.push(i(parseFloat(E[1]),parseFloat(E[2]),parseFloat(E[3])));else if(null!==(E=A.exec(z)))m.push(i(parseFloat(E[1]),parseFloat(E[2]),parseFloat(E[3])));else if(null!==(E=_.exec(z)))g.push((l=parseFloat(E[1]),h=parseFloat(E[2]),new mono.Vec2(l,h)));else if(null!==(E=w.exec(z)))a([E[1],E[2],E[3],E[4]]);else if(null!==(E=b.exec(z)))a([E[2],E[5],E[8],E[11]],[E[3],E[6],E[9],E[12]]);else if(null!==(E=M.exec(z))){var D=[],L=[],R=[];(z=(z=z.substr(2)).split(/\s+/)).forEach(function(e){e=e.split("/"),D.push(e[0]),R.push(e[1]),L.push(e[2])}),a(D,R,L)}else if(null!==(E=S.exec(z)))a([E[2],E[5],E[8],E[11]],[],[E[3],E[6],E[9],E[12]]);else if("#"===z.charAt(0)&&"o"===z.charAt(2))r(),c+=d.length,d=[],(f=new mono.Entity)._name=z.substring(2).trim(),u.addChild(f);else if(/^g /.test(z))r(z.substring(2).trim(),Me);else if(/^usemtl /.test(z))r(Me,z.substring(7).trim());else if(/^mtllib /.test(z)){if(t){var N=z.substring(7);t(N=N.trim())}}else/^s /.test(z)&&(E=P.exec(z),y.indexOf(E[2])<0&&y.push(E[2]),v=E[2])}return r(Me,Me),u}}),mono.DaeAdapter=function(){function o(e,t,i){B=e,function(){if(!0!==W.convertUpAxis||I===W.upAxis)F=null;else switch(I){case"X":F="Y"===W.upAxis?"XtoY":"XtoZ";break;case"Y":F="X"===W.upAxis?"YtoX":"YtoZ";break;case"Z":F="X"===W.upAxis?"ZtoX":"ZtoY"}}(),U=function(){var e={entity:[]},t=B.querySelectorAll("library_geometries geometry");if(t&&0<t.length)for(var i=0;i<t.length;i++){var r=(new u).parse(t[i]);r&&(e[r.id]=r,e.entity.push(r))}return e}(),(V=new s).parse();var r=function(){var e=[],t=B.querySelectorAll("library_lights light");if(t&&0<t.length)for(var i=0;i<t.length;i++){t[i];var r=(new N).parse(t);e.push(r)}return e}();if(O=function(){var e=B.querySelectorAll("library_images image"),t={};if(e&&0<e.length)for(var i=0;i<e.length;i++){var r=e[i];if(r){var a=(new P).parse(r);t[a.id]=a}}return t}(),k=function(){var e=B.querySelectorAll("library_effects effect"),t={};if(e&&0<e.length)for(var i=0;i<e.length;i++){var r=e[i];if(r){var a=(new T).parse(r);t[a.id]=a}}return t}(),Y=function(){var e=B.querySelectorAll("library_materials material"),t={};if(e&&0<e.length)for(var i=0;i<e.length;i++){var r=e[i];if(r){var a=(new n).parse(r);a&&(t[a.id]=a)}}return t}(),V)for(var a=0;a<V.nodes.length;a++)S(V.nodes[a]);t&&t({lights:r,visualScenes:V,images:O,materials:Y,geometries:U,entityies:G})}function S(e,t){if(e){for(var i={},r=0;r<e.geometries.length;r++){var a,n=e.geometries[r],o=n.instance_material,s=U[n.url],l={},h=[],c=0;if(s){if(!s.mesh||!s.mesh.primitives)continue;if(o)for(M=0;M<o.length;M++){var u=o[M],f=Y[u.target],p=f.instance_effect.url,d=k[p].shader.material;if(s.doubleSided){if(!(u.symbol in i)){var m=d.clone();m.side=mono.DoubleSide,i[u.symbol]=m}d=i[u.symbol]}d.opacity=d.opacity?d.opacity:1,l[u.symbol]=c,h.push(d),(a=d).name=null==f.name||""===f.name?f.id:f.name,c++}var g=a||new mono.LambertMaterial({color:14540253,shading:mono.FlatShading,side:s.doubleSided?mono.DoubleSide:mono.FrontSide}),y=s.mesh.node3D;if(1<c)for(g=new mono.ArrayMaterial(h),M=0;M<y.faces.length;M++){var v=y.faces[M];v.materialIndex=l[v.daeMaterial]}g instanceof mono.ArrayMaterial&&y.setMaterialSize(g.materials.length),y.createMaterial(g),y.matrix=e.matrix,y.matrix.decompose(y._position,y.quaternion,y.scale);var x=y.quaternion;if(x){var A=x.x*x.x,_=x.y*x.y,w=x.z*x.z,b=x.w*x.w;y._rotation.x=Math.atan2(2*(x.x*x.w-x.y*x.z),b-A-_+w),y._rotation.y=Math.asin(mono.Math.clamp(2*(x.x*x.z+x.y*x.w),-1,1)),y._rotation.z=Math.atan2(2*(x.z*x.w-x.x*x.y),b+A-_-w)}G.push(y)}}for(var M=0;M<e.nodes.length;M++)S(e.nodes[M],e)}}function n(){this.id="",this.name="",this.instance_effect=null}function i(){this.url=""}function s(){this.nodes=[],this.id="",this.name=""}function l(){this.nodes=[],this.id="",this.name="",this.sid="",this.type="",this.controllers=[],this.geometries=[],this.type="",this.layer="",this.matrix=new mono.Mat4,this.transforms=[]}function a(){this.sid="",this.type="",this.data=[]}function h(){this.url="",this.instance_material=[]}function c(){this.symbol="",this.target=""}function u(){this.id="",this.mesh=null}function f(){this.sources={},this.primitives=[],this.vertices=null,this.node3D=null}function z(e,t){var i=[e[t],e[t+1],e[t+2]];return r(i,-1),new mono.Vec3(i[0],i[1],i[2])}function r(e,t){if(!0===W.convertUpAxis&&I!==W.upAxis)switch(F){case"XtoY":i=e[0],e[0]=t*e[1],e[1]=i;break;case"XtoZ":i=e[2],e[2]=e[1],e[1]=e[0],e[0]=i;break;case"YtoX":i=e[0],e[0]=e[1],e[1]=t*i;break;case"YtoZ":i=e[1],e[1]=t*e[2],e[2]=i;break;case"ZtoX":i=e[0],e[0]=e[1],e[1]=e[2],e[2]=i;break;case"ZtoY":var i=e[1];e[1]=e[2],e[2]=t*i}}function p(){this.id="",this.input={}}function d(){this.semantic="",this.offset=0,this.source="",this.set=0}function m(){this.inputs=[],this.count=0,this.p=[],this.material=""}function g(){m.call(this),this.vcount=3}function y(){this.id,this.dataType,this.technique_common={},this.accessor=null,this.data=[]}function v(){this.source="",this.count=0,this.stride=0,this.params=[]}function x(e){return e?parseInt(e,10):0}function A(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function _(e){var t=[];if(!e)return e;if(0<(e=A(e)).length)for(var i=e.split(/\s+/),r=0;r<i.length;r++){var a=i[r];a!=Me&&null!=a&&null!=parseFloat(a)&&t.push(parseFloat(a))}return t}function w(e){var t=[];if(!e)return[];if(0<(e=A(e)).length)for(var i=e.split(/\s+/),r=0;r<i.length;r++){var a=i[r];a!=Me&&null!=a&&null!=parseInt(a)&&t.push(parseInt(a))}return t}function b(e){var t=[];if(!e)return[];if(0<(e=A(e)).length)for(var i=e.split(/\s+/),r=0;r<i.length;r++)t.push("true"==i[r]||"1"==i[r]);return t}function M(e){if(W.convertUpAxis){var t=[e[0],e[4],e[8]];r(t,-1),e[0]=t[0],e[4]=t[1],e[8]=t[2],r(t=[e[1],e[5],e[9]],-1),e[1]=t[0],e[5]=t[1],e[9]=t[2],r(t=[e[2],e[6],e[10]],-1),e[2]=t[0],e[6]=t[1],e[10]=t[2],r(t=[e[0],e[1],e[2]],-1),e[0]=t[0],e[1]=t[1],e[2]=t[2],r(t=[e[4],e[5],e[6]],-1),e[4]=t[0],e[5]=t[1],e[6]=t[2],r(t=[e[8],e[9],e[10]],-1),e[8]=t[0],e[9]=t[1],e[10]=t[2],r(t=[e[3],e[7],e[11]],-1),e[3]=t[0],e[7]=t[1],e[11]=t[2]}return new mono.Mat4(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function P(){this.id="",this.init_from=""}function T(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function C(e,t){this.type=e,this.effect=t,this.material=null}function E(){this.color=new mono.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function D(e){this.effect=e,this.init_from=null,this.format=null}function L(e){this.effect=e,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function R(e){for(var t=B.querySelectorAll("library_nodes node"),i=0;i<t.length;i++){var r=t[i].attributes.getNamedItem("id");if(r&&r.value===e)return t[i]}return Me}function N(){this.id="",this.name="",this.technique=""}this.id="",this.name="",this.type="";var t,B=null,I="Y",F=null,V=null,U={},k={},O={},X="",G=[],Y={},W={};return n.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++)if("instance_effect"==e.childNodes[t].nodeName){this.instance_effect=(new i).parse(e.childNodes[t]);break}return this},i.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},s.prototype.parse=function(){var e=B.querySelectorAll("library_visual_scenes visual_scene");if(!e||e.length<0)return this;this.id="",this.name="";for(var t=0;t<e.length;t++){var i=e[t];if(i&&i.childNodes&&0<i.childNodes.length)for(var r=0;r<i.childNodes.length;r++){var a=i.childNodes[r];if(a&&a.nodeName)switch(a.nodeName){case"node":this.nodes.push((new l).parse(a))}}}return this},l.prototype.parse=function(e){if(!e)return this;if(this.id=e.getAttribute("id"),this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.type=e.getAttribute("type"),this.layer=e.getAttribute("layer"),this.type="JOINT"==this.type?this.type:"NODE",0<e.childNodes.length)for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&i.nodeName)switch(i.nodeName){case"node":this.nodes.push((new l).parse(i));break;case"instance_camera":case"instance_controller":break;case"instance_geometry":this.geometries.push((new h).parse(i));break;case"instance_light":break;case"instance_node":var r=R(i.getAttribute("url").replace(/^#/,""));r&&this.nodes.push((new l).parse(r));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new a).parse(i));break;case"extra":break;default:console.log(i.nodeName)}}return this.updateMatrix(),this},l.prototype.updateMatrix=function(){this.matrix.identity();for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(this.matrix)},a.prototype.parse=function(e){return this.sid=e.getAttribute("sid"),this.type=e.nodeName,this.data=_(e.textContent),this.convert(),this},a.prototype.convert=function(){switch(this.type){case"matrix":this.obj=M(this.data);break;case"rotate":this.angle=mono.Math.degToRad(this.data[3]);case"translate":r(this.data,-1),this.obj=new mono.Vec3(this.data[0],this.data[1],this.data[2]);break;case"scale":r(this.data,1),this.obj=new mono.Vec3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},a.prototype.apply=(t=new mono.Mat4,function(e){switch(this.type){case"matrix":e.multiply(this.obj);break;case"translate":e.multiply(t.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":e.multiply(t.makeRotationAxis(this.obj,this.angle));break;case"scale":e.scale(this.obj)}}),a.prototype.update=function(e,t){var i=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(t)if(1===t.length)switch(t[0]){case 0:this.obj.n11=e[0],this.obj.n21=e[1],this.obj.n31=e[2],this.obj.n41=e[3];break;case 1:this.obj.n12=e[0],this.obj.n22=e[1],this.obj.n32=e[2],this.obj.n42=e[3];break;case 2:this.obj.n13=e[0],this.obj.n23=e[1],this.obj.n33=e[2],this.obj.n43=e[3];break;case 3:this.obj.n14=e[0],this.obj.n24=e[1],this.obj.n34=e[2],this.obj.n44=e[3]}else if(2===t.length){var r="n"+(t[0]+1)+(t[1]+1);this.obj[r]=e}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(e);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;case"ANGLE":this.angle=mono.Math.degToRad(e);break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2],this.angle=mono.Math.degToRad(e[3])}}},h.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType&&"bind_material"==i.nodeName){for(var r=i.querySelectorAll("instance_material"),a=0;a<r.length;a++){var n=r[a];this.instance_material.push((new c).parse(n))}break}}return this},c.prototype.parse=function(e){return this.symbol=e.getAttribute("symbol"),this.target=e.getAttribute("target").replace(/^#/,""),this},u.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&"mesh"==i.nodeName){var r=(new f).parse(i);r&&(this.mesh=r)}}return this},f.prototype.parse=function(e){if(e&&e.childNodes&&0<e.childNodes.length)for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"source":var r=i.getAttribute("id");this.sources[r]=(new y).parse(i);break;case"vertices":var a=new p;this.vertices=a.parse(i);break;case"polygons":var n=(new m).parse(i);n&&this.primitives.push(n);break;case"triangles":var o=(new g).parse(i);o&&this.primitives.push(o);break;case"polylist":this.primitives.push(null)}}this.node3D=new mono.Entity;var s=null;for(this.vertices&&this.vertices.input&&this.vertices.input.POSITION&&(s=this.sources[this.vertices.input.POSITION.source].data),t=0;t<this.primitives.length;t++){var l=this.primitives[t];l.setVertices(this.vertices),this.handlePrimitive(l,this.node3D)}for(t=0;t<s.length;t+=3)this.node3D.vertices.push(z(s,t).clone());return this.node3D.computeFaceNormals(),this},f.prototype.handlePrimitive=function(e,t){var i,r,a,n,o,s,l,h=e.p,c=e.inputs,u=0,f=3,p=0,d=[];for(i=0;i<c.length;i++){var m=(a=c[i]).offset+1;switch(p=p<m?m:p,a.semantic){case"TEXCOORD":d.push(a.set)}}for(var g=0;g<h.length;++g)for(var y=h[g],v=0;v<y.length;){var x=[],A=[],_=null,w=[];for(f=e.vcount?e.vcount.length?e.vcount[u++]:e.vcount:y.length/p,i=0;i<f;i++)for(r=0;r<c.length;r++)switch(a=c[r],s=this.sources[a.source],n=y[v+i*p+a.offset],l=s.accessor.params.length,o=n*l,a.semantic){case"VERTEX":x.push(n);break;case"NORMAL":A.push(z(s.data,o));break;case"TEXCOORD":(_=_||{})[a.set]===Me&&(_[a.set]=[]),_[a.set].push(new mono.Vec2(s.data[o],s.data[o+1]));break;case"COLOR":w.push((new mono.Color).setRGB(s.data[o],s.data[o+1],s.data[o+2]))}if(0==A.length)if(a=this.vertices.input.NORMAL){l=(s=s[a.source]).accessor.params.length;for(var b=0,M=x.length;b<M;b++)A.push(z(s.data,x[b]*l))}else t.calcNormals=!0;if(!_&&(_={},a=this.vertices.input.TEXCOORD)){d.push(a.set),l=(s=sources[a.source]).accessor.params.length;for(b=0,M=x.length;b<M;b++)o=x[b]*l,_[a.set]===Me&&(_[a.set]=[]),_[a.set].push(new mono.Vec2(s.data[o],1-s.data[o+1]))}if(0==w.length&&(a=this.vertices.input.COLOR)){l=(s=sources[a.source]).accessor.params.length;for(b=0,M=x.length;b<M;b++)o=x[b]*l,w.push((new mono.Color).setRGB(s.data[o],s.data[o+1],s.data[o+2]))}var S,P,T=null,C=[];if(3===f)C.push(new mono.Face3(x[0],x[1],x[2],A,w.length?w:new mono.Color(16711680)));else if(4===f)C.push(new mono.Face3(x[0],x[1],x[3],[A[0],A[1],A[3]],w.length?[w[0],w[1],w[3]]:new mono.Color(16711680))),C.push(new mono.Face3(x[1],x[2],x[3],[A[1],A[2],A[3]],w.length?[w[1],w[2],w[3]]:new mono.Color(16711680)));else if(4<f&&W.subdivideFaces){var E=w.length?w:new mono.Color;for(r=1;r<f-1;)C.push(new mono.Face3(x[0],x[r],x[r+1],[A[0],A[r++],A[r]],E))}if(C.length)for(b=0,M=C.length;b<M;b++)for((T=C[b]).daeMaterial=e.material,t.faces.push(T),r=0;r<d.length;r++)S=_[d[r]],P=4<f?[S[0],S[b+1],S[b+2]]:4===f?0===b?[S[0],S[1],S[3]]:[S[1].clone(),S[2],S[3].clone()]:[S[0],S[1],S[2]],t.uvs===Me&&(t.uvs=[]),t.uvs.push(P);else console.log("dropped face with vcount "+f+" for geometry with id: "+t.id);v+=p*f}},p.prototype.parse=function(e){if(e&&(this.id=e.getAttribute("id"),0<e.childNodes.length))for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&i.nodeName)switch(i.nodeName){case"input":var r=(new d).parse(i);this.input[r.semantic]=r}}return this},d.prototype.parse=function(e){return e&&(this.semantic=e.getAttribute("semantic"),this.offset=x(e.getAttribute("offset")),this.set=x(e.getAttribute("set")),this.source=e.getAttribute("source").replace(/^#/,""),"TEXCOORD"==this.semantic&&this.set<0&&(this.set=0)),this},m.prototype.parse=function(e){if(e&&(this.count=e.getAttribute("count"),this.material=e.getAttribute("material"),0<e.childNodes.length))for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&i.nodeName)switch(i.nodeName){case"input":var r=(new d).parse(i);r&&this.inputs.push(r);break;case"p":this.p.push(w(i.textContent))}}return this},m.prototype.setVertices=function(e){for(var t=0;t<this.inputs.length;t++)this.inputs[t].source==e.id&&(this.inputs[t].source=e.input.POSITION.source)},g.prototype=Object.create(m.prototype),y.prototype.parse=function(e){if(!e)return this;if(this.id=e.getAttribute("id"),0<e.childNodes.length)for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&i.nodeName)switch(i.nodeName){case"float_array":this.dataType=i.nodeName,this.data=_(i.textContent);break;case"bool_array":this.dataType=i.nodeName,this.data=b(i.textContent);break;case"int_array":this.data=w(i.textContent),this.dataType=i.nodeName;break;case"technique_common":if(i.childNodes&&0<i.childNodes.length)for(var r=0;r<i.childNodes.length;r++){var a=i.childNodes[r];if(a&&a.nodeName)switch(a.nodeName){case"accessor":var n=(new v).parse(a);n.source&&(this.technique_common[n.source]=n,this.accessor=n)}}}}return this},y.prototype.read=function(){var e=[],t=this.accessor.params[0];switch(t.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var i=0;i<this.data.length;i+=16){var r=M(this.data.slice(i,i+16));e.push(r)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+t.type+".")}return e},v.prototype.parse=function(e){if(!e)return this;if(this.source=e.getAttribute("source"),this.count=x(e.getAttribute("count")),this.stride=x(e.getAttribute("stride")),0<e.childNodes.length)for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&i.nodeName)switch(i.nodeName){case"param":var r={};r.name=i.getAttribute("name"),r.type=i.getAttribute("type"),this.params.push(r)}}return this},P.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];"init_from"==i.nodeName&&(this.init_from=i.textContent)}return this},T.prototype.create=function(){if(null==this.shader)return null},T.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),function(e,t){e.doubleSided=!1;var i=t.querySelectorAll("extra double_sided")[0];i&&i&&1===parseInt(i.textContent,10)&&(e.doubleSided=!0)}(this,e),this.shader=null;for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(i))}}return this},T.prototype.parseNewparam=function(e){for(var t=e.getAttribute("sid"),i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"surface":this.surface[t]=new D(this).parse(r);break;case"sampler2D":this.sampler[t]=new L(this).parse(r);break;case"extra":break;default:console.log(r.nodeName)}}},T.prototype.parseProfileCOMMON=function(e){for(var t,i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"profile_COMMON":this.parseProfileCOMMON(r);break;case"technique":t=r;break;case"newparam":this.parseNewparam(r);break;case"image":var a=(new P).parse(r);O[a.id]=a;break;case"extra":break;default:console.log(r.nodeName)}}return t},T.prototype.parseTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new C(i.nodeName,this).parse(i);break;case"extra":this.parseExtra(i)}}},T.prototype.parseExtra=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique":this.parseExtraTechnique(i)}}},T.prototype.parseExtraTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"bump":this.shader.parse(i)}}},C.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[i.nodeName]=(new E).parse(i);break;case"bump":var r=i.getAttribute("bumptype");r?"heightfield"===r.toLowerCase()?this.bump=(new E).parse(i):"normalmap"===r.toLowerCase()?this.normal=(new E).parse(i):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+r+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new E).parse(i)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new E).parse(i));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var a=i.querySelectorAll("float");0<a.length&&(this[i.nodeName]=parseFloat(a[0].textContent))}}return this.create(),this},C.prototype.create=function(){var e={},t=!1;if(this.transparency!==Me&&this.transparent!==Me){this.transparent;var i=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;0<i&&(t=!0,e.transparent=!0,e.opacity=1-i)}var r={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var a in this)switch(a){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var n=this[a];if(n instanceof E)if(n.isTexture()){var o=n.texture,s=this.effect.sampler[o],l=null;if(s!==Me&&s.source!==Me){var h=this.effect.surface[s.source];l=O[h.init_from]}else l=O[o];if(l){var c=X+l.init_from,u=new Image;u.loaded=!1;var f=new mono.Texture;f._imageSrc=c,f._image=u,f.setImage(c),f.wrapS=n.texOpts.wrapU?mono.RepeatWrapping:mono.ClampToEdgeWrapping,f.wrapT=n.texOpts.wrapV?mono.RepeatWrapping:mono.ClampToEdgeWrapping,f.offsetX=n.texOpts.offsetU,f.offsetY=n.texOpts.offsetV,f.repeatX=n.texOpts.repeatU,f.repeatY=n.texOpts.repeatV,e[r[a]]=f,"emission"===a&&(e.emissive=16777215)}}else"diffuse"!==a&&t||("emission"===a?e.emissive=n.color.getHex():e[a]=n.color.getHex());break;case"shininess":e[a]=this[a];break;case"reflectivity":e[a]=this[a],0<e[a]&&(e.envMap=W.defaultEnvMap),e.combine=mono.MixOperation;break;case"index_of_refraction":e.refractionRatio=this[a],1!==this[a]&&(e.envMap=W.defaultEnvMap)}switch(e.shading=mono.SmoothShading,e.side=this.effect.doubleSided?mono.DoubleSide:mono.FrontSide,this.type){case"constant":e.emissive!=Me&&(e.color=e.emissive),this.material=new mono.EntityMaterial(e);break;case"phong":case"blinn":e.diffuse!=Me&&(e.color=e.diffuse),this.material=new mono.EntityMaterial(e);break;case"lambert":default:e.diffuse!=Me&&(e.color=e.diffuse),this.material=new mono.LambertMaterial(e)}return this.material},E.prototype.isColor=function(){return null==this.texture},E.prototype.isTexture=function(){return null!=this.texture},E.prototype.parse=function(e){"transparent"==e.nodeName&&(this.opaque=e.getAttribute("opaque"));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"color":var r=_(i.textContent);this.color=new mono.Color,this.color.setRGB(r[0],r[1],r[2]),this.color.a=r[3];break;case"texture":this.texture=i.getAttribute("texture"),this.texcoord=i.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(i)}}return this},E.prototype.parseTexture=function(e){if(!e.childNodes)return this;e.childNodes[1]&&"extra"===e.childNodes[1].nodeName&&(e=e.childNodes[1]).childNodes[1]&&"technique"===e.childNodes[1].nodeName&&(e=e.childNodes[1]);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?this.texOpts[i.nodeName]=1:this.texOpts[i.nodeName]=parseInt(i.textContent);break;default:this.texOpts[i.nodeName]=i.textContent}}return this},D.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"init_from":this.init_from=i.textContent;break;case"format":this.format=i.textContent;break;default:console.log("unhandled Surface prop: "+i.nodeName)}}return this},L.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"source":this.source=i.textContent;break;case"minfilter":this.minfilter=i.textContent;break;case"magfilter":this.magfilter=i.textContent;break;case"mipfilter":this.mipfilter=i.textContent;break;case"wrap_s":this.wrap_s=i.textContent;break;case"wrap_t":this.wrap_t=i.textContent;break;default:console.log("unhandled Sampler2D prop: "+i.nodeName)}}return this},N.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique_common":this.parseCommon(i);break;case"technique":this.parseTechnique(i)}}return this},N.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++)switch(e.childNodes[t].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=e.childNodes[t].nodeName;for(var i=e.childNodes[t],r=0;r<i.childNodes.length;r++){var a=i.childNodes[r];switch(a.nodeName){case"color":var n=_(a.textContent);this.color=new mono.Color(0),this.color.setRGB(n[0],n[1],n[2]),this.color.a=n[3];break;case"falloff_angle":this.falloff_angle=parseFloat(a.textContent);break;case"quadratic_attenuation":var o=parseFloat(a.textContent);this.distance=o?Math.sqrt(1/o):0}}}return this},N.prototype.parseTechnique=function(e){this.profile=e.getAttribute("profile");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"intensity":this.intensity=parseFloat(i.textContent)}}return this},{load:function(e,t,i){var r=0;if(e!==Me){var a=e.split("/");a.pop(),X=(a.length<1?".":a.join("/"))+"/"}var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState?0!=n.status&&200!=n.status||(n.responseXML?o(n.responseXML,t):n.responseText?o((new DOMParser).parseFromString(n.responseText,"application/xml"),t):console.error("ColladaLoader: Empty or non-existing file ("+e+")")):3==n.readyState&&i&&(0==r&&(r=n.getResponseHeader("Content-Length")),i({total:r,loaded:n.responseText.length}))},n.open("GET",e,!0),n.send(null)},parse:o,geometries:{},options:W}};var Be,Ie=mono.GLTFLoader={DRACO_DECODER_PATH:"/"},Fe={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",COLOR_0:"color",JOINTS_0:"joint",WEIGHTS_0:"weight"},Ve={5121:Uint8Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ue={5121:1,5123:2,5125:4,5126:4},ke={0:"POINTS",1:"LINES",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN"},Oe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Xe={translation:3,rotation:4,scale:3},Ge={33071:"CLAMP_TO_EDGE",10497:"REPEAT",33648:"MIRRORED_REPEAT"},Ye={9728:"NEAREST",9729:"LINEAR",9984:"NEAREST_MIPMAP_NEAREST",9985:"LINEAR_MIPMAP_NEAREST",9986:"NEAREST_MIPMAP_LINEAR",9987:"LINEAR_MIPMAP_LINEAR"};Ie.load=function(d,e,t,y){var i;Ie._dracoDecoderUrl||(Ie._dracoDecoderUrl=(i=new Blob(["("+r.toString()+")()"],{type:"application/javascript"}),URL.createObjectURL(i))),x((d+=d.endsWith("/")?"":"/")+e+".gltf","json",function(h,e){function i(e,t){c[t]=e,++r===a&&(h.accessors.forEach(function(e,t){var i,r=Ve[e.componentType],a=h.bufferViews[e.bufferView],n=a&&a.byteStride||0,o=a&&c[a.buffer],s=(e.byteOffset||0)+(a&&a.byteOffset||0),l=e.count;i=n?l*(n/Ue[e.componentType]):l*Oe[e.type],u.push({buffer:a&&new r(o,s,i),offset:s,count:l,stride:n,type:e.componentType})}),h.meshes.forEach(function(e){e.primitives.forEach(function(r){var t=r.extensions&&r.extensions.KHR_draco_mesh_compression;if(t){var a=new Worker(Ie._dracoDecoderUrl),e=h.bufferViews[t.bufferView],n=new Int8Array(c[e.buffer],e.byteOffset,e.byteLength);a.onmessage=function(e){if("init"===e.data)a.postMessage({type:"decode",encodedData:n,attributes:t.attributes,mode:null==r.mode?"TRIANGLES":ke[r.mode]},[n.buffer]);else{p++;var i=e.data;i.error?console.error(i.error):(null!=r.indices&&(u[r.indices].buffer=i.indices),Object.keys(i.datas).forEach(function(e){var t=r.attributes[e];u[t].buffer=i.datas[e]})),p===f.length&&o()}},f.push(a),a.postMessage({type:"init",path:Ie.DRACO_DECODER_PATH})}})}),0===f.length&&o())}function o(){h.meshes.forEach(function(e){var t=[],i={primitives:t};m.push(i),null!=e.name&&(i.name=e.name),null!=e.weights&&(i.weights=e.weights),e.primitives.forEach(function(r){var a={},e={buffers:a};t.push(e),null!=r.mode&&(e.mode=ke[r.mode]),Object.keys(r.attributes).forEach(function(e){var t=u[r.attributes[e]],i={data:t.buffer,type:t.type};t.stride&&(i.stride=t.stride),a[Fe[e]]=i}),r.targets&&(i.targetCount=r.targets.length,r.targets.forEach(function(e,t){a["position"+t]=u[e.POSITION].buffer,e.NORMAL&&(a["normal"+t]=u[e.NORMAL].buffer),e.TANGENT&&(a["tangent"+t]=u[e.TANGENT].buffer)})),null!=r.indices&&(a.index=u[r.indices].buffer),null!=r.material&&(e.material=r.material)})}),h.nodes&&h.nodes.forEach(function(e){var t={},i=new mono.Mat4;g.push(t),null!=e.name&&(t.name=e.name),e.rotation&&(t.rotation=e.rotation),e.translation&&(t.translation=e.translation),e.scale&&(t.scale=e.scale),e.weights&&(t.weights=e.weights),e.children&&(t.children=e.children),e.matrix?i.set(e.matrix):(e.rotation||e.scale||e.translation)&&(e.translation&&i.translate(e.translation),e.scale&&i.scale(e.scale),e.rotation&&i.setRotationFromQuaternion(e.rotation)),i&&(t.matrix=i),null!=e.mesh&&(t.mesh=e.mesh),e.camera}),h.skins&&h.skins.forEach(function(e){for(var t=u[e.inverseBindMatrices],i=new Array(e.joints.length),r={joints:e.joints,inverseBindMatrices:i},a=0;a<e.joints.length;a++)i[a]=new Float32Array(t.buffer.buffer,16*a*4,16);n.push(r)}),h.nodes&&h.nodes.forEach(function(e,t){var i=g[t];null!=e.skin&&(i.skin=n[e.skin])}),h.animations&&h.animations.forEach(function(e){var p=[],t={channels:p},d=[];s.push(t),null!=e.name&&(t.name=e.name),e.samplers.forEach(function(e){d.push({input:u[e.input].buffer,interpolation:e.interpolation,output:u[e.output]})}),e.channels.forEach(function(e){var t=g[e.target.node],i=m[t.mesh],r=e.target.path,a=d[e.sampler],n=a.output,o=n.buffer.buffer,s=[];if("weights"===r){for(var l=i.targetCount,h=n.count/l,c=0;c<h;c++)f=n.offset+4*c*l,s.push(new Float32Array(o,f,l));a.splitOutput=s,t.weights||(t.weights=i.weights.slice(0))}else{var u=Xe[r];for(c=0;c<n.count;c++){var f=n.offset+4*c*u;s.push(new(3===u?mono.Vec3:mono.Quat)(new Float32Array(o,f,u)))}a.output=s,"translation"!==r||t.translation||(t.translation=new mono.Vec3),"rotation"!==r||t.rotation||(t.rotation=new mono.Quat),"scale"!==r||t.scale||(t.scale=new mono.Vec3)}p.push({node:e.target.node,sampler:a,path:r})})}),h.textures&&h.textures.forEach(function(e){var t={};if(l.push(t),null!=e.sampler){var i=h.samplers[e.sampler];i.magFilter&&(t.magFilter=Ye[i.magFilter]),i.minFilter&&(t.minFilter=Ye[i.minFilter]),i.wrapS&&(t.wrapS=Ge[i.wrapS]),i.wrapT&&(t.wrapT=Ge[i.wrapT])}if(null!=e.source){var r=h.images[e.source];r.uri&&(t.url=d+r.uri)}}),t(v({nodes:g,scenes:h.scenes,meshes:m,animations:s,textures:l,materials:h.materials},y))}if(!h)return t(null,e);var c=[],r=0,a=h.buffers.length,u=[],m=[],n=[],g=[],s=[],l=[],f=[],p=0;h.buffers.forEach(function(e,t){0===e.uri.indexOf("data:")?i(function(e){var t,i,r,a=e.indexOf(",");for(e=e.substr(a+1),i=(e=atob(e)).length,r=new Uint8Array(i),t=0;t<i;t++)r[t]=e.charCodeAt(t);return r.buffer}(e.uri),t):x(d+e.uri,"arraybuffer",function(e){i(e,t)})})})},Se.TextureUtils={crossOrigin:"anonymous",loadTexture:function(e,t,i,r){var a=new Se.ImageLoader;a.crossOrigin=this.crossOrigin;var n=new Se.Texture(Me,t),o=a.load(e,function(){n.needsUpdate=!0,i&&i(n)});return n.image=o,n.sourceFile=e,n},loadCompressedTexture:function(e,t,i,r,a){(a=a||new Se.CompressedTexture).mapping=t;var n=new XMLHttpRequest;return n.onload=function(){var e=n.response,t=Se.TextureUtils.parseDDS(e,!0);a.format=t.format,a.mipmaps=t.mipmaps,a.image.width=t.width,a.image.height=t.height,a.generateMipmaps=!1,a.needsUpdate=!0,i&&i(a)},n.onerror=r,n.open("GET",e,!0),n.responseType="arraybuffer",n.send(null),a},loadTextureCube:function(e,t,i,r){var a=[];a.loadCount=0;var n=new Se.Texture;n.image=a,t!==Me&&(n.mapping=t),n.flipY=!1;for(var o=0,s=e.length;o<s;++o){var l=new Image;(a[o]=l).onload=function(){a.loadCount+=1,6===a.loadCount&&(n.needsUpdate=!0,i&&i(n))},l.onerror=r,l.crossOrigin=this.crossOrigin,l.src=e[o]}return n},loadCompressedTextureCube:function(e,t,n,i){var o=[];o.loadCount=0;var s=new Se.CompressedTexture;if(s.image=o,t!==Me&&(s.mapping=t),s.flipY=!1,s.generateMipmaps=!1,e instanceof Array)for(var r=0,a=e.length;r<a;++r){var l={};o[r]=l,(c=new XMLHttpRequest).onload=function(i,r){return function(){var e=i.response,t=Se.TextureUtils.parseDDS(e,!0);r.format=t.format,r.mipmaps=t.mipmaps,r.width=t.width,r.height=t.height,o.loadCount+=1,6===o.loadCount&&(s.format=t.format,s.needsUpdate=!0,n&&n(s))}}(c,l),c.onerror=i,h=e[r],c.open("GET",h,!0),c.responseType="arraybuffer",c.send(null)}else{var h=e,c=new XMLHttpRequest;c.onload=function(){var e=c.response,t=Se.TextureUtils.parseDDS(e,!0);if(t.isCubemap){for(var i=t.mipmaps.length/t.mipmapCount,r=0;r<i;r++){o[r]={mipmaps:[]};for(var a=0;a<t.mipmapCount;a++)o[r].mipmaps.push(t.mipmaps[r*t.mipmapCount+a]),o[r].format=t.format,o[r].width=t.width,o[r].height=t.height}s.format=t.format,s.needsUpdate=!0,n&&n(s)}},c.onerror=i,c.open("GET",h,!0),c.responseType="arraybuffer",c.send(null)}return s},loadDDSTexture:function(e,t,n,i){var o=[];o.loadCount=0;var s=new Se.CompressedTexture;s.image=o,t!==Me&&(s.mapping=t),s.flipY=!1,s.generateMipmaps=!1;var l=new XMLHttpRequest;return l.onload=function(){var e=l.response,t=Se.TextureUtils.parseDDS(e,!0);if(t.isCubemap)for(var i=t.mipmaps.length/t.mipmapCount,r=0;r<i;r++){o[r]={mipmaps:[]};for(var a=0;a<t.mipmapCount;a++)o[r].mipmaps.push(t.mipmaps[r*t.mipmapCount+a]),o[r].format=t.format,o[r].width=t.width,o[r].height=t.height}else s.image.width=t.width,s.image.height=t.height,s.mipmaps=t.mipmaps;s.format=t.format,s.needsUpdate=!0,n&&n(s)},l.onerror=i,l.open("GET",e,!0),l.responseType="arraybuffer",l.send(null),s},parseDDS:function(m,e){function t(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var i={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},r=t("DXT1"),a=t("DXT3"),n=t("DXT5"),o=new Int32Array(m,0,31);if(542327876!==o[0])return console.error("TextureUtils.parseDDS(): Invalid magic number in DDS header"),i;if(4&!o[20])return console.error("TextureUtils.parseDDS(): Unsupported format, must contain a FourCC code"),i;var s,l,h=o[21],c=!1;switch(h){case r:s=8,i.format=Se.RGB_S3TC_DXT1_Format;break;case a:s=16,i.format=Se.RGBA_S3TC_DXT3_Format;break;case n:s=16,i.format=Se.RGBA_S3TC_DXT5_Format;break;default:if(!(32==o[22]&&16711680&o[23]&&65280&o[24]&&255&o[25]&&4278190080&o[26]))return console.error("TextureUtils.parseDDS(): Unsupported FourCC code: ",(l=h,String.fromCharCode(255&l,l>>8&255,l>>16&255,l>>24&255))),i;c=!0,s=64,i.format=Se.RGBAFormat}i.mipmapCount=1,131072&o[2]&&!1!==e&&(i.mipmapCount=Math.max(1,o[7])),i.isCubemap=!!(512&o[28]),i.width=o[4],i.height=o[3];for(var g=o[1]+4,u=i.width,f=i.height,p=i.isCubemap?6:1,d=0;d<p;d++){for(var y=0;y<i.mipmapCount;y++){if(c)v=(x=function(e,t,i,r){for(var a=i*r*4,n=new Uint8Array(m,g,a),o=new Uint8Array(a),s=0,l=0,h=0;h<r;h++)for(var c=0;c<i;c++){var u=n[l],f=n[++l],p=n[++l],d=n[++l];l++,o[s]=p,o[++s]=f,o[++s]=u,o[++s]=d,s++}return o}(0,0,u,f)).length;else var v=Math.max(4,u)/4*Math.max(4,f)/4*s,x=new Uint8Array(m,g,v);var A={data:x,width:u,height:f};i.mipmaps.push(A),g+=v,u=Math.max(.5*u,1),f=Math.max(.5*f,1)}u=i.width,f=i.height}return i},getNormalMap:function(e,t){var i=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]};t|=1;var r=e.width,a=e.height,n=document.createElement("canvas");n.width=r,n.height=a;var o,s,l,h,c=n.getContext("2d");c.drawImage(e,0,0);for(var u=c.getImageData(0,0,r,a).data,f=c.createImageData(r,a),p=f.data,d=0;d<r;d++)for(var m=0;m<a;m++){var g=m-1<0?0:m-1,y=a-1<m+1?a-1:m+1,v=d-1<0?0:d-1,x=r-1<d+1?r-1:d+1,A=[],_=[0,0,u[4*(m*r+d)]/255*t];A.push([-1,0,u[4*(m*r+v)]/255*t]),A.push([-1,-1,u[4*(g*r+v)]/255*t]),A.push([0,-1,u[4*(g*r+d)]/255*t]),A.push([1,-1,u[4*(g*r+x)]/255*t]),A.push([1,0,u[4*(m*r+x)]/255*t]),A.push([1,1,u[4*(y*r+x)]/255*t]),A.push([0,1,u[4*(y*r+d)]/255*t]),A.push([-1,1,u[4*(y*r+v)]/255*t]);for(var w=[],b=A.length,M=0;M<b;M++){var S=A[M],P=A[(M+1)%b];S=i(S,_),P=i(P,_),w.push((h=P,o=[(l=S)[1]*h[2]-l[2]*h[1],l[2]*h[0]-l[0]*h[2],l[0]*h[1]-l[1]*h[0]],void 0,s=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]),[o[0]/s,o[1]/s,o[2]/s]))}var T=[0,0,0];for(M=0;M<w.length;M++)T[0]+=w[M][0],T[1]+=w[M][1],T[2]+=w[M][2];T[0]/=w.length,T[1]/=w.length,T[2]/=w.length;var C=4*(m*r+d);p[C]=(T[0]+1)/2*255|0,p[C+1]=(T[1]+1)/2*255|0,p[C+2]=255*T[2]|0,p[C+3]=255}return c.putImageData(f,0,0),n},generateDataTexture:function(e,t,i){for(var r=e*t,a=new Uint8Array(3*r),n=Math.floor(255*i.r),o=Math.floor(255*i.g),s=Math.floor(255*i.b),l=0;l<r;l++)a[3*l]=n,a[3*l+1]=o,a[3*l+2]=s;var h=new Se.DataTexture(a,e,t,Se.RGBFormat);return h.needsUpdate=!0,h}},Se.DataBox=function(e){Se.DataBox.superClass.constructor.apply(this,arguments),1===arguments.length&&(this._name=e),this._dataList=new xe,this._dataMap={},this._rootList=new xe,this._rootMap={},this._clientMap={},this._lightList=new xe,this._flareList=new xe,this._billboardList=new xe,this._nodeList=new xe,this._annotationList=new xe,this._particleList=new xe,this.nodes=[],this.particles=[],this.billboards=[],this._dataBoxChangeDispatcher=new Se.EventDispatcher,this._dataPropertyChangeDispatcher=new Se.EventDispatcher,this._groupLists={},this.selection=new xe,this instanceof Se.AlarmBox||(this._selectionModel=new Se.SelectionModel(this),this._alarmBox=new Se.AlarmBox(this),this._alarmStatePropagator=new Se.AlarmStatePropagator(this),this._alarmStatePropagator.setEnable(!0)),this.batch=!1,this._clientMap={}},Se.extend(Se.DataBox,Se.PropertyChangeDispatcher,{constructor:Se.DataBox,className:"TGL.DataBox",___accessor:["name"],add:function(e,t){if(e){1===arguments.length&&(t=-1);var i=e.getId();if(this._dataMap.hasOwnProperty(i)){if(this._dataMap[i]!==e)throw"Data with ID '"+i+"' already exists"}else this._dataMap[i]=e,this._dataList.add(e),e.getParent()||(this._rootMap[i]=e,0<=t?this._rootList.add(e,t):this._rootList.add(e)),e instanceof Se.Billboard?this._billboardList.add(e):e instanceof Se.LensFlare?this._flareList.add(e):e instanceof Se.Node?this._nodeList.add(e):e instanceof Se.Particle?this._particleList.add(e):e instanceof Se.Annotation?this._annotationList.add(e):e instanceof Se.Light&&this._lightList.add(e),this._dataBoxChangeDispatcher.fire({kind:"add",data:e,source:this}),e.getGroupId()&&this.groupElements(e,null,e.getGroupId()),e.addPropertyChangeListener(this.handleDataPropertyChange,this),e._selected=!1}},onPropertyChange:function(){},firePropertyChange:function(){},addByDescendant:function(e,t){t&&0==t(e)||e&&(this.add(e),0<e.getChildren().size()&&e.getChildren().forEach(function(e){this.addByDescendant(e,t)},this))},getAlarmBox:function(){return this._alarmBox},removeById:function(e,t){var i=this.getDataById(e);this.remove(i,t)},remove:function(t,e){if(t&&this._dataMap.hasOwnProperty(t.getId())){t instanceof Se.Link&&(t.setFromNode(null),t.setToNode(null)),t instanceof Se.Node&&t.getLinks()&&t.getLinks().toList().forEach(function(e){this.remove(e)},this),e&&(t.getChildren().forEach(function(e){t.removeChild(e)},this),t.getParent()&&t.getParent().removeChild(t)),this._dataList.remove(t);var i=t._id;delete this._dataMap[i],this._rootMap[i]&&(delete this._rootMap[i],this._rootList.remove(t)),t instanceof Se.Billboard?this._billboardList.remove(t):t instanceof Se.Node?this._nodeList.remove(t):t instanceof Se.Particle?this._particleList.remove(t):t instanceof Se.Annotation?this._annotationList.remove(t):t instanceof Se.Light?this._lightList.remove(t):t instanceof Se.LensFlare&&this._flareList.remove(t),t.getGroupId()&&this.groupElements(t,t.getGroupId(),null),t.removePropertyChangeListener(this.handleDataPropertyChange,this),this._dataBoxChangeDispatcher.fire({kind:"remove",data:t,source:this}),this._selectionModel&&this._selectionModel.removeSelection(t)}},removeByDescendant:function(e,t,i){if(e){var r=this;e.hasChildren()&&e.getChildren().forEachReverse(function(e){r.removeByDescendant(e,t,i)}),i&&0==i(e)||this.remove(e,t)}},containsById:function(e){return this._dataMap.hasOwnProperty(e)},contains:function(e){return!!e&&this._dataMap[e._id]===e},lightsSize:function(){return this._lightList.size()},getLights:function(){return this._lightList},getLightsArray:function(){return this._lightList.toArray()},getAnnotations:function(){return this._annotationList},clear:function(t){if(0<this._dataList.size()){var e=this._dataList.toList(function(e){return!this._lightList.contains(e)||t},this);if(e.forEach(function(e){e.removePropertyChangeListener(this.handleDataPropertyChange,this)},this),this._dataList.clear(),this._dataMap={},this._rootList.clear(),this._rootMap={},this._nodeList.clear(),this._billboardList.clear(),t)this._lightList.clear(),this._flareList.clear();else{var i=this;this._lightList.forEach(function(e){i._dataList.add(e);var t=e.getId();null==(i._dataMap[t]=e).getParent()&&(i._rootList.add(e),i._rootMap[t]=e)})}this._dataBoxChangeDispatcher.fire({kind:"clear",datas:e}),this.clearSelection()}},startBatch:function(){this.batch=!0},endBatch:function(){this.batch=!1,this._dataBoxChangeDispatcher.fire({kind:"batchEnd"})},removeSelection:function(){this._selectionModel.toSelection().forEach(function(e){this.remove(e)},this)},clearSelection:function(){this._selectionModel&&this._selectionModel.clearSelection()},clearEditing:function(){this._nodeList.forEach(function(e){e.editing=!1}),this._billboardList.forEach(function(e){e.editing=!1})},getDataById:function(e){return this._dataMap[e]},groupElements:function(e,t,i){var r;t&&(r=this._groupLists[t])&&(r.remove(e),r.isEmpty()&&delete this._groupLists[t]),i&&(null==(r=this._groupLists[i])&&(r=new xe,this._groupLists[i]=r),r.contains(e)||r.add(e))},synchronizeGroup:function(t,i,r,a){if(!this.isAdjustingGroup){this.isAdjustingGroup=!0;var e=t.getGroupId(),n=new Se.Vec3;if(e){var o=this._groupLists[e];o&&1<o.size()&&o.forEach(function(e){e===t||e.isDescendantOf(t)||t.isDescendantOf(e)||(n.subVectors(r,i),e[Se.setter(a)](e[Se.getter(a)]().clone().add(n)))})}this.isAdjustingGroup=!1}},handleDataPropertyChange:function(e){var t=e.source;if("parent"===e.property){var i=t.getId();t.getParent()?this._rootMap[i]&&(delete this._rootMap[i],this._rootList.remove(t)):this._rootMap[i]||(this._rootMap[i]=t,this._rootList.add(t))}else if("groupId"===e.property){var r=e.oldValue,a=e.newValue;this.groupElements(t,r,a)}else"position"===e.property||"scale"===e.property||"rotation"===e.property?this.synchronizeGroup(t,e.oldValue,e.newValue,e.property):"selected"===e.property&&(t._selected?this._selectionModel.appendSelection(t):this._selectionModel.removeSelection(t));this.onDataPropertyChanged(t,e),this._dataPropertyChangeDispatcher.fire(e)},onDataPropertyChanged:function(e,t){},addDataBoxChangeListener:function(e,t,i){this._dataBoxChangeDispatcher.add(e,t,i)},removeDataBoxChangeListener:function(e,t){this._dataBoxChangeDispatcher.remove(e,t)},addDataPropertyChangeListener:function(e,t,i){this._dataPropertyChangeDispatcher.add(e,t,i)},removeDataPropertyChangeListener:function(e,t){this._dataPropertyChangeDispatcher.remove(e,t)},allocateLights:function(){var e,t,i,r,a,n;i=r=a=0;var o=this._lightList;for(e=0,t=o.size();e<t;e++)(n=o.get(e)).onlyShadow||(n instanceof Se.DirectionalLight&&i++,n instanceof Se.PointLight&&r++,n instanceof Se.SpotLight&&a++);return{directional:i,point:r,spot:a,hemi:0}},allocateShadows:function(){var e,t,i,r=0,a=this._lightList;for(e=0,t=a.size();e<t;e++)(i=a.get(e)).castShadow&&(i instanceof Se.SpotLight&&r++,i instanceof Se.DirectionalLight&&!i.shadowCascade&&r++);return r},allocatePointShadows:function(){var e,t,i,r=0,a=this._lightList;for(e=0,t=a.size();e<t;e++)(i=a.get(e)).castShadow&&i instanceof Se.PointLight&&r++;return r},getSelectionModel:function(){return this._selectionModel},size:function(){return this._dataList.size()},isEmpty:function(){return this._dataList.isEmpty()},getLimit:function(){return this._limit},setLimit:function(e){var t=this._limit;this._limit=e,this.firePropertyChange("limit",t,e),this._checkLimit()},_checkLimit:function(){0<=this._limit&&this.size()>this._limit&&this.removeFirst(this.size()-this._limit)},removeFirst:function(e){for(0===arguments.length&&(e=1);0<e&&0<this._dataList.size();){var t=this._dataList.get(0);this.remove(t),e--}},getSiblings:function(e){if(!this.contains(e))throw e+" dosen't belong to this dataBox";var t=e.getParent();return t?t.getChildren():this._rootList},getRoots:function(){return this._rootList},getSiblingIndex:function(e){return e.getParent()?e.getParent().getChildren().indexOf(e):this._rootList.indexOf(e)},getNodes:function(){return this._nodeList},getBillboards:function(){return this._billboardList},getLensFlares:function(){return this._flareList},getDatas:function(){return this._dataList},getDataAt:function(e){return this._dataList.get(e)},toDatas:function(e,t){return this._dataList.toList(e,t)},forEach:function(e,t){this._dataList.forEach(e,t)},forEachReverse:function(e,t){this._dataList.forEachReverse(e,t)},forEachByDepthFirst:function(e,t,i){if(t)this._depthFirst(e,t,i);else for(var r=this._rootList.size(),a=0;a<r;a++){var n=this._rootList.get(a);if(!1===this._depthFirst(e,n,i))return}},_depthFirst:function(e,t,i){for(var r=t.getChildrenSize(),a=0;a<r;a++){var n=t.getChildAt(a);if(!1===this._depthFirst(e,n,i))return!1}if(i){if(!1===e.call(i,t))return!1}else if(!1===e(t))return!1},forEachByBreadthFirst:function(e,t,i){var r=new xe;for(t?r.add(t):this._rootList.forEach(r.add,r);0<r.size();)if((t=r.removeAt(0)).getChildren().forEach(r.add,r),i){if(!1===e.call(i,t))return}else if(!1===e(t))return},getAlarmStatePropagator:function(){return this._alarmStatePropagator},setAlarmStatePropagator:function(e){this._alarmStatePropagator!=e&&(this._alarmStatePropagator&&this._alarmStatePropagator.setEnable(!1),this._alarmStatePropagator=e,this._alarmStatePropagator.setEnable(!0))},setClient:function(e,t){if(null==e)return this;null==this._clientMap&&(this._clientMap=new Object);var i=this._clientMap[e];return i!==t?(null==t?delete this._clientMap[e]:this._clientMap[e]=t,this._clientMap[e]=t,this.firePropertyChange("C:"+e,i,t),this):void 0},getClient:function(e){return this._clientMap[e]}}),Se.QuickFinder=function(e,t,i,r,a){if(this._map={},!e)throw"dataBox can not be null";if(!t)throw"propertyName can not be null";this._dataBox=e,this._propertyName=t,this._propertyType=i||"accessor","accessor"===this._propertyType&&(this._getter=Se.getter(t)),this._valueFunction=r||this.getValue,this._filterFunction=a||this.isInterested,this._dataBox.forEach(this._addData,this),this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this,!0)},Se.extend(Se.QuickFinder,Object,{_NULL_:"mono-null-key",getValueFunction:function(){return this._valueFunction},getFilterFunction:function(){return this._filterFunction},handleDataBoxChange:function(e){"add"===e.kind?this._addData(e.data):"remove"===e.kind?this._removeData(e.data):"clear"===e.kind&&(this._map={})},handleDataPropertyChange:function(e){if(this._filterFunction.call(this,e.source)){if("accessor"===this._propertyType&&this._propertyName===e.property);else if("style"===this._propertyType&&e.source.IStyle&&"S:"+this._propertyName===e.property);else if("client"!==this._propertyType||"C:"+this._propertyName!==e.property)return;var t=this._getMap(e.oldValue);t&&t.remove(e.source),this._addData(e.source)}},_getMap:function(e){return e=null==e?this._NULL_:e,this._map[e]},find:function(e){var t=this._getMap(e);return t?t.toList():new xe},findFirst:function(e){var t=this._getMap(e);return!t||t.isEmpty()?null:t.get(0)},_addData:function(e){if(this._filterFunction.call(this,e)){var t=this._valueFunction.call(this,e),i=this._getMap(t);i||(i=new xe,t=null==t?this._NULL_:t,this._map[t]=i),i.add(e)}},_removeData:function(e){if(this._filterFunction.call(this,e)){var t=this._valueFunction.call(this,e),i=this._getMap(t);i&&(i.remove(e),i.isEmpty()&&(t=null==t?this._NULL_:t,delete this._map[t]))}},dispose:function(){this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),delete this._dataBox},getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isInterested:function(e){return!("style"===this._propertyType&&!e.IStyle||"accessor"===this._propertyType&&this._valueFunction===this.getValue&&!e[this._getter])},getValue:function(e){return"accessor"===this._propertyType?e[this._getter]():"style"===this._propertyType&&e.getStyle?e.getStyle(this._propertyName):"client"===this._propertyType&&e.getClient?e.getClient(this._propertyName):null}}),Se.SelectionModel=function(e){Se.SelectionModel.superClass.constructor.apply(this,arguments),this._selectionMode="multipleSelection",this._selectionList=new xe,this._selectionChangeDispatcher=new Se.EventDispatcher,this._selectionMap={},this._setDataBox(e)},Se.extend(Se.SelectionModel,Se.PropertyChangeDispatcher,{getSelectionMode:function(){return this._selectionMode},setSelectionMode:function(e){if(this._selectionMode!==e&&("noneSelection"===e||"singleSelection"===e||"multipleSelection"===e)){this.clearSelection();var t=this._selectionMode;this._selectionMode=e,this.firePropertyChange("selectionMode",t,this._selectionMode)}},getDataBox:function(){return this._dataBox},_setDataBox:function(e){if(!e)throw"dataBox can not be null";if(this._dataBox!==e){this._dataBox&&(this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this));var t=this._dataBox;this._dataBox=e,this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this.firePropertyChange("dataBox",t,this._dataBox)}},dispose:function(){this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this)},handleDataBoxChange:function(e){if("remove"===e.kind){var t=e.data;this.contains(t)&&(this._selectionList.remove(t),delete this._selectionMap[t.getId()],this.fireSelectionChange("remove",new xe(t))),t._selected=!1}else"clear"===e.kind&&this.clearSelection()},getFilterFunction:function(){return this._filterFunction},setFilterFunction:function(e){if(this._filterFunction!==e){this.clearSelection();var t=this._filterFunction;this._filterFunction=e,this.firePropertyChange("filterFunction",t,this._filterFunction)}},fireSelectionChange:function(e,t,i){i&&(this._selectionList.forEach(function(e){i.contains(e)?i.remove(e):i.add(e)}),t=i.toList()),this._selectionChangeDispatcher.fire({kind:e,datas:new xe(t)})},addSelectionChangeListener:function(e,t,i){this._selectionChangeDispatcher.add(e,t,i)},removeSelectionChangeListener:function(e,t){this._selectionChangeDispatcher.remove(e,t)},_filterList:function(e,t){for(var i=new xe(e),r=0;r<i.size();r++){var a=i.get(r);(this._filterFunction&&!this._filterFunction(a)||t&&this.contains(a)||!t&&!this.contains(a)||!this._dataBox.contains(a))&&(i.removeAt(r),r--)}return i},appendSelection:function(e){if("noneSelection"!==this._selectionMode){var t=this._filterList(e,!0);if(!t.isEmpty()){var i=null;"singleSelection"===this._selectionMode&&(i=new xe(this._selectionList),this._selectionList.forEach(function(e){e._selected=!1}),this._selectionList.clear(),this._selectionMap={},t=new xe(t.get(t.size()-1)));for(var r=0;r<t.size();r++){var a=t.get(r);a._selected=!0,this._selectionList.add(a),this._selectionMap[a._id]=a}this.fireSelectionChange("append",t,i)}}},removeSelection:function(e){var t=this._filterList(e);if(0!==t.size()){for(var i=0;i<t.size();i++){var r=t.get(i);r._selected=!1,this._selectionList.remove(r),delete this._selectionMap[r.getId()]}this.fireSelectionChange("remove",t)}},toSelection:function(e,t){return this._selectionList.toList(e,t)},getSelection:function(){return this._selectionList},setSelection:function(e){if("noneSelection"!==this._selectionMode&&(0!==this._selectionList.size()||null!=e)){var t=new xe(this._selectionList);this._selectionList.forEach(function(e){e._selected=!1}),this._selectionList.clear(),this._selectionMap={};var i=this._filterList(e,!0);"singleSelection"===this._selectionMode&&1<i.size()&&(i=new xe(i.get(i.size()-1)));for(var r=0;r<i.size();r++){var a=i.get(r);a._selected=!0,this._selectionList.add(a),this._selectionMap[a.getId()]=a}this.fireSelectionChange("set",null,t)}},clearSelection:function(){if(0<this._selectionList.size()){var e=this._selectionList.toList();this._selectionList.forEach(function(e){e._selected=!1}),this._selectionList.clear(),this._selectionMap={},this.fireSelectionChange("clear",e)}},selectAll:function(){if("noneSelection"!==this._selectionMode){var e=this._dataBox.toDatas(),t=0,i=null;if(this._filterFunction)for(t=0;t<e.size();t++)i=e.get(t),this._filterFunction(i)||(e.removeAt(t),t--);var r=new xe(this._selectionList);for(this._selectionList.clear(),this._selectionMap={},"singleSelection"===this._selectionMode&&1<e.size()&&(e=new xe(e.get(e.size()-1))),t=0;t<e.size();t++)i=e.get(t),this._selectionList.add(i),this._selectionMap[i.getId()]=i;this.fireSelectionChange("all",null,r)}},size:function(){return this._selectionList.size()},contains:function(e){return!!e&&null!=this._selectionMap[e._id]},getLastData:function(){return 0<this._selectionList.size()?this._selectionList.get(this._selectionList.size()-1):null},getFirstData:function(){return 0<this._selectionList.size()?this._selectionList.get(0):null},isSelectable:function(e){return!(!e||"noneSelection"===this._selectionMode||this._filterFunction&&!this._filterFunction(e))}}),Se.AlarmSeverity=function(e,t,i,r,a){this.value=e,this.name=t,this.nickName=i,this.color=r,this.displayName=a},Se.extend(Se.AlarmSeverity,Object,{toString:function(){return this.displayName?this.displayName:this.name}}),(Be=Se.AlarmSeverity).severities=new xe,Be._vm={},Be._nm={},Be._cp=function(e,t){if(e&&t){var i=e.value-t.value;return 0<i?1:i<0?-1:0}return e&&!t?1:!e&&t?-1:0},Be.forEach=function(e,t){Be.severities.forEach(e,t)},Be.getSortFunction=function(){return Be._cp},Be.setSortFunction=function(e){Be._cp=e,Be.severities.sort(e)},Be.add=function(e,t,i,r,a){var n=new Be(e,t,i,r,a);return Be._vm[e]=n,Be._nm[t]=n,Be.severities.add(n),Be.severities.sort(Be._cp),n},Be.remove=function(e){var t=Be._nm[e];return t&&(delete Be._nm[e],delete Be._vm[t.value],Be.severities.remove(t)),t},Be.CRITICAL=Be.add(500,"Critical","C","#FF0000"),Be.MAJOR=Be.add(400,"Major","M","#FFA000"),Be.MINOR=Be.add(300,"Minor","m","#FFFF00"),Be.WARNING=Be.add(200,"Warning","W","#00FFFF"),Be.INDETERMINATE=Be.add(100,"Indeterminate","N","#C800FF"),Be.CLEARED=Be.add(0,"Cleared","R","#00FF00"),Be.isClearedAlarmSeverity=function(e){return!!e&&0===e.value},Be.getByName=function(e){return Be._nm[e]},Be.getByValue=function(e){return Be._vm[e]},Be.clear=function(){Be.severities.clear(),Be._vm={},Be._nm={}},Be.compare=function(e,t){return Be._cp(e,t)},Se.AlarmState=function(e){this._e=e,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0},Se.extend(Se.AlarmState,Object,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._e.firePropertyChange("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var e=null;for(var t in this._am)t=Se.AlarmSeverity.getByName(t),Se.AlarmSeverity.isClearedAlarmSeverity(t)||0!==this.getAcknowledgedAlarmCount(t)&&(e=e&&0<Se.AlarmSeverity.compare(e,t)?e:t);this._haa=e},_c2:function(){var e=null;for(var t in this._nm)t=Se.AlarmSeverity.getByName(t),Se.AlarmSeverity.isClearedAlarmSeverity(t)||0!==this.getNewAlarmCount(t)&&(e=e&&0<Se.AlarmSeverity.compare(e,t)?e:t);this._hna=e},_c3:function(){if(this._hna){for(var e in this._nm)if(e=Se.AlarmSeverity.getByName(e),!Se.AlarmSeverity.isClearedAlarmSeverity(e)&&0!==this.getNewAlarmCount(e)&&0<Se.AlarmSeverity.compare(this._hna,e))return void(this._hls=!0);this._hls=!1}else this._hls=!1},_c4:function(){var e=this._haa,t=this._hna,i=this._ps;this._hoa=e,0<Se.AlarmSeverity.compare(t,this._hoa)&&(this._hoa=t),0<Se.AlarmSeverity.compare(i,this._hoa)&&(this._hoa=i)},_c5:function(){var e=this._haa,t=this._hna;this._hta=e,0<Se.AlarmSeverity.compare(t,this._hta)&&(this._hta=t)},increaseAcknowledgedAlarm:function(e,t){if(null==t&&(t=1),0!==t){var i=this._am[e.name];null==i&&(i=0),i+=t,this._am[e.name]=i,this._f(),this._e.onAlarmChange()}},increaseNewAlarm:function(e,t){if(null==t&&(t=1),0!==t){var i=this._nm[e.name];null==i&&(i=0),i+=t,this._nm[e.name]=i,this._f(),this._e.onAlarmChange()}},decreaseAcknowledgedAlarm:function(e,t){if(null==t&&(t=1),0!==t){var i=this._am[e.name];if(null==i&&(i=0),(i-=t)<0)throw"Alarm count can not be negative";this._am[e.name]=i,this._f(),this._e.onAlarmChange()}},decreaseNewAlarm:function(e,t){if(null==t&&(t=1),0!==t){var i=this._nm[e.name];if(null==i&&(i=0),(i-=t)<0)throw"Alarm count can not be negative";this._nm[e.name]=i,this._f(),this._e.onAlarmChange()}},acknowledgeAlarm:function(e){this.decreaseNewAlarm(e,1),this.increaseAcknowledgedAlarm(e,1)},acknowledgeAllAlarms:function(e){if(e){var t=this.getNewAlarmCount(e);this.decreaseNewAlarm(e,t),this.increaseAcknowledgedAlarm(e,t)}else for(var i in this._nm)this.acknowledgeAllAlarms(Se.AlarmSeverity.getByName(i))},_c6:function(){for(var e in this._aac=0,this._am)e=Se.AlarmSeverity.getByName(e),this._aac+=this.getAcknowledgedAlarmCount(e)},getAcknowledgedAlarmCount:function(e){if(e){var t=this._am[e.name];return null==t?0:t}return this._aac},getAlarmCount:function(e){return this.getAcknowledgedAlarmCount(e)+this.getNewAlarmCount(e)},_c7:function(){for(var e in this._nac=0,this._nm)e=Se.AlarmSeverity.getByName(e),this._nac+=this.getNewAlarmCount(e)},getNewAlarmCount:function(e){if(e){var t=this._nm[e.name];return null==t?0:t}return this._nac},setNewAlarmCount:function(e,t){this._nm[e.name]=t,this._f()},removeAllNewAlarms:function(e){e?delete this._nm[e]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(e,t){this._am[e.name]=t,this._f()},removeAllAcknowledgedAlarms:function(e){e?delete this._am[e.name]:this._am={},this._f()},isEmpty:function(){return null==this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(e){if(this._ep||(e=null),this._ps!==e){var t=this._ps;this._ps=e,this._f(),this._e.onAlarmChange(),this._e.firePropertyChange("propagateSeverity",t,e)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(e){var t=this._ep;this._ep=e,this._e.firePropertyChange("enablePropagation",t,e)&&(e||this.setPropagateSeverity(null))}}),Se.Alarm=function(e,t,i,r,a){Se.Data.call(this,e),this._id=null!=e?e:Se.id("A"),this._elementId=t,this._alarmSeverity=i,this._acked=r||!1,this._cleared=a||!1},Se.extend(Se.Alarm,Se.Data,{IAlarm:!0,getElementId:function(){return this._elementId},___accessor:["acked","cleared","alarmSeverity"]}),Se.AlarmBox=function(e){if(!e)throw"elementBox can not be null.";Se.AlarmBox.superClass.constructor.call(this),this._elementBox=e,this._alarmElementMapping=new Se.AlarmElementMapping(this,e),this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange,this,!0),this.addDataBoxChangeListener(this.handleAlarmBoxChange,this,!0),this.addDataPropertyChangeListener(this.handleAlarmPropertyChange,this,!0)},Se.extend(Se.AlarmBox,Se.DataBox,{__accessor:["removeAlarmWhenElementIsRemoved"],_name:"AlarmBox",_removeAlarmWhenAlarmIsCleared:!1,_removeAlarmWhenElementIsRemoved:!0,getElementBox:function(){return this._elementBox},isRemoveAlarmWhenAlarmIsCleared:function(){return this._removeAlarmWhenAlarmIsCleared},setRemoveAlarmWhenAlarmIsCleared:function(e){var t=this._removeAlarmWhenAlarmIsCleared;if(this._removeAlarmWhenAlarmIsCleared=e,this.firePropertyChange("removeAlarmWhenAlarmIsCleared",t,e),e)for(var i in this.datas){var r=this.datas[i];r.isCleard()&&this.remove(r)}},getAlarmElementMapping:function(){return this._alarmElementMapping},setAlarmElementMapping:function(e){if(!e)throw"alarmElementMapping can not be null";if(this._alarmElementMapping!==e){var t=this._alarmElementMapping;this.getDatas().forEach(this._decreaseAlarmState,this),this._alarmElementMapping=e,this.getDatas().forEach(this._increaseAlarmState,this),this.firePropertyChange("alarmElementMapping",t,e)}},handleElementBoxChange:function(e){"add"===e.kind?this.handleElementAdded(e.data):"remove"===e.kind?(this.handleElementRemoved(e.data),this._removeAlarmWhenElementIsRemoved&&this.removeAlarmsByElement(e.data)):"clear"===e.kind&&(e.datas.forEach(this.handleElementRemoved,this),this._removeAlarmWhenElementIsRemoved&&this.clear())},handleAlarmBoxChange:function(e){"add"===e.kind?this._increaseAlarmState(e.data):"remove"===e.kind?this._decreaseAlarmState(e.data):"clear"===e.kind&&e.datas.forEach(this._decreaseAlarmState,this)},handleAlarmPropertyChange:function(e){var t=e.source;t.isCleared()||("alarmSeverity"===e.property?this.handleAlarmSeverityChange(t,e):"acked"===e.property&&this.handleAckedChange(t,e)),"cleared"===e.property&&(t.isCleared()?(this._decreaseAlarmState(t,!0),this._removeAlarmWhenAlarmIsCleared&&this.remove(t)):this._increaseAlarmState(t,!0))},handleAckedChange:function(e,t){if(e.getAlarmSeverity()){var i=this.getCorrespondingElements(e);if(i)for(var r=0;r<i.size();r++){var a=i.get(r);t.oldValue?a.getAlarmState().decreaseAcknowledgedAlarm(e.getAlarmSeverity()):a.getAlarmState().decreaseNewAlarm(e.getAlarmSeverity()),t.newValue?a.getAlarmState().increaseAcknowledgedAlarm(e.getAlarmSeverity()):a.getAlarmState().increaseNewAlarm(e.getAlarmSeverity())}}},handleAlarmSeverityChange:function(e,t){var i=t.oldValue,r=t.newValue,a=this.getCorrespondingElements(e);if(a)for(var n=0;n<a.size();n++){var o=a.get(n);i&&(e.isAcked()?o.getAlarmState().decreaseAcknowledgedAlarm(i):o.getAlarmState().decreaseNewAlarm(i)),r&&(e.isAcked()?o.getAlarmState().increaseAcknowledgedAlarm(r):o.getAlarmState().increaseNewAlarm(r))}},getCorrespondingAlarms:function(e){return this._alarmElementMapping.getCorrespondingAlarms(e)},getCorrespondingElements:function(e){return this._alarmElementMapping.getCorrespondingElements(e)},handleElementAdded:function(e){var t=this.getCorrespondingAlarms(e);if(t)for(var i=0;i<t.size();i++){var r=t.get(i);if(!r.isCleared()){var a=r.getAlarmSeverity();a&&(r.isAcked()?e.getAlarmState().increaseAcknowledgedAlarm(a):e.getAlarmState().increaseNewAlarm(a))}}},_increaseAlarmState:function(e,t){if(!e.isCleared()||t){var i=e.getAlarmSeverity();if(i){var r=this.getCorrespondingElements(e);if(r)for(var a=0;a<r.size();a++){var n=r.get(a);e.isAcked()?n.getAlarmState().increaseAcknowledgedAlarm(i):n.getAlarmState().increaseNewAlarm(i)}}}},_decreaseAlarmState:function(e,t){if(e.isCleared||console.log(),!e.isCleared()||t){var i=e.getAlarmSeverity();if(i){var r=this.getCorrespondingElements(e);if(r)for(var a=0;a<r.size();a++){var n=r.get(a);e.isAcked()?n.getAlarmState().decreaseAcknowledgedAlarm(i):n.getAlarmState().decreaseNewAlarm(i)}}}},handleElementRemoved:function(t){var e=this.getCorrespondingAlarms(t);e&&e.forEach(function(e){!e.isCleared()&&e.getAlarmSeverity()&&(e.isAcked()?t.getAlarmState().decreaseAcknowledgedAlarm(e.getAlarmSeverity()):t.getAlarmState().decreaseNewAlarm(e.getAlarmSeverity()))})},removeAlarmsByElement:function(e){var t=this.getCorrespondingAlarms(e);t&&t.forEach(this.remove,this)},add:function(e,t){if(!e.IAlarm)throw"Only IAlarm can be added into AlarmBox";this._removeAlarmWhenAlarmIsCleared&&e.isCleared()||Se.AlarmBox.superClass.add.apply(this,arguments)}}),Se.AlarmElementMapping=function(e,t){if(!t)throw"ElementBox can not be null";if(!e)throw"AlarmBox can not be null";this._elementBox=t,this._alarmBox=e,this._alarmsFinder=new Se.QuickFinder(e,"elementId")},Se.extend(Se.AlarmElementMapping,Object,{getCorrespondingAlarms:function(e){return this._alarmsFinder.find(e.getId())},getCorrespondingElements:function(e){var t=this._elementBox.getDataById(e.getElementId());return new xe(t)},dispose:function(){delete this._elementBox,delete this._alarmBox,delete this._alarmsFinder}}),Se.PropertyPropagator=function(e,t,i){if(!e)throw"dataBox can not be null";if(!t)throw"propertyName can not be null";this._dataBox=e,this._propertyName=t,this._propertyType=i||"accessor","accessor"===this._propertyType&&(this._getter=Se.getter(t),this._setter=Se.setter(t)),this._enable=!1,this._isPropagating=!1},Se.extend(Se.PropertyPropagator,Object,{getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isEnable:function(){return this._enable},setEnable:function(e){if(this._enable!==e)if(this._enable=e,this._enable)for(var t in this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this._dataBox.datas)this.propagate(this._dataBox.datas[t]);else this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this)},handleDataBoxChange:function(e){e.data&&this.propagate(e.data)},handleDataPropertyChange:function(e){if(this.isInterestedProperty(e))this.propagate(e.source);else if("parent"===e.property){var t=e.oldValue;t&&this.propagate(t),this.propagate(e.source)}},isInterestedProperty:function(e){return"accessor"===this._propertyType&&this._propertyName===e.property||!("style"!==this._propertyType||!e.IElement||"S:"+this._propertyName!==e.property)||"client"===this._propertyType&&"C:"+this._propertyName===e.property},propagate:function(e){e&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(e),this._isPropagating=!1)},propagateToTop:function(e){for(this.propagateToParent(null,e);e&&e.getParent();)this.propagateToParent(e,e.getParent()),e=e.getParent()},propagateToParent:function(e,t){}}),Se.AlarmStatePropagator=function(e){Se.AlarmStatePropagator.superClass.constructor.call(this,e,"alarmState")},Se.extend(Se.AlarmStatePropagator,Se.PropertyPropagator,{handleDataPropertyChange:function(e){"enablePropagation"===e.property?this.propagate(e.source):Se.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this,e)},propagateToParent:function(e,t){var i=null;t.getChildren().forEach(function(e){var t=e.getAlarmState().getHighestOverallAlarmSeverity();0<Se.AlarmSeverity.compare(t,i)&&(i=t)}),t.getAlarmState&&t.getAlarmState().setPropagateSeverity(i)}});var We={KEEP_DEFAULT_FUNCTION:function(e){return!!(e.target.keepDefault||e.target.getAttribute("keepDefault")||e.target.parentNode&&(e.target.parentNode.keepDefault||e.target.parentNode.getAttribute("keepDefault"))||e.shiftKey)},paintSortFunction:function(e,t){return e.z!==t.z?e.z-t.z:0},doubleClickToLookAtFunction:function(e){return!0},needSmoothNormalFunction:function(e){return!(e instanceof Le||e instanceof Se.TextNode||e instanceof Se.PathCube||e instanceof Se.ShapeNode||e instanceof Se.ComboNode||"TGL.Entity"==e.getClassName())},PATH_LINK_COMPUTE_DELAY:!1};Se.Defaults=We,Se.ShaderChunk={gradient_parts_fragment:["#ifdef MAX_GRADIENT","uniform vec3 gradientColor[MAX_GRADIENT];","uniform float gradientStop[MAX_GRADIENT];","uniform int gradientType;","#endif"].join("\n"),gradient_basic_fragment:["#ifdef MAX_GRADIENT","float gradientUV = 1.0;","float PI = 3.14;","if(gradientType == 1){","gradientUV = oUv.x;","} else if(gradientType == 2){","gradientUV = oUv.y;","} else if(gradientType == 3){","gradientUV = (oUv.x + oUv.y)/2.0;","} else if(gradientType == 4){","gradientUV = (oUv.x + 1.0 - oUv.y)/2.0;","} else if(gradientType == 5){","gradientUV = 1.414 * sqrt((oUv.x - 0.5) * (oUv.x - 0.5) + (oUv.y - 0.5) * (oUv.y - 0.5));","} else if(gradientType == 6){","gradientUV = (atan(oUv.y - 0.5,oUv.x - 0.5)) / (2.0 * PI);","if(gradientUV < 0.0){","gradientUV = 1.0 + gradientUV;","}","}","for( int i = 1; i < MAX_GRADIENT; i ++ ){","if(gradientStop[i - 1] <= gradientUV){","if((gradientStop[i] >= gradientUV)){","vec3 color1 = gradientColor[i-1];","vec3 color2 = gradientColor[i];","float stop1 = gradientStop[i-1];","float stop2 =gradientStop[i]; ","gl_FragColor = vec4( (color1 * (stop2 - gradientUV )  + color2 * (gradientUV - stop1))/(stop2 - stop1),opacity);","break;","}","}","}","#endif"].join("\n"),gradient_phong_fragment:["#ifdef MAX_GRADIENT","float gradientUV = 1.0;","float PI = 3.14;","if(gradientType == 1){","gradientUV = oUv.x;","} else if(gradientType == 2){","gradientUV = oUv.y;","} else if(gradientType == 3){","gradientUV = (oUv.x + oUv.y)/2.0;","} else if(gradientType == 4){","gradientUV = (oUv.x + 1.0 - oUv.y)/2.0;","} else if(gradientType == 5){","gradientUV = 1.414 * sqrt((oUv.x - 0.5) * (oUv.x - 0.5) + (oUv.y - 0.5) * (oUv.y - 0.5));","} else if(gradientType == 6){","gradientUV = (atan(oUv.y - 0.5,oUv.x - 0.5)) / (2.0 * PI);","if(gradientUV < 0.0){","gradientUV = 1.0 + gradientUV;","}","}","for( int i = 1; i < MAX_GRADIENT; i ++ ){","if(gradientStop[i - 1] < gradientUV){","if((gradientStop[i] > gradientUV)){","vec3 color1 = gradientColor[i-1];","vec3 color2 = gradientColor[i];","float stop1 = gradientStop[i-1];","float stop2 = gradientStop[i]; ","tempDiffuse = (color1 * (stop2 - gradientUV )  + color2 * (gradientUV - stop1))/(stop2 - stop1);","break;","}","}","}","#endif"].join("\n"),fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( reflectVec.x*flipEnvMap,  reflectVec.y,reflectVec.z) );","#else","vec4 cubeColor = textureCube( envMap, vec3(reflectVec.x*flipEnvMap,  reflectVec.y,reflectVec.z) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","#ifdef PHONG","#else","float specularStrength = 1.0;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP ) ","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","varying vec2 vUv;","varying vec2 oUv;","uniform vec4 offsetRepeat;","uniform bool flipX; ","uniform bool flipY; ","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","varying vec2 vUv;","varying vec2 oUv;","#endif","#ifdef USE_MAP","uniform bool mapLoaded;","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","if(flipX || flipY){","float sx = 1.0, ox = 0.0;","float sy = 1.0,oy = 0.0;","if(flipX){  sx = -1.0;ox = 1.0;}","if(flipY){  sy = -1.0; oy = 1.0;}","vUv.x = uv.x * offsetRepeat.z * sx  + offsetRepeat.x + offsetRepeat.z * ox;","vUv.y = uv.y * offsetRepeat.w * sy  + offsetRepeat.y + offsetRepeat.w * oy;","}else{","vUv = uv * offsetRepeat.zw  + offsetRepeat.xy;","}","oUv = uv;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","if(mapLoaded){","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = texelColor * gl_FragColor;","}","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = uspecularStrength;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0 ","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -viewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += tempDiffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ]) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += tempDiffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += tempDiffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += tempDiffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","float ssao = 1.0;","#ifdef USE_SSAO","ssao = clamp(1.0 - texture2D(mapSSAO, (finalPosition.xy / finalPosition.w / 2.0 + vec2(0.5,0.5))).x,0.0,1.0);","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + (ambientLightColor * ambient * ssao) + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + (ambientLightColor * ambient) * ssao ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","mat4 boneMatZ = getBoneMatrix( skinIndex.z );","mat4 boneMatW = getBoneMatrix( skinIndex.w );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","skinned \t  += boneMatZ * skinVertex * skinWeight.z;","skinned \t  += boneMatW * skinVertex * skinWeight.w;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += morphTarget0 * morphTargetInfluences[ 0 ];","morphed += morphTarget1 * morphTargetInfluences[ 1 ];","morphed += morphTarget2 * morphTargetInfluences[ 2 ];","morphed += morphTarget3 * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += morphTarget4 * morphTargetInfluences[ 4 ];","morphed += morphTarget5 * morphTargetInfluences[ 5 ];","morphed += morphTarget6 * morphTargetInfluences[ 6 ];","morphed += morphTarget7 * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal += morphNormal0 * morphTargetInfluences[ 0 ];","morphedNormal += morphNormal1 * morphTargetInfluences[ 1 ];","morphedNormal += morphNormal2 * morphTargetInfluences[ 2 ];","morphedNormal += morphNormal3 * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix \t+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","#endif","#ifdef USE_POINT_SHADOWMAP","uniform sampler2D pShadowMap[MAX_POINT_SHADOWS];","uniform vec2 pShadowMapSize[ MAX_POINT_SHADOWS ];","uniform float pShadowDarkness[MAX_POINT_SHADOWS];","uniform float pShadowRadius [MAX_POINT_SHADOWS];","uniform float pShadowBias [MAX_POINT_SHADOWS];","uniform vec3 pPosition[MAX_POINT_SHADOWS];","uniform float shadowCameraNear;","uniform float shadowCameraFar;","varying vec4 pWorldPosition;","vec2 cubeToUV( vec3 v, float texelSizeY ) {","\tvec3 absV = abs( v );","\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );","\tabsV *= scaleToCube;","\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );","\tvec2 planar = v.xy;","\tfloat almostATexel = 1.5 * texelSizeY;","\tfloat almostOne = 1.0 - almostATexel;","\tif ( absV.z >= almostOne ) {","\t\tif ( v.z > 0.0 )","\t\t\tplanar.x = 4.0 - v.x;","\t\t} else if ( absV.x >= almostOne ) {","\t\t \tfloat signX = sign( v.x );","\t\t\tplanar.x = v.z * signX + 2.0 * signX;","\t\t} else if ( absV.y >= almostOne ) {","\t\t\tfloat signY = sign( v.y );","\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;","\t\t\tplanar.y = v.z * signY - 2.0;","\t\t}","\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );","}","float unpack (vec4 colour){","const vec4 bitShifts = vec4(1.0,1.0 / 255.0,1.0 / (255.0 * 255.0),1.0 / (255.0 * 255.0 * 255.0));","return dot(colour, bitShifts) ;","}","float texture2DCompare( sampler2D depths, vec2 uv, float compare ){","\treturn step( compare, unpack( texture2D( depths, uv ) ) );","}","float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec3 lightToPosition, float shadowCameraNear, float shadowCameraFar ) {","\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );","\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );","\tdp += shadowBias;","\tvec3 bd3D = normalize( lightToPosition );","\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )","\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;","\treturn (","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )","\t) * ( 1.0 / 9.0 );","#else","\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );","#endif","}","#endif","#if defined(USE_SHADOWMAP) || defined(USE_POINT_SHADOWMAP)","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3(inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2(inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( depthKernel[0][0] < shadowCoord.z ) shadowKernel[0][0] = 0.25;","else shadowKernel[0][0] = 0.0;","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( depthKernel[0][1] < shadowCoord.z ) shadowKernel[0][1] = 0.25;","else shadowKernel[0][1] = 0.0;","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( depthKernel[0][2] < shadowCoord.z ) shadowKernel[0][2] = 0.25;","else shadowKernel[0][2] = 0.0;","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( depthKernel[1][0] < shadowCoord.z ) shadowKernel[1][0] = 0.25;","else shadowKernel[1][0] = 0.0;","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( depthKernel[1][1] < shadowCoord.z ) shadowKernel[1][1] = 0.25;","else shadowKernel[1][1] = 0.0;","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( depthKernel[1][2] < shadowCoord.z ) shadowKernel[1][2] = 0.25;","else shadowKernel[1][2] = 0.0;","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( depthKernel[2][0] < shadowCoord.z ) shadowKernel[2][0] = 0.25;","else shadowKernel[2][0] = 0.0;","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( depthKernel[2][1] < shadowCoord.z ) shadowKernel[2][1] = 0.25;","else shadowKernel[2][1] = 0.0;","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( depthKernel[2][2] < shadowCoord.z ) shadowKernel[2][2] = 0.25;","else shadowKernel[2][2] = 0.0;","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif","#ifdef USE_POINT_SHADOWMAP"," ","for( int i = 0; i < MAX_POINT_SHADOWS; i ++ ) {","vec3 lightToPosition = pWorldPosition.xyz - pPosition[i];","vec2 shadowMapSize = pShadowMapSize[i];","float shadow = getPointShadow(pShadowMap[i],shadowMapSize,pShadowBias[i],pShadowRadius[i],lightToPosition,shadowCameraNear,shadowCameraFar);","float darkness = 1.0 - pShadowDarkness[i];","gl_FragColor.xyz *= (darkness + (1.0 - darkness) * shadow);","}","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif","#ifdef USE_POINT_SHADOWMAP","varying vec4 pWorldPosition;","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","#ifdef USE_POINT_SHADOWMAP","pWorldPosition = modelMatrix * vec4(position,1.0);","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},Se.UniformsUtils={merge:function(e){var t,i,r,a={};for(t=0;t<e.length;t++)for(i in r=this.clone(e[t]))a[i]=r[i];return a},clone:function(e){var t,i,r,a={};for(t in e)for(i in a[t]={},e[t])(r=e[t][i])instanceof Se.Color||r instanceof Se.Vec2||r instanceof Se.Vec3||r instanceof Se.Vec4||r instanceof Se.Mat4||r instanceof Se.Texture?a[t][i]=r.clone():r instanceof Array?a[t][i]=r.slice():a[t][i]=r;return a}},Se.UniformsLib={outline:{diffuse:{type:"c",value:new Se.Color(15658734)},outline_offset:{type:"f",value:0}},glow:{map:{type:"t",value:null}},blur:{orientation:{type:"i",value:0},texelSize:{type:"v2",value:new Se.Vec2(512,512)},blurAmount:{type:"i",value:10},blurScale:{type:"f",value:1},blurStrength:{type:"f",value:.2},map:{type:"t",value:null},useBlur:{type:"i",value:1},blurGlobalAlpha:{type:"f",value:1}},deferred:{linearDepth:{type:"f",value:9e3},isNormal:{type:"i",value:1}},ssao:{map0:{type:"t",value:null},map1:{type:"t",value:null},map2:{type:"t",value:null},occluderBias:{type:"f",value:.05},samplingRadius:{type:"f",value:20},attenuation:{type:"v2",value:new pe(1,0)},texelSize:{type:"v2",value:new pe(1/512,1/512)}},common:{diffuse:{type:"c",value:new Se.Color(15658734)},wireframeLinecolor:{type:"c",value:new Se.Color(0)},wireframeLineopacity:{type:"f",value:1},opacity:{type:"f",value:1},clipPlane:{type:"v4",value:new Se.Vec4(0,0,0,0)},map:{type:"t",value:null},mapLoaded:{type:"i",value:0},offsetRepeat:{type:"v4",value:new Se.Vec4(0,0,1,1)},flipX:{type:"i",value:0},flipY:{type:"i",value:0},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},gradient:{gradientColor:{type:"v3v",value:[]},gradientStop:{type:"fv1",value:[]},gradientType:{type:"i",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new Se.Vec2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new Se.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new Se.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new Se.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]},pShadowMap:{type:"tv",value:[]},pShadowMapSize:{type:"v2v",value:[]},pShadowDarkness:{type:"fv1",value:[]},pShadowRadius:{type:"fv1",value:[]},pShadowBias:{type:"fv1",value:[]},pPosition:{type:"v3v",value:[]},shadowCameraNear:{type:"f",value:.1},shadowCameraFar:{type:"f",value:1e4}},gradientramp:{skyColor:{type:"c",value:new Se.Color(16777215)},horizonColor:{type:"c",value:new Se.Color(16777215)},earthColor:{type:"c",value:new Se.Color(16777215)},skyY:{type:"f",value:0},horizonY:{type:"f",value:0},earthY:{type:"f",value:0}}},Se.ShaderLib={outline:{uniforms:Se.UniformsUtils.merge([Se.UniformsLib.outline]),vertexShader:["uniform float outline_offset;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position + normalize(position)  * outline_offset, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","void main() {","gl_FragColor = vec4(diffuse, 1.0 );","}"].join("\n")},blur:{uniforms:Se.UniformsUtils.merge([Se.UniformsLib.blur]),vertexShader:["varying vec2 vUv;","void main (){","gl_Position = vec4(position, 1.0);","vUv = uv;","}"].join("\n"),fragmentShader:["uniform vec2 texelSize;","uniform sampler2D map;","uniform int orientation;","uniform int blurAmount;","uniform float blurScale;","uniform float blurStrength;","uniform int useBlur;","uniform float blurGlobalAlpha;","uniform sampler2D depthMap;","varying vec2 vUv;","float Gaussian (float x, float deviation){","return (1.0 / sqrt(2.0 * 3.141592 * deviation)) * exp(-((x * x) / (2.0 * deviation)));","}","void main (){","float halfBlur = float(blurAmount) * 0.5;","vec4 colour = vec4(0.0);","if(useBlur == 0){","colour = texture2D(map,vUv);","}else {","vec4 texColour = vec4(0.0);","float deviation = halfBlur * 0.35;","deviation *= deviation;","float strength = 1.0 - blurStrength;","if ( orientation == 0 ){","for (int i = 0; i < 20; ++i){","if ( i >= blurAmount ){","break;","}","float offset = float(i) - halfBlur;","texColour = texture2D(map, vUv + vec2(offset / texelSize.x * blurScale, 0.0)) * Gaussian(offset * strength, deviation);","colour += texColour;","}","}else{","for (int i = 0; i < 20; ++i){","if ( i >= blurAmount )","break;","float offset = float(i) - halfBlur;","texColour = texture2D(map, vUv + vec2(0.0, offset / texelSize.y * blurScale)) * Gaussian(offset * strength, deviation);","colour += texColour;","}","}","}","gl_FragColor = clamp(colour, 0.0, 1.0);","if(useBlur == 0){","gl_FragColor.w *=  gl_FragColor.w * gl_FragColor.w * gl_FragColor.w * blurGlobalAlpha;","}","}"].join("\n")},linex:{uniforms:Se.UniformsUtils.merge([{near:{type:"f",value:.1},opacity:{type:"f",value:1},viewport:{type:"v4",value:new Se.Vec4(0)},lineColor:{type:"c",value:new Se.Color(16777215)},modelViewProjectionMatrix:{type:"m4",value:new ie},useVertexColor:{type:"i",value:0},totalSize:{type:"f",value:0},dashSize:{type:"f",value:0},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new Se.Vec4(0,0,1,1)}},Se.UniformsLib.gradient]),vertexShader:["attribute vec3 positionPrev;","attribute vec3 positionNext;","attribute float offset;","attribute float lineDistances;","varying  vec3 vColor;","varying float vLineDistance;","varying vec2 vUv;","varying vec2 oUv;","uniform mat4 modelViewProjectionMatrix;","uniform vec4 viewport;","uniform float near;","uniform vec4 offsetRepeat;","vec4 clipNear(vec4 p1,vec4 p2){","\tfloat n = (p1.w - near) / (p1.w - p2.w);","\treturn vec4(mix(p1.xy,p2.xy,n),-near,near);","}","void main(){"," \tvLineDistance = lineDistances;","\tvec4 prevProj = modelViewProjectionMatrix * vec4(positionPrev, 1.0);","\tvec4 currProj = modelViewProjectionMatrix * vec4(position, 1.0);","\tvec4 nextProj = modelViewProjectionMatrix * vec4(positionNext, 1.0);","\tif (currProj.w < 0.0) {","\t\tif (prevProj.w < 0.0) {","\t \t\tcurrProj = clipNear(currProj, nextProj);","\t\t}else {","\t\t\tcurrProj = clipNear(currProj, prevProj);","\t\t}","\t}","\tvec2 prevScreen = (prevProj.xy / abs(prevProj.w) + 1.0) * 0.5 * viewport.zw;","\tvec2 currScreen = (currProj.xy / abs(currProj.w) + 1.0) * 0.5 * viewport.zw;","\tvec2 nextScreen = (nextProj.xy / abs(nextProj.w) + 1.0) * 0.5 * viewport.zw;","\tvec2 dir;","\tfloat len = offset;","\tif(position == positionPrev){","\t\tdir = normalize(nextScreen - currScreen);","\t}else if(position == positionNext){","\t\tdir = normalize(currScreen - prevScreen);","\t}else {","\t\tvec2 dirA = normalize(currScreen - prevScreen);","\t\tvec2 dirB = normalize(nextScreen - currScreen);","\t\tvec2 tanget = normalize(dirA + dirB);","\t\tfloat miter = 1.0 / max(dot(tanget,dirA),0.5);","\t\tlen *= miter;","\t\tdir = tanget;","\t}","\tdir = vec2(-dir.y,dir.x) * len;","\tcurrScreen += dir;","\tcurrProj.xy = (currScreen / viewport.zw - 0.5) * 2.0 * abs(currProj.w);","\tgl_Position = currProj;","\tvColor = color;","\toUv = uv;","\tvUv = uv * offsetRepeat.zw  + offsetRepeat.xy;","}"].join("\n"),fragmentShader:["uniform vec3 lineColor;","uniform float opacity;","uniform int useVertexColor;","uniform float totalSize;","uniform float dashSize;","varying  vec3 vColor;","varying float vLineDistance;","varying vec2 vUv;","varying vec2 oUv;","#ifdef USE_MAP","uniform sampler2D map;","#endif",Se.ShaderChunk.gradient_parts_fragment,"void main (){","\tif(totalSize > dashSize && dashSize > 0.0){","\t     if ( mod( vLineDistance, totalSize ) > (totalSize - dashSize) ) {","\t\t\tdiscard;","\t\t}","\t}","#ifndef MAX_GRADIENT","\tif(useVertexColor == 0){","\t\tgl_FragColor = vec4(lineColor,opacity);","\t}else{","\t\tgl_FragColor = vec4(vColor,opacity);","\t}","#endif",Se.ShaderChunk.gradient_basic_fragment,"#ifdef USE_MAP","\tgl_FragColor *= texture2D(map,vUv);","#endif","}"].join("\n")},lensflare:{uniforms:{renderType:{type:"i",value:2},screenPosition:{type:"v3",value:new Se.Vec3(0)},scale:{type:"v2",value:new Se.Vec2(0)},rotation:{type:"f",value:0},occlusionMap:{type:"t",value:null},map:{type:"t",value:null}},vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},deferred:{uniforms:Se.UniformsUtils.merge([Se.UniformsLib.deferred]),vertexShader:["varying vec4 vPosition;","varying vec3 vNormal;","void main (){","vNormal = mat3(modelViewMatrix) * normal;","vPosition = modelViewMatrix * vec4(position, 1.0);","gl_Position = projectionMatrix * vPosition;","}"].join("\n"),fragmentShader:["uniform float linearDepth;","uniform int isNormal;","varying vec4 vPosition;","varying vec3 vNormal;","void main (){","float linear_depth = length(vPosition) / linearDepth;","if(isNormal == 1){","vec3 normal = normalize(vNormal);","gl_FragColor = vec4(normal.x, normal.y, normal.z, 1.0);","}else{","gl_FragColor = vec4(vPosition.x, vPosition.y, vPosition.z, linear_depth);","}","}"].join("\n")},ssao:{uniforms:Se.UniformsUtils.merge([Se.UniformsLib.ssao]),vertexShader:["varying vec2 vUv;","void main (){","gl_Position = vec4(position, 1.0);","vUv = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D map0;","uniform sampler2D map1;","uniform sampler2D map2;","uniform vec2 texelSize;","uniform float occluderBias;","uniform float samplingRadius;","uniform vec2 attenuation;","varying vec2 vUv;","float samplePixels (vec3 srcPosition, vec3 srcNormal, vec2 uv){","vec3 dstPosition = texture2D(map0, uv).xyz;","vec3 positionVec = dstPosition - srcPosition;","float intensity = max(dot(normalize(positionVec), srcNormal) - occluderBias, 0.0);","float dist = length(positionVec);","float attenuationValue = 1.0 / (attenuation.x + (attenuation.y * dist));","return intensity * attenuationValue;","}","void main (){","vec3 srcPosition = texture2D(map0, vUv).xyz;","vec3 srcNormal = texture2D(map1, vUv).xyz;","vec2 randVec = normalize(texture2D(map2, vUv).xy * 2.0 - 1.0);","float srcDepth = texture2D(map0, vUv).w;","float kernelRadius = samplingRadius * (1.0 - srcDepth);","vec2 kernel[4];","kernel[0] = vec2(0.0, 1.0);","kernel[1] = vec2(1.0, 0.0);","kernel[2] = vec2(0.0, -1.0);","kernel[3] = vec2(-1.0, 0.0);","const float sin45 = 0.707107;","float occlusion = 0.0;","for (int i = 0; i < 4; ++i){","vec2 k1 = reflect(kernel[i], randVec);","vec2 k2 = vec2(k1.x * sin45 - k1.y * sin45,k1.x * sin45 + k1.y * sin45);","k1 *= texelSize;","k2 *= texelSize;","occlusion += samplePixels(srcPosition, srcNormal, vUv + k1 * kernelRadius);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k2 * kernelRadius * 0.75);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k1 * kernelRadius * 0.5);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k2 * kernelRadius * 0.25);","}","occlusion /= 16.0;","occlusion = clamp(occlusion, 0.0, 1.0);","gl_FragColor =  vec4(occlusion,0.0,0.0,1.0);","}"].join("\n")},basic:{uniforms:Se.UniformsUtils.merge([Se.UniformsLib.common,Se.UniformsLib.gradient,Se.UniformsLib.fog,Se.UniformsLib.gradientramp]),vertexShader:[Se.ShaderChunk.map_pars_vertex,Se.ShaderChunk.lightmap_pars_vertex,Se.ShaderChunk.envmap_pars_vertex,Se.ShaderChunk.color_pars_vertex,Se.ShaderChunk.morphtarget_pars_vertex,Se.ShaderChunk.skinning_pars_vertex,Se.ShaderChunk.shadowmap_pars_vertex,"varying vec3 vPosition;","void main() {",Se.ShaderChunk.map_vertex,Se.ShaderChunk.lightmap_vertex,Se.ShaderChunk.color_vertex,Se.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",Se.ShaderChunk.morphnormal_vertex,Se.ShaderChunk.skinnormal_vertex,Se.ShaderChunk.defaultnormal_vertex,"#endif",Se.ShaderChunk.morphtarget_vertex,Se.ShaderChunk.skinning_vertex,Se.ShaderChunk.default_vertex,Se.ShaderChunk.worldpos_vertex,Se.ShaderChunk.envmap_vertex,Se.ShaderChunk.shadowmap_vertex,"vPosition = position;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 wireframeLinecolor;","uniform float wireframeLineopacity;","uniform float opacity;","uniform vec3 skyColor;","uniform vec3 horizonColor;","uniform vec3 earthColor;","uniform float skyY;","uniform float horizonY;","uniform float earthY;","varying vec3 vPosition;",Se.ShaderChunk.color_pars_fragment,Se.ShaderChunk.map_pars_fragment,Se.ShaderChunk.gradient_parts_fragment,Se.ShaderChunk.lightmap_pars_fragment,Se.ShaderChunk.envmap_pars_fragment,Se.ShaderChunk.fog_pars_fragment,Se.ShaderChunk.specularmap_pars_fragment,"vec4 lerp (vec4 colora, vec4 colorb, float t) {","if(t >= 1.0){","return colorb;}","float r = mix(colora.r, colorb.r, t);","float g = mix(colora.g, colorb.g, t);","float b = mix(colora.b, colorb.b, t);","float a = mix(colora.a, colorb.a, t);","return vec4(r,g,b,a);","}","void main() {","#ifdef USE_CLIP_PLANE","if (dot(vPosition, clipPlane.xyz) > clipPlane.w) discard;","#endif","#ifdef USE_WIREFRAME","float wireframeLineopacityValue = wireframeLineopacity * opacity;","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,wireframeLineopacityValue),vec4(skyColor ,wireframeLineopacityValue),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,wireframeLineopacityValue),vec4(earthColor ,wireframeLineopacityValue),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( diffuse, wireframeLineopacityValue );","}","else{","gl_FragColor = vec4( wireframeLinecolor, wireframeLineopacityValue );","}","#else","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(skyColor ,opacity),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(earthColor ,opacity),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( diffuse, opacity );","}","else{","gl_FragColor = vec4( diffuse, opacity );","}",Se.ShaderChunk.gradient_basic_fragment,Se.ShaderChunk.map_fragment,Se.ShaderChunk.alphatest_fragment,Se.ShaderChunk.lightmap_fragment,"if(skyY <= earthY){",Se.ShaderChunk.color_fragment,"}",Se.ShaderChunk.envmap_fragment,Se.ShaderChunk.linear_to_gamma_fragment,Se.ShaderChunk.fog_fragment,"#endif","}"].join("\n")},lambert:{uniforms:Se.UniformsUtils.merge([Se.UniformsLib.common,Se.UniformsLib.fog,Se.UniformsLib.lights,Se.UniformsLib.shadowmap,{ambient:{type:"c",value:new Se.Color(16777215)},emissive:{type:"c",value:new Se.Color(0)},wrapRGB:{type:"v3",value:new Se.Vec3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",Se.ShaderChunk.map_pars_vertex,Se.ShaderChunk.lightmap_pars_vertex,Se.ShaderChunk.envmap_pars_vertex,Se.ShaderChunk.lights_lambert_pars_vertex,Se.ShaderChunk.color_pars_vertex,Se.ShaderChunk.morphtarget_pars_vertex,Se.ShaderChunk.skinning_pars_vertex,Se.ShaderChunk.shadowmap_pars_vertex,"void main() {",Se.ShaderChunk.map_vertex,Se.ShaderChunk.lightmap_vertex,Se.ShaderChunk.color_vertex,Se.ShaderChunk.morphnormal_vertex,Se.ShaderChunk.skinbase_vertex,Se.ShaderChunk.skinnormal_vertex,Se.ShaderChunk.defaultnormal_vertex,Se.ShaderChunk.morphtarget_vertex,Se.ShaderChunk.skinning_vertex,Se.ShaderChunk.default_vertex,Se.ShaderChunk.worldpos_vertex,Se.ShaderChunk.envmap_vertex,Se.ShaderChunk.lights_lambert_vertex,Se.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",Se.ShaderChunk.color_pars_fragment,Se.ShaderChunk.map_pars_fragment,Se.ShaderChunk.lightmap_pars_fragment,Se.ShaderChunk.envmap_pars_fragment,Se.ShaderChunk.fog_pars_fragment,Se.ShaderChunk.shadowmap_pars_fragment,Se.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",Se.ShaderChunk.map_fragment,Se.ShaderChunk.alphatest_fragment,Se.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",Se.ShaderChunk.lightmap_fragment,Se.ShaderChunk.color_fragment,Se.ShaderChunk.envmap_fragment,Se.ShaderChunk.shadowmap_fragment,Se.ShaderChunk.linear_to_gamma_fragment,Se.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:Se.UniformsUtils.merge([Se.UniformsLib.common,Se.UniformsLib.gradient,Se.UniformsLib.bump,Se.UniformsLib.normalmap,Se.UniformsLib.fog,Se.UniformsLib.lights,Se.UniformsLib.shadowmap,Se.UniformsLib.gradientramp,{ambient:{type:"c",value:new Se.Color(16777215)},emissive:{type:"c",value:new Se.Color(0)},specular:{type:"c",value:new Se.Color(1118481)},uspecularStrength:{type:"f",value:1},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new Se.Vec3(1,1,1)},mapSSAO:{type:"t",value:null}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;","varying vec4 finalPosition;",Se.ShaderChunk.map_pars_vertex,Se.ShaderChunk.lightmap_pars_vertex,Se.ShaderChunk.envmap_pars_vertex,Se.ShaderChunk.lights_phong_pars_vertex,Se.ShaderChunk.color_pars_vertex,Se.ShaderChunk.morphtarget_pars_vertex,Se.ShaderChunk.skinning_pars_vertex,Se.ShaderChunk.shadowmap_pars_vertex,"varying vec3 vPosition;","void main() {",Se.ShaderChunk.map_vertex,Se.ShaderChunk.lightmap_vertex,Se.ShaderChunk.color_vertex,Se.ShaderChunk.morphnormal_vertex,Se.ShaderChunk.skinbase_vertex,Se.ShaderChunk.skinnormal_vertex,Se.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",Se.ShaderChunk.morphtarget_vertex,Se.ShaderChunk.skinning_vertex,Se.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",Se.ShaderChunk.worldpos_vertex,Se.ShaderChunk.envmap_vertex,Se.ShaderChunk.lights_phong_vertex,Se.ShaderChunk.shadowmap_vertex,"finalPosition = gl_Position;","vPosition = position;","}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 wireframeLinecolor;","uniform float wireframeLineopacity;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float uspecularStrength;","uniform float shininess;","varying vec4 finalPosition;","uniform vec3 skyColor;","uniform vec3 horizonColor;","uniform vec3 earthColor;","uniform float skyY;","uniform float horizonY;","uniform float earthY;","varying vec3 vPosition;",Se.ShaderChunk.color_pars_fragment,Se.ShaderChunk.gradient_parts_fragment,Se.ShaderChunk.map_pars_fragment,Se.ShaderChunk.lightmap_pars_fragment,Se.ShaderChunk.envmap_pars_fragment,Se.ShaderChunk.fog_pars_fragment,Se.ShaderChunk.lights_phong_pars_fragment,Se.ShaderChunk.shadowmap_pars_fragment,Se.ShaderChunk.bumpmap_pars_fragment,Se.ShaderChunk.normalmap_pars_fragment,Se.ShaderChunk.specularmap_pars_fragment,"#ifdef USE_SSAO","uniform sampler2D mapSSAO;","#endif","vec4 lerp (vec4 colora, vec4 colorb, float t) {","if(t >= 1.0){","return colorb;}","float r = mix(colora.r, colorb.r, t);","float g = mix(colora.g, colorb.g, t);","float b = mix(colora.b, colorb.b, t);","float a = mix(colora.a, colorb.a, t);","return vec4(r,g,b,a);","}","void main() {","#ifdef USE_CLIP_PLANE","if (dot(vPosition, clipPlane.xyz) > clipPlane.w) discard;","#endif","#ifdef USE_WIREFRAME","float wireframeLineopacityValue = wireframeLineopacity * opacity;","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,wireframeLineopacityValue),vec4(skyColor ,wireframeLineopacityValue),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,wireframeLineopacityValue),vec4(earthColor ,wireframeLineopacityValue),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( vec3 ( 1.0 ), wireframeLineopacityValue );","}","else{","gl_FragColor = vec4( wireframeLinecolor, wireframeLineopacityValue );","}","#else","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(skyColor ,opacity),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(earthColor ,opacity),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( vec3 ( 1.0 ), opacity );","}","else{","gl_FragColor = vec4(  vec3 ( 1.0 ), opacity );","}","vec3 tempDiffuse = diffuse;",Se.ShaderChunk.gradient_phong_fragment,Se.ShaderChunk.map_fragment,Se.ShaderChunk.alphatest_fragment,Se.ShaderChunk.specularmap_fragment,Se.ShaderChunk.lights_phong_fragment,Se.ShaderChunk.lightmap_fragment,Se.ShaderChunk.color_fragment,Se.ShaderChunk.envmap_fragment,Se.ShaderChunk.shadowmap_fragment,Se.ShaderChunk.linear_to_gamma_fragment,Se.ShaderChunk.fog_fragment,"#endif","}"].join("\n")},particle_basic:{uniforms:Se.UniformsUtils.merge([Se.UniformsLib.particle,Se.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",Se.ShaderChunk.color_pars_vertex,Se.ShaderChunk.shadowmap_pars_vertex,"void main() {",Se.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * normal.x * ( scale / length( mvPosition.xyz ) );","#else","float s = normal.x;","if(s == 0.0){","   s = 1.0;","}","gl_PointSize = size * s;","#endif","gl_Position = projectionMatrix * mvPosition;",Se.ShaderChunk.worldpos_vertex,Se.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",Se.ShaderChunk.color_pars_fragment,Se.ShaderChunk.map_particle_pars_fragment,Se.ShaderChunk.fog_pars_fragment,Se.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",Se.ShaderChunk.map_particle_fragment,Se.ShaderChunk.alphatest_fragment,Se.ShaderChunk.color_fragment,Se.ShaderChunk.shadowmap_fragment,Se.ShaderChunk.fog_fragment,"}"].join("\n")},billboard:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")},dashed:{uniforms:Se.UniformsUtils.merge([Se.UniformsLib.common,Se.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}},Se.UniformsLib.gradientramp]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;","varying vec3 vPosition;",Se.ShaderChunk.color_pars_vertex,"void main() {",Se.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vPosition = position;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;","uniform vec3 skyColor;","uniform vec3 horizonColor;","uniform vec3 earthColor;","uniform float skyY;","uniform float horizonY;","uniform float earthY;","varying vec3 vPosition;",Se.ShaderChunk.color_pars_fragment,Se.ShaderChunk.fog_pars_fragment,"vec4 lerp (vec4 colora, vec4 colorb, float t) {","if(t >= 1.0){","return colorb;}","float r = mix(colora.r, colorb.r, t);","float g = mix(colora.g, colorb.g, t);","float b = mix(colora.b, colorb.b, t);","float a = mix(colora.a, colorb.a, t);","return vec4(r,g,b,a);","}","void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(skyColor ,opacity),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(earthColor ,opacity),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( diffuse, opacity );",Se.ShaderChunk.fog_fragment,"}","else{","gl_FragColor = vec4( diffuse, opacity );",Se.ShaderChunk.color_fragment,Se.ShaderChunk.fog_fragment,"}","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:Se.UniformsUtils.merge([Se.UniformsLib.fog,Se.UniformsLib.lights,Se.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new Se.Vec2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new Se.Color(16777215)},uSpecularColor:{type:"c",value:new Se.Color(1118481)},uSpecualarStrength:{type:"f",value:1},uAmbientColor:{type:"c",value:new Se.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new Se.Vec2(0,0)},uRepeat:{type:"v2",value:new Se.Vec2(1,1)},wrapRGB:{type:"v3",value:new Se.Vec3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform vec3 uSpecularStrength;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",Se.ShaderChunk.shadowmap_pars_fragment,Se.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",Se.ShaderChunk.shadowmap_fragment,Se.ShaderChunk.linear_to_gamma_fragment,Se.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",Se.ShaderChunk.skinning_pars_vertex,Se.ShaderChunk.shadowmap_pars_vertex,"void main() {",Se.ShaderChunk.skinbase_vertex,Se.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{isCube:{type:"i",value:0},nearDistance:{type:"f",value:10},farDistance:{type:"f",value:1e4},referencePosition:{type:"v3",value:new mono.Vec3}},vertexShader:[Se.ShaderChunk.morphtarget_pars_vertex,Se.ShaderChunk.skinning_pars_vertex,"varying vec4 vPosition1;","void main() {",Se.ShaderChunk.skinbase_vertex,Se.ShaderChunk.morphtarget_vertex,Se.ShaderChunk.skinning_vertex,Se.ShaderChunk.default_vertex,"vPosition1 = modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int isCube;","uniform float nearDistance;","uniform float farDistance;","varying vec4 vPosition1;","varying vec3 vPosition2;","vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","vec4 pack (float depth){","const vec4 bias = vec4(1.0 / 255.0,1.0 / 255.0,1.0 / 255.0, 0.0);","float r = depth;","float g = fract(r * 255.0);","float b = fract(g * 255.0);","float a = fract(b * 255.0);","vec4 colour = vec4(r, g, b, a);","return colour - (colour.yzww * bias);","}","void main() {","if(isCube == 1){"," \tfloat dist = length( vPosition1.xyz/vPosition1.w);","\t\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );","\t\tgl_FragData[ 0 ] = pack(dist);","}else{","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}","}"].join("\n")}},Se.UniformsUtils={merge:function(e){var t,i,r,a={};for(t=0;t<e.length;t++)for(i in r=this.clone(e[t]))a[i]=r[i];return a},clone:function(e){var t,i,r,a={};for(t in e)for(i in a[t]={},e[t])(r=e[t][i])instanceof Se.Color||r instanceof Se.Vec2||r instanceof Se.Vec3||r instanceof Se.Vec4||r instanceof Se.Mat4||r instanceof Se.Texture?a[t][i]=r.clone():r instanceof Array?a[t][i]=r.slice():a[t][i]=r;return a}},Se.UniformsLib={outline:{diffuse:{type:"c",value:new Se.Color(15658734)},outline_offset:{type:"f",value:0}},glow:{map:{type:"t",value:null}},blur:{orientation:{type:"i",value:0},texelSize:{type:"v2",value:new Se.Vec2(512,512)},blurAmount:{type:"i",value:10},blurScale:{type:"f",value:1},blurStrength:{type:"f",value:.2},map:{type:"t",value:null},useBlur:{type:"i",value:1},blurGlobalAlpha:{type:"f",value:1}},deferred:{linearDepth:{type:"f",value:9e3},isNormal:{type:"i",value:1}},ssao:{map0:{type:"t",value:null},map1:{type:"t",value:null},map2:{type:"t",value:null},occluderBias:{type:"f",value:.05},samplingRadius:{type:"f",value:20},attenuation:{type:"v2",value:new pe(1,0)},texelSize:{type:"v2",value:new pe(1/512,1/512)}},common:{diffuse:{type:"c",value:new Se.Color(15658734)},wireframeLinecolor:{type:"c",value:new Se.Color(0)},wireframeLineopacity:{type:"f",value:1},opacity:{type:"f",value:1},clipPlane:{type:"v4",value:new Se.Vec4(0,0,0,0)},map:{type:"t",value:null},mapLoaded:{type:"i",value:0},offsetRepeat:{type:"v4",value:new Se.Vec4(0,0,1,1)},flipX:{type:"i",value:0},flipY:{type:"i",value:0},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},gradient:{gradientColor:{type:"v3v",value:[]},gradientStop:{type:"fv1",value:[]},gradientType:{type:"i",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new Se.Vec2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new Se.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new Se.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new Se.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]},pShadowMap:{type:"tv",value:[]},pShadowMapSize:{type:"v2v",value:[]},pShadowDarkness:{type:"fv1",value:[]},pShadowRadius:{type:"fv1",value:[]},pShadowBias:{type:"fv1",value:[]},pPosition:{type:"v3v",value:[]},shadowCameraNear:{type:"f",value:.1},shadowCameraFar:{type:"f",value:1e4}},gradientramp:{skyColor:{type:"c",value:new Se.Color(16777215)},horizonColor:{type:"c",value:new Se.Color(16777215)},earthColor:{type:"c",value:new Se.Color(16777215)},skyY:{type:"f",value:0},horizonY:{type:"f",value:0},earthY:{type:"f",value:0}},linex:{near:{type:"f",value:.1},opacity:{type:"f",value:1},viewport:{type:"v4",value:new Se.Vec4(0)},lineColor:{type:"c",value:new Se.Color(16777215)},modelViewProjectionMatrix:{type:"m4",value:new ie},useVertexColor:{type:"i",value:0},totalSize:{type:"f",value:0},dashSize:{type:"f",value:0}},lensflare:{renderType:{type:"i",value:2},screenPosition:{type:"v3",value:new Se.Vec3(0)},scale:{type:"v2",value:new Se.Vec2(0)},rotation:{type:"f",value:0},occlusionMap:{type:"t",value:null},map:{type:"t",value:null}}},Se.ShaderTerrain={terrain:{uniforms:Se.UniformsUtils.merge([Se.UniformsLib.fog,Se.UniformsLib.lights,Se.UniformsLib.shadowmap,{enableDiffuse1:{type:"i",value:0},enableDiffuse2:{type:"i",value:0},enableDiffuse3:{type:"i",value:0},enableDisplacement:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse1:{type:"t",value:null},tDiffuse2:{type:"t",value:null},tDiffuse3:{type:"t",value:null},tDetail:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tDisplacement:{type:"t",value:null},heightUnit:{type:"f",value:1},blendRange:{type:"fv1",value:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new Se.Color(15658734)},uSpecularColor:{type:"c",value:new Se.Color(1118481)},uAmbientColor:{type:"c",value:new Se.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uRepeatBase:{type:"v2",value:new Se.Vec2(1,1)},uRepeatOverlay:{type:"v2",value:new Se.Vec2(1,1)},uOffset:{type:"v2",value:new Se.Vec2(0,0)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableDiffuse3;","uniform bool enableSpecular;","uniform bool enableDisplacement;","uniform float blendRange[2];","uniform float heightUnit;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tDiffuse3;","uniform sampler2D tDetail;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tDisplacement;","uniform float uNormalScale;","uniform vec2 uRepeatOverlay;","uniform vec2 uRepeatBase;","uniform vec2 uOffset;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vPosition;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","varying vec3 vViewPosition;",Se.ShaderChunk.shadowmap_pars_fragment,Se.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;","vec2 uvBase = uRepeatBase * vUv;","vec3 normalTex = texture2D( tDetail, uvOverlay ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( (enableDiffuse1 && enableDiffuse2)  || (enableDiffuse1 && enableDiffuse3) || (enableDiffuse2 && enableDiffuse3) ){","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","vec4 colDiffuse3 = texture2D( tDiffuse3, uvOverlay );","vec4 allDefiuuses[3];","allDefiuuses[0] = colDiffuse1;","allDefiuuses[1] = colDiffuse2;","allDefiuuses[2] = colDiffuse3;","#ifdef GAMMA_INPUT","colDiffuse1.xyz *= colDiffuse1.xyz;","colDiffuse2.xyz *= colDiffuse2.xyz;","colDiffuse3.xyz *= colDiffuse3.xyz;","#endif","vec4 mixColor;","if(enableDisplacement){","vec4 dis = texture2D( tDisplacement, uvBase );","if(enableDiffuse1 && enableDiffuse2 && enableDiffuse3){","float total = dis.r + dis.g + dis.b;","if(total == 0.0){","mixColor = colDiffuse1 * 1.0/3.0 + colDiffuse2 * 1.0/3.0 + colDiffuse3 * 1.0/3.0;","}else{","mixColor = colDiffuse1 * dis.r/total + colDiffuse2 * dis.g/total + colDiffuse3 * dis.b/total;","}","}","}else {","mixColor = colDiffuse2;","float y = vPosition.y;","float blend2Bottom = blendRange[1] * heightUnit * 255.0;","float percent = 0.0;","if(y < blendRange[0] * heightUnit * 255.0){","mixColor = colDiffuse1;","percent = y / (blendRange[0] * heightUnit * 255.0);","if(percent >=0.8){","mixColor = mix(colDiffuse1,colDiffuse2,(percent - 0.8) / 0.2);","}","} else if(y > blend2Bottom){","mixColor = colDiffuse3;","percent = (y - blend2Bottom) / (heightUnit * 255.0 - blend2Bottom);","if(percent <= 0.2){","mixColor = mix(colDiffuse2,colDiffuse3,percent/0.2);","}","}","}","gl_FragColor = gl_FragColor * mixColor;"," } else if( enableDiffuse1 ) {","gl_FragColor = gl_FragColor * texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","gl_FragColor = gl_FragColor * texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","mat3 tsb = mat3( vTangent, vBinormal, vNormal );","vec3 finalNormal = tsb * normalTex;","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDistance = lDistance;","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","hemiDiffuse += uDiffuseColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","hemiSpecular += uSpecularColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif",Se.ShaderChunk.shadowmap_fragment,Se.ShaderChunk.linear_to_gamma_fragment,Se.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uRepeatBase;","uniform sampler2D tNormal;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vPosition;","varying vec3 vViewPosition;",Se.ShaderChunk.shadowmap_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );","vUv = uv;","vec2 uvBase = uv * uRepeatBase;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uvBase ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec3 displacedPosition = normal * df + position;","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","#else","vPosition = vec4(position,1.0);","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vec3 normalTex = texture2D( tNormal, uvBase ).xyz * 2.0 - 1.0;","vNormal = normalMatrix * normalTex;",Se.ShaderChunk.shadowmap_vertex,"}"].join("\n")}},Se.ShaderLib.terrain=Se.ShaderTerrain.terrain,Se.Fog=function(e,t,i){this.name="",this.color=new Se.Color(e),this.near=t!==Me?t:1,this.far=i!==Me?i:1e3},Se.Fog.prototype={constructor:Se.Fog,clone:function(){return new Se.Flog(this.color.getHex(),this.near,this.far)},refreshUniforms:function(e){e.fogNear.value=this.near,e.fogFar.value=this.far,e.fogColor.value=this.color}},Se.FogExp2=function(e,t){this.name="",this.color=new Se.Color(e),this.density=t!==Me?t:1},Se.FogExp2.prototype={DensityFactor:25e-5,constructor:Se.FogExp2,clone:function(){return new Se.FogExp2(this.color.getHex(),this.density)},refreshUniforms:function(e){e.fogDensity.value=this.density*this.DensityFactor,e.fogColor.value=this.color}};var je={},He=je.RADIANS_TO_DEGREES=180/Math.PI,qe=je.DEGREES_TO_RADIANS=Math.PI/180;je.isPowerOfTwo=function(e){return 0==(e&e-1)},je.clone=function(e,t){for(var i in t==Me&&(t=new e.prototype.constructor),e)if("id"!==i){var r=e[i];if(r.copy&&"function"==typeof r.copy)t[i].copy(r);else if(r instanceof Array){var a=r,n=t[i];null==n&&(n=[]);for(var o=0;o<a.length;o++){var s=a[o];n.push(s.clone())}}else cloneObjet[i]=r}},je.paramToGL=function(e,t,i){if(t){var r=i?i._glExtensionCompressedTextureS3TC:null;switch(e){case Se.RepeatWrapping:return t.REPEAT;case Se.ClampToEdgeWrapping:return t.CLAMP_TO_EDGE;case Se.MirroredRepeatWrapping:return t.MIRRORED_REPEAT;case Se.NearestFilter:return t.NEAREST;case Se.NearestMipMapNearestFilter:return t.NEAREST_MIPMAP_NEAREST;case Se.NearestMipMapLinearFilter:return t.NEAREST_MIPMAP_LINEAR;case Se.LinearFilter:return t.LINEAR;case Se.LinearMipMapNearestFilter:return t.LINEAR_MIPMAP_NEAREST;case Se.LinearMipMapLinearFilter:return t.LINEAR_MIPMAP_LINEAR;case Se.ByteType:return t.BYTE;case Se.UnsignedByteType:return t.UNSIGNED_BYTE;case Se.ShortType:return t.SHORT;case Se.UnsignedShortType:return t.UNSIGNED_SHORT;case Se.IntType:return t.INT;case Se.UnsignedIntType:return t.UNSIGNED_INT;case Se.FloatType:return t.FLOAT;case Se.AlphaFormat:return t.ALPHA;case Se.RGBFormat:return t.RGB;case Se.RGBAFormat:return t.RGBA;case Se.LuminanceFormat:return t.LUMINANCE;case Se.LuminanceAlphaFormat:return t.LUMINANCE_ALPHA;case Se.RGB_S3TC_DXT1_Format:return r.COMPRESSED_RGB_S3TC_DXT1_EXT;case Se.RGBA_S3TC_DXT1_Format:return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;case Se.RGBA_S3TC_DXT3_Format:return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;case Se.RGBA_S3TC_DXT5_Format:return r.COMPRESSED_RGBA_S3TC_DXT5_EXT;case Se.AddEquation:return t.FUNC_ADD;case Se.SubtractEquation:return t.FUNC_SUBTRACT;case Se.ReverseSubtractEquation:return t.FUNC_REVERSE_SUBTRACT;case Se.ZeroFactor:return t.ZERO;case Se.OneFactor:return t.ONE;case Se.SrcColorFactor:return t.SRC_COLOR;case Se.OneMinusSrcColorFactor:return t.ONE_MINUS_SRC_COLOR;case Se.SrcAlphaFactor:return t.SRC_ALPHA;case Se.OneMinusSrcAlphaFactor:return t.ONE_MINUS_SRC_ALPHA;case Se.DstAlphaFactor:return t.DST_ALPHA;case Se.OneMinusDstAlphaFactor:return t.ONE_MINUS_DST_ALPHA;case Se.DstColorFactor:return t.DST_COLOR;case Se.OneMinusDstColorFactor:return t.ONE_MINUS_DST_COLOR;case Se.SrcAlphaSaturateFactor:return t.SRC_ALPHA_SATURATE}return 0}console.error("No webgl context")},je.createElement=function(e,t,i,r){var a,n,o,s,l=e.vertices.length,h=(e.uvs.length,e.vertices),c=t.vertices,u=e.faces,f=t.faces,p=e.uvs,d=t.uvs,m=[],g=[],y=[];r===Me&&(r=0),e instanceof Se.Element&&(e.matrixAutoUpdate&&e.updateMatrix(),a=e.matrix,n=(new J).getNormalMatrix(a)),t instanceof Se.Element&&(t.matrixAutoUpdate&&t.updateMatrix(),o=t.matrix,s=(new J).getNormalMatrix(o));for(var v=0,x=h.length;v<x;v++)_=(A=h[v]).clone(),a&&_.applyMatrix4(a),g.push(_);for(v=0,x=c.length;v<x;v++){var A=c[v],_=A.clone();o&&_.applyMatrix4(o),g.push(_)}for(v=0,x=u.length;v<x;v++){var w=(E=u[v]).vertexNormals,b=E.vertexColors;(P=E instanceof Ce?new Ce(E.a,E.b,E.c):new Ee(E.a,E.b,E.c,E.d)).normal.copy(E.normal),n&&P.normal.applyMatrix3(n).normalize();for(var M=0,S=w.length;M<S;M++)T=w[M].clone(),n&&T.applyMatrix3(n).normalize(),P.vertexNormals.push(T);P.color.copy(E.color);for(M=0,S=b.length;M<S;M++)C=b[M],P.vertexColors.push(C.clone());P.materialIndex=E.materialIndex,P.centroid.copy(E.centroid),a&&P.centroid.applyMatrix4(a),m.push(P)}for(v=0,x=f.length;v<x;v++){var P,T,C,E=f[v];w=E.vertexNormals,b=E.vertexColors;(P=E instanceof Ce?new Ce(E.a+l,E.b+l,E.c+l):new Ee(E.a+l,E.b+l,E.c+l,E.d+l)).normal.copy(E.normal),s&&P.normal.applyMatrix3(s).normalize();for(M=0,S=w.length;M<S;M++)T=w[M].clone(),s&&T.applyMatrix3(s).normalize(),P.vertexNormals.push(T);P.color.copy(E.color);for(M=0,S=b.length;M<S;M++)C=b[M],P.vertexColors.push(C.clone());P.materialIndex=E.materialIndex+r,P.centroid.copy(E.centroid),o&&P.centroid.applyMatrix4(o),m.push(P)}for(v=0,x=p.length;v<x;v++){var z=[];for(M=0,S=(D=p[v]).length;M<S;M++)z.push(new pe(D[M].x,D[M].y));y.push(z)}for(v=0,x=d.length;v<x;v++){var D=d[v];for(z=[],M=0,S=D.length;M<S;M++)z.push(new pe(D[M].x,D[M].y));y.push(z)}var L=new Se.Entity;return L.vertices=g,L.faces=m,L.uvs=y,L.material=i===Me?e.material:i,L},je.transformElement=function(e,t){var i,r,a=e.vertices,n=e.faces,o=e.uvs,s=[],l=[],h=[];e instanceof Se.Element&&(e.matrixAutoUpdate&&e.updateMatrix(),i=e.matrix,r=(new J).getNormalMatrix(i));for(var c=0,u=a.length;c<u;c++){var f=a[c].clone();i&&f.applyMatrix4(i),l.push(f)}for(c=0,u=n.length;c<u;c++){var p,d,m,g=n[c],y=g.vertexNormals,v=g.vertexColors;(p=g instanceof Ce?new Ce(g.a,g.b,g.c):new Ee(g.a,g.b,g.c,g.d)).normal.copy(g.normal),r&&p.normal.applyMatrix3(r).normalize();for(var x=0,A=y.length;x<A;x++)d=y[x].clone(),r&&d.applyMatrix3(r).normalize(),p.vertexNormals.push(d);p.color.copy(g.color);for(x=0,A=v.length;x<A;x++)m=v[x],p.vertexColors.push(m.clone());p.materialIndex=g.materialIndex,p.centroid.copy(g.centroid),i&&p.centroid.applyMatrix4(i),s.push(p)}for(c=0,u=o.length;c<u;c++){var _=o[c],w=[];for(x=0,A=_.length;x<A;x++)w.push(new pe(_[x].x,_[x].y));h.push(w)}if(t){var b=new Se.Entity(e.material);return b.vertices=l,b.faces=s,b.uvs=h,b.setPosition(0,0,0),b.setRotation(0,0,0),b.setScale(1,1,1),(M={}).vertices=l,M.faces=s,M.uvs=h,b.primitive=new Se.Primitive(M),b}e.vertices=l,e.faces=s,e.uvs=h,e.setPosition(0,0,0),e.setRotation(0,0,0),e.setScale(1,1,1);var M={};for(var c in M.vertices=l,M.faces=s,M.uvs=h,e.primitive=new Se.Primitive(M),i.elements)e._attachId+=i.elements[c];return e},je.mergeElements=function(e){var t,i,r,a,n,o,s=0,l=0,h=0;for(t=0;t<e.length;t++)s+=(r=e[t]).materialSize;var c=new Se.Entity(s),u={},f={},p=(new Q(0,0,0),[]),d=[],m=[],g=[],y=new Se.ArrayMaterial;for(t=0;t<e.length;t++){for((r=e[t]).matrixAutoUpdate&&r.updateWorldMatrix(),a=r.worldMatrix.clone(),n=(new J).getNormalMatrix(a),i=0;i<r.vertices.length;i++)o=r.vertices[i],p.push(o.clone().applyMatrix4(a));for(i=0;i<r.faces.length;i++){var v,x=r.faces[i];x.vertexNormals,x.vertexColors,(v=x instanceof Ce?new Ce(x.a+l,x.b+l,x.c+l):new Ee(x.a+l,x.b+l,x.c+l,x.d+l)).normal.copy(x.normal),n&&v.normal.applyMatrix3(n).normalize(),v.materialIndex=x.materialIndex+h,v.centroid.copy(x.centroid),a&&v.centroid.applyMatrix4(a),d.push(v)}for(i=0,len=r.uvs.length;i<len;i++){for(var A=r.uvs[i],_=[],w=0,b=A.length;w<b;w++)_.push(new pe(A[w].x,A[w].y));m.push(_)}if(r.uv2s&&0<r.uv2s.length)for(i=0,len=r.uv2s.length;i<len;i++){var M=r.uv2s[i],S=[];for(w=0,b=M.length;w<b;w++)S.push(new pe(M[w].x,M[w].y));g.push(S)}for(var P in y.materials=y.materials.concat(r.material.materials),l+=r.vertices.length,h+=r.materialSize,r.styleMap){var T=u[P];null==T&&(T=[]);var C=r.styleMap[P],E=!0;if(je.isArray(C))for(w=0;w<C.length;w++)T.push(C[t]),0<w&&C[w]!=C[w-1]&&(E=!1);else for(w=0;w<r.materialSize;w++)T.push(C);1!=f[P]&&null!=f[P]||(f[P]=E),u[P]=T}}for(var P in f)1==f[P]&&(u[P]=u[P][0]);return c.styleMap=u,c.material=y,c.vertices=p,c.faces=d,c.setUvs(m),c.uv2s=g,c.setUpdateFlags(!0),c},je.mergeBufferNodes=function(e){if(1===e.length)return e[0];var t=new mono.BufferNode;return t.boundingBox=new mono.BoundingBox,(t._bufferNodes=e).forEach(function(e){e.matrix=t.matrix,e.worldMatrix=t.worldMatrix,e.boundingBox&&t.boundingBox.union(e.boundingBox)}),t},je.mergeElement=function(e,t,i){var r,a,n,o,s=e.vertices.length,l=(e.uvs.length,e.vertices),h=t.vertices,c=e.faces,u=t.faces,f=e.uvs,p=t.uvs,d=[],m=[],g=[];i===Me&&(i=0),e instanceof Se.Element&&(e.matrixAutoUpdate&&e.updateMatrix(),r=e.matrix,a=(new J).getNormalMatrix(r)),t instanceof Se.Element&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,o=(new J).getNormalMatrix(n));for(var y=0,v=l.length;y<v;y++)A=(x=l[y]).clone(),r&&A.applyMatrix4(r),m.push(A);for(y=0,v=h.length;y<v;y++){var x=h[y],A=x.clone();n&&A.applyMatrix4(n),m.push(A)}for(y=0,v=c.length;y<v;y++){var _=(C=c[y]).vertexNormals,w=C.vertexColors;(S=C instanceof Ce?new Ce(C.a,C.b,C.c):new Ee(C.a,C.b,C.c,C.d)).normal.copy(C.normal),a&&S.normal.applyMatrix3(a).normalize();for(var b=0,M=_.length;b<M;b++)P=_[b].clone(),a&&P.applyMatrix3(a).normalize(),S.vertexNormals.push(P);S.color.copy(C.color);for(b=0,M=w.length;b<M;b++)T=w[b],S.vertexColors.push(T.clone());S.materialIndex=C.materialIndex,S.centroid.copy(C.centroid),r&&S.centroid.applyMatrix4(r),d.push(S)}for(y=0,v=u.length;y<v;y++){var S,P,T,C=u[y];_=C.vertexNormals,w=C.vertexColors;(S=C instanceof Ce?new Ce(C.a+s,C.b+s,C.c+s):new Ee(C.a+s,C.b+s,C.c+s,C.d+s)).normal.copy(C.normal),o&&S.normal.applyMatrix3(o).normalize();for(b=0,M=_.length;b<M;b++)P=_[b].clone(),o&&P.applyMatrix3(o).normalize(),S.vertexNormals.push(P);S.color.copy(C.color);for(b=0,M=w.length;b<M;b++)T=w[b],S.vertexColors.push(T.clone());S.materialIndex=C.materialIndex+i,S.centroid.copy(C.centroid),n&&S.centroid.applyMatrix4(n),d.push(S)}for(y=0,v=f.length;y<v;y++){var E=[];for(b=0,M=(z=f[y]).length;b<M;b++)E.push(new pe(z[b].x,z[b].y));g.push(E)}for(y=0,v=p.length;y<v;y++){var z=p[y];for(E=[],b=0,M=z.length;b<M;b++)E.push(new pe(z[b].x,z[b].y));g.push(E)}return e.vertices=m,e.faces=d,e.uvs=g,e._position.set(0,0,0),e._rotation.set(0,0,0),e._scale.set(1,1,1),e},je.autoAdjustNetworkBounds=function(e,t,i,r,a,n){a=a||0,n=n||0,e.adjustBounds(t[i]-a,t[r]-n),!e._resizeFunction&&(e._resizeFunction=function(){e.adjustBounds(t[i]-a,t[r]-n,n,a)}),q.addEventListener("resize",e._resizeFunction,!0)},je.isEmptyObject=function(e){for(var t in e)return!1;return!0},je.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},je.isSame=function(e,t){if(e===t)return!0;if(null==e&&null!=t)return!1;if(null!=e&&null==t)return!1;if(typeof e!=typeof t)return!1;for(var i in e)if(e[i]!=t[i])return!1;for(var i in t)if(e[i]!=t[i])return!1;return!0},je.toString=function(e){if(e){var t="";for(var i in e)t+=i+":"+e[i];return t}},je.validateLicense=function(e){nt=e,yt()},je.getLicense=function(){return nt},je.getObjectCount=function(e){if(!e)return 0;var t=0;for(var i in e)t++;return t},je.isNaN=function(e){return""===e||null===e||isNaN(e)},je.getTransformVertices=function(e,t,i){var r;if(null==i&&(i=[]),e instanceof Se.Node||e instanceof Se.Billboard){for(a=0;a<e.vertices.length;a++)r=e.vertices[a].clone(),e instanceof Se.Billboard?(r.x*=e.rotation3d.x,r.y*=e.rotation3d.y,r.add(e.getPosition())):r.applyMatrix4(e.worldMatrix),i.push(r);for(var a=0;a<(e._childList?e._childList.size():0);a++){var n=e._childList.get(a);je.getTransformVertices(n,t,i)}}return i},je.getBoundingBox=function(e,t){var i,r,a;if(null==e)return null;i=e instanceof xe?e._as:je.isArray(e)?e:[e];var n=[];for(r=0;r<i.length;r++)a=i[r],je.getTransformVertices(a,t,n);var o=new Se.BoundingBox;return o.setFromPoints(n),o},je.mergeWrapMap=function(e){if(e instanceof Le&&!e.getWrapMap()){for(var t,i=[],r=(e.getMaterialMapping(),e.material.materials),a=0;a<r.length;a++)(t=r[a]).map&&-1==i.indexOf(t.map._image)&&i.push(t.map._image);e.setWrapMap(!0)}},je.setWrapMap=function(r,a,n,o){je.loadImages(a,function(e){var t=mono.Utils.createWrapMapFromImages(e,n,o);for(t.__uniqueCode="",i=0;i<a.length;i++)t.__uniqueCode+=a[i].src;for(var i in n)t.__uniqueCode+=i+":"+n[i];if(je.isArray(r))for(i=0;i<r.length;i++)r[i].setStyle("m.texture.image",t),r[i].setClient("_originalImage",a),r[i].setClient("_wrapMapping",n);else r.setStyle("m.texture.image",t),r.setClient("_wrapMapping",n)})},je.loadImages=function(t,i){function r(){for(var e=0;e<t.length;e++)if(!t[e].loaded)return;i(t)}if(null!=t&&0!=t.length&&null!=i)for(var e=0;e<t.length;e++){var a=t[e];"string"==typeof a&&(t[e]=new Image,t[e].crossOrigin="",t[e].src=a),function(e){e.onload=function(){e.loaded=!0,r(),e.onload=null}}(a=t[e])}},je.createWrapMapFromImages=function(e,t,i,r,a){if(null==e||0==e.length)return null;if("six-each"==(i=(i||"six-each").toLowerCase())||"front-other"==i||"back-other"==i||"left-other"==i||"right-other"==i||"top-other"==i||"bottom-other"==i){null==t&&(t={0:"bottom",1:"top",2:"back",3:"left",4:"front",5:"right"});var n=document.createElement("canvas"),o=n.getContext("2d"),s=0,l=0;if("six-each"==i){var h={bottom:[0,0],top:[1/3,0],back:[2/3,0],left:[0,.5],front:[1/3,.5],right:[2/3,.5]};if(null==r||null==a)for(p=0;p<e.length;p++)s=Math.max(e[p].width,s),l=Math.max(e[p].height,l);1024<(s*=3)&&(s=1024),1024<(l*=2)&&(l=1024);var c,u=["front","back","right","left","top","bottom"],f=[];for(var p in t)"other"!==(g=t[p])?(f.push(g),u.splice(u.indexOf(g),1)):c=p;for(null!=c&&(t[c]=u),r=r||s,a=a||l,n.setAttribute("width",r),n.setAttribute("height",a),Math.min(e.length,6),p=0;p<6;p++)if(A=t[p]){var d;d=je.isArray(A)?A:-1!=A.indexOf(",")?A.split(","):[A];for(var m=0;m<d.length;m++){var g=d[m],y=h[g][0],v=h[g][1];o.drawImage(e[p],y*r,v*a,r/3,a/2)}}}else{var x=i.split("-")[0];if(null==r||null==a)for(p=0;p<e.length;p++)s+=e[p].width,l=Math.max(e[p].height,l);for(r=r||s,a=a||l,n.setAttribute("width",r),n.setAttribute("height",a),t[x],Math.min(e.length,2),p=0;p<2;p++){var A=t[p];A&&(A==x?o.drawImage(e[p],0,0,r/2,a):o.drawImage(e[p],r/2,0,r/2,a))}}return n}},je.getVectorAngles=function(e,t){var i=e;t&&(i=t.clone().sub(e)),i=i.normalize();var r=Math.asin(i.y)*He;return[Math.atan2(i.x,i.z)*He,r]},je.getPixelFromImage=function(e,t,i){var r;return re.isCanvas(e)?r=e:((r=document.createElement("canvas")).width=e.width,r.height=e.height,r.getContext("2d").drawImage(e,0,0,e.width,e.height)),t-=Math.floor(t),i=1-(i-=Math.floor(i)),r.getContext("2d").getImageData(e.width*t,e.height*i,1,1).data},je.nextPowerOfTwo=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},je.createTextBillboard=function(e,t){var i=new mono.Billboard;e=e||"",t=t||{};var r=je.createTextImage(e,t);return i.setStyle("m.texture.image",r),i.setScale(r.width,r.height,1),i},je.createTextImage=function(e,t){e=e||"";var i=t.font,r=t.color,a=t.background,n=t.powerOfTwo,o=t.canvas,s=t.drawFunction;o=o||document.createElement("canvas"),i=i||'20px "Dialog"',r=r||"white",a=a===Me?"#0F90C4":a,n=n||!1;var l,h=t.textAlign||"center";l=je.isArray(e)?e:e.split("\n");var c=mono.Utils.getMaxTextSize(l,i),u=t.ratio||c.width/c.height,f=o.realSize={width:c.width,height:c.height};n&&(c.width=mono.Utils.nextPowerOfTwo(c.width),c.height=mono.Utils.nextPowerOfTwo(c.height));var p=o.drawRect={width:u<f.width/f.height?f.width:f.height*u,height:u<f.width/f.height?f.width/u:f.height};Number.isNaN(p.width)&&console.log("debug -- b",f.width,f.height,u),p.width=Math.min(p.width,c.width),p.height=Math.min(p.height,c.height),o.width=c.width,o.height=c.height,Number.isNaN(p.width)&&console.log("debug -- a");var d=o.getContext("2d");if(a&&(d.fillStyle=a),s)s(d,o.width,o.height);else{a&&d.fillRect(0,0,o.width,o.height),d.font=i,d.fillStyle=r,d.strokeStyle="gray",d.textBaseline="middle",d.textAlign=h;for(var m,g=l.length,y=f.height/g,v=0;v<g;v++){je.isArray(r)&&(m=r[v])&&(d.fillStyle=m);var x=mono.Utils.getTextSize(i,l[v]),A=(x.width,x.height,o.height,(p.width-f.width)/2);"center"===h?A=p.width/2:"right"===h&&(A=p.width);var _=(p.height-f.height)/2+y/2+v*y+(o.height-p.height);d.strokeText(l[v],A,_),d.fillText(l[v],A,_)}}return o},je.createTextImage2=function(e,t){e=e||"",e=String(e);var i=t.font,r=t.color,a=t.background,n=t.powerOfTwo,o=t.canvas,s=t.drawFunction;o=o||document.createElement("canvas"),i=i||'20px "Dialog"',r=r||"white",a=a===Me?"#0F90C4":a,n=n||!1,t.align;var l=t.sizeScale||1,h=je.getMaxTextSize(e.split("\n"),i);o.realSize={width:h.width,height:h.height},h.width*=l,h.height*=l,n&&(h.width=je.nextPowerOfTwo(h.width),h.height=je.nextPowerOfTwo(h.height)),o.width=h.width,o.height=h.height;var c=o.getContext("2d");return a&&(c.fillStyle=a),s?s(c,o.width,o.height):(a&&c.fillRect(0,0,o.width,o.height),function(e,t,i,r,a,n){var o=a.realSize?a.realSize:a;t=t||"",t=String(t),e.font=i,e.fillStyle=r,e.strokeStyle="gray",e.textBaseline="middle",e.textAlign="center";for(var s=t.split("\n"),l=s.length,h=o.height/l,c=(a.height-o.height)/2,u=0;u<l;u++){var f=ce.getTextSize(i,s[u]).width,p=(a.height,f/2);"right"==n?(p=a.width-f/2,e.textAlign="center"):"left"==n?(p=f/2,e.textAlign="center",e.textBaseline="middle"):"center"==n&&(p=a.width/2),e.strokeText(s[u],p,h/2+u*h+c),e.fillText(s[u],p,h/2+u*h+c)}}(c,e,i,r,o,"center")),o},je.getMaxTextSize=function(e,t){if(e&&0<e.length){for(var i=e.length,r=ce.getTextSize(t,e[0]),a=r.width,n=r.height*i,o=0;o<i;o++){var s=ce.getTextSize(t,e[o]).width;a<s&&(a=s)}return{width:a,height:n}}return null},je.getTextSize=function(e,t){return ce.getTextSize(e,t)},je.playCameraAnimation=function(o,e,t,i,r){if(je.activeAnimates&&je.activeAnimates instanceof Array)for(var a=0;a<je.activeAnimates.length;a++)je.activeAnimates[a].stop();if(e=e||o.p(),t=t||o.getTarget(),e.equals(o.getPosition())&&t.equals(o.target))return r&&r(),null;var n=o.getPosition().sub(o.getTarget()),s=(new mono.Vec3).addVectors(n,t);i=i||3e3;var l=mono.Utils.getVectorAngles(t,s),h=mono.Utils.getVectorAngles(t,e),c=h[0]-l[0];180<c?c-=360:c<-180&&(c+=360);var u=h[1]-l[1];180<u?u-=360:u<-180&&(u+=360);var f=o.getTarget(),p=t,d=o.getDistance(),m=(new mono.Vec3).subVectors(e,t).length(),g=l[0],y=l[1],v=h[0],x=h[1],A=new mono.Animate({from:0,to:1,repeat:1,dur:i/3,onPlay:function(){this.isPlaying=!0},onUpdate:function(e){var t=v,i=x<y?y+u*e:x,r=p,a=d+(m-d)*e,n=new mono.Vec3;n.x=r.x+a*Math.sin(t*qe)*Math.cos(i*qe),n.z=r.z+a*Math.cos(t*qe)*Math.cos(i*qe),n.y=r.y+a*Math.sin(i*qe),o.p(n),o.lookAt(r)},onDone:function(){r&&r()},onStop:function(){}}),_=new mono.Animate({from:0,to:1,repeat:1,dur:i/3,onPlay:function(){this.isPlaying=!0},onUpdate:function(e){var t=g+c*e,i=x<y?y:x,r=p,a=m<d?d:m;y<=x&&(a=m);var n=new mono.Vec3;n.x=r.x+a*Math.sin(t*qe)*Math.cos(i*qe),n.z=r.z+a*Math.cos(t*qe)*Math.cos(i*qe),n.y=r.y+a*Math.sin(i*qe),o.p(n),o.lookAt(r)},onDone:function(){d=o.getDistance(),f=o.getTarget()},onStop:function(){this.isPlaying&&(delete this.isPlaying,y<=x?r&&r():A.play())}}),w=new mono.Animate({from:0,to:1,dur:i/3,onPlay:function(){this.isPlaying=!0},onUpdate:function(e){var t=g,i=x<y?y:y+u*e,r=(new mono.Vec3).lerpVectors(f,p,e),a=d+(m-d)*e;m<d&&(0!=c||x<y)&&(a=d);var n=new mono.Vec3;n.x=r.x+a*Math.sin(t*qe)*Math.cos(i*qe),n.z=r.z+a*Math.cos(t*qe)*Math.cos(i*qe),n.y=r.y+a*Math.sin(i*qe),o.p(n),o.lookAt(r)},onDone:function(){},onStop:function(){this.isPlaying&&(delete this.isPlaying,0==c&&y<=x?r&&r():0!=c?_.play():A.play())}});return 0==c&&y<=x?(w.dur=i,w.finish=i):0==c?(A.dur=2*i/3,A.finish=2*i/3):x<y&&(_.dur=2*i/3,_.finish=2*i/3),w.play(),je.activeAnimates=[w,_,A],[w,_,A]},je.stopAnimate=function(e,t){U(e,t)},je.stopAllAnimates=function(e){var i;null==(i=e)&&(i=!0),Object.keys(Jt).forEach(function(e){var t=Jt[e];i&&O(t,t.to),t.onStop&&t.onStop()}),Jt={}},Se.Utils=je,Se.NurbsUtils={findSpan:function(e,t,i){var r=i.length-e-1;if(t>=i[r])return r-1;if(t<=i[e])return e;for(var a=e,n=r,o=Math.floor((a+n)/2);t<i[o]||t>=i[o+1];)t<i[o]?n=o:a=o,o=Math.floor((a+n)/2);return o},calcBasisFunctions:function(e,t,i,r){for(var a=[],n=[],o=[],s=a[0]=1;s<=i;++s){n[s]=t-r[e+1-s],o[s]=r[e+s]-t;for(var l=0,h=0;h<s;++h){var c=o[h+1],u=n[s-h],f=a[h]/(c+u);a[h]=l+c*f,l=u*f}a[s]=l}return a},calcBSplinePoint:function(e,t,i,r){for(var a=this.findSpan(e,r,t),n=this.calcBasisFunctions(a,r,e,t),o=new Se.Vec4(0,0,0,0),s=0;s<=e;++s){var l=i[a-e+s],h=n[s],c=l.w*h;o.x+=l.x*c,o.y+=l.y*c,o.z+=l.z*c,o.w+=l.w*h}return o},calcBasisFunctionDerivatives:function(e,t,i,r,a){for(var n=[],o=0;o<=i;++o)n[o]=0;var s=[];for(o=0;o<=r;++o)s[o]=n.slice(0);var l=[];for(o=0;o<=i;++o)l[o]=n.slice(0);l[0][0]=1;for(var h=n.slice(0),c=n.slice(0),u=1;u<=i;++u){h[u]=t-a[e+1-u],c[u]=a[e+u]-t;for(var f=0,p=0;p<u;++p){var d=c[p+1],m=h[u-p];l[u][p]=d+m;var g=l[p][u-1]/l[u][p];l[p][u]=f+d*g,f=m*g}l[u][u]=f}for(u=0;u<=i;++u)s[0][u]=l[u][i];for(p=0;p<=i;++p){var y=0,v=1,x=[];for(o=0;o<=i;++o)x[o]=n.slice(0);for(M=x[0][0]=1;M<=r;++M){var A=0,_=p-M,w=i-M;M<=p&&(x[v][0]=x[y][0]/l[w+1][_],A=x[v][0]*l[_][w]);var b=p-1<=w?M-1:i-p;for(u=-1<=_?1:-_;u<=b;++u)x[v][u]=(x[y][u]-x[y][u-1])/l[w+1][_+u],A+=x[v][u]*l[_+u][w];p<=w&&(x[v][M]=-x[y][M-1]/l[w+1][p],A+=x[v][M]*l[p][w]),s[M][p]=A,u=y,y=v,v=u}}p=i;for(var M=1;M<=r;++M){for(u=0;u<=i;++u)s[M][u]*=p;p*=i-M}return s},calcBSplineDerivatives:function(e,t,i,r,a){for(var n=a<e?a:e,o=[],s=this.findSpan(e,r,t),l=this.calcBasisFunctionDerivatives(s,r,e,n,t),h=[],c=0;c<i.length;++c){var u=(f=i[c].clone()).w;f.x*=u,f.y*=u,f.z*=u,h[c]=f}for(d=0;d<=n;++d){for(var f=h[s-e].clone().multiplyScalar(l[d][0]),p=1;p<=e;++p)f.add(h[s-e+p].clone().multiplyScalar(l[d][p]));o[d]=f}for(var d=n+1;d<=a+1;++d)o[d]=new Se.Vec4(0,0,0);return o},calcKoverI:function(e,t){for(var i=1,r=2;r<=e;++r)i*=r;var a=1;for(r=2;r<=t;++r)a*=r;for(r=2;r<=e-t;++r)a*=r;return i/a},calcRationalCurveDerivatives:function(e){for(var t=e.length,i=[],r=[],a=0;a<t;++a){var n=e[a];i[a]=new Se.Vec3(n.x,n.y,n.z),r[a]=n.w}for(var o=[],s=0;s<t;++s){var l=i[s].clone();for(a=1;a<=s;++a)l.sub(o[s-a].clone().multiplyScalar(this.calcKoverI(s,a)*r[a]));o[s]=l.divideScalar(r[0])}return o},calcNURBSDerivatives:function(e,t,i,r,a){var n=this.calcBSplineDerivatives(e,t,i,r,a);return this.calcRationalCurveDerivatives(n)},calcSurfacePoint:function(e,t,i,r,a,n,o){for(var s=this.findSpan(e,n,i),l=this.findSpan(t,o,r),h=this.calcBasisFunctions(s,n,e,i),c=this.calcBasisFunctions(l,o,t,r),u=[],f=0;f<=t;++f){u[f]=new Se.Vec4(0,0,0,0);for(var p=0;p<=e;++p){var d=a[s-e+p][l-t+f].clone(),m=d.w;d.x*=m,d.y*=m,d.z*=m,u[f].add(d.multiplyScalar(h[p]))}}var g=new Se.Vec4(0,0,0,0);for(f=0;f<=t;++f)g.add(u[f].multiplyScalar(c[f]));return g.divideScalar(g.w),new Se.Vec3(g.x,g.y,g.z)}},Se.GLParameters=function(e,t,i){this.material=e,this.network=t,this.precision=t._precision,this.map=!!e.map,this.mapLoaded=!0,this.envMap=!!e.envMap,this.lightMap=!!e.lightMap,this.bumpMap=!!e.bumpMap&&"phong"===e._type,this.normalMap=!!e.normalMap&&"phong"===e._type,this.specularMap=!!e.specularMap,this.vertexColors=i instanceof mono.BufferNode?i.attributes.color:e.vertexColors,this.wireframe=e.wireframe,this.clipPlane=e.clipPlane,this.fog=t._fog,this.useFog=e.fog,this.fogExp=this.fog instanceof Se.FogExp2,this.sizeAttenuation=e.sizeAttenuation,this.skinning=e.skinning,this.maxBones=e.maxBones,this.useVertexTexture=t._supportsBoneTextures&&i&&i.useVertexTexture,this.boneTextureWidth=i&&i.boneTextureWidth,this.boneTextureHeight=i&&i.boneTextureHeight,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.maxMorphTargets=4,this.maxMorphNormals=4,this.maxDirLights=t.maxLightCount.directional,this.maxPointLights=t.maxLightCount.point,this.maxSpotLights=t.maxLightCount.spot,this.maxHemiLights=t.maxLightCount.hemi,this.maxShadows=t.maxShadows,this.maxPointShadows=t.maxPointShadows,this.shadowMapEnable=t._shadowMapEnable&&i.receiveShadow&&0<this.maxShadows,this.pointShadowMapEnable=t._shadowMapEnable&&i.receiveShadow&&0<this.maxPointShadows,this.shadowMapType=t.shadowMapType,this.shadowMapDebug=t.shadowMapDebug,this.shadowMapCascade=t.shadowMapCascade,this.alphaTest=e.alphaTest,this.metal=e.metal,this.perPixel=e.perPixel,this.wrapAround=e.wrapAround,this.doubleSided=e.side===Se.DoubleSide&&!le.isIE,this.flipSided=e.side===Se.BackSide,this.useSSAO=t.isSSAOEnable()&&t.pm.isLightMaterial(e),this.gammaInput=t.gammaInput,this.gammaOutput=t.gammaOutput,this.physicallyBasedShading=t.physicallyBasedShading,this.supportsVertexTextures=!1,this.shadowMapTypeDefine="SHADOWMAP_TYPE_BASIC",this.shadowMapType===Se.PCFShadowMap?this.shadowMapTypeDefine="SHADOWMAP_TYPE_PCF":this.shadowMapType===Se.PCFSoftShadowMap&&(this.shadowMapTypeDefine="SHADOWMAP_TYPE_PCF_SOFT"),this.maxGrandient=je.getObjectCount(e.gradient)},Se.GLParameters.prototype.getShaders=function(e){e=e===Me?"":e;var t=this;return[["precision "+t.precision+" float;",e,this.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.gammaInput?"#define GAMMA_INPUT":"",t.gammaOutput?"#define GAMMA_OUTPUT":"",t.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+t.maxDirLights,"#define MAX_POINT_LIGHTS "+t.maxPointLights,"#define MAX_SPOT_LIGHTS "+t.maxSpotLights,"#define MAX_HEMI_LIGHTS "+t.maxHemiLights,"#define MAX_SHADOWS "+t.maxShadows,"#define MAX_POINT_SHADOWS "+t.maxPointShadows,"#define MAX_BONES "+t.maxBones,t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.lightMap?"#define USE_LIGHTMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.vertexColors?"#define USE_COLOR":"",0<t.maxGrandient?"#define MAX_GRADIENT "+t.maxGrandient:"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.boneTextureWidth?"#define N_BONE_PIXEL_X "+t.boneTextureWidth.toFixed(1):"",t.boneTextureHeight?"#define N_BONE_PIXEL_Y "+t.boneTextureHeight.toFixed(1):"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals?"#define USE_MORPHNORMALS":"",t.perPixel?"#define PHONG_PER_PIXEL":"",t.wrapAround?"#define WRAP_AROUND":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnable?"#define USE_SHADOWMAP":"",t.shadowMapEnable||t.pointShadowMapEnable?"#define "+t.shadowMapTypeDefine:"",t.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",t.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",t.pointShadowMapEnable?"#define USE_POINT_SHADOWMAP":"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),["precision "+this.precision+" float;",t.bumpMap||t.normalMap?"#extension GL_OES_standard_derivatives : enable":"",e,"#define MAX_DIR_LIGHTS "+t.maxDirLights,"#define MAX_POINT_LIGHTS "+t.maxPointLights,"#define MAX_SPOT_LIGHTS "+t.maxSpotLights,"#define MAX_HEMI_LIGHTS "+t.maxHemiLights,"#define MAX_SHADOWS "+t.maxShadows,"#define MAX_POINT_SHADOWS "+t.maxPointShadows,t.useSSAO?"#define USE_SSAO":"",t.wireframe?"#define USE_WIREFRAME":"",t.clipPlane?"#define USE_CLIP_PLANE":"",t.alphaTest?"#define ALPHATEST "+t.alphaTest:"",this.gammaInput?"#define GAMMA_INPUT":"",this.gammaOutput?"#define GAMMA_OUTPUT":"",this.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.lightMap?"#define USE_LIGHTMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",0<t.maxGrandient?"#define MAX_GRADIENT "+t.maxGrandient:"",t.vertexColors?"#define USE_COLOR":"",t.metal?"#define METAL":"",t.perPixel?"#define PHONG_PER_PIXEL":"",t.wrapAround?"#define WRAP_AROUND":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnable?"#define USE_SHADOWMAP":"",t.shadowMapEnable||t.pointShadowMapEnable?"#define "+t.shadowMapTypeDefine:"",t.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",t.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",t.pointShadowMapEnable?"#define USE_POINT_SHADOWMAP":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","#ifdef USE_CLIP_PLANE","uniform vec4 clipPlane;","#endif",""].join("\n")]};var Ze={setDepthTest:function(e,t){var i=t._gl;t._oldDepthTest!==e&&(e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),t._oldDepthTest=e)},setSmapleAlphaToCoverage:function(e,t){var i=t._gl;t._oldSmapleAlphaToCoverage!==e&&(e?i.enable(i.SAMPLE_ALPHA_TO_COVERAGE):i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),t._oldSmapleAlphaToCoverage=e)},setDepthWrite:function(e,t){var i=t._gl;t._oldDepthWrite!==e&&(i.depthMask(e),t._oldDepthWrite=e)},clear:function(e,t,i,r){var a=r._gl,n=0;(e===Me||e)&&(n|=a.COLOR_BUFFER_BIT),(t===Me||t)&&(n|=a.DEPTH_BUFFER_BIT),(i===Me||i)&&(n|=a.STENCIL_BUFFER_BIT),r._gl.clear(n)},setPolygonOffset:function(e,t,i,r){var a=r._gl;r._oldPolygonOffset!==e&&(e?a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL),r._oldPolygonOffset=e),!e||r._oldPolygonOffsetFactor===t&&r._oldPolygonOffsetUnits===i||(a.polygonOffset(t,i),r._oldPolygonOffsetFactor=t,r._oldPolygonOffsetUnits=i)},setBlending:function(e,t,i,r,a){var n=a._gl;e!==a._oldBlending&&(e===Se.NoBlending?n.disable(n.BLEND):e===Se.AdditiveBlending?(n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE)):e===Se.SubtractiveBlending?(n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ZERO,n.ONE_MINUS_SRC_COLOR)):e===Se.MultiplyBlending?(n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ZERO,n.SRC_COLOR)):e===Se.CustomBlending?n.enable(n.BLEND):(n.enable(n.BLEND),n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)),a._oldBlending=e),e===Se.CustomBlending?(t!==this._oldBlendEquation&&(n.blendEquation(je.paramToGL(t)),a._oldBlendEquation=t),i===_oldBlendSrc&&r===_oldBlendDst||(n.blendFunc(je.paramToGL(i),je.paramToGL(r)),a._oldBlendSrc=i,a._oldBlendDst=r)):(a._oldBlendEquation=null,a._oldBlendSrc=null,a._oldBlendDst=null)},enableStencil:function(e,t){e.enable(e.STENCIL_TEST),e.stencilFunc(e.ALWAYS,1,1),e.stencilOp(e.KEEP,e.REPLACE,e.REPLACE),t._setStencilMask(1),e.clearStencil(0),e.clear(e.STENCIL_BUFFER_BIT)},stencilTest:function(e,t){e.enable(e.STENCIL_TEST),e.stencilFunc(e.EQUAL,0,1),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),t._setStencilMask(0)},disableStencil:function(e){e.disable(e.STENCIL_TEST)},r:function(e,t,i,r,a,n,o){e._AK47(t,i,r,a,n,o)},g:function(e,t,i,r,a,n){e.renderGroup(t,i,r,a,n)}};Se.GLUtils=Ze;var Qe=Se.GPU=function(e){var t=e._gl,i=e.webglVersion;this.network=e,this._glExtensionTextureFloat=1<i||t.getExtension("OES_texture_float"),this._glExtensionStandardDerivatives=1<i||t.getExtension("OES_standard_derivatives"),this._glExtensionTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this._glExtensionCompressedTextureS3TC=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._glExtensionTextureFloat||console.log("Float textures not supported."),this._glExtensionStandardDerivatives||console.log("Standard derivatives not supported."),this._glExtensionTextureFilterAnisotropic||console.log("Anisotropic texture filtering not supported."),this._glExtensionCompressedTextureS3TC||console.log("S3TC compressed textures not supported."),this._maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this._maxVertexTextures=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this._maxCubemapSize=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),this._maxAnisotropy=this._glExtensionTextureFilterAnisotropic?t.getParameter(this._glExtensionTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._supportsVertexTextures=0<this._maxVertexTextures,this._supportsBoneTextures=this._supportsVertexTextures&&this._glExtensionTextureFloat,this._compressedTextureFormats=this._glExtensionCompressedTextureS3TC?t.getParameter(t.COMPRESSED_TEXTURE_FORMATS):[],this._vertexShaderPrecisionHighpFloat=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT),this._vertexShaderPrecisionMediumpFloat=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT),this._vertexShaderPrecisionLowpFloat=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.LOW_FLOAT),this._fragmentShaderPrecisionHighpFloat=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT),this._fragmentShaderPrecisionMediumpFloat=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT),this._fragmentShaderPrecisionLowpFloat=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.LOW_FLOAT),this._vertexShaderPrecisionHighpInt=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_INT),this._vertexShaderPrecisionMediumpInt=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_INT),this._vertexShaderPrecisionLowpInt=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.LOW_INT),this._fragmentShaderPrecisionHighpInt=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_INT),this._fragmentShaderPrecisionMediumpInt=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_INT),this._fragmentShaderPrecisionLowpInt=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.LOW_INT);var r=this._vertexShaderPrecisionHighpFloat&&0<this._vertexShaderPrecisionHighpFloat.precision&&this._fragmentShaderPrecisionHighpFloat&&0<this._fragmentShaderPrecisionHighpFloat.precision,a=this._vertexShaderPrecisionMediumpFloat&&0<this._vertexShaderPrecisionMediumpFloat.precision&&this._fragmentShaderPrecisionMediumpFloat&&0<this._fragmentShaderPrecisionMediumpFloat.precision,n=e._precision;"highp"!==n||r||(a?(n="mediump",console.log("highp not supported, using mediump")):(n="lowp",console.log("highp and mediump not supported, using lowp"))),"mediump"!==n||a||(n="lowp",console.log("mediump not supported, using lowp")),e._precision=n,this.initElementIndexUInt()};Qe.prototype.initElementIndexUInt=function(){var e=this.network;if(1<e.webglVersion)this.elementIndexUIntSupported=!0;else{var t=e._gl.getExtension("OES_element_index_uint");this.elementIndexUIntSupported=!!t,this.elementIndexUIntSupported||console.log("Element Index UInt not supported")}},Qe.prototype.initVertextArrayObject=function(){var e=this.network;if(!1!==e.parameters.enableVertexArrayObject)if(1<e.webglVersion)this.vertextArraySupported=!0;else{var t=e._gl,i=t.getExtension("OES_vertex_array_object");i?(t.createVertexArray=function(){return i.createVertexArrayOES()},t.bindVertexArray=function(e){return i.bindVertexArrayOES(e)},t.deleteVertexArray=function(e){return i.deleteVertexArrayOES(e)},this.vertextArraySupported=!0):console.log("Vertex Array not supported")}},Qe.prototype.initInstancedArray=function(){var e=this.network;if(1<e.webglVersion)this.instancedArraySupported=!0;else{var t=e._gl,n=t.getExtension("ANGLE_instanced_arrays");n?(t.drawArraysInstanced=function(e,t,i,r){return n.drawArraysInstancedANGLE(e,t,i,r)},t.drawElementsInstanced=function(e,t,i,r,a){return n.drawElementsInstancedANGLE(e,t,i,r,a)},t.vertexAttribDivisor=function(e,t){return n.vertexAttribDivisorANGLE(e,t)}):console.log("Instanced Array not supported")}};var Ke=mono.VertexArrayObject=function(e,t){this.network=e,this.tempGroup=t,this.create()};Ke.prototype.create=function(){if(this.network.gpu.vertextArraySupported){(this.tempGroup._vao=this).dirty=!0;var e=this.network._gl;return this.vao=e.createVertexArray()}},Ke.prototype.destory=function(){return this.tempGroup._vao=null,!!this.vao&&gl.deleteVertexArray(this.vao)},Ke.prototype.bind=function(e,t){return!!this.vao&&this.network._gl.bindVertexArray(this.vao)},Ke.prototype.unbind=function(){return!!this.vao&&this.network._gl.bindVertexArray(null)},Se.Program=function(e,t,i,r){this.entity=e,this.group=t,this.material=i,this.network=r},Se.Program.prototype.setEntity=function(){this.entity},Se.Program.prototype.buildGLProgram=function(){},Se.Uniform=function(e,t,i){this.id=e,this.type=t,this.value=i,this.location=Me},Se.Uniform.prototype={constructor:Se.Uniform,setValue:function(e){this.value=e},getUniformLocation:function(e,t){return e.getUniformLocation(this.id)}},Se.Uniform.loadUniform=function(e,t,r){if(type=t.type,value=t.value,"i"===type)r.uniform1i(e,value);else if("f"===type)r.uniform1f(e,value);else if("v2"===type)r.uniform2f(e,value.x,value.y);else if("v3"===type)r.uniform3f(e,value.x,value.y,value.z);else if("v4"===type)r.uniform4f(e,value.x,value.y,value.z,value.w);else if("c"===type)r.uniform3f(e,value.r,value.g,value.b);else if("iv1"===type)r.uniform1iv(e,value);else if("iv"===type)r.uniform3iv(e,value);else if("fv1"===type)r.uniform1fv(e,value);else if("fv"===type)r.uniform3fv(e,value);else if("v2v"===type){for(t._array===Me&&(t._array=new Float32Array(2*value.length)),i=0,il=value.length;i<il;i++)offset=2*i,t._array[offset]=value[i].x,t._array[offset+1]=value[i].y;r.uniform2fv(e,t._array)}else if("v3v"===type){for(t._array===Me&&(t._array=new Float32Array(3*value.length)),i=0,il=value.length;i<il;i++)offset=3*i,t._array[offset]=value[i].x,t._array[offset+1]=value[i].y,t._array[offset+2]=value[i].z;r.uniform3fv(e,t._array)}else if("v4v"===type){for(t._array===Me&&(t._array=new Float32Array(4*value.length)),i=0,il=value.length;i<il;i++)offset=4*i,t._array[offset]=value[i].x,t._array[offset+1]=value[i].y,t._array[offset+2]=value[i].z,t._array[offset+3]=value[i].w;r.uniform4fv(e,t._array)}else if("m4"===type)t._array===Me&&(t._array=new Float32Array(16)),value.flattenToArray(t._array),r.uniformMatrix4fv(e,!1,t._array);else if("m4v"===type){for(t._array===Me&&(t._array=new Float32Array(16*value.length)),i=0,il=value.length;i<il;i++)value[i].flattenToArrayOffset(t._array,16*i);r.uniformMatrix4fv(e,!1,t._array)}else if("t"===type)texture=value,textureUnit=getTextureUnit(),r.uniform1i(e,textureUnit),texture&&(texture.image instanceof Array&&6===texture.image.length?setCubeTexture(texture,textureUnit):texture instanceof $CubeRenderTargetCube?setCubeTextureDynamic(texture,textureUnit):_this.setTexture(texture,textureUnit));else if("tv"===type){for(t._array===Me&&(t._array=[]),i=0,il=t.value.length;i<il;i++)t._array[i]=getTextureUnit();for(r.uniform1iv(e,t._array),i=0,il=t.value.length;i<il;i++)texture=t.value[i],textureUnit=t._array[i],texture&&_this.setTexture(texture,textureUnit)}},Se.Uniform.loadGeneralUniforms=function(e,t,i){var r,a,n;for(a=0,n=t.length;a<n;a++)e.uniforms[t[a][1]]&&(r=t[a][0],Se.Uniform.loadUniform(r,i))},Se.ProgramManager=function(e){this.id=Se.ProgramManagerId++,this.network=e,this.gl=this.network._gl,this.gpu=this.network.gpu,this.programs=[],this.currentProgram=null,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0},currentMaterialId:-1},this.textureCount=0,this._lightNeedsUpdate=!0,this._lights={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}},this.gammaInput=!1,this.textureCount=0,this.programMap={},this.textureMap={},this.textureUpdateFlags={},this.glTextureMap={},this.textureMaterialMap={},this.unLoadedImage={},this.materialMap={},this.materialUpdateFlags={},this.handleTextureChange=function(e){if("image"===e.property||"loaded"===e.property)t=e.source,this.changeTextureUpdateFlags(t,!0),delete this.unLoadedImage[t._image];else if("disposed"===e.property){var t=e.source;this.deallocateTexture(t),t.removePropertyChangeListener(this.handleTextureChange),delete this.textureUpdateFlags[t.id],delete this.textureMap[t.id]}je.getObjectCount(this.unLoadedImage)<=0&&this.network.dirtyNetwork()},this.handleMaterialChange=function(e){if("map"==e.property||e.property.endsWith("Map")||"needsUpdate"===e.property)t=e.source,this.materialUpdateFlags[t.id]=!0;else if("disposed"===e.property){var t=e.source;this.deallocateMaterial(t),t.removePropertyChangeListener(this.handleMaterialChange),delete this.materialUpdateFlags[t.id],delete this.materialMap[t.id],delete this.programMap[t.id]}je.getObjectCount(this.unLoadedImage)<=0&&this.network.dirtyNetwork()}},Se.ProgramManager.prototype.addMaterial=function(e){null==this.materialMap[e.id]&&(this.materialMap[e.id]=e).addPropertyChangeListener(this.handleMaterialChange,this)},Se.ProgramManager.prototype.dispose=function(){for(var e in this.materialMap)this.materialMap[e].removePropertyChangeListener(this.handleMaterialChange,this);for(var e in this.materialMap={},this.textureMap)this.textureMap[e].removePropertyChangeListener(this.handleTextureChange,this);this.textureMap={}},Se.ProgramManager.prototype.needsUpdateMaterial=function(e){return this.materialUpdateFlags[e.id]===Me||!0===this.materialUpdateFlags[e.id]||e.map instanceof $e||e.map instanceof et},Se.ProgramManager.prototype.changeMaterialUpdateFlags=function(e,t){this.materialUpdateFlags[e.id]=t},Se.ProgramManager.prototype.isLightMaterial=function(e){return e instanceof Se.LambertMaterial||e instanceof Se.PhongMaterial||e.lights||"lambert"===e._type||"phong"===e._type||"terrain"===e._type},Se.ProgramManager.prototype.changeAllMaterialUpdateFlags=function(e,t,i){for(var r in this.materialMap){var a=this.materialMap[r];(null==t||t.call(i,a))&&(this.materialUpdateFlags[a.id]=e)}},Se.ProgramManager.prototype.changeAllLightMaterialUpdateFlags=function(e){this.changeAllMaterialUpdateFlags(e,this.isLightMaterial,this)},Se.ProgramManager.prototype.addTexture=function(e){null!=e.id&&this.textureMap[e.id]===Me&&((this.textureMap[e.id]=e).addPropertyChangeListener(this.handleTextureChange,this),e._image.loaded||(this.unLoadedImage[e._image]=1))},Se.ProgramManager.prototype.needsUpdateTexture=function(e){return this.textureUpdateFlags[e.id]===Me||!0===this.textureUpdateFlags[e.id]},Se.ProgramManager.prototype.changeTextureUpdateFlags=function(e,t){for(var i in this.textureUpdateFlags[e.id]=t,this.materialMap){var r=this.materialMap[i];r.map!==e&&r.lightMap!==e&&r.envMap!==e&&r.normalMap!==e&&r.specularMap!==e||this.changeMaterialUpdateFlags(r,!0)}},Se.ProgramManager.prototype.buildProgram=function(e,t,i){i.shaderID||i.setupMaterialShader();var r,a,n,o=new Se.GLParameters(i,this.network,e),s=[];if(i.shaderID?s.push(i.shaderID):(s.push(i.vertexShader),s.push(i.fragmentShader)),i instanceof Se.ShaderMaterial);else for(wt in o)"material"!==wt&&"network"!==wt&&"node"!==wt&&"getShaders"!==wt&&(s.push(wt),s.push(o[wt]));for(n=s.join(),u=0,r=this.programs.length;u<r;u++)if(this.programs[u].code===n){for(h in i.program=this.programs[u].program,i.uniformsList=[],i.uniforms)i.uniformsList.push([i.uniforms[h],h]);return this.programs[u].usedTimes++,this.programs[u].program}a=this.gl.createProgram();var l,h,c,u,f=o.getShaders(),p=f[1],d=f[0];if(this.gl.attachShader(a,m("fragment",p+i.fragmentShader,this.gl)),this.gl.attachShader(a,m("vertex",d+i.vertexShader,this.gl)),this.gl.linkProgram(a),this.gl.getProgramParameter(a,this.gl.LINK_STATUS)||this.gl.isContextLost()||console.log("Could not initialise shader\nVALIDATE_STATUS: "+this.gl.getProgramParameter(a,this.gl.VALIDATE_STATUS)+", gl error ["+this.gl.getError()+"]"),!a)return a;for(h in a.uniforms={},a.attributes={},a.attributeSizes={},l=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","boneGlobalMatrices","morphTargetInfluences"],i.uniforms)l.push(h);for(this.attachGLLocations(a,l,"uniform"),l=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"],u=0;u<o.maxMorphTargets;u++)l.push("morphTarget"+u);for(u=0;u<o.maxMorphNormals;u++)l.push("morphNormal"+u);for(c in i.attributes)l.push(c);for(h in this.attachGLLocations(a,l,"attribute"),a.id=this.programs.length,this.programs.push({program:a,code:n,usedTimes:1}),this.info.memory.programCount=this.programs.length,i.program=a,i.uniformsList=[],i.uniforms)i.uniformsList.push([i.uniforms[h],h]);return a},Se.ProgramManager.prototype.enableAttribute=function(e,t){var i=t.program.attributes;if(0<=i.position&&_gl.enableVertexAttribArray(i.position),0<=i.color&&_gl.enableVertexAttribArray(i.color),0<=i.normal&&_gl.enableVertexAttribArray(i.normal),t.attributes)for(a in t.attributes)i[a]!==Me&&0<=i[a]&&_gl.enableVertexAttribArray(i[a])};var Je={5126:1,35664:2,35665:3,35666:4,35676:16};Se.ProgramManager.prototype.attachGLLocations=function(e,t,i){var r,a,n=this.gl;if("uniform"===i)for(s=0,r=t.length;s<r;s++)a=t[s],e.uniforms[a]=n.getUniformLocation(e,a);else if("attribute"===i)for(var o=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES),s=0;s<o;s++){var l=n.getActiveAttrib(e,s);l&&(e.attributeSizes[l.name]=Je[l.type],e.attributes[l.name]=n.getAttribLocation(e,l.name))}},Se.ProgramManager.prototype.setProgram=function(e,t,i,r,a,n){if(this.textureCount=0,this.addMaterial(r),this.needsUpdateMaterial(r)){r.setupMaterialShader(),this.programMap[r.id]&&this.deallocateMaterial(r);var o=this.buildProgram(n,a,r);this.programMap[r.id]=o,this.changeMaterialUpdateFlags(r,!1)}var s=r._needRefreshUniform,l=this.programMap[r.id];if(!l)return l;var h,c,u=l.uniforms,f=r.uniforms;return l!=this.currentProgram&&(this.gl.useProgram(l),this.currentProgram=l,s=!0),r.id!==this.currentMaterialId&&(this.currentMaterialId=r.id,s=!0),(s||e!==this.network._currentCamera)&&(this.gl.uniformMatrix4fv(u.projectionMatrix,!1,e.projectionMatrix.elements),e!==this.network._currentCamera&&(this.network._currentCamera=e)),i&&r.fog&&i.refreshUniforms(f),(r.lights||"phong"===r._type||"lambert"===r._type||"terrain"===r._type)&&(this._lightNeedsUpdate&&(this.setupLights(l,t),this._lightNeedsUpdate=!1),h=f,c=this._lights,h.ambientLightColor.value=c.ambient,h.directionalLightColor.value=c.directional.colors,h.directionalLightDirection.value=c.directional.positions,h.pointLightColor.value=c.point.colors,h.pointLightPosition.value=c.point.positions,h.pointLightDistance.value=c.point.distances,h.spotLightColor.value=c.spot.colors,h.spotLightPosition.value=c.spot.positions,h.spotLightDistance.value=c.spot.distances,h.spotLightDirection.value=c.spot.directions,h.spotLightAngleCos.value=c.spot.anglesCos,h.spotLightExponent.value=c.spot.exponents,h.hemisphereLightSkyColor.value=c.hemi.skyColors,h.hemisphereLightGroundColor.value=c.hemi.groundColors,h.hemisphereLightDirection.value=c.hemi.positions),s&&r.refreshUniforms(!1,{camera:this.network._camera,network:this.network}),n.receiveShadow&&!r._shadowPass&&this.network.isShadowable()&&(function(e,t){var i=0;if(e.shadowMatrix)for(var r=0,a=t.size();r<a;r++)t.get(r).refreshShadowUniforms(e,i)&&i++}(f,t),function(e,t){var i=0;if(e.pShadowMap)for(var r=0,a=t.size();r<a;r++)t.get(r).refreshUniformsPointShadow(e,i)&&i++}(f,t)),s&&(this.loadUniformsGeneric(l,r.uniformsList,r),(r.skinning||"phong"===r._type||"lambert"===r._type||"terrain"===r._type||r instanceof Se.ShaderMaterial)&&null!==u.viewMatrix&&this.gl.uniformMatrix4fv(u.viewMatrix,!1,e.worldMatrixInverse.elements)),r.loadCameraPosition(u,e,this.gl),function(e,t,i,r){if(t._modelViewMatrix||(t._modelViewMatrix=new ie),i.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&i.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements),e.modelViewProjectionMatrix){t._modelViewProjectionMatrix=new ie;var a=r._currentCamera.projectionMatrix;t._modelViewProjectionMatrix.multiply(a,t._modelViewMatrix),i.uniformMatrix4fv(e.modelViewProjectionMatrix,!1,t._modelViewProjectionMatrix.elements)}}(u,n,this.gl,this.network),null!=u.modelMatrix&&this.gl.uniformMatrix4fv(u.modelMatrix,!1,n.worldMatrix.elements),this.network._baseRender&&this.loadSSAOUniforms(u,r,s),r._needRefreshUniform=!1,l},Se.ProgramManager.prototype.loadSSAOUniforms=function(e,t,i){if(null!=e.mapSSAO&&this.network._sSAOEnable){var r=e.mapSSAO,a=i?this.getTextureUnit():t._ssaoSlot;this.gl.uniform1i(r,a),this.setTexture(this.network.finalSSAOTarget,a),t._ssaoSlot=a}},Se.ProgramManager.prototype.onTextureDispose=function(e){var t=e.target;t.removeEventListener("dispose",onTextureDispose),deallocateTexture(t),this.info.memory.textures--},Se.ProgramManager.prototype.deallocateTexture=function(e){var t=this.gl,i=e.id,r=this.glTextureMap[i];if(r)delete this.glTextureMap[i],t.deleteTexture(r),this.info.memory.textures--;else if(e._image&&e._image.__webglTextureCube)t.deleteTexture(e._image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,t.deleteTexture(e.__webglTexture)}},Se.ProgramManager.prototype.setTextureParameters=function(e,t,i,r){var a=this.gl,n=this.gpu,o=Se.Utils.paramToGL;i&&!r?(a.texParameteri(e,a.TEXTURE_WRAP_S,o(t.wrapS,a)),a.texParameteri(e,a.TEXTURE_WRAP_T,o(t.wrapT,a)),a.texParameteri(e,a.TEXTURE_MAG_FILTER,o(t.magFilter,a)),a.texParameteri(e,a.TEXTURE_MIN_FILTER,o(t.minFilter,a))):(a.texParameteri(e,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(e,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(e,a.TEXTURE_MAG_FILTER,this.filterFallback(t.magFilter)),a.texParameteri(e,a.TEXTURE_MIN_FILTER,this.filterFallback(t.minFilter))),n._glExtensionTextureFilterAnisotropic&&t.type!==Se.FloatType&&(1<t.anisotropy||t.__oldAnisotropy)&&(a.texParameterf(e,n._glExtensionTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,n._maxAnisotropy)),t.__oldAnisotropy=t.anisotropy)},Se.ProgramManager.prototype.setCubeTexture=function(e,t){var i=this.gl;this.addTexture(e);var r=e.id;if(6===e._image.length){if(!e._image.loaded)return;var a=Se.Utils.isPowerOfTwo,n=Se.Utils.paramToGL;if(this.needsUpdateTexture(e)){this.glTextureMap[r]===Me&&(this.glTextureMap[r]=i.createTexture(),this.info.memory.texture++),this.changeTextureUpdateFlags(e,!1),i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_CUBE_MAP,this.glTextureMap[r]),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var o=e instanceof Se.CompressedTexture,s=[],l=0;l<6;l++)this.autoScaleCubemaps&&!o?s[l]=clampToMaxSize(e._image[l],_maxCubemapSize):s[l]=e._image[l];var h=s[0],c=a(h.width)&&a(h.height),u=n(e.format,i),f=n(e.type,i);for(this.setTextureParameters(i.TEXTURE_CUBE_MAP,e,c),l=0;l<6;l++)if(o)for(var p,d=s[l].mipmaps,m=0,g=d.length;m<g;m++)p=d[m],i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,m,u,p.width,p.height,0,p.data);else i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,u,u,f,s[l]);e.generateMipmaps&&c&&i.generateMipmap(i.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_CUBE_MAP,this.glTextureMap[r])}},Se.ProgramManager.prototype.setCubeTextureDynamic=function(e,t){var i=this.gl;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_CUBE_MAP,e.__webglTexture)},Se.ProgramManager.prototype.loadUniformsGeneric=function(e,t,i){var r,a,n,o,s,l,h,c,u,f,p,d=this.gl;for(u=0,f=t.length;u<f;u++)if(o=e.uniforms[t[u][1]])if(n=(r=t[u][0]).type,a=r.value,"i"===n)d.uniform1i(o,a);else if("f"===n)d.uniform1f(o,a);else if("v2"===n)d.uniform2f(o,a.x,a.y);else if("v3"===n)d.uniform3f(o,a.x,a.y,a.z);else if("v4"===n)d.uniform4f(o,a.x,a.y,a.z,a.w);else if("c"===n)d.uniform3f(o,a.r,a.g,a.b);else if("iv1"===n)d.uniform1iv(o,a);else if("iv"===n)d.uniform3iv(o,a);else if("fv1"===n)d.uniform1fv(o,a);else if("fv"===n)d.uniform3fv(o,a);else if("v2v"===n){for(r._array===Me&&(r._array=new Float32Array(2*a.length)),h=0,c=a.length;h<c;h++)p=2*h,r._array[p]=a[h].x,r._array[p+1]=a[h].y;d.uniform2fv(o,r._array)}else if("v3v"===n){for(r._array===Me&&(r._array=new Float32Array(3*a.length)),h=0,c=a.length;h<c;h++)p=3*h,a[h]instanceof Se.Color?(r._array[p]=a[h].r,r._array[p+1]=a[h].g,r._array[p+2]=a[h].b):(r._array[p]=a[h].x,r._array[p+1]=a[h].y,r._array[p+2]=a[h].z);d.uniform3fv(o,r._array)}else if("v4v"===n){for(r._array===Me&&(r._array=new Float32Array(4*a.length)),h=0,c=a.length;h<c;h++)p=4*h,r._array[p]=a[h].x,r._array[p+1]=a[h].y,r._array[p+2]=a[h].z,r._array[p+3]=a[h].w;d.uniform4fv(o,r._array)}else if("m4"===n)r._array===Me&&(r._array=new Float32Array(16)),a.flattenToArray(r._array),d.uniformMatrix4fv(o,!1,r._array);else if("m4v"===n){for(r._array===Me&&(r._array=new Float32Array(16*a.length)),h=0,c=a.length;h<c;h++)a[h].flattenToArrayOffset(r._array,16*h);d.uniformMatrix4fv(o,!1,r._array)}else if("t"===n){if(s=a,l=this.getTextureUnit(),d.uniform1i(o,l),!s)continue;s._image instanceof Array&&6===s._image.length?this.setCubeTexture(s,l):(m=s._image,this.setTexture(s,l,!m||!m.loaded))}else if("tv"===n){for(r._array===Me&&(r._array=[]),h=0,c=r.value.length;h<c;h++)r._array[h]=this.getTextureUnit();if(0==r._array.length)return;for(d.uniform1iv(o,r._array),h=0,c=r.value.length;h<c;h++)if(s=r.value[h],l=r._array[h],s){var m=s._image;s instanceof et?this.setCubeTextureDynamic(s,l):this.setTexture(s,l,!m||!m.loaded)}}},Se.ProgramManager.prototype.setTexture=function(e,t,i){(e.loaded||e._image&&e._image.loaded)&&(i=!1);var r=this.gl,a=Se.Utils.isPowerOfTwo,n=e.id;if(this.addTexture(e),!this.needsUpdateTexture(e)||e instanceof $e)r.activeTexture(r.TEXTURE0+t),e instanceof $e?r.bindTexture(r.TEXTURE_2D,e.__webglTexture):r.bindTexture(r.TEXTURE_2D,this.glTextureMap[n]);else{if(!e._image)return;this.glTextureMap[n]===Me&&(this.glTextureMap[n]=r.createTexture(),this.info.memory.textures++),this.changeTextureUpdateFlags(e,!1),r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,this.glTextureMap[n]),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!e.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,e.unpackAlignment);var o=Se.Utils.paramToGL,s=i?Se.ImageCache.Logo:e._image,l=a(s.width)&&a(s.height),h=o(e.format,r,this.network),c=o(e.type,r,this.network);this.setTextureParameters(r.TEXTURE_2D,e,l,i);var u,f=e.mipmaps;if(e instanceof Se.PixelsTexture)if(0<f.length&&l){for(var p=0,d=f.length;p<d;p++)u=f[p],r.texImage2D(r.TEXTURE_2D,p,h,u.width,u.height,0,h,c,u.data);e.generateMipmaps=!1}else r.texImage2D(r.TEXTURE_2D,0,h,s.width,s.height,0,h,c,s.data);else if(e instanceof Se.CompressedTexture)if(e.loaded)for(p=0,d=f.length;p<d;p++)u=f[p],r.compressedTexImage2D(r.TEXTURE_2D,p,h,u.width,u.height,0,u.data);else r.texImage2D(r.TEXTURE_2D,0,h,h,c,s);else if(0<f.length&&l){for(p=0,d=f.length;p<d;p++)u=f[p],r.texImage2D(r.TEXTURE_2D,p,h,h,c,u);e.generateMipmaps=!1}else r.texImage2D(r.TEXTURE_2D,0,h,h,c,s);e.generateMipmaps&&l&&r.generateMipmap(r.TEXTURE_2D),e.onUpdate&&e.onUpdate()}},Se.ProgramManager.prototype.getTextureUnit=function(){var e=this.textureCount;return e>=this.gpu._maxTextures&&console.warn("Network3D: trying to use "+e+" texture units while this GPU supports only "+this.gpu._maxTextures),this.textureCount++,e},Se.ProgramManager.prototype.deallocateMaterial=function(e){var t=e.program;if(t!==Me){e.program=Me;var i,r,a,n=!1;for(i=0,r=this.programs.length;i<r;i++)if((a=this.programs[i]).program===t){0==--a.usedTimes&&(n=!0);break}if(!0===n){var o=[];for(i=0,r=this.programs.length;i<r;i++)(a=this.programs[i]).program!==t&&o.push(a);this.programs=o,this.gl.deleteProgram(t),this.info.memory.programs--}}},Se.ProgramManager.prototype.filterFallback=function(e){return e===Se.NearestFilter||e===Se.NearestMipMapNearestFilter||e===Se.NearestMipMapLinearFilter?this.gl.NEAREST:this.gl.LINEAR},Se.ProgramManager.prototype.setupLights=function(e,t){var i,r,a,n,o,s,l,h,c,u,f=0,p=0,d=0,m=this._lights,g=m.directional.colors,y=m.directional.positions,v=m.point.colors,x=m.point.positions,A=m.point.distances,_=m.spot.colors,w=m.spot.positions,b=m.spot.distances,M=m.spot.directions,S=m.spot.anglesCos,P=m.spot.exponents,T=m.hemi.skyColors,C=m.hemi.groundColors,E=m.hemi.positions,z=0,D=0,L=0,R=0,N=0,B=0,I=0,F=0,V=0,U=0,k=0,O=0,X=new Se.Vec3;for(i=0,r=t.size();i<r;i++)if(!(a=t.get(i)).onlyShadow)if(n=a.color,l=a.intensity*this.network.lightIntensityRatio,u=a.distance,a.updateWorldMatrix(!0),a instanceof Se.AmbientLight){if(!a._visible)continue;this.gammaInput?(f+=n.r*n.r,p+=n.g*n.g,d+=n.b*n.b):(f+=n.r,p+=n.g,d+=n.b)}else if(a instanceof Se.DirectionalLight){if(N+=1,!a._visible)continue;if(a.direction?X.copy(a.direction):(X.copy(a.worldMatrix.getPosition()),X.sub(a.target.worldMatrix.getPosition())),X.normalize(),0===X.x&&0===X.y&&0===X.z)continue;y[V=3*z]=X.x,y[V+1]=X.y,y[V+2]=X.z,this.gammaInput?Y(g,V,n,l*l):G(g,V,n,l),z+=1}else if(a instanceof Se.PointLight){if(B+=1,!a._visible)continue;U=3*D,this.gammaInput?Y(v,U,n,l*l):G(v,U,n,l),c=a.worldMatrix.getPosition(),x[U]=c.x,x[U+1]=c.y,x[U+2]=c.z,A[D]=u,D+=1}else if(a instanceof Se.SpotLight){if(I+=1,!a._visible)continue;k=3*L,this.gammaInput?Y(_,k,n,l*l):G(_,k,n,l),c=a.worldMatrix.getPosition(),w[k]=c.x,w[k+1]=c.y,w[k+2]=c.z,b[L]=u,X.copy(c),X.sub(a.target.worldMatrix.getPosition()),X.normalize(),M[k]=X.x,M[k+1]=X.y,M[k+2]=X.z,S[L]=Math.cos(a.angle),P[L]=a.exponent,L+=1}else if(a instanceof Se.HemisphereLight){if(F+=1,!a._visible)continue;if(X.copy(a.worldMatrix.getPosition()),X.normalize(),0===X.x&&0===X.y&&0===X.z)continue;E[O=3*R]=X.x,E[O+1]=X.y,E[O+2]=X.z,o=a.color,s=a.groundColor,this.gammaInput?(Y(T,O,o,h=l*l),Y(C,O,s,h)):(G(T,O,o,l),G(C,O,s,l)),R+=1}for(i=3*z,r=Math.max(g.length,3*N);i<r;i++)g[i]=0;for(i=3*D,r=Math.max(v.length,3*B);i<r;i++)v[i]=0;for(i=3*L,r=Math.max(_.length,3*I);i<r;i++)_[i]=0;for(i=3*R,r=Math.max(T.length,3*F);i<r;i++)T[i]=0;for(i=3*R,r=Math.max(C.length,3*F);i<r;i++)C[i]=0;m.directional.length=z,m.point.length=D,m.spot.length=L,m.hemi.length=R,m.ambient[0]=f,m.ambient[1]=p,m.ambient[2]=d},Se.ProgramManagerId=0;var $e=function(e,t,i){this.width=e,this.height=t,i=i||{},this.wrapS=i.wrapS!==Me?i.wrapS:Se.ClampToEdgeWrapping,this.wrapT=i.wrapT!==Me?i.wrapT:Se.ClampToEdgeWrapping,this.magFilter=i.magFilter!==Me?i.magFilter:Se.LinearFilter,this.minFilter=i.minFilter!==Me?i.minFilter:Se.LinearMipMapLinearFilter,this.anisotropy=i.anisotropy!==Me?i.anisotropy:1,this.offset=new Se.Vec2(0,0),this.repeat=new Se.Vec2(1,1),this.format=i.format!==Me?i.format:Se.RGBAFormat,this.type=i.type!==Me?i.type:Se.UnsignedByteType,this.depthBuffer=i.depthBuffer===Me||i.depthBuffer,this.stencilBuffer=i.stencilBuffer===Me||i.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=null,this.flipY=!0};$e.prototype={constructor:$e,clone:function(){var e=new $e(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},getUniqueCode:function(){return this._id},dispose:function(){this.dispatchEvent({type:"dispose"})}};var et=function(e,t,i){$e.call(this,e,t,i),this.activeCubeFace=0};Se.extend(et,$e,{});var tt=new mono.Vec3,it=new mono.Vec3(1,1,1),rt=new mono.Quat;Se.Network3D=function(e,t,i,r){Se.Element.call(this);var a=this;this.id=Se.Network3DId++,this._interactionDispatcher=new Se.EventDispatcher,r=r||{},this.parameters=r,this.helperBox=new Se.DataBox,this.helperBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._rootView=re.createView("hidden"),this._canvas=i=this.initCanvas(i),this._topCanvas=re.createCanvas(this),this._bottomCanvas=re.createCanvas(this);var n=this._canvas.parentNode;n&&(n.removeChild(this._canvas),n.appendChild(this._rootView),this.adjustRootViewBounds(0,0,this._canvas.width,this._canvas.height)),this._rootView.appendChild(this._bottomCanvas),this._rootView.appendChild(this._canvas),this._rootView.appendChild(this._topCanvas),this.setCanvasPropety(),this._camera=t||new Se.PerspectiveCamera,this._camera.addPropertyChangeListener(this.dirtyNetwork,this),this._clearColor=r.clearColor!==Me?r.clearColor:new Se.Color(16777215),this._clearAlpha=r.clearAlpha!=Me?r.clearAlpha:1,this._precision=r.precision!==Me?r.precision:"mediump",this.__fog=new Se.FogExp2,this.devicePixelRatio=r.devicePixelRatio!==Me?r.devicePixelRatio:q.devicePixelRatio!==Me?q.devicePixelRatio:1,this._premultipliedAlpha=null==r.premultipliedAlpha||r.premultipliedAlpha,this.lightIntensityRatio=1,le.isIOS||le.isAndroid?(this._antialias=!1,this._preserveDrawingBuffer=!1,this.lightIntensityRatio=.1):(this._preserveDrawingBuffer=null==r.preserveDrawingBuffer||r.preserveDrawingBuffer,this._antialias=r.antialias==Me||r.antialias),this._useWebgl2=r.useWebgl2||!1,i.addEventListener("webglcontextlost",function(e){console.log("webgl context lost"),e.preventDefault(),a._animateId&&((a._vrDisplay&&a._vrDisplay.isPresenting?a._vrDisplay:q).cancelAnimationFrame(a._animateId),a._animateId=null)}),i.addEventListener("webglcontextrestored",function(e){console.log("webgl context restored"),a._currentProgram=null,a.billboardRenderer=null,a.pm.dispose(),Ut.clear(),a._enabledAttributes={},a._currentGroupHash=null,a._oldLineWidth=null,a.gpu=new Se.GPU(a),a.pm=new Se.ProgramManager(a),a.setDefaultGLState(),a.dirtyNetwork(),a._clearNodeCache(),o(a)}),this._gl=this.initGL(),this._currentProgram=null,this.overrideMaterial=null,this._maxLights=r.maxLights!==Me?r.maxLights:4,this._projScreenMatrix=new ie,this._projScreenMatrixPS=new ie,this._frustum=new Se.Frustum,this._vector3=new Q,this._oldDoubleSided=-1,this._oldFlipSided=-1,this._oldBlending=null,this._oldBlendEquation=null,this._oldBlendSrc=null,this._oldBlendDst=null,this._currentCamera=null,this._enabledAttributes={},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.gpu=new Se.GPU(this),this.pm=new Se.ProgramManager(this),this.setDefaultGLState(),this.paintSortFunction=Se.Defaults.paintSortFunction,this.sortNodes=!0,this.sortOpaqueOrderByMaterial=!0,this.glNodeList=[],this.helperGLNodeList=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0},currentMaterialId:-1},this.projector=new Se.Projector,this.up=new Se.Vec3(0,1,0),this.position=new Se.Vec3(0,0,0),this.seletionMaterial=new Se.BasicMaterial,this.seletionMaterial.wireframe=!0,this.seletionMaterial.wireframeLinewidth=1,this.seletionMaterial.color=new Se.Color(65280),this.selectionCube=new Le,this.selectionCube.material=this.seletionMaterial,this.outlineMaterialMap={},this.selectionCube._modelViewMatrix=new ie,this.selectionCube._normalMatrix=new J,this.selectionCube.name="select",this.alarmMaterial=new Se.BasicMaterial,this.alarmMaterial.wireframe=!0,this.alarmMaterial.wireframeLinewidth=1,this.alarmMaterial.color=new Se.Color(16711680),this.alarmCube=new Le,this.alarmCube.material=this.alarmMaterial,this.alarmCube._modelViewMatrix=new ie,this.alarmCube._normalMatrix=new J,this.alarmCube.name="alarm",this._glowSurface=new Se.Plane(2,2),this._glowSurface2=new Se.Plane(512,512),this._glowSurface.target=new $e(512,512,{type:Se.UnsignedByteType}),this._glowSurface.target1=new $e(512,512,{type:Se.UnsignedByteType}),this._glowSurface.target2=new $e(512,512,{type:Se.UnsignedByteType}),this._glowSurfaceMaterial=new Se.BlurMaterial,this._blurMaterialH=new Se.BlurMaterial,this._blurMaterialH.orientation=1,this._blurMaterialV=new Se.BlurMaterial,this.deferredPostionMaterial=new Se.DeferredMaterial,this.deferredNormalMaterial=new Se.DeferredMaterial({isNormal:1}),this.ssaoMaterial=new Se.SSAOMaterial,this.ssaoMaterial.map2=new Se.Texture(Ae.ssaoNormalImage),this.deferredPostionTarget=new $e(1024,1024,{type:Se.FloatType,magFilter:Se.NearestFilter,minFilter:Se.NearestFilter}),this.deferredNormalTarget=new $e(1024,1024,{type:Se.FloatType,magFilter:Se.NearestFilter,minFilter:Se.NearestFilter,format:Se.RGBFormat}),this.ssaoTarget=new $e(1024,1024,{type:Se.FloatType,magFilter:Se.NearestFilter,minFilter:Se.NearestFilter}),this.ssaoTarget1=new $e(512,512,{type:Se.UnsignedByteType}),this.ssaoTarget2=new $e(512,512,{type:Se.UnsignedByteType}),this.finalSSAOTarget=null,this._interactions=null,this.billboardRenderer=null,this.flareRenderer=null,this._groupCounter=0,this.groupMap={},this.groupCountMap={},this.bufferNodeMap={},this.lineMap={},this.particleMap={},this.normalNodeMap={},this._pickingNodeMap={},this._animations=[],this._pickingTarget=new $e(512,512,{depthBuffer:!0,stencilBuffer:!1}),this._pickingTarget.generateMipmaps=!1,this.showAxis=!1,this.axisSize=20,this.axisPosition=new Se.Vec3(0,0,0),this.axis=new Se.Axis({size:this.axisSize}),this.alarmBillboards=[],this.areaPickingRect={},this.setDataBox(e==Me?new Se.DataBox:e),this.renderCallback=null,this.beforeRenderFunction=null,this.dirtyNetwork(),this.prepareData(),this.autoUpdateCameraAspect=!0,this.shadowMapRenderer=null,this.shadowMapType=Se.PCFSoftShadowMap,this.shadowMapCullFace=Se.CullFaceFront,this.adjustBounds(this._canvas.width,this._canvas.height,0,0),this.getRootView().addEventListener("mousedown",function(e){a.handleMouseDown(e)}),this.getRootView().addEventListener("mouseup",function(e){a.handleClick(e)}),this.setInteractions([new Se.DefaultInteraction(this),new Se.SelectionInteraction(this)]),this.doubleClickToLookAtFunction=We.doubleClickToLookAtFunction,o(this),this.initSurfaceGroup(),this.materialRenderListMap={},this._selectTransparencyThreshold=0,this._pickingTexturePixel=!0,this._dynamicBatchDraw=!1,this._dynamicBatchDrawCountLimit=1024,this.needSmoothNormalFunction=We.needSmoothNormalFunction,this._annotationMap={},this._activeAnnotation=null},Se.extend(Se.Network3D,Se.Data,{___accessor:["shadowMapEnable","editableFunction","keyboardRemoveEnabled","selectTransparencyThreshold","pickingTexturePixel","dynamicBatchDraw","showFps"],setUseFog:function(e){this._useFog=e,this._useFog?this._fog=this.__fog:this._fog=null},setOverloadMaterial:function(e){this._overloadMaterial=e},setFogColor:function(e){this.__fog.color=e},setFogDensity:function(e){this.__fog.density=e},setDataBox:function(e){if(!e)throw"DataBox can not be null";if(this.dataBox!==e){var t=this.dataBox;t&&(this._clearDataBox(t),t.removeDataBoxChangeListener(this.handleDataBoxChange,this),t.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),t.getAlarmBox().removeDataBoxChangeListener(this.dirtyNetwork,this),t.getSelectionModel().removeSelectionChangeListener(this.dirtyNetwork,this)),this.dataBox=e,this.dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this.dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this.dataBox.getAlarmBox().addDataBoxChangeListener(this.dirtyNetwork,this),this.dataBox.getSelectionModel().addSelectionChangeListener(this.dirtyNetwork,this),this.firePropertyChange("dataBox",t,this._box),this.glNodeList=[],this.dirtyNetwork(),this._clearNodeCache()}},setRenderCallback:function(e){this.renderCallback=e},setBeforeRenderFunction:function(e){this.beforeRenderFunction=e},getDataBox:function(){return this.dataBox},getClearColor:function(){return this._clearColor},setClearColor:function(e){3==arguments.length?(this._clearColor=new Se.Color,this._clearColor.setRGB(e,arguments[1],arguments[2])):(this._clearColor=e,this._clearColor instanceof Se.Color||(this._clearColor=new Se.Color(e))),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.dirtyNetwork()},setClearAlpha:function(e){this._clearAlpha=e,this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.dirtyNetwork()},getClearAlpha:function(){return this._clearAlpha},getPrecision:function(){return this._precision},setPrecision:function(e){this._precesion=e},setSSAOBlur:function(e){this._ssaoBlur=e},setSSAOEnable:function(e){return!(e&&!this.isFloatTextureSupport()||(this._sSAOEnable=e,this._dirty=!0,0))},isSSAOEnable:function(){return this._sSAOEnable&&this._baseRender},setSSAOOccluderBias:function(e){this._occluderBias=e,this._dirty=!0},setSSAOSamplingRadius:function(e){this._samplingRadius=e,this._dirty=!0},setSSAOAttenuation:function(e){this._attenuation=e,this._dirty=!0},isFloatTextureSupport:function(){return null!=this._glExtensionTextureFloat},getCamera:function(){return this._camera},setCamera:function(e,t){if(this._camera!=e){var i=this._camera;if(i.removePropertyChangeListener(this.dirtyNetwork),this._camera=e,this._camera.addPropertyChangeListener(this.dirtyNetwork,this),this.autoUpdateCameraAspect){this._camera.setAspect&&this._camera.setAspect(i.aspect);var r=this.getDefaultInteraction();r&&(r.object=this._camera)}t&&(this._camera.p(i.p()),this._camera.lookAt(i.getTarget())),this.dirtyNetwork()}},isVisible:function(e){if(e){if(e instanceof Se.Link||e instanceof Se.PathLink){if(!e.isVisible())return!1;if(!this.isVisible(e._fromNode))return!1;if(!this.isVisible(e._toNode))return!1}if(!e.isVisible())return!1;if(e._parent&&!this.isVisible(e._parent))return!1;if(this.visibleFunction)return this.visibleFunction(e)}return!0},setCanvasPropety:function(){this._canvas&&(this._canvas.setAttribute("tabindex",this.id),this._canvas.style.outline="none",this._canvas.style.position="absolute")},initCanvas:function(e){return e==Me?document.createElement("canvas"):("string"==typeof e&&(e=document.getElementById(e)),e)},initGL2:function(e){if(this._useWebgl2){var t=this._canvas.gl;if(!t)try{t=this._canvas.getContext("webgl2",e)||this._canvas.getContext("experimental-webgl2",e)}catch(e){console.log(e)}if(t)return this.webglVersion=2,t;this.webglVersion=1}},initGL:function(){var e={preserveDrawingBuffer:this._preserveDrawingBuffer,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:!0},t=this.initGL2(e);if(t)return t;var i=this._canvas.gl;if(!i)try{i=this._canvas.getContext("webgl",e)||this._canvas.getContext("experimental-webgl",e)}catch(e){console.log(e)}if(this._initVR(),i||console.error("Can not init webgl context"),this._glExtensionTextureFloat=i.getExtension("OES_texture_float"),this._glExtensionStandardDerivatives=i.getExtension("OES_standard_derivatives"),this._glExtensionTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this._glExtensionCompressedTextureS3TC=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._glExtensionTextureFloat||console.log("TGL.Network3D: Float textures not supported."),this._glExtensionStandardDerivatives||console.log("TGL.Network3D: Standard derivatives not supported."),this._glExtensionTextureFilterAnisotropic||console.log("TGL.Network3D: Anisotropic texture filtering not supported."),this._glExtensionCompressedTextureS3TC||console.log("TGL.Network3D: S3TC compressed textures not supported."),i)return i;console.log("Error: Your browser does not support WebGL.")},resetRenderInfo:function(){this.info.render.calls=0,this.info.render.vertices=0,this.info.render.faces=0,this.info.render.points=0,this.info.currentMaterialId=-1},_clearDataBox:function(e,t){for(var i=null,r=(i=e===this.helperBox?this.helperGLNodeList:this.glNodeList).length-1;0<=r;r--)i[r],i.splice(r,1);i=[],this.prepareData(),this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0);var a=this;(t=t||e.getDatas()).forEach(function(e){a._clearNodeCache(e)}),this.deleteCloneNode()},handleDataBoxChange:function(e){var t,i=e.kind,r=e.data,a=e.source;t=a===this.helperBox?this.helperGLNodeList:this.glNodeList,"add"===i?r instanceof Se.Light?(this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0),this.prepareData()):r instanceof Se.Annotation?this._createAnnotationDiv(r):(this.addNodeMaterials(r),this.addNode(r,t),r._alarmBillboard&&this.alarmBillboards.push(r._alarmBillboard)):"remove"===i?r instanceof Se.Light?(this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0),this.prepareData()):r instanceof Se.Annotation?this._removeAnnotationDiv(r):(this.removeNode(r,t),this.deleteCloneNode(r)):"clear"===i&&this._clearDataBox(a,e.datas),this.boundingBox=null,this.shadowMapRenderer&&this.shadowMapRenderer.handleDataBoxChange(e),this.dirtyNetwork()},removeNode:function(e,t){for(var i=t.length-1;0<=i;i--)t[i].node===e&&t.splice(i,1);this._clearNodeCache(e)},_clearNodeCache:function(e){if(e){if(delete this.bufferNodeMap[e._id],delete this._pickingNodeMap[e._pickingId],e._animation&&this._animations.splice(this._animations.indexOf(e),1),e.oldGroups=e.groups||e.oldGroups,null!=e.oldGroups)for(var t in e.oldGroups){var i=e.oldGroups[t],r=this.groupCountMap[i.id];null!=r&&(--r<=0?(delete this.groupCountMap[i.id],delete this.groupMap[i.id]):this.groupCountMap[i.id]=r)}for(var a=0;a<this.alarmBillboards.length;a++)this.alarmBillboards[a].getParent()===e&&(this.alarmBillboards.splice(a,1),a--);e instanceof Se.Annotation?this._removeAnnotationDiv(e):this._clearNodeMaterial(e)}else{for(var n in this.groupMap){var o=this.groupMap[n]._nodeId;this.helperBox.containsById(o)||delete this.groupMap[n]}this.alarmBillboards.splice(0),this.glNodeList=[]}for(var n in this._annotationMap)this._removeAnnotationDiv(n)},_clearNodeMaterial:function(e){var t=e.material;if(t)if(t.materials)for(var i=t.materials,r=i.length,a=0;a<r;a++)this._clearMaterial(i[a]);else this._clearMaterial(t)},_clearMaterial:function(e){e.map&&mono.TexturePool.unUseTexture(e.map),e.lightMap&&mono.TexturePool.unUseTexture(e.lightMap),e.specularMap&&mono.TexturePool.unUseTexture(e.specularMap),e.bumpMap&&mono.TexturePool.unUseTexture(e.bumpMap),e.normalMap&&mono.TexturePool.unUseTexture(e.normalMap),e.envMap&&mono.TexturePool.unUseTexture(e.envMap),mono.MaterialPool.unUseMaterial(e)},addNode:function(e,t){for(var i=this.addWebGLNode(t,e),r=0;r<i.length;r++){var a=i[r];this.updateWebGLNode(a)}e._animation&&this._animations.push(e),this._pickingNodeMap[e._pickingId]=e},addNodeMaterials:function(e){var t,i=e.material;if(i instanceof Se.Material)this.addMaterial(i);else if(i instanceof Se.ArrayMaterial){var r=i.materials,a=r.length;for(t=0;t<a;t++)this.addMaterial(r[t])}},addMaterial:function(e){this.pm.addMaterial(e),e.map&&this.pm.addTexture(e.map)},handleDataPropertyChange:function(e){var t=e.source;if(t instanceof Se.Node){var i=e.property;if(t.isSizeChangedProperty(i)||i===Se.Styles.MaterailType||i===Se.Styles.NormalType){if(t instanceof Se.Line)t.verticesNeedUpdate=!0,n=this.lineMap[t._id],this.initLineBuffers(t),fe.buildLineBufferData(t,this._gl.DYNAMIC_DRAW,this._gl,n);else if(t.groups)for(var r in t.verticesNeedUpdate=!0,i!==Se.Styles.MaterailType&&i!==Se.Styles.NormalType||(t.normalsNeedUpdate=!0),t.groups){var a=t.groups[r],n=this.groupMap[a.id],o=fe.getMaterial(t,a.materialIndex);t.normalsNeedUpdate&&this.initGroupBuffer(t,a,n,!0),fe.buildGroupBufferData(a,t,this._gl.DYNAMIC_DRAW,!t.dynamic,o,this._gl,n,this)}}else if("materialMapping"===i)this._currentGroupHash=null,this.removeNode(t,this.glNodeList),this.addNode(t,this.glNodeList);else if("alarmBillboard"===i){var s=e.oldValue,l=e.newValue;this._addNodeAlarmBillboard(t,s,l)}this.addNodeMaterials(t)}else t instanceof Se.Light&&(this.pm._lightNeedsUpdate=!0);(t.isSizeChangedProperty&&t.isSizeChangedProperty(i)||"parent"==i||t.isSpaceChangedProperty(i))&&(this.deleteCloneNode(t),this.boundingBox=null),this.shadowMapRenderer&&this.shadowMapRenderer.handleDataPropertyChange(e),this.dirtyNetwork()},deleteCloneNode:function(e){if(e){var t=e.getId?e.getId():e,i=this.normalNodeMap[t];if(null!=i)for(var r in i.setParent(null),i.groups){var a=i.groups[r];delete this.groupMap[a.id]}delete this.normalNodeMap[t]}else for(var t in this.normalNodeMap)this.deleteCloneNode(t)},setBlurAmount:function(e){this._blurAmount=e},setBlurScale:function(e){this._blurScale=e},setBlurStrength:function(e){this._blurStrength=e},setBlurGlobalAlpha:function(e){this._blurGlobalAlpha=e},dirtyNetwork:function(e){this.dataBox.batch||(this._dirty=!0)},dirtyShadowMap:function(e){this.shadowMapRenderer&&this.shadowMapRenderer.dirtyShadowMap()},_addNodeAlarmBillboard:function(e,t,i){if(i===Me&&(i=e._alarmBillboard),null!=t&&-1!==this.alarmBillboards.indexOf(t)){var r=this.alarmBillboards.indexOf(t);this.alarmBillboards.splice(r,1),t.removePropertyChangeListener(this.dirtyNetwork,this)}i&&-1===this.alarmBillboards.indexOf(i)&&(this.alarmBillboards.push(i),i.addPropertyChangeListener(this.dirtyNetwork,this))},initWebGLNodes:function(e,t){var i,r,a=e.getNodes();for(i=0,r=a.size();i<r;i++){var n=a.get(i);n.renderSelected=!1,this.addWebGLNode(t,n)}for(i=0,r=t.length;i<r;i++)this.updateWebGLNode(t[i])},updateWebGLNode:function(e){var t,i,r=e.node;if(r instanceof Se.Entity){for(var a in r.groups)t=r.groups[a],i=fe.getMaterial(r,t.materialIndex),r.buffersNeedUpdate&&(n=this.groupMap[t.id],this.initGroupBuffer(r,t,n),fe.buildGroupBufferData(t,r,this._gl.DYNAMIC_DRAW,!r.dynamic,i,this._gl,n,this));r.setUpdateFlags(!1),r.buffersNeedUpdate=!1}else if(r instanceof Se.BufferNode)this.setBufferNodeData(r,this._gl.DYNAMIC_DRAW,!r.dynamic);else if(r instanceof Se.Line)n=this.lineMap[r._id],fe.buildLineBufferData(r,this._gl.DYNAMIC_DRAW,this._gl,n);else if(r instanceof Se.Particle){var n=this.particleMap[r._id];ye(r,this._gl.DYNAMIC_DRAW,this._gl,n)}},addWebGLNode:function(e,t){var i,r,a,n,o=[];if(this._addNodeAlarmBillboard(t),t._modelViewMatrix=new ie,t._normalMatrix=new J,t instanceof Se.Entity)for(i in t.groups==Me&&ge(t,this.gpu.elementIndexUIntSupported),t.groups){(r=t.groups[i]).id=r.id===Me?Se.Network3D.GroupCache._groupCounter++:r.id;var s=this.groupCountMap[r.id]||0;s++,this.groupCountMap[r.id]=s,this.groupMap[r.id]===Me&&(this.groupMap[r.id]={}),(l=this.groupMap[r.id])._nodeId=t.getId(),l.__webglVertexBuffer||(this.createGroupBuffer(r,l),this.initGroupBuffer(t,r,l),t.setUpdateFlags(!0))}else if(t instanceof Se.Line)null==this.lineMap[t._id]&&(this.lineMap[t._id]={}),(l=this.lineMap[t._id])._nodeId=t.getId(),l.__webglVertexBuffer||(this.createLineBuffers(t),this.initLineBuffers(t),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0,t.lineDistancesNeedUpdate=!0);else if(t instanceof Se.Particle){null==this.particleMap[t._id]&&(this.particleMap[t._id]={});var l=this.particleMap[t._id];l._nodeId=t.getId(),l.__webglVertexBuffer||(this.createParticleBuffers(t),this.initParticleBuffers(t),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0)}else t instanceof Se.BufferNode?this.initBufferNode(t):t instanceof Se.Annotation&&this._createAnnotationDiv(t);if(t instanceof Se.Entity){for(i in t.groups)n={group:r=t.groups[i],node:t,opaque:(a=fe.getMaterial(t,r.materialIndex)).transparent?null:a,transparent:a.transparent?a:null},e.push(n),o.push(n);t.groups}else t instanceof Se.Line||t instanceof Se.LensFlare?(n={group:t,node:t,opaque:(a=t.material).transparent?null:a,transparent:a.transparent?a:null},e.push(n),o.push(n)):t instanceof Se.Particle?(n={group:t,node:t,opaque:(a=t.material).transparent?null:a,transparent:a.transparent?a:null},e.push(n),o.push(n)):t instanceof Se.BufferNode&&(n={group:t,node:t,opaque:(a=t.material instanceof Se.ArrayMaterial?t.material.materials[0]:t.material).transparent?null:a,transparent:a.transparent?a:null},e.push(n),o.push(n));return t.glActive=!0,o},onElementDispose:function(e){var t=e.target;t.removeEventListener("dispose",this.onElementDispose),deallocateElement(t),this.info.memory.geometries--},deallocateElement:function(e){},_AK47:function(e,t,i,r,a,n){var o,s,l,h;if(this._fog,e.parent===Me&&e.updateWorldMatrix(!0,!1),!this._isPresenting&&e.worldMatrixInverse.getInverse(e.worldMatrix),this._projScreenMatrix.multiply(e.projectionMatrix,e.worldMatrixInverse),this._frustum.setFromMatrix(this._projScreenMatrix),0===i.length&&(this.initWebGLNodes(t,i),this.prepareData()),!n)for(o=0,s=i.length;o<s;o++)(h=(l=i[o]).node).renderSelected=!1,l.render=!1,this.isVisible(h)&&(this.unrollBufferMaterial(l),this.setupMatrices(h,e),(h instanceof Se.Entity||h instanceof Se.Particle)&&h.frustumCulled&&!this._frustum.intersectsObject(h)||(l.render=!0,this.sortNodes&&(h.worldMatrix.getPosition(this._vector3),this._vector3.applyProjection(this._projScreenMatrix),null!=h.renderDepth?l.z=h.renderDepth+this._vector3.z:l.z=this._vector3.z)));var c=new xe;if(c.addAll(r),!a&&!n){for(var u=this.alarmBillboards.length-1;0<=u;u--)null==this.alarmBillboards[u].getParent()&&this.alarmBillboards.splice(u,1);c.addAll(this.alarmBillboards)}var f=this;!n&&c.forEach(function(e){e.renderDepth?e.z=e.renderDepth:(e.worldMatrix.getPosition(f._vector3),f._vector3.applyProjection(f._projScreenMatrix),e.z=f._vector3.z)}),0<c.size()&&!n&&null==this.billboardRenderer&&(this.billboardRenderer=new Se.BillboardRenderer),0<t.getLensFlares().size()&&!n&&null==this.flareRenderer&&(this.flareRenderer=new Se.FlareRenderer);var p=[].concat(i).concat(c._as),d=this.sortNodesFunc(p);this.setBlending(Se.NoBlending),this.renderNodes(d,!1,"opaque",e,t.getLights(),!1,null,n,this.sortOpaqueOrderByMaterial),this.renderNodes(d,!0,"transparent",e,t.getLights(),!0,null,n),this.setDepthTest(!0),this.setDepthWrite(!0)},unrollBufferMaterial:function(e){var t,i,r,a=e.node,n=e.group;(r=a.material)instanceof Se.ArrayMaterial?(i=n.materialIndex||0,(t=r.materials[i]).transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)):(t=r)&&(t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null))},renderLicense:function(){},isShadowable:function(){return this.isShadowMapEnable()&&(0<this.maxShadows||0<this.maxPointShadows)},_handleAnimation:function(d){this._animations.length&&(d=d||0,this._animations.forEach(function(e){e._animation.channels.forEach(function(e){var i,r,a,n,o=e.sampler.input,s=e.sampler.splitOutput||e.sampler.output,l=d/1e3%o[o.length-1];o.some(function(e,t){return 0!==t&&l<e&&(i=o[t-1],r=e,a=s[t-1],n=s[t],!0)});var t=(l-i)/(r-i),h=e.node,c=h._info;if("rotation"===e.path)mono.Quat.slerp(a,n,c.rotation,t);else if("translation"===e.path)c.translation.lerpVectors(a,n,t);else if("scale"===e.path)c.scale.lerpVectors(a,n,t);else if("weights"===e.path)for(var u=1-t,f=c.weights,p=0;p<a.length;p++)f[p]=u*a[p]+t*n[p];"weights"!==e.path&&(h.matrix.fromRotationTranslationScale(c.rotation||rt,c.translation||tt,c.scale||it),h.setMatrix(h.matrix))})}),this.dataBox._nodeList.forEach(function(e){e._skin&&e._skin.update()}),this._dirty=!0)},render:function(e){if(this._dirty&&(this.resetRenderInfo(),this._dirty=!1,this._handleAnimation(e),null!=this.beforeRenderFunction&&this.beforeRenderFunction.call(this),!this.isShadowable()||(this.shadowMapRender(),this.setRenderTarget(Me),!this.debugPointLight))){if(vt.twm(this),this.paintBottom(this._bottomCanvas),this.getShowFps()&&(this.__time=(new Date).getTime()),this.innerRender(this._camera,!0),this.renderAnnotations(this._camera),this.extendRender(this._camera),this.paintTopCanvas(),this.getShowFps()){this._tpf=(new Date).getTime()-this.__time;var t=this._topCanvas.getContext("2d"),i=(1e3/this._tpf).toFixed(0);500<i&&(i="> 500"),s="FPS:"+i+",TPF:"+this._tpf+" ms",t.font="20px Arial sans-serif",t.fontWeight="bold",t.lineWith=2,t.fillStyle="rgba(0, 0, 0, 1)",t.fillText(s,10,25)}if(this._xyz!=Me){var r,a=this._xyz,n=a.markText,o=a.type,s=(a.expired,a.innerHTML),l=0,h=0;t=(this._topCanvas.getBoundingClientRect(),this._topCanvas.getContext("2d"));n!=Me&&null!=n&&""!=n||"2"==o?(t.font="24px Arial sans-serif",r=ce.getTextSize(t.font,s),t.fillStyle="red"):(t.font="15px Arial sans-serif",t.fillStyle="rgba(240, 120, 25, 0.6)",r=ce.getTextSize(t.font,s)),l=this._canvas.width-r.width-20,h=this._canvas.height-r.height-10,t.fillText(s,l,h)}null!=this.renderCallback&&this.renderCallback.call(this)}},getTextSize:function(e,t){return ce.getTextSize(e,t)},shadowMapRender:function(){null==this.shadowMapRenderer&&(this.shadowMapRenderer=new Ot,this.shadowMapRenderer.init(this)),0===this.glNodeList.length&&(this.initWebGLNodes(this.dataBox,this.glNodeList),this.prepareData()),this.shadowMapRenderer.render(this.dataBox,this._camera)},handleMouseDown:function(e){var t=e.target;this.lastX=e.clientX,this.lastY=e.clientY,"tgl_annotation"==t.getAttribute("class")&&"1"==t.style.opacity&&(e.stop=!0,e.stopPropagation())},handleClick:function(e){var t=e.clientX-this.lastX,i=e.clientY-this.lastY;if(Math.abs(t)<.1&&Math.abs(i)<.1){var r=e.target;if("tgl_annotation"!=r.getAttribute("clazz"))this._activeAnnotation&&(this._activeAnnotation=null,this.dirtyNetwork());else if("1"==r.style.opacity){var a=r.getAttribute("id"),n=this.getDataBox().getDataById(a),o=this._annotationMap[a];this.handleDefaultAnnotationClick(n,o),this.handleAnnotationClick(n,o),this.dirtyNetwork()}}},handleDefaultAnnotationClick:function(e,t){this._activeAnnotation==e||(this._activeAnnotation=e)},handleAnnotationClick:function(e,t){},renderAnnotations:function(t){var e=this.dataBox.getAnnotations(),i=this;if(e&&(e.forEach(function(e){i.renderAnnotation(t,e)}),this._createAnnotationStyle()),this._activeAnnotation){this._createAnnotationToolTipDiv();var r=this._annotationToolTipDiv;r.innerHTML=this._activeAnnotation.getText();var a=this._annotationMap[this._activeAnnotation.getId()];r.parentNode!=a&&a.appendChild(r),r.style.opacity=a.style.opacity}},getAnnotationDiv:function(e){return this._annotationMap[e.getId()]},renderAnnotation:function(e,t){var i=this._annotationMap[t.getId()];null==i&&(i=this._createAnnotationDiv(t)),i.innerHTML=t._label,t.updateWorldMatrix();var r=t.worldMatrix.getPosition(),a=t.getStyle("annotation.class");i.setAttribute("class",a);var n=this.getViewPosition(r);this._annotationToolTipDiv,i.style.left=n.x+"px",i.style.top=n.y+"px",i.style.opacity="1";var o=r.distanceTo(e.getPosition()),s=this.getElementByScreenPoint(n,!1);s&&0<s.length&&s[0].distance<o&&(i.style.opacity="0.03")},_addCSSRule:function(e,t,i,r){r=r||(e.cssRules||e.rules).length,e.insertRule?e.insertRule(t+"{"+i+"}",r):e.addRule&&e.addRule(t,i,r)},_createAnnotationStyle:function(){if(!this._annotationStyle){var e=document.createElement("style");e.appendChild(document.createTextNode("")),document.head.appendChild(e);var t=e.sheet;this._addCSSRule(t,".tgl_annotation","position:absolute;width:16px;height:16px;border-radius:10px;text-align:center;border : 2px solid gray;"),this._addCSSRule(t,".tgl_annotation:hover","border : 2px solid black;"),this._annotationStyle=e}},_removeAnnotationDiv:function(e){var t=e.getId?e.getId():e,i=this._annotationMap[t];null!=i&&this.getRootView().removeChild(i)},_createAnnotationDiv:function(e){var t=document.createElement("div"),i=e.getStyle("annotation.class");return t.setAttribute("id",e.getId()),t.setAttribute("class",i),t.setAttribute("clazz","tgl_annotation"),this._annotationMap[e.getId()]=t,this.getRootView().appendChild(t),t},_createAnnotationToolTipDiv:function(){if(null==this._annotationToolTipDiv){var e=document.createElement("div");e.setAttribute("class","tgl_annotation_tooltip");var t=document.createElement("style");t.appendChild(document.createTextNode("")),document.head.appendChild(t);var i=t.sheet,r="position: absolute;border: 3px solid #333; background-color: #ccd; padding: 3px;text-align: left;width: 220px;height: 'auto';border-radius: 10px;bottom:35px;left:-13px;";this._addCSSRule(i,".tgl_annotation_tooltip",r),r="content: ' ';position: absolute;top: 100%; border: 1px solid;",this._addCSSRule(i,".tgl_annotation_tooltip:after, .tgl_annotation_tooltip:before",r),r="border-color: #333 transparent transparent transparent;border-width: 16px 17px 0 7px;left: 10px;",this._addCSSRule(i,".tgl_annotation_tooltip:before",r),r="border-color: #ccd transparent transparent transparent;border-width: 12px 11px 0 4px;left: 14px;",this._addCSSRule(i,".tgl_annotation_tooltip:after",r),this._annotationToolTipDiv=e}},extendRender:function(e){},innerRender:function(e,t){if(e===Me&&(e=this._camera),null!==e){if(this.debug&&console.log("inner Render"),(!this._vrDisplay||!this._vrDisplay.isPresenting)&&this.autoClear){var i=this._clearColor;this._gl.clearColor(i.r,i.g,i.b,this._clearAlpha),Ze.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil,this)}if(t)for(var r=0;r<this._interactions.length;r++){var a=this._interactions[r];a.update&&a.update()}if(this.billboardRenderer&&this.billboardRenderer.disable(),this.flareRenderer&&this.flareRenderer.disable(),this._vrDisplay||this._gl.viewport(0,0,this._canvas.width,this._canvas.height),this._sSAOEnable&&(this.linearDepth=e.far-e.near,this.ssaoing=!0,this._renderDeferredTarget(e,this.deferredPostionMaterial,this.deferredPostionTarget),this._renderDeferredTarget(e,this.deferredNormalMaterial,this.deferredNormalTarget),this._setSSAOMaterial(),this._overloadMaterial=null,this._renderSurface(e,this.ssaoTarget,this.ssaoMaterial),c=this._canvas.width/this._canvas.height,this._ssaoBlur?(this._renderBlurTarget(e,this._blurMaterialH,this.ssaoTarget,this.ssaoTarget1,c),this._renderBlurTarget(e,this._blurMaterialV,this.ssaoTarget1,this.ssaoTarget2,c),this.finalSSAOTarget=this.ssaoTarget2):this.finalSSAOTarget=this.ssaoTarget,this.setRenderTarget(Me),this.ssaoing=!1),this.renderOutline=!1,this.renderOutlineGlow=!1,Ze.enableStencil(this._gl,this),this._baseRender=!0,Ze.r(this,e,this.dataBox,this.glNodeList,this.dataBox.getBillboards()),this._baseRender=!1,Ze.stencilTest(this._gl,this),this.renderOutline&&Ze.r(this,e,this.dataBox,this.glNodeList,this.dataBox.getBillboards(),!1,"stencil"),this.renderOutlineGlow){var n,o,s=this._glowSurface.target,l=this._glowSurface.target1,h=this._glowSurface.target2;for(n in Ze.disableStencil(this._gl),this.setRenderTarget(s),s._id=s._id||(new Date).getTime()+"0",l._id=l._id||(new Date).getTime()+"1",h._id=h._id||(new Date).getTime()+"2",this._gl.viewport(0,0,s.width,s.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.colorMask(!1,!1,!1,!1),Ze.r(this,e,this.dataBox,this.glNodeList,[],!1,"glow.unselect"),this._gl.colorMask(!0,!0,!0,!0),Ze.r(this,e,this.dataBox,this.glNodeList,[],!1,"glow.select"),this.setRenderTarget(l),this._gl.viewport(0,0,l.width,l.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialH.setMap(s),c=this._canvas.width/this._canvas.height,this._blurMaterialH.texelSize=new pe(s.width,s.height/c),this._blurMaterialH.blurAmount=this._blurAmount||5,this._blurMaterialH.blurScale=this._blurScale||1,this._blurMaterialH.blurStrength=this._blurStrength||1,this._blurMaterialH.orientation=1,this._glowSurface.groups)o=this._glowSurface.groups[n],this.renderGroup(e,[],this._blurMaterialH,o,this._glowSurface2);for(n in this.setRenderTarget(h),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialV.setMap(l),this._blurMaterialV.texelSize=new pe(l.width,l.height/c),this._blurMaterialV.blurAmount=this._blurAmount||5,this._blurMaterialV.blurScale=this._blurScale||1,this._blurMaterialV.blurStrength=this._blurStrength||1,this._blurMaterialV.orientation=0,this._glowSurface.groups)o=this._glowSurface.groups[n],this.renderGroup(e,[],this._blurMaterialV,o,this._glowSurface2);for(n in this.setRenderTarget(Me),this._glowSurface._modelViewMatrix=new ie,this._glowSurface._normalMatrix=new J,this.setupMatrices(this._glowSurface,e),this._glowSurfaceMaterial.setMap(h),this._glowSurfaceMaterial.useBlur=0,this._glowSurfaceMaterial.blurGlobalAlpha=this._blurGlobalAlpha||1,Ze.setBlending(this._glowSurfaceMaterial.blendMode,this._glowSurfaceMaterial.blendEquation,this._glowSurfaceMaterial.blendSrc,this._glowSurfaceMaterial.blendDst,this),this._gl.enable(this._gl.STENCIL_TEST),this._glowSurface.groups)o=this._glowSurface.groups[n],this.renderGroup(e,[],this._glowSurfaceMaterial,o,this._glowSurface);this.setRenderTarget(l),this._gl.viewport(0,0,l.width,l.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialH.setMap(s);var c=this._canvas.width/this._canvas.height;for(n in this._blurMaterialH.texelSize=new pe(s.width,s.height/c),this._blurMaterialH.blurAmount=this._blurAmount||10,this._blurMaterialH.blurScale=this._blurScale||1,this._blurMaterialH.blurStrength=this._blurStrength||1,this._blurMaterialH.orientation=0,this._glowSurface.groups)o=this._glowSurface.groups[n],this.renderGroup(e,[],this._blurMaterialH,o,this._glowSurface2);for(n in this.setRenderTarget(h),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialV.setMap(l),this._blurMaterialV.texelSize=new pe(l.width,l.height/c),this._blurMaterialV.blurAmount=this._blurAmount||10,this._blurMaterialV.blurScale=this._blurScale||1,this._blurMaterialV.blurStrength=this._blurStrength||1,this._blurMaterialV.orientation=1,this._glowSurface.groups)o=this._glowSurface.groups[n],this.renderGroup(e,[],this._blurMaterialV,o,this._glowSurface2);for(n in this.setRenderTarget(Me),this._glowSurface._modelViewMatrix=new ie,this._glowSurface._normalMatrix=new J,this.setupMatrices(this._glowSurface,e),this._glowSurfaceMaterial.setMap(h),this._glowSurfaceMaterial.useBlur=0,this._glowSurfaceMaterial.blurGlobalAlpha=this._blurGlobalAlpha||1,Ze.setBlending(this._glowSurfaceMaterial.blendMode,this._glowSurfaceMaterial.blendEquation,this._glowSurfaceMaterial.blendSrc,this._glowSurfaceMaterial.blendDst,this),this._gl.enable(this._gl.STENCIL_TEST),this._glowSurface.groups)o=this._glowSurface.groups[n],this.renderGroup(e,[],this._glowSurfaceMaterial,o,this._glowSurface);this._gl.clearColor(0,0,0,0)}Ze.disableStencil(this._gl),this.renderHelper(e)}else console.log(" no camera")},_renderDeferredTarget:function(e,t,i,r){r=r||new Se.Vec4(0,0,0,0,0),t.linearDepth=this.linearDepth,this.setRenderTarget(i),this._overloadMaterial=t,this._gl.clearColor(r.x,r.y,r.z,r.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),Ze.r(this,e,this.dataBox,this.glNodeList,this.dataBox.getBillboards())},_renderBlurTarget:function(e,t,i,r,a){var n,o;for(n in clearColor=clearColor||new Se.Vec4(0,0,0,0,0),this.setRenderTarget(r),this._gl.viewport(0,0,r.width,r.height),this._gl.clearColor(clearColor.x,clearColor.y,clearColor.z,clearColor.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),t.setMap(i),t.texelSize=new pe(i.width,i.height/a),t.blurAmount=this._blurAmount||5,t.blurScale=this._blurScale||1,t.blurStrength=this._blurStrength||1,this._glowSurface.groups)o=this._glowSurface.groups[n],this.renderGroup(e,[],t,o,this._glowSurface2)},_setSSAOMaterial:function(){this.ssaoMaterial.map=this.deferredPostionTarget,this.ssaoMaterial.map1=this.deferredNormalTarget,this.ssaoMaterial.attenuation=this._attenuation||new pe(1,.02),this.ssaoMaterial.occluderBias=this._occluderBias||.5,this.ssaoMaterial.samplingRadius=this._samplingRadius||20,this.ssaoMaterial.texelSize=new pe(1/this.deferredPostionTarget.width,1/this.deferredPostionTarget.height)},_renderSurface:function(e,t,i,r){var a,n;for(n in r=r||new Se.Vec4(1,1,1,1),this.setRenderTarget(t),this._gl.clearColor(r.x,r.y,r.z,r.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._glowSurface._modelViewMatrix=new ie,this._glowSurface._normalMatrix=new J,this.setupMatrices(this._glowSurface,e),this._glowSurface.groups)a=this._glowSurface.groups[n],this.renderGroup(e,[],i,a,this._glowSurface)},renderHelper:function(e){Ze.r(this,e,this.helperBox,this.helperGLNodeList,this.helperBox.getBillboards(),"stencil")},initSurfaceGroup:function(){for(var e in this._glowSurface.setUpdateFlags(!0),ge(this._glowSurface,this.gpu.elementIndexUIntSupported),this._glowSurface.groups)(t=this._glowSurface.groups[e]).id=t.id===Me?Se.Network3D.GroupCache._groupCounter++:t.id,this.groupMap[t.id]===Me&&(this.groupMap[t.id]={}),i=this.groupMap[t.id],this.createGroupBuffer(t,i),this.initGroupBuffer(this._glowSurface,t,i),fe.buildGroupBufferData(t,this._glowSurface,this._gl.DYNAMIC_DRAW,!1,this._glowSurfaceMaterial,this._gl,i,this);for(var e in this._glowSurface2.setUpdateFlags(!0),ge(this._glowSurface2,this.gpu.elementIndexUIntSupported),this._glowSurface2.groups){var t=this._glowSurface2.groups[e];t.id=t.id===Me?Se.Network3D.GroupCache._groupCounter++:t.id,this.groupMap[t.id]===Me&&(this.groupMap[t.id]={});var i=this.groupMap[t.id];this.createGroupBuffer(t,i),this.initGroupBuffer(this._glowSurface2,t,i),fe.buildGroupBufferData(t,this._glowSurface2,this._gl.DYNAMIC_DRAW,!1,this._glowSurfaceMaterial,this._gl,i,this)}},getOutlineMaterial:function(e,t){var i=(t.getStyle("select.width")||1)+1+" "+new Se.Color(t.getStyle("select.color")).getUniqueCode()+e,r=this.outlineMaterialMap[i];return null==r&&(r=new Se.EntityMaterial,"outline.normal"==e?(r._type="outline",r.outline=t.getStyle("select.width")||1):"outline.glow"==e?r._type="basic":(r.wireframe=!0,r.wireframeLinewidth=(t.getStyle("select.width")||1)+1),r.color=new Se.Color(t.getStyle("select.color")),this.outlineMaterialMap[i]=r),r},renderNodes:function(e,t,i,r,a,n,o,s,l){if("glow.unselect"!==s||!n){var h,c,u,f,p,d,m;t?(p=e.length-1,m=d=-1):(p=0,d=e.length,m=1);for(var g=p;g!==d;g+=m)if(f=(h=e[g]).node?h.transparent||h.opaque:h.material){this._overloadMaterial&&(f=this._overloadMaterial);var y=this.getOverLoadMaterial(h.node?h.node:h,f);if(y&&y!==f){var v=y.getUniqueCode(),x=Ut.getMaterial(v);x?f=x:(Ut.setMaterial(v,y),f=y)}if(!("opaque"==i&&1==f.transparent||"transparent"==i&&0==f.transparent)){if(n?(Ze.setBlending(f.blendMode,f.blendEquation,f.blendSrc,f.blendDst,this),Ze.setDepthWrite(!1,this)):Ze.setDepthWrite(f.depthMask,this),h instanceof Se.Billboard)i==(h.material.transparent?"transparent":"opaque")&&this.billboardRenderer.render(this,[h],r,2*this._canvas.width,2*this._canvas.height,y);else if(h.render){if(this.billboardRenderer&&this.billboardRenderer.disable(),this.flareRenderer&&this.flareRenderer.disable(),c=h.node,u=h.group,Ze.setDepthTest(f.depthTest,this),Ze.setPolygonOffset(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits,this),this.setGLFaces(f),c instanceof Se.Particle){if(c.verticesNeedUpdate||c.colorsNeedUpdate||c.sortParticles){var A=this.particleMap[c._id];ye(c,this._gl.DYNAMIC_DRAW,this._gl,A)}c.verticesNeedUpdate=!1,c.colorsNeedUpdate=!1}var _=this.getSelectStyle(c);if("outline"==_&&(_="outline.normal"),s?"glow.unselect"===s&&(c.isSelected()||(c instanceof Se.BufferNode?this.renderBufferNode(r,a,f,u,c):Ze.g(this,r,a,f,u,c))):(!c.isSelected()||"outline.normal"!==_&&"outline.wireframe"!==_&&"outline.glow"!==_?this.setStencilTest(!1):(this.setStencilTest(!0),"outline.glow"===_?this.renderOutlineGlow=!0:this.renderOutline=!0),c instanceof Se.BufferNode?this.renderBufferNode(r,a,f,u,c):(this._setStencilMask(this._oldStencilTest?1:0),Ze.g(this,r,a,f,u,c))),c.isSelected()&&this.renderSelect(c))if("outline.normal"===_||"outline.wireframe"===_||"outline.glow"===_){if(null!=s&&"glow.unselect"!=s)if("outline.normal"===_){if(!1===c.renderSelected){if(M=this.getOutlineMaterial(_,c),null==(w=this.normalNodeMap[c.getId()])){var w=this.cloneNode(c,M);this.normalNodeMap[c.getId()]=w}for(var b in this.setupMatrices(w,r),w.groups)Ze.g(this,r,a,M,w.groups[b],w);c.renderSelected=!0}}else if("outline.normal"!==_){var M=this.getOutlineMaterial(_,c);Ze.g(this,r,a,M,u,c)}}else!1===c.renderSelected&&(this.renderNodeSelection(r,a,c),c.renderSelected=!0);c instanceof Se.LensFlare&&this.flareRenderer&&this.flareRenderer.render(this,[h],r,2*this._canvas.width,2*this._canvas.height),c.getAlarmState().getPropagateSeverity()&&this.renderAlarmBorder(c)&&this.renderNodeAlarm(r,a,c)}c&&c.setUpdateFlags&&c.setUpdateFlags(!1)}}}},cloneNode:function(e,t){var i,r,a=new Se.Entity,n={vertices:[],uvs:[],faces:[]};for(i=0,r=e.vertices.length;i<r;i++)n.vertices.push(e.vertices[i].clone());for(i=0,r=e.faces.length;i<r;i++)n.faces.push(e.faces[i].clone());for(i=0,r=e.uvs.lenght;i<r;i++){for(var o=uvs[i],s=[],l=0;l<o;l++)s.push(o[l].clone());n.uvs.push(s)}return Se.Node.prototype.mergeVertices.call(n),Se.Node.prototype.computeFaceNormals.call(n),Se.Node.prototype.computeVertexNormals.call(n,!0),a.setPosition(e.getPosition()),a.setScale(e.getScale()),a.setRotation(e.getRotation()),a.setParent(e.getParent()),a._modelViewMatrix=new ie,a._normalMatrix=new J,a.data=n,a.vertices=n.vertices,a.uvs=n.uvs,a.faces=n.faces,a.material=t,a.primitive=new Se.Primitive(n),a.setUpdateFlags(!0),ge(a,this.gpu.elementIndexUIntSupported),this.buildNodeBufferData(a),a},buildNodeBufferData:function(e){for(var t in e.groups){var i=e.groups[t];i.id=i.id===Me?Se.Network3D.GroupCache._groupCounter++:i.id,this.groupMap[i.id]===Me&&(this.groupMap[i.id]={});var r=this.groupMap[i.id];this.createGroupBuffer(i,r),this.initGroupBuffer(e,i,r),fe.buildGroupBufferData(i,e,this._gl.DYNAMIC_DRAW,!1,e.material,this._gl,r,this)}},needSmoothNormal:function(e,t){var i=t.normalType;return i!=Me?i===Se.NormalTypeSmooth:!!this.needSmoothNormalFunction&&this.needSmoothNormalFunction(e)},renderNodeSelection:function(e,t,i){i.createSelectionCube(this.selectionCube),this.setupMatrices(this.selectionCube,e);var r=this.selectionCube.groups;for(var a in this.selectionCube.material.needsUpdate=!0,r){var n=r[a];n.id=n.id===Me?Se.Network3D.GroupCache._groupCounter++:n.id,this.groupMap[n.id]===Me&&(this.groupMap[n.id]={});var o=this.groupMap[n.id];o.__webglVertexBuffer||(this.createGroupBuffer(n,o),this.initGroupBuffer(i,n,o)),this.selectionCube.setUpdateFlags(!0),fe.buildGroupBufferData(n,this.selectionCube,this._gl.DYNAMIC_DRAW,!1,this.selectionCube.material,this._gl,o,this),this.renderGroup(e,[],this.selectionCube.material,n,this.selectionCube)}},renderNodeAlarm:function(e,t,i){i.createPropagateAlarmCube(this.alarmCube),this.setupMatrices(this.alarmCube,e);var r=this.alarmCube.groups;for(var a in this.alarmCube.material.needsUpdate=!0,r){var n=r[a];n.id=n.id===Me?Se.Network3D.GroupCache._groupCounter++:n.id,this.groupMap[n.id]===Me&&(this.groupMap[n.id]={});var o=this.groupMap[n.id];o.__webglVertexBuffer||(this.createGroupBuffer(n,o),this.initGroupBuffer(i,n,o)),this.alarmCube.setUpdateFlags(!0),fe.buildGroupBufferData(n,this.alarmCube,this._gl.DYNAMIC_DRAW,!1,this.alarmCube.material,this._gl,o,this),this.renderGroup(e,[],this.alarmCube.material,n,this.alarmCube)}},renderBufferNode:function(e,t,i,r,a,n){if(!1!==i.visible&&a.computed){var o,s,l=this;o=this.pm.setProgram(e,t,this._fog,i,r,a),s=o.attributes;var h=a,c=!1,u=i.wireframe?1:0,f=16777215*r._id+2*o.id+u;(f!==this._currentGroupHash||n)&&(this._currentGroupHash=f,c=!0),c&&this.disableAttributes();var p=this._gl,d=h.attributes.index,m=this.bufferNodeMap[a._id];if(d){var g=h.offsets;1<g.length&&(c=!0);for(var y=0,v=g.length;y<v;y++)g[y].index,c&&(Object.keys(h.attributes).forEach(function(e){if("index"!==e){var t=o.attributeSizes[e];if(t){var i=h.attributes[e];p.bindBuffer(p.ARRAY_BUFFER,m[e]),l.enableAttribute(s[e]),p.vertexAttribPointer(s[e],t,i.type||p.FLOAT,!1,i.stride||0,0)}}}),a._info&&a._info.weights&&p.uniform1fv(o.uniforms.morphTargetInfluences,a._info.weights),a._skin&&p.uniformMatrix4fv(o.uniforms.boneGlobalMatrices,!1,a._skin.jointMatrix),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,m.index)),p.drawElements(p[a.mode],g[y].count,d.element_type,g[y].start*d.element_size),this.info.render.calls++,this.info.render.vertices+=g[y].count,this.info.render.faces+=g[y].count/3}else{c&&Object.keys(h.attributes).forEach(function(e){if("index"!==e){var t=o.attributeSizes[e];if(t){var i=h.attributes[e];p.bindBuffer(p.ARRAY_BUFFER,m[e]),l.enableAttribute(s[e]),p.vertexAttribPointer(s[e],t,i.type||p.FLOAT,!1,i.stride||0,0)}}});var x=h.attributes.position;p.drawArrays(p[a.mode],0,x.array.length/3),this.info.render.calls++,this.info.render.vertices+=x.array.length/3,this.info.render.faces+=x.array.length/3/3}}},getOverLoadMaterial:function(e,t){return null},renderGroup:function(e,t,i,r,a){if(null==i&&console.log("material is null"),!1!==i.visible){var n,o,s,l,h,c,u,f=this._gl;if(a instanceof Se.Entity?n=this.groupMap[r.id]:a instanceof Se.Line?n=this.lineMap[r._id]:a instanceof Se.Particle&&(n=this.particleMap[r._id]),null!=n){if(o=this.pm.setProgram(e,t,this._fog,i,r,a)){s=o.attributes;var p,d=!1,m=i.wireframe?1:0;if((p=null!=r.id?16777215*r.id+2*o.id+m:r._id+""+(2*o.id+m))!==this._currentGroupHash&&(this._currentGroupHash=p,d=!0),d&&this.disableAttributes(),d&&(n._vao&&n._vao.bind(),!n._vao||n._vao.dirty)){if(0<=s.position&&d&&(f.bindBuffer(f.ARRAY_BUFFER,n.__webglVertexBuffer),this.enableAttribute(s.position),f.vertexAttribPointer(s.position,3,f.FLOAT,!1,0,0)),n.__webglCustomAttributesList)for(c=0,u=n.__webglCustomAttributesList.length;c<u;c++)0<=s[(h=n.__webglCustomAttributesList[c]).buffer.belongsToAttribute]&&(f.bindBuffer(f.ARRAY_BUFFER,h.buffer),this.enableAttribute(s[h.buffer.belongsToAttribute]),f.vertexAttribPointer(s[h.buffer.belongsToAttribute],h.size,f.FLOAT,!1,0,0));0<=s.color&&(f.bindBuffer(f.ARRAY_BUFFER,n.__webglColorBuffer),this.enableAttribute(s.color),f.vertexAttribPointer(s.color,3,f.FLOAT,!1,0,0)),0<=s.normal&&(f.bindBuffer(f.ARRAY_BUFFER,n.__webglNormalBuffer),this.enableAttribute(s.normal),f.vertexAttribPointer(s.normal,3,f.FLOAT,!1,0,0)),0<=s.uv&&(f.bindBuffer(f.ARRAY_BUFFER,n.__webglUVBuffer),this.enableAttribute(s.uv),f.vertexAttribPointer(s.uv,2,f.FLOAT,!1,0,0)),0<=s.uv2&&(f.bindBuffer(f.ARRAY_BUFFER,n.__webglUV2Buffer),this.enableAttribute(s.uv2),f.vertexAttribPointer(s.uv2,2,f.FLOAT,!1,0,0)),0<=s.lineDistance&&(f.bindBuffer(f.ARRAY_BUFFER,n.__webglLineDistanceBuffer),this.enableAttribute(s.lineDistance),f.vertexAttribPointer(s.lineDistance,1,f.FLOAT,!1,0,0)),n._vao&&(n._vao.dirty=!1)}if(a instanceof Se.Entity){var g=n.elementIndexUInt?f.UNSIGNED_INT:f.UNSIGNED_SHORT;i.wireframe?(this.setLineWidth(i.wireframeLinewidth),this._gl.lineJoin="round",d&&f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,n.__webglLineBuffer),f.drawElements(f.LINES,n.__webglLineCount,g,0)):(d&&f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,n.__webglFaceBuffer),f.drawElements(f.TRIANGLES,n.__webglFaceCount,g,0)),this.info.render.calls++,this.info.render.vertices+=n.__webglFaceCount,this.info.render.faces+=n.__webglFaceCount/3}else a instanceof Se.Line?(l=a.type===Se.LineStrip?f.LINE_STRIP:f.LINES,this.setLineWidth(i.linewidth),f.drawArrays(l,0,n.__webglLineCount),this.info.render.calls++):a instanceof Se.Particle?(f.drawArrays(f.POINTS,0,n.__webglParticleCount),this.info.render.calls++,this.info.render.points+=n.__webglParticleCount):a instanceof Se.Ribbon&&(f.drawArrays(f.TRIANGLE_STRIP,0,r.__webglVertexCount),this.info.render.calls++);n._vao&&n._vao.unbind()}}else this.debug&&console.error("tempGroup for id:"+(r.id||r._id)+" is null,please check")}},prepareData:function(){this.maxLightCount=this.dataBox.allocateLights(this._maxLights),this.maxShadows=this.dataBox.allocateShadows(),this.maxPointShadows=this.dataBox.allocatePointShadows()},wrapBillboardMaterial:function(e){e instanceof Se.Billboard&&e.material&&(e.opaque=e.material.transparent?null:e.material,e.transparent=e.material.transparent?e.material:null)},sortNodesFunc:function(e){if(this.sortNodes&&(null!==this.paintSortFunction||this.sortOpaqueOrderByMaterial)){var a=this;this.sortOpaqueOrderByMaterial?null==this.__st&&(this.__st=function(e,t){if(a.wrapBillboardMaterial(e),a.wrapBillboardMaterial(e),e.opaque&&t.opaque)return e.opaque.id-t.opaque.id;if(!e.opaque&&t.opaque)return-1;if(e.opaque&&!t.opaque)return 1;if(e.transparent&&t.transparent)return e.transparent.id-t.transparent.id;var i=e.node?e.node:e,r=t.node?t.node:t;return i.z=e.z,r.z=t.z,a.paintSortFunction?a.paintSortFunction(i,r):void 0}):null==this.__st&&(this.__st=function(e,t){if(e.transparent||t.transparent)return e.transparent&&t.transparent?e.transparent.id-t.transparent.id:e.transparent?-1:1;var i=e.node?e.node:e,r=t.node?t.node:t;return i.z=e.z,r.z=t.z,a.paintSortFunction?a.paintSortFunction(i,r):void 0}),e.sort(this.__st)}return e},paintTopCanvas:function(){var e=this._topCanvas.getContext("2d");e.clearRect(0,0,this._topCanvas.width,this._topCanvas.height);var t=this.areaPickingRect;t&&(e.beginPath(),e.lineStyle="#FFffff",e.rect(t.x,t.y,t.w,t.h),e.stroke()),this.renderLicense()},setBackgroundImage:function(e){if("string"==typeof e){var t=new Image;e.startsWith("data:image")||(t.crossOrigin="use-credentials"),t.src=e,this._backgroundImage=t;var i=this;t.onload=function(){i.dirtyNetwork()}}else this._backgroundImage=e,this.dirtyNetwork()},paintBottom:function(e){var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);var i=this._backgroundImage;i instanceof Image&&i.height&&t.drawImage(i,0,0,e.width,e.height)},initBufferNode:function(e){if(!this.bufferNodeMap[e._id]){var t={};this.bufferNodeMap[e._id]=t;var i,r,a,n=this._gl;for(i in e.attributes)a="index"===i?n.ELEMENT_ARRAY_BUFFER:n.ARRAY_BUFFER,r=e.attributes[i],t[i]=n.createBuffer(),n.bindBuffer(a,t[i]),n.bufferData(a,r.array,n.STATIC_DRAW)}},setBufferNodeData:function(e,t,i){var r=this.bufferNodeMap[e._id],a=e.attributes,n=a.index,o=a.position,s=a.normal,l=a.uv,h=a.color,c=(a.tangent,this._gl);if(e.elementsNeedUpdate&&n!==Me&&(c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r.index),c.bufferData(c.ELEMENT_ARRAY_BUFFER,n.array,t)),e.verticesNeedUpdate&&o!==Me&&(c.bindBuffer(c.ARRAY_BUFFER,r.position),c.bufferData(c.ARRAY_BUFFER,o.array,t)),e.normalsNeedUpdate&&s!==Me&&(c.bindBuffer(c.ARRAY_BUFFER,r.normal),c.bufferData(c.ARRAY_BUFFER,s.array,t)),e.uvsNeedUpdate&&l!==Me&&(c.bindBuffer(c.ARRAY_BUFFER,r.uv),c.bufferData(c.ARRAY_BUFFER,l.array,t)),e.colorsNeedUpdate&&h!==Me&&(c.bindBuffer(c.ARRAY_BUFFER,r.color),c.bufferData(c.ARRAY_BUFFER,h.array,t)),i)for(var u in e.attributes);},initGroupBuffer:function(e,t,i,r){var a=this._gl,n=t.faces3,o=t.faces4,s=3*n.length+4*o.length,l=1*n.length+2*o.length,h=3*n.length+4*o.length,c=fe.getMaterial(e,t.materialIndex?t.materialIndex:0),u=c.needUV(),f=c.getNormalType(),p=c.isVertexColor(),d=c.isGradientColor();if(i.__vertexArray=new Float32Array(3*s),f&&(i.__normalArray=new Float32Array(3*s)),!r){var m,g;if(p&&(i.__colorArray=new Float32Array(3*s)),d&&(i.__color2Array=new Float32Array(6)),u&&(i.__uvArray=new Float32Array(2*s),e.uv2s&&(i.__uv2Array=new Float32Array(2*s))),i.elementIndexUInt?(i.__faceArray=new Uint32Array(3*l),i.__lineArray=new Uint32Array(2*h)):(i.__faceArray=new Uint16Array(3*l),i.__lineArray=new Uint16Array(2*h)),t.numMorphTargets)for(i.__morphTargetsArrays=[],m=0,g=t.numMorphTargets;m<g;m++)i.__morphTargetsArrays.push(new Float32Array(3*s));if(t.numMorphNormals)for(i.__morphNormalsArrays=[],m=0,g=t.numMorphNormals;m<g;m++)i.__morphNormalsArrays.push(new Float32Array(3*s));if(i.__webglFaceCount=3*l,i.__webglLineCount=2*h,c.attributes)for(var y in i.__webglCustomAttributesList=[],c.attributes){var v=c.attributes[y],x={};for(var A in v)x[A]=v[A];if(!x.__webglInitialized||x.createUniqueBuffers){x.__webglInitialized=!0;var _=1;"v2"===x.type?_=2:"v3"===x.type?_=3:"v4"===x.type?_=4:"c"===x.type&&(_=3),x.size=_,x.array=new Float32Array(s*_),x.buffer=a.createBuffer(),x.buffer.belongsToAttribute=y,v.needsUpdate=!0,x.__original=v,x.value=e.data[x.ref]}i.__webglCustomAttributesList.push(x)}i.__inittedArrays=!0}},createLineBuffers:function(e){null==this.lineMap[e._id]&&(this.lineMap[e._id]={});var t=this.lineMap[e._id],i=this._gl;t.__webglVertexBuffer=i.createBuffer(),t.__webglColorBuffer=i.createBuffer(),t.__webglLineDistanceBuffer=i.createBuffer(),this.info.memory.geometries++},initLineBuffers:function(e){null==this.lineMap[e._id]&&(this.lineMap[e._id]={});var t=this.lineMap[e._id],i=e.vertices.length;t.__vertexArray=new Float32Array(3*i),t.__colorArray=new Float32Array(3*i),t.__color2Array=new Float32Array(6),t.__lineDistanceArray=new Float32Array(1*i),t.__webglLineCount=i},createParticleBuffers:function(e){null==this.particleMap[e._id]&&(this.particleMap[e._id]={});var t=this.particleMap[e._id],i=this._gl;t.__webglVertexBuffer=i.createBuffer(),t.__webglColorBuffer=i.createBuffer(),t.__webglNormalBuffer=i.createBuffer(),this.info.memory.geometries++},initParticleBuffers:function(e){null==this.particleMap[e._id]&&(this.particleMap[e._id]={});var t=this.particleMap[e._id],i=e.vertices.length;t.__vertexArray=new Float32Array(3*i),t.__colorArray=new Float32Array(3*i),t.__normalArray=new Float32Array(3*i),t.__sortArray=[],t.__webglParticleCount=i},createGroupBuffer:function(e,t){var i=this._gl;t.__webglVertexBuffer=i.createBuffer(),t.__webglNormalBuffer=i.createBuffer(),t.__webglColorBuffer=i.createBuffer(),t.__webglColor2Buffer=i.createBuffer(),t.__webglUVBuffer=i.createBuffer(),t.__webglUV2Buffer=i.createBuffer(),t.__webglFaceBuffer=i.createBuffer(),t.__webglLineBuffer=i.createBuffer(),new Ke(this,t),t.elementIndexUInt=e.elementIndexUInt,this.info.memory.geometries++},setRenderTarget:function(e){var t,i,r,a,n,o=e instanceof et,s=this._gl;if(e&&!e.__webglFramebuffer){e.depthBuffer===Me&&(e.depthBuffer=!0),e.stencilBuffer===Me&&(e.stencilBuffer=!0),e.__webglTexture=s.createTexture(),this.info.memory.textures++;var l=je.isPowerOfTwo,h=l(e.width)&&l(e.height),c=je.paramToGL(e.format,s),u=je.paramToGL(e.type,s);e.type,Se.FloatType;var f=c;if(o){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],s.bindTexture(s.TEXTURE_CUBE_MAP,e.__webglTexture),this.pm.setTextureParameters(s.TEXTURE_CUBE_MAP,e,h);for(var p=0;p<6;p++)e.__webglFramebuffer[p]=s.createFramebuffer(),e.__webglRenderbuffer[p]=s.createRenderbuffer(),s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,f,e.width,e.height,0,c,u,null),this.setupFrameBuffer(e.__webglFramebuffer[p],e,s.TEXTURE_CUBE_MAP_POSITIVE_X+p),this.setupRenderBuffer(e.__webglRenderbuffer[p],e);h&&e.generateMipmaps&&s.generateMipmap(s.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=s.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=s.createRenderbuffer(),s.bindTexture(s.TEXTURE_2D,e.__webglTexture),this.pm.setTextureParameters(s.TEXTURE_2D,e,h),s.texImage2D(s.TEXTURE_2D,0,f,e.width,e.height,0,c,u,null),this.setupFrameBuffer(e.__webglFramebuffer,e,s.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e.__webglRenderbuffer):this.setupRenderBuffer(e.__webglRenderbuffer,e),h&&e.generateMipmaps&&s.generateMipmap(s.TEXTURE_2D);o?s.bindTexture(s.TEXTURE_CUBE_MAP,null):s.bindTexture(s.TEXTURE_2D,null),s.bindRenderbuffer(s.RENDERBUFFER,null),s.bindFramebuffer(s.FRAMEBUFFER,null)}e?(t=o?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,i=e.width,r=e.height,n=a=0):(t=null,i=this._viewportWidth,r=this._viewportHeight,a=this._viewportX,n=this._viewportY),t!==this._currentFramebuffer&&(s.bindFramebuffer(s.FRAMEBUFFER,t),s.viewport(a,n,i,r),this._currentFramebuffer=t),this._currentWidth=i,this._currentHeight=r},setupFrameBuffer:function(e,t,i){var r=this._gl;r.bindFramebuffer(r.FRAMEBUFFER,e),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,i,t.__webglTexture,0)},setupRenderBuffer:function(e,t){var i=this._gl;i.bindRenderbuffer(i.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e)):i.renderbufferStorage(i.RENDERBUFFER,i.RGBA4,t.width,t.height)},setLineWidth:function(e){if(e!==this._oldLineWidth){try{this._gl.lineWidth&&this._gl.lineWidth(e)}catch(e){}this._oldLineWidth=e}},setupMatrices:function(e,t){e.fixSize(t),e.updateWorldMatrix(),e._modelViewMatrix.multiplyMatrices(t.worldMatrixInverse,e.worldMatrix),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)},setDefaultGLState:function(){var e=this._gl,t=new Se.Color(this._clearColor);e.clearColor(t.r,t.g,t.b,this._clearAlpha),e.clearDepth(1),le.isIE||e.clearStencil(0),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.frontFace(e.CCW),e.cullFace(e.BACK),e.enable(e.CULL_FACE),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)},clear:function(e,t,i){var r=this._gl,a=0;(e===Me||e)&&(a|=r.COLOR_BUFFER_BIT),(t===Me||t)&&(a|=r.DEPTH_BUFFER_BIT),(i===Me||i)&&(a|=r.STENCIL_BUFFER_BIT),r.clear(a)},setGLFaces:function(e){var t=this._gl,i=e.side===Se.DoubleSide,r=e.side===Se.BackSide;this._oldDoubleSided!==i&&(i?t.disable(t.CULL_FACE):t.enable(t.CULL_FACE),this._oldDoubleSided=i),this._oldFlipSided!==r&&(r?t.frontFace(t.CW):t.frontFace(t.CCW),this._oldFlipSided=r)},getView:function(){return this._canvas},getRootView:function(){return this._rootView},setBlending:function(e,t,i,r){Ze.setBlending(e,t,i,r,this)},setDepthTest:function(e){Ze.setDepthTest(e,this)},setStencilTest:function(e){this._oldStencilTest!=e&&(e?this._gl.enable(this._gl.STENCIL_TEST):this._gl.disable(this._gl.STENCIL_TEST),this._oldStencilTest=e)},_setStencilMask:function(e){this._oldStencilMask!==e&&(this._gl.stencilMask(e),this._oldStencilMask=e)},setDepthWrite:function(e){Ze.setDepthWrite(e,this)},getLineWidthRange:function(){var e=this._gl;return e.getParameter(e.ALIASED_LINE_WIDTH_RANGE)},setTexture:function(e,t){this.pm.setTexture(e,t)},disableAttributes:function(){for(var e in this._enabledAttributes)this._enabledAttributes[e]&&(this._gl.disableVertexAttribArray(e),this._enabledAttributes[e]=!1)},enableAttribute:function(e){this._enabledAttributes[e]||(this._gl.enableVertexAttribArray(e),this._enabledAttributes[e]=!0)},adjustRootViewBounds:function(e,t){var i=this._rootView;i.style.width=e+"px",i.style.height=t+"px"},adjustCanvasBounds:function(e,t,i,r,a){e.width=t*this.devicePixelRatio,e.height=i*this.devicePixelRatio,e.style.margin="0px",e.style.padding="0px",e.style.width=t+"px",e.style.height=i+"px"},adjustBounds:function(e,t,i,r){var a=this.getView();if(this._w=e,this._h=t,this.adjustRootViewBounds(e,t,i,r),this.adjustCanvasBounds(a,e,t,i,r),this.adjustCanvasBounds(this._topCanvas,e,t,i,r),this.adjustCanvasBounds(this._bottomCanvas,e,t,i,r),this.adjustCallback(e,t,i,r),this.setViewport(0,0,a.width,a.height),this.autoUpdateCameraAspect&&0!==t){var n=this._camera;n.aspect=e/t,n.updateProjectionMatrix(),this._currentCamera=null}this.dirtyNetwork()},adjustCallback:function(){},setViewport:function(e,t,i,r){var a=this.getView();this._viewportX=e!==Me?e:0,this._viewportY=t!==Me?t:0,this._viewportWidth=i!==Me?i:a.width,this._viewportHeight=r!==Me?r:a.height,this._gl.viewport(this._viewportX,this._viewportY,this._viewportWidth,this._viewportHeight)},setShowAxis:function(e){this.showAxis!==e&&(this.showAxis=e,this.showAxis&&(this.helperBox.contains(this.axis)||this.helperBox.addByDescendant(this.axis)),this.axis._visible=e,this.dirtyNetwork())},setShowAxisText:function(e){this.axis.showAxisText(e),this.dirtyNetwork()},setAxisSize:function(e){this.axis.setSize(e)},onSelect:function(e){null!=this.onSelectFunction&&this.onSelectFunction(e)},setOnSelectFunction:function(e){this.onSelectFunction=e},isSelectable:function(e){return!!e.isSelectable()&&(!this.selectableFunction||this.selectableFunction(e))},setSelectableFunction:function(e){this.selectableFunction=e},setRenderSelectFunction:function(e){this.renderSelectFunction=e},renderSelect:function(e){return!this.renderSelectFunction||this.renderSelectFunction(e)},renderAlarmBorder:function(e){return!this.renderAlarmBorderFunction||this.renderAlarmBorderFunction(e)},selectable:function(e){return this.isVisible(e.element)&&this.isSelectable(e.element)&&this.getDataBox().getSelectionModel().isSelectable(e.element)},editable:function(e){var t=this.selectable(e);return t&&null!=this.editableFunction?this.editableFunction(e.element):t},getFirstSelectElement:function(e){if(null==e)return null;for(var t,i=0;i<e.length;){var r=e[i];if(this.selectable(r)){t=r.element;break}i++}return t},getFirstEditElement:function(e){if(null==e)return null;for(var t,i=0;i<e.length;){var r=e[i];if(this.editable(r)){t=r.element;break}i++}return t},toImageData:function(e,t,i,r){return this.dirtyNetwork(),this.render(),(e=e||"PNG").toUpperCase(),"PNG"===e?he.saveAsPNG(this.getView(),t,!1,i,r):"JPEG"===e?he.saveAsJPEG(this.getView(),t,!1,i,r):"BMP"===e?he.saveAsBMP(this.getView(),t,!1,i,r):void console.log("Not surport type "+e)},getPickingByEvent:function(e){var t=this._camera,i={},r=this.getView().getBoundingClientRect(),a=e.clientX,n=e.clientY;e.touches&&e.touches.length&&(a=e.touches[0].pageX,n=e.touches[0].pageY);var o=(a-r.left)/r.width,s=(n-r.top)/r.height;i.x=2*o-1,i.y=2*-s+1;var l=new Se.Vec3(i.x,i.y,.5);this.projector.unprojectVector(l,t);var h=null;if(t instanceof Se.PerspectiveCamera)h=new Se.Picking(t._position,l.sub(t._position).normalize(),t.up,null,null,this);else{var c=l.clone().sub(t._position),u=t.getTarget().clone().sub(t.p()).normalize(),f=u.multiplyScalar(c.clone().dot(u)),p=c.sub(f),d=(new Q).addVectors(t._position,p);h=new Se.Picking(d,l.sub(d).normalize(),t.up,null,null,this)}return h},getElementsByMouseEvent:function(e,t,i){var r=this.getPickingByEvent(e),a=new xe;return a.addAll(this.dataBox.getNodes()),a.addAll(this.dataBox.getBillboards()),i&&a.addAll(new xe(this.alarmBillboards)),r.intersectObjects(a.toArray(),!1,t)},getElementByColorPicking:function(e,n){var o=this,s=o._gl,t=o.getView().getBoundingClientRect(),i=(e.touches?e.touches[0]:e).clientX-t.left,r=(e.touches?e.touches[0]:e).clientY-t.top,a=o._pickingTarget.width,l=o._pickingTarget.height,h=new Uint8Array(4),c=o._pickingProgram;if(o.pm.currentProgram=null,o.setRenderTarget(o._pickingTarget),!o._pickingProgram){var u=s.createProgram(),f=s.createShader(s.FRAGMENT_SHADER),p=s.createShader(s.VERTEX_SHADER);s.shaderSource(f,"precision highp float;uniform vec4 u_color; void main () { gl_FragColor = u_color; }"),s.shaderSource(p,"precision highp float;attribute vec3 a_position;uniform mat4 u_viewProjectMatrix;uniform mat4 u_modelMatrix;void main () { gl_Position = u_viewProjectMatrix * u_modelMatrix * vec4(a_position, 1.0); }"),s.compileShader(f),s.compileShader(p),s.attachShader(u,f),s.attachShader(u,p),s.linkProgram(u),u._u_color=s.getUniformLocation(u,"u_color"),u._u_viewProjectMatrix=s.getUniformLocation(u,"u_viewProjectMatrix"),u._u_modelMatrix=s.getUniformLocation(u,"u_modelMatrix"),c=o._pickingProgram=u}return s.useProgram(c),s.viewport(0,0,a,l),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.uniformMatrix4fv(c._u_viewProjectMatrix,!1,o._projScreenMatrix.elements),o.glNodeList.forEach(function(e){var t=e.node;if(o.isVisible(t)&&t.getStyle("m.visible")&&0!==t.getStyle("m.transparent")&&(!n||n(t))&&t.computed){s.uniformMatrix4fv(c._u_modelMatrix,!1,t.worldMatrix.elements);var i=t._pickingColor;if(s.uniform4f(c._u_color,i[0],i[1],i[2],i[3]),t instanceof mono.BufferNode){var r=o.bufferNodeMap[t._id];r&&r.position&&(s.bindBuffer(s.ARRAY_BUFFER,r.position),s.enableVertexAttribArray(0),s.vertexAttribPointer(0,3,s.FLOAT,!1,0,0),r.index?(s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.index),s.drawElements(s[t.mode],t.attributes.index.array.length,s.UNSIGNED_SHORT,0)):s.drawArrays(s[t.mode],0,t.attributes.position.array.length/3))}else{var a=o.groupMap[e.group.id];a&&(s.bindBuffer(s.ARRAY_BUFFER,a.__webglVertexBuffer),s.enableVertexAttribArray(0),s.vertexAttribPointer(0,3,s.FLOAT,!1,0,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,a.__webglFaceBuffer),s.drawElements(s[t.mode],a.__webglFaceCount,s.UNSIGNED_SHORT,0))}}}),s.readPixels(Math.floor(i*a/o._w),Math.floor(l-r*l/o._h),1,1,s.RGBA,s.UNSIGNED_BYTE,h),o.setRenderTarget(),o._pickingNodeMap[(h[0]<<24)+(h[1]<<16)+(h[2]<<8)+h[3]]},getElementByScreenPoint:function(e,t,i){var r={},a=this.getView(),n=this._camera,o=a.getBoundingClientRect();e.x&&(i=t,t=e.y,e=e.x),e/=o.width,t/=o.height,r.x=2*e-1,r.y=2*-t+1;var s=new Se.Vec3(r.x,r.y,.5);this.projector.unprojectVector(s,n);var l=new Se.Picking(n._position,s.sub(n._position).normalize(),n.up,null,null,this),h=new xe;return h.addAll(this.dataBox.getNodes()),h.addAll(this.dataBox.getBillboards()),l.intersectObjects(h.toArray(),!1,i)},getFirstElementByMouseEvent:function(e,t,i,r){var a=this.getElementsByMouseEvent(e,t,r);if(a.length)for(var n=0;n<a.length;n++){var o=a[n],s=o.element;if(null==i||i.call(null,s))return o}return null},getUnProjectVector:function(e){var t={},i=this.getView().getBoundingClientRect(),r=e.x/i.width,a=e.y/i.height;t.x=2*r-1,t.y=2*-a+1;var n=new Se.Vec3(t.x,t.y,.5);return this.projector.unprojectVector(n,this._camera),n},getFrustumByBounding:function(e){var t=e,i=this.getUnProjectVector(new pe(t.x,t.y)),r=this.getUnProjectVector(new pe(t.x+t.w,t.y)),a=this.getUnProjectVector(new pe(t.x,t.y+t.h)),n=this.getUnProjectVector(new pe(t.x+t.w,t.y+t.h)),o=this.getNearFarPoints(i),s=this.getNearFarPoints(r),l=this.getNearFarPoints(a),h=this.getNearFarPoints(n),c=new Se.math.Plane,u=new Se.math.Plane,f=new Se.math.Plane,p=new Se.math.Plane,d=new Se.math.Plane,m=new Se.math.Plane;c.setFromCoplanarPoints(o[0],s[0],l[0]),u.setFromCoplanarPoints(o[0],o[1],s[0]),f.setFromCoplanarPoints(o[0],l[0],o[1]),p.setFromCoplanarPoints(s[0],s[1],h[0]),d.setFromCoplanarPoints(l[0],h[0],l[1]),m.setFromCoplanarPoints(o[1],l[1],s[1]);var g=new Se.Frustum(c,u,f,p,d,m);return g.setPoints([o[0],s[0],l[0],h[0],o[1],s[1],l[1],h[1]]),g},getNearFarPoints:function(e){var t=this._camera,i=e.sub(t._position).normalize(),r=t.target.clone().sub(t._position),a=i.angleTo(r),n=t.getNear()/Math.acos(a),o=t.getFar()/Math.acos(a);return[t._position.clone().add(i.clone().multiplyScalar(n)),t._position.clone().add(i.clone().multiplyScalar(o))]},getSpacePointOnPlane:function(e,t){var i={},r=this.getView(),a=this._camera,n=r.getBoundingClientRect(),o=e.clientX,s=e.clientY;e.touches&&e.touches.length&&(o=e.touches[0].pageX,s=e.touches[0].pageY);var l=(o-n.left)/n.width,h=(s-n.top)/n.height;i.x=2*l-1,i.y=2*-h+1;var c=new Se.Vec3(i.x,i.y,.5);this.projector.unprojectVector(c,a);var u=a._position;if(a instanceof mono.OrthoCamera){var f=new Se.Vec3(0,0,.5);this.projector.unprojectVector(f,a),u=u.clone().sub(f.sub(c))}var p=c.sub(u).normalize(),d=new Se.Ray(u,p),m=d.distanceToPlane(t);return m<0||Math.abs(m)<Se.Picking.prototype.precision?null:d.at(m)},getElementsByBounding:function(e,t,s){var i=new xe;i.addAll(this.dataBox.getNodes()),i.addAll(this.dataBox.getBillboards());var l,h=this.getFrustumByBounding(e),c=[],u=new Q,f=this._camera;return i.forEach(function(e){if(e instanceof Se.Billboard){u.setFromMatrixPosition(e.worldMatrix);var t=e.material,i=t.alignment;l=new Se.Plane(1,1),(i.x||i.y)&&(l.setPosition(i.x,i.y,0),l=Se.Utils.transformElement(l,!0)),l.setPosition(u);var r=(new Q).getScaleFromMatrix(e.worldMatrix);l.setScale(r.x,r.y,1);var a=f.getTarget().clone(),n=f.getPosition();a.sub(n);var o=l.getPosition().clone();t&&t.vertical&&(a.y=0),o.sub(a),l.lookAt(o),l.updateWorldMatrix(!0),h.intersectsObjectAccurate(l,s)&&c.push({element:e})}else Se.Line,h.intersectsObjectAccurate(e,s)&&c.push({element:e})}),c},getViewPosition:function(e){var t=new Q;return(t=this.projector.projectVector(e,this._camera,t)).x=t.x/2+.5,t.y=-t.y/2+.5,{x:this._canvas.width*t.x/this.devicePixelRatio,y:this._canvas.height*t.y/this.devicePixelRatio,h:this._canvas.height}},setInteractions:function(e){var t,i=this._interactions;if(i)for(t=0;t<i.length;t++)i[t].tearDown();if(this._interactions=e)for(t=0;t<e.length;t++)e[t].setUp()},getDefaultInteraction:function(){if(this._interactions&&0<this._interactions.length)for(var e=0;e<this._interactions.length;e++){var t=this._interactions[e];if(t instanceof Se.DefaultInteraction)return t}return null},getInteractions:function(){return this._interactions},fireInteractionEvent:function(e){this._interactionDispatcher.fire(e)},addInteractionListener:function(e,t,i){this._interactionDispatcher.add(e,t,i)},removeInteractionListener:function(e,t){this._interactionDispatcher.remove(e,t)},dispose:function(){this._animateId&&((this._vrDisplay&&this._vrDisplay.isPresenting?this._vrDisplay:q).cancelAnimationFrame(this._animateId),this._animateId=null),this.setInteractions(null),this.pm.dispose(),this._resizeFunction&&q.removeEventListener("resize",this._resizeFunction)},setRenderInterval:function(e){(je.isNaN(e)||e<=5)&&(e=5),this._renderInterval=e},_computeNetworkBoundingBox:function(){function e(e,t){e.applyMatrix4(t),s.push(e)}var t,i,r,a,n=this.getDataBox().size(),o=this.getDataBox().getDatas(),s=[];for(t=0;t<n;t++)if((i=o.get(t))instanceof Se.Node){r=i.getBoundingBox(),a=i.worldMatrix;var l=r.min,h=r.max;e(l.clone(),a),e(h.clone(),a),e(new Q(l.x,l.y,h.z),a),e(new Q(l.x,h.y,l.z),a),e(new Q(h.x,l.y,l.z),a),e(new Q(h.x,h.y,l.z),a),e(new Q(h.x,l.y,h.z),a),e(new Q(l.x,h.y,h.z),a)}if(s.length<=1)return null;var c=new Se.BoundingBox;return c.setFromPoints(s),c},getNetworkBoundingBox:function(){return null==this.boundingBox&&(this.boundingBox=this._computeNetworkBoundingBox()),this.boundingBox},getSelectStyle:function(e){return e.getSelectStyle()},setZoomStandard:function(e){this._zoomStandard=e},getZoomStandard:function(){return this._zoomStandard},zoom:function(e,t){t=t||this._zoomStandard,this._camera.zoom(e,t)},zoomIn:function(e){this.zoom(.9,e)},zoomOut:function(e){this.zoom(1.1,e)},move:function(e,t){new mono.Vec3(-e,-t,0);var i=this._camera.t(),r=this._camera.p();this._camera.translateX(-e),this._camera.translateY(-t);var a=this._camera.p();i.add(a.clone().sub(r)),this._camera.lookAt(i)},moveLeft:function(e){e=e||50,this.move(-e,0)},moveRight:function(e){e=e||50,this.move(e,0)},moveUp:function(e){e=e||30,this.move(0,e)},moveDown:function(e){e=e||30,this.move(0,-e)},zoomEstimateOverview:function(e){var t=this.getNetworkBoundingBox();if(null!=t){var i,r=t.center(),a=new Q(0,t.max.y-t.min.y,t.max.z-t.min.z),n=new Q(t.max.x-t.min.x,0,0,0),o=a.clone();if(o.length()<n.length()&&(o=n.clone()),e){var s=a.length();a.y=a.z*Math.tan(e/180*Math.PI),a.setLength(s)}i=(new Q).addVectors(r,a.multiplyScalar(.5));var l=this._camera.fov,h=(this._camera.aspect,o.length()/2/Math.tan(l*Math.PI/180));i.add(a.normalize().multiplyScalar(h)),this._camera.setPosition(i),this._camera.lookAt(r),this._overviewDistance=this._camera.getDistance()}},_onVRRequestPresent:function(){var e=this,t=e._canvas,i=e._vrDisplay;if(i){e._oldCamera=e._camera;var r=new mono.VRCamera(e,e._oldCamera.near,e._oldCamera.far);r.setPosition(e._camera.getPosition()),e.setCamera(r),i.requestPresent([{source:t}]).then(function(){e._isPresenting=!0,e.onEnterVR()},function(e){console.log("requestPresent failed.",e)})}},onEnterVR:function(){},onExitVR:function(){},_onVRExitPresent:function(){var e=this,t=e._vrDisplay;t&&t.isPresenting&&t.exitPresent().then(function(){e._isPresenting=!1,e.onExitVR(),e.setCamera(e._oldCamera),e._oldCamera=null},function(){console.log("exitPresent failed.")})},enterVR:function(){this._onVRRequestPresent()},_initVR:function(){var r,a=this,n=a._canvas;a._vrDisplay||navigator.getVRDisplays&&navigator.getVRDisplays().then(function(e){e&&e.length&&((r=a._vrDisplay=e[0]).depthNear=a._camera.near,r.depthFar=a._camera.far,a.onVRRequestPresent||(a.onVRRequestPresent=function(e){a._onVRRequestPresent()}),a.onVRExitPresent||(a.onVRExitPresent=function(e){a._onVRExitPresent()}),a.onVRPresentChange||(a.onVRPresentChange=function(e){if(r.isPresenting){var t=r.getEyeParameters("left"),i=r.getEyeParameters("right");n.width=2*Math.max(t.renderWidth,i.renderWidth),n.height=Math.max(t.renderHeight,i.renderHeight)}else a.adjustBounds(a._rootView.clientWidth,a._rootView.clientHeight)}),q.addEventListener("vrdisplaypresentchange",a.onVRPresentChange,!1),q.addEventListener("vrdisplayactivate",a.onVRRequestPresent,!1),q.addEventListener("vrdisplaydeactivate",a.onVRExitPresent,!1))})},exitVR:function(){this._onVRExitPresent()},toggleVR:function(){this._isPresenting?this.exitVR():this.enterVR()},s:function(e){this.setStyle(e)},setStyle:function(e){var i=this;if(e){if(e.parentDom&&e.parentDom.appendChild(i.getRootView()),e.width&&e.height&&i.adjustBounds(e.width,e.height),e.autoAdjustBounds&&mono.Utils.autoAdjustNetworkBounds(i,document.documentElement,"clientWidth","clientHeight"),e.camera){var t=i.getCamera(),r=e.camera;null!=r.near&&t.setNear(r.near),null!=r.far&&t.setFar(r.far),null!=r.fov&&t.setFov&&t.setFov(r.fov),null!=r.width&&t.setWidth&&t.setWidth(r.width),null!=r.position&&t.setPosition(r.position),null!=r.target&&t.lookAt(r.target)}if(e.lights){var a=i.getDataBox();e.lights.forEach(function(e){var t;"directional"===e.type&&(t=new mono.DirectionalLight(e.color,e.intensity),e.direction&&t.setDirection(e.direction)),"point"===e.type&&(t=new mono.PointLight(e.color,e.intensity,e.distance),e.position&&t.setPosition(e.position)),"ambient"===e.type&&(t=new mono.AmbientLight(e.color)),"spot"===e.type&&(t=new mono.SpotLight(e.color,e.intensity,e.distance,e.angle,e.exponent)),t&&a.add(t)})}if(e.interactions){var n,o,s,l;i.getInteractions().forEach(function(e){e instanceof mono.DefaultInteraction&&(n=e),e instanceof mono.EditInteraction&&(o=e),e instanceof mono.SelectionInteraction&&(s=e)}),e.interactions.forEach(function(t){"default"===t.type&&(n||(n=new mono.DefaultInteraction(i)),l=n),"edit"===t.type&&(o||(o=new mono.EditInteraction(i)),l=o),"selection"===t.type&&(s||(s=new mono.SelectionInteraction(i)),l=s),Object.keys(t).forEach(function(e){"type"!==e&&(l[e]=t[e])})});var h=[];n&&h.push(n),o&&h.push(o),s&&h.push(s),i.setInteractions(h)}}}}),Se.Network3DId=0,Se.Network3D.GroupCache={_groupCounter:0},Se.Projector=function(){function X(){if(Q===i){var e=new $RenderObject;return t.push(e),i++,Q++,e}return t[Q++]}function G(){if(J===r){var e=new $RenderVertex;return se.push(e),r++,J++,e}return se[J++]}function Y(){if(ee===n){var e=new Se.RenderFace3;return a.push(e),n++,ee++,e}return a[ee++]}function W(){if(te===s){var e=new Se.RenderFace4;return o.push(e),s++,te++,e}return o[te++]}function j(){if(re===h){var e=new Se.RenderLine;return l.push(e),h++,re++,e}return l[re++]}function H(){if(ne===u){var e=new Se.RenderableParticle;return c.push(e),u++,ne++,e}return c[ne++]}function q(e,t){return t.z-e.z}var Z,Q,K,J,$,ee,te,ie,re,ae,ne,oe,t=[],i=0,se=[],r=0,a=[],n=0,o=[],s=0,l=[],h=0,c=[],u=0,le={objects:[],sprites:[],lights:[],elements:[]},he=new Se.Vec3,ce=new Se.Vec4,ue=new Se.BoundingBox(new Se.Vec3(-1,-1,-1),new Se.Vec3(1,1,1)),fe=new Se.BoundingBox,pe=new Array(3),de=new Array(4),me=new Se.Mat4,ge=new Se.Mat4,ye=new Se.Mat4,ve=new Se.Mat3,xe=new Se.Mat3,Ae=new Se.Vec3,_e=new Se.Frustum,we=new Se.Vec4,be=new Se.Vec4;this.projectVector=function(e,t,i){return t.worldMatrixInverse.getInverse(t.worldMatrix),ge.multiplyMatrices(t.projectionMatrix,t.worldMatrixInverse),i===Me?e.applyProjection(ge):(i.copy(e),i.applyProjection(ge))},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),ge.multiplyMatrices(t.worldMatrix,t.projectionMatrixInverse),e.applyProjection(ge)},this.pickingRay=function(e,t){e.z=-1;var i=new Se.Vec3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(i,t),i.sub(e).normalize(),new Se.Picking(e,i)};this.projectDataBox=function(e,t,i,r){var a,n,o,s,l,h,c,u,f,p,d,m,g,y,v,x,A,_,w,b,M,S,P,T,C,E,z,D,L,R,N,B=!1;ne=re=te=ee=0;for(var I=le.elements.length=0;I<e.getRoots().size();I++)e.getRoots().get(I).updateWorldMatrix();for(t.parent===Me&&t.updateWorldMatrix(!0,!1),me.copy(t.worldMatrixInverse.getInverse(t.worldMatrix)),ge.multiplyMatrices(t.projectionMatrix,me),xe.getInverse(me),xe.transpose(),_e.setFromMatrix(ge),a=0,n=(le=function(e,t){Q=0,le.objects.length=0,le.sprites.length=0,le.lights.length=0;var n=function(e){for(var t,i=0,r=(t=(t=e instanceof Se.DataBox?e.getRoots():e.getChildren()).toList()).size();i<r;i++)(a=t.get(i)).isSelected()&&a instanceof Se.Node&&(t.add(a.createCanvasSelectionCube(),i),i++);for(i=0,r=t.size();i<r;i++){var a=t.get(i);!1!==a._visible&&(a instanceof Se.Light?le.lights.push(a):a instanceof Se.Entity||a instanceof Se.Line?!1!==a.frustumCulled&&!0!==_e.intersectsObject(a)||(null!==((Z=X()).object=a).renderDepth?Z.z=a.renderDepth:(he.copy(a.worldMatrix.getPosition()),he.applyProjection(ge),Z.z=he.z),le.objects.push(Z)):a instanceof Se.Billboard||a instanceof Se.Particle?(null!==((Z=X()).object=a).renderDepth?Z.z=a.renderDepth:(he.copy(a.worldMatrix.getPosition()),he.applyProjection(ge),Z.z=he.z),le.sprites.push(Z)):(null!==((Z=X()).object=a).renderDepth?Z.z=a.renderDepth:(he.copy(a.worldMatrix.getPosition()),he.applyProjection(ge),Z.z=he.z),le.objects.push(Z)),n(a))}};return n(e),!0===t&&le.objects.sort(q),le}(e,i)).objects.length;a<n;a++)if(d=le.objects[a].object,oe=d.worldMatrix,J=0,d instanceof Se.Entity){for(g=(m=d).vertices,y=m.faces,A=m.uvs,ve.getInverse(oe),ve.transpose(),P=!0==(S=d.material instanceof Se.ArrayMaterial)?d.material:null,o=0,s=g.length;o<s;o++)(K=G()).positionWorld.copy(g[o]).applyMatrix4(oe),K.positionScreen.copy(K.positionWorld).applyMatrix4(ge),K.positionScreen.x/=K.positionScreen.w,K.positionScreen.y/=K.positionScreen.w,K.positionScreen.z/=K.positionScreen.w,K.visible=!(K.positionScreen.x<-1||1<K.positionScreen.x||K.positionScreen.y<-1||1<K.positionScreen.y||K.positionScreen.z<-1||1<K.positionScreen.z);for(l=0,h=y.length;l<h;l++){v=y[l];var F=!0===S?P.materials[v.materialIndex]:d.material;if(F!==Me){var V=F.side;if(v instanceof Se.Face3){if(_=se[v.a],w=se[v.b],b=se[v.c],pe[0]=_.positionScreen,pe[1]=w.positionScreen,pe[2]=b.positionScreen,!0!==_.visible&&!0!==w.visible&&!0!==b.visible&&!ue.isIntersectionBox(fe.setFromPoints(pe)))continue;if(B=(b.positionScreen.x-_.positionScreen.x)*(w.positionScreen.y-_.positionScreen.y)-(b.positionScreen.y-_.positionScreen.y)*(w.positionScreen.x-_.positionScreen.x)<0,V!==Se.DoubleSide&&B!==(V===Se.FrontSide))continue;($=Y()).v1.copy(_),$.v2.copy(w),$.v3.copy(b)}else if(v instanceof Se.Face4){if(_=se[v.a],w=se[v.b],b=se[v.c],M=se[v.d],de[0]=_.positionScreen,de[1]=w.positionScreen,de[2]=b.positionScreen,de[3]=M.positionScreen,!0!==_.visible&&!0!==w.visible&&!0!==b.visible&&!0!==M.visible&&!ue.isIntersectionBox(fe.setFromPoints(de)))continue;if(B=(M.positionScreen.x-_.positionScreen.x)*(w.positionScreen.y-_.positionScreen.y)-(M.positionScreen.y-_.positionScreen.y)*(w.positionScreen.x-_.positionScreen.x)<0||(w.positionScreen.x-b.positionScreen.x)*(M.positionScreen.y-b.positionScreen.y)-(w.positionScreen.y-b.positionScreen.y)*(M.positionScreen.x-b.positionScreen.x)<0,V!==Se.DoubleSide&&B!==(V===Se.FrontSide))continue;($=W()).v1.copy(_),$.v2.copy(w),$.v3.copy(b),$.v4.copy(M)}for($.normalModel.copy(v.normal),!1!==B||V!==Se.BackSide&&V!==Se.DoubleSide||$.normalModel.negate(),$.normalModel.applyMatrix3(ve).normalize(),$.normalModelView.copy($.normalModel).applyMatrix3(xe),$.centroidModel.copy(v.centroid).applyMatrix4(oe),c=0,u=(x=v.vertexNormals).length;c<u;c++){var U=$.vertexNormalsModel[c];U.copy(x[c]),!1!==B||V!==Se.BackSide&&V!==Se.DoubleSide||U.negate(),U.applyMatrix3(ve).normalize(),$.vertexNormalsModelView[c].copy(U).applyMatrix3(xe)}$.vertexNormalsLength=x.length;var k=A[l];for(f=0,p=k.length;f<p;f++)$.uvs[0][f]=k[f];$.color=v.color,$.material=F,Ae.copy($.centroidModel).applyProjection(ge),$.z=Ae.z,le.elements.push($)}}}else if(d instanceof Se.Line){ye.multiplyMatrices(ge,oe),g=d.vertices,(_=G()).positionScreen.copy(g[0]).applyMatrix4(ye);var O=d.type===Se.LinePieces?2:1;for(o=1,s=g.length;o<s;o++)(_=G()).positionScreen.copy(g[o]).applyMatrix4(ye),0<(o+1)%O||(w=se[J-2],we.copy(_.positionScreen),be.copy(w.positionScreen),!0==(C=be,z=E=void 0,E=0,z=1,D=(T=we).z+T.w,L=C.z+C.w,R=-T.z+T.w,N=-C.z+C.w,0<=D&&0<=L&&0<=R&&0<=N||!(D<0&&L<0||R<0&&N<0)&&(D<0?E=Math.max(E,D/(D-L)):L<0&&(z=Math.min(z,D/(D-L))),R<0?E=Math.max(E,R/(R-N)):N<0&&(z=Math.min(z,R/(R-N))),!(z<E||(T.lerp(C,E),C.lerp(T,1-z),0))))&&(we.multiplyScalar(1/we.w),be.multiplyScalar(1/be.w),(ie=j()).v1.positionScreen.copy(we),ie.v2.positionScreen.copy(be),ie.z=Math.max(we.z,be.z),ie.material=d.material,le.elements.push(ie)))}for(a=0,n=le.sprites.length;a<n;a++)d=le.sprites[a].object,oe=d.worldMatrix,d instanceof Se.Particle&&(ce.set(oe.elements[12],oe.elements[13],oe.elements[14],1),ce.applyMatrix4(ge),ce.z/=ce.w,0<ce.z&&ce.z<1&&((ae=H()).object=d,ae.x=ce.x/ce.w,ae.y=ce.y/ce.w,ae.z=ce.z,ae.rotation=d.rotation.z,ae.scale.x=d.scale.x*Math.abs(ae.x-(ce.x+t.projectionMatrix.elements[0])/(ce.w+t.projectionMatrix.elements[12])),ae.scale.y=d.scale.y*Math.abs(ae.y-(ce.y+t.projectionMatrix.elements[5])/(ce.w+t.projectionMatrix.elements[13])),ae.material=d.material,le.elements.push(ae)));return!0===r&&le.elements.sort(q),le}},Se.Billboard=function(e){null!=e&&null!=e.id?this._id=e.id:this._id=e,Se.Element.call(this,this._id),this.material=new Se.BillboardMaterial,this.rotation3d=this._rotation,this.rotation=0,this.vertices=[new Q(-.5,-.5,0),new Q(.5,-.5,0),new Q(.5,.5,0),new Q(-.5,.5,0)]},Se.extend(Se.Billboard,Se.Element,{constructor:Se.Billboard,className:"TGL.Billboard",updateMatrix:function(){this.matrix.setPosition(this._position),this.rotation=this._rotation.z,this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),1===this._scale.x&&1===this._scale.y||this.matrix.scale(this._scale),this.matrixWorldNeedsUpdate=!0},invalidateTexture:function(){var e=this.material;e instanceof Se.BillboardMaterial&&this._dirtyMaterialTexture(e)},clone:function(e){return e===Me&&(e=new Se.Billboard),e.material=this.material.clone(),Se.Element.prototype.clone.call(this,e),e},clonePrefab:function(){return this.clone()},setMaterialStyle:function(e,t){var i=this.material.clone();e=e.substr(e.indexOf(".")+1),this._A97(i,e,t);var r=i.getUniqueCode(),a=Ut.getMaterial(r);null!=a?(Ut.unUseMaterial(this.material),this.material=a,Ut.useMaterial(a)):(Ut.unUseMaterial(this.material),Ut.setMaterial(r,i),this.material=i)}}),Se.BillboardRenderer=function(){var y,v,h,x={},A=(new Se.Billboard,new Se.BillboardMaterial({color:255}));this.init=function(e){this.enable=!0,e._currentGroupHash=null,y=e._gl,h=(v=e).getPrecision(),x.vertices=new Float32Array(16),x.faces=new Uint16Array(6),x.lines=new Uint16Array(8);var t,i,r,a,n,o,s,l=0;x.vertices[l++]=-.5,x.vertices[l++]=-.5,x.vertices[l++]=0,x.vertices[l++]=0,x.vertices[l++]=.5,x.vertices[l++]=-.5,x.vertices[l++]=1,x.vertices[l++]=0,x.vertices[l++]=.5,x.vertices[l++]=.5,x.vertices[l++]=1,x.vertices[l++]=1,x.vertices[l++]=-.5,x.vertices[l++]=.5,x.vertices[l++]=0,x.vertices[l++]=1,l=0,x.faces[l++]=0,x.faces[l++]=1,x.faces[l++]=2,x.faces[l++]=0,x.faces[l++]=2,x.faces[l++]=3,l=0,x.lines[l++]=0,x.lines[l++]=1,x.lines[l++]=0,x.lines[l++]=3,x.lines[l++]=1,x.lines[l++]=2,x.lines[l++]=2,x.lines[l++]=3,x.vertexBuffer=y.createBuffer(),x.elementBuffer=y.createBuffer(),y.bindBuffer(y.ARRAY_BUFFER,x.vertexBuffer),y.bufferData(y.ARRAY_BUFFER,x.vertices,y.STATIC_DRAW),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,x.elementBuffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,x.faces,y.STATIC_DRAW),x.program=(t="uniform int useScreenCoordinates;\nuniform int sizeAttenuation;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nuniform bool vertical;\nuniform float fixedSize;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\n\nvoid main() {\n  vec4 finalPosition;\n  finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n  vUV = uvOffset + uv * uvScale;\n  vec2 finalScale;\n  if(fixedSize != 0.0){\n    finalScale = scale  * length(finalPosition.xyz) / fixedSize;\n  }else{\n    finalScale = scale;\n  }\n  vec2 alignedPosition = (position + alignment) * finalScale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n  rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n  vec4 upPosition;\n  vec4 rightPosition = vec4(finalScale.x,0.0,0.0,1.0);\n  if(vertical){\n    upPosition =  modelViewMatrix * vec4( 0.0, 1.0, 0.0, 1.0 ) - finalPosition;\n    normalize(upPosition);\n  }\n  if(vertical){\n    finalPosition.xyz += (rotatedPosition.x * rightPosition.xyz / finalScale.x) + (rotatedPosition.y * upPosition.xyz / scale.y);\n  }else{\n    finalPosition.xy += rotatedPosition;\n  }\n  finalPosition = projectionMatrix * finalPosition;\n  gl_Position = finalPosition;\n}",i="uniform vec3 color;\nuniform int useMap;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\n\nvoid main() {\n  if(useMap > 0){\n    vec4 texture = texture2D( map, vUV );\n    if ( texture.a < alphaTest ) {\n      discard;\n    }\n    gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n  } else {\n    gl_FragColor = vec4( color, 1.0);\n  }\n  if ( fogType > 0 ) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    float fogFactor = 0.0;\n    if ( fogType == 1 ) {\n      fogFactor = smoothstep( fogNear, fogFar, depth );\n    } else {\n      const float LOG2 = 1.442695;\n      float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n      fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n    }\n    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n  }\n}",r=h,a=y.createProgram(),n=y.createShader(y.FRAGMENT_SHADER),o=y.createShader(y.VERTEX_SHADER),s="precision "+r+" float;\n",y.shaderSource(n,s+i),y.shaderSource(o,s+t),y.compileShader(n),y.compileShader(o),y.attachShader(a,n),y.attachShader(a,o),y.linkProgram(a),a),x.attributes={},x.uniforms={},x.attributes.position=y.getAttribLocation(x.program,"position"),x.attributes.uv=y.getAttribLocation(x.program,"uv"),x.uniforms.uvOffset=y.getUniformLocation(x.program,"uvOffset"),x.uniforms.uvScale=y.getUniformLocation(x.program,"uvScale"),x.uniforms.rotation=y.getUniformLocation(x.program,"rotation"),x.uniforms.scale=y.getUniformLocation(x.program,"scale"),x.uniforms.alignment=y.getUniformLocation(x.program,"alignment"),x.uniforms.color=y.getUniformLocation(x.program,"color"),x.uniforms.useMap=y.getUniformLocation(x.program,"useMap"),x.uniforms.map=y.getUniformLocation(x.program,"map"),x.uniforms.opacity=y.getUniformLocation(x.program,"opacity"),x.uniforms.vertical=y.getUniformLocation(x.program,"vertical"),x.uniforms.fixedSize=y.getUniformLocation(x.program,"fixedSize"),x.uniforms.useScreenCoordinates=y.getUniformLocation(x.program,"useScreenCoordinates"),x.uniforms.sizeAttenuation=y.getUniformLocation(x.program,"sizeAttenuation"),x.uniforms.screenPosition=y.getUniformLocation(x.program,"screenPosition"),x.uniforms.modelViewMatrix=y.getUniformLocation(x.program,"modelViewMatrix"),x.uniforms.projectionMatrix=y.getUniformLocation(x.program,"projectionMatrix"),x.uniforms.fogType=y.getUniformLocation(x.program,"fogType"),x.uniforms.fogDensity=y.getUniformLocation(x.program,"fogDensity"),x.uniforms.fogNear=y.getUniformLocation(x.program,"fogNear"),x.uniforms.fogFar=y.getUniformLocation(x.program,"fogFar"),x.uniforms.fogColor=y.getUniformLocation(x.program,"fogColor"),x.uniforms.alphaTest=y.getUniformLocation(x.program,"alphaTest"),this.inited=!0},this.render=function(e,t,i,r,a,n){this.inited||this.init(e);var o=new xe(t),s=o.size();if(s){var l=x.attributes,h=x.uniforms,c=!1;e.pm.currentProgram!=x.program&&(y.useProgram(x.program),e.pm.currentProgram=x.program,e._currentGroupHash=null,y.enableVertexAttribArray(l.position),y.enableVertexAttribArray(l.uv),y.disable(y.CULL_FACE),y.bindBuffer(y.ARRAY_BUFFER,x.vertexBuffer),y.vertexAttribPointer(l.position,2,y.FLOAT,!1,16,0),y.vertexAttribPointer(l.uv,2,y.FLOAT,!1,16,8),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,x.elementBuffer),c=this.enable=!0),c&&y.uniformMatrix4fv(h.projectionMatrix,!1,i.projectionMatrix.elements),c&&y.activeTexture(y.TEXTURE0),c&&y.uniform1i(h.map,0);var u,f,p,d=0,m=0,g=e.fog;for(g?(y.uniform3f(h.fogColor,g.color.r,g.color.g,g.color.b),g instanceof Se.Fog?(y.uniform1f(h.fogNear,g.near),y.uniform1f(h.fogFar,g.far),y.uniform1i(h.fogType,1),m=d=1):g instanceof Se.FogExp2&&(y.uniform1f(h.fogDensity,g.density),y.uniform1i(h.fogType,2),m=d=2)):m=d=0,u=0;u<s;u++)f=o.get(u),p=n||f.material,v.isVisible(f)&&0!==p.opacity&&(f.updateWorldMatrix(!0,!1),p.useScreenCoordinates?f.z=-f.position.z:(f._modelViewMatrix=new Se.Mat4,f._modelViewMatrix.multiplyMatrices(i.worldMatrixInverse,f.worldMatrix),f.z=-f._modelViewMatrix.elements[14]));for(u=0;u<s;u++)f=o.get(u),this.renderBillboard(f,h,e,d,m,null,n),f._selected&&(f._scale.x=1.01*f._scale.x,f._scale.y=1.01*f._scale.y,f.material.clone(A),A.map=null,A.color.set(65280),this.renderBillboard(f,h,e,d,m,A),f._scale.x=f._scale.x/1.01,f._scale.y=f._scale.y/1.01)}},this.disable=function(){if(this.enable){var e=x.attributes;x.uniforms,y.disableVertexAttribArray(e.position),y.disableVertexAttribArray(e.uv),v._oldDoubleSided||y.enable(y.CULL_FACE),v._oldBlending===Se.NoBlending&&y.disable(y.BLEND),Ze.setDepthWrite(!0,v),this.enable=!1,this.lastMaterialId=null,v.pm.currentProgram=null}},this.renderBillboard=function(e,t,i,r,a,n,o){var s,l,h,c=[],u=new Q;if(s=n||o||e.material,v.isVisible(e)&&0!==s.opacity){var f=!(s.id==this.lastMaterialId);f&&y.uniform1f(t.alphaTest,s.alphaTest),f&&(!0===s.useScreenCoordinates?(y.uniform1i(t.useScreenCoordinates,1),y.uniform3f(t.screenPosition,(e.position.x*v.devicePixelRatio-halfViewportWidth)/halfViewportWidth,(halfViewportHeight-e.position.y*v.devicePixelRatio)/halfViewportHeight,Math.max(0,Math.min(1,e.position.z)))):(y.uniform1i(t.useScreenCoordinates,0),y.uniform1i(t.sizeAttenuation,s.sizeAttenuation?1:0))),!0===s.useScreenCoordinates?(c[0]=v.devicePixelRatio,c[1]=v.devicePixelRatio):(y.uniformMatrix4fv(t.modelViewMatrix,!1,e._modelViewMatrix.elements),c[0]=1,c[1]=1),r!==(h=i.fog&&s.fog?a:0)&&(y.uniform1i(t.fogType,h),r=h),l=1/(s.scaleByViewport?viewportHeight:1),u.getScaleFromMatrix(e.worldMatrix),c[0]*=l*u.x,c[1]*=l*u.y,f&&(y.uniform2f(t.uvScale,s.repeat.x,s.repeat.y),y.uniform2f(t.uvOffset,s.offset.x,s.offset.y),y.uniform2f(t.alignment,s.alignment.x,s.alignment.y),y.uniform1f(t.opacity,s.opacity),y.uniform1i(t.vertical,s.vertical),y.uniform1f(t.fixedSize,s.fixedSize),y.uniform3f(t.color,s.color.r,s.color.g,s.color.b),y.uniform1f(t.rotation,e.rotation)),y.uniform2fv(t.scale,c),f&&(v.setBlending(s.blending,s.blendEquation,s.blendSrc,s.blendDst),v.setDepthTest(s.depthTest),v.setDepthWrite(s.depthMask)),s.map&&s.map._image&&v.pm.addTexture(s.map),f=f||s.map&&v.pm.needsUpdateTexture(s.map),s.map&&s.map._image&&s.map._image.width?(f&&v.setTexture(s.map,0),f&&y.uniform1i(t.useMap,1)):f&&y.uniform1i(t.useMap,0),n?(f&&y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,x.elementBuffer),f&&y.bufferData(y.ELEMENT_ARRAY_BUFFER,x.lines,y.STATIC_DRAW),f&&y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,x.elementBuffer),y.drawElements(y.LINES,8,y.UNSIGNED_SHORT,0)):(f&&y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,x.elementBuffer),f&&y.bufferData(y.ELEMENT_ARRAY_BUFFER,x.faces,y.STATIC_DRAW),f&&y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,x.elementBuffer),y.drawElements(y.TRIANGLES,6,y.UNSIGNED_SHORT,0)),this.lastMaterialId=s.id}}},Se.ShaderFlare={flare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},Se.FlareRenderer=function(){var A,_,w,b,M,S,P,T,C,n;this.init=function(e){this.enable=!0,T=e._gl,n=(C=e).getPrecision();var t=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),i=new Uint16Array([0,1,2,0,2,3]);A=T.createBuffer(),_=T.createBuffer(),T.bindBuffer(T.ARRAY_BUFFER,A),T.bufferData(T.ARRAY_BUFFER,t,T.STATIC_DRAW),T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,_),T.bufferData(T.ELEMENT_ARRAY_BUFFER,i,T.STATIC_DRAW),S=T.createTexture(),P=T.createTexture(),T.bindTexture(T.TEXTURE_2D,S),T.texImage2D(T.TEXTURE_2D,0,T.RGB,16,16,0,T.RGB,T.UNSIGNED_BYTE,null),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.NEAREST),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.NEAREST),T.bindTexture(T.TEXTURE_2D,P),T.texImage2D(T.TEXTURE_2D,0,T.RGBA,16,16,0,T.RGBA,T.UNSIGNED_BYTE,null),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.NEAREST),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.NEAREST),w=this.createProgram(Se.ShaderFlare.flare),b={vertex:T.getAttribLocation(w,"position"),uv:T.getAttribLocation(w,"uv")},M={renderType:T.getUniformLocation(w,"renderType"),map:T.getUniformLocation(w,"map"),occlusionMap:T.getUniformLocation(w,"occlusionMap"),opacity:T.getUniformLocation(w,"opacity"),color:T.getUniformLocation(w,"color"),scale:T.getUniformLocation(w,"scale"),rotation:T.getUniformLocation(w,"rotation"),screenPosition:T.getUniformLocation(w,"screenPosition")},this.inited=!0},this.render=function(e,t,i,r,a){if(this.inited||this.init(e),C=e,0!==t.length){var n=new Q,o=a/r,s=.5*r,l=.5*a,h=16/a,c=new pe(h*o,h),u=new Q(1,1,0),f=new pe(1,1),p=new Se.Box2;if(p.min.set(0,0),p.max.set(r-16,a-16),e.pm.currentProgram!=w){T.useProgram(w),e.pm.currentProgram=w,e._currentGroupHash=null,T.enableVertexAttribArray(b.vertex),T.enableVertexAttribArray(b.uv),T.uniform1i(M.occlusionMap,0),T.uniform1i(M.map,1),T.bindBuffer(T.ARRAY_BUFFER,A),T.vertexAttribPointer(b.vertex,2,T.FLOAT,!1,16,0),T.vertexAttribPointer(b.uv,2,T.FLOAT,!1,16,8),T.bindBuffer(T.ELEMENT_ARRAY_BUFFER,_),T.disable(T.CULL_FACE),this.enable=!0;for(var d=0,m=t.length;d<m;d++){h=16/a,c.set(h*o,h);var g=t[d].node;if(n.set(g.worldMatrix.elements[12],g.worldMatrix.elements[13],g.worldMatrix.elements[14]),n.applyMatrix4(i.worldMatrixInverse),n.applyMatrix4(i.projectionMatrix),u.copy(n),f.x=0+u.x*s+s-8,f.y=0+u.y*l+l-8,!0===p.containsPoint(f)){T.activeTexture(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,S),T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,!0),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.NEAREST),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.NEAREST),T.activeTexture(T.TEXTURE1),T.bindTexture(T.TEXTURE_2D,S),T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,!0),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.NEAREST),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.NEAREST),T.copyTexImage2D(T.TEXTURE_2D,0,T.RGB,f.x/2,f.y/2,16,16,0),T.uniform1i(M.renderType,0),T.uniform2f(M.scale,c.x,c.y),T.uniform3f(M.screenPosition,u.x,u.y,u.z),T.disable(T.BLEND),T.enable(T.DEPTH_TEST),T.drawElements(T.TRIANGLES,6,T.UNSIGNED_SHORT,0),T.uniform1i(M.renderType,1),T.activeTexture(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,P),T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,!0),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.NEAREST),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.NEAREST),T.copyTexImage2D(T.TEXTURE_2D,0,T.RGBA,f.x/2,f.y/2,16,16,0),T.uniform1i(M.renderType,1),T.disable(T.DEPTH_TEST),T.activeTexture(T.TEXTURE1),T.bindTexture(T.TEXTURE_2D,S),T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,!0),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.NEAREST),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.NEAREST),T.drawElements(T.TRIANGLES,6,T.UNSIGNED_SHORT,0),g.positionScreen=u,g.customUpdateCallback?g.customUpdateCallback(g):g.updateLensFlares(),T.uniform1i(M.renderType,2),T.enable(T.BLEND);for(var y=0,v=g.lensFlares.length;y<v;y++){var x=g.lensFlares[y];.001<x.opacity&&.001<x.scale&&(u.x=x.x,u.y=x.y,u.z=x.z,h=x.size*x.scale/a,c.x=h*o,c.y=h,T.uniform3f(M.screenPosition,u.x,u.y,u.z),T.uniform2f(M.scale,c.x,c.y),T.uniform1f(M.rotation,x.rotation),T.uniform1f(M.opacity,x.opacity),T.uniform3f(M.color,x.color.r,x.color.g,x.color.b),C.setBlending(x.blending,x.blendEquation,x.blendSrc,x.blendDst),T.activeTexture(T.TEXTURE1),T.bindTexture(T.TEXTURE_2D,S),T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,!0),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.NEAREST),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.NEAREST),T.texImage2D(T.TEXTURE_2D,0,T.RGBA,T.RGBA,T.UNSIGNED_BYTE,x.texture),T.drawElements(T.TRIANGLES,6,T.UNSIGNED_SHORT,0))}}}T.enable(T.CULL_FACE),T.enable(T.DEPTH_TEST)}}},this.createProgram=function(e){var t=T.createProgram(),i=T.createShader(T.FRAGMENT_SHADER),r=T.createShader(T.VERTEX_SHADER),a="precision "+n+" float;\n";return T.shaderSource(i,a+e.fragmentShader),T.shaderSource(r,a+e.vertexShader),T.compileShader(i),T.compileShader(r),T.attachShader(t,i),T.attachShader(t,r),T.linkProgram(t),t},this.disable=function(){this.enable&&(T.disableVertexAttribArray(b.vertex),T.disableVertexAttribArray(b.uv),C._oldDoubleSided||T.enable(T.CULL_FACE),C._oldBlending===Se.NoBlending&&T.disable(T.BLEND),Ze.setDepthWrite(!0,C),this.enable=!1,this.lastMaterialId=null,C.pm.currentProgram=null)}};var at,nt="l=1.0\ntype=1\ngis=0\n3d=1\nstart=2018-03-19\nend=2018-07-01\nnote=This license applies to the evaluation version of TWaver. The License is limited to noncommercial use. Noncommercial use relates only to educational, research, personal or evaluation purposes. Any other use is commercial use. You may not use the Software in connection with any business activities.And You are not permitted to modify the software or attempt to decipher, decompile, disassemble or reverse engineer this Software.\nsignature=158cb606299a9781894a1391d6a7d222b3543276cdc1661cf19e6aa30cedef44ca42bb471e01894481a2e522231c80d50a1a0d0e673adf13529a9b006c9bb7ac9240fb7a6b26b979b7a531392f4c84ee981fd25f322f24dbb635da2653b19a91f07547d5def700760c2febaef8cef2f066de7c5e5584a1f8e1adbcbed3531c19180620596287d8f27db47e19cb0dca73c9cb84e25019563ea02d3bea3b3821df1840d3f8fb2ac54cdf2f0e2c11aefbf1542de330743d739e6bb149583b8b78e4c9388cf0af1a044646aecae59599bad7ee6b5990918d235babc062b322872f22205bc09f4e753a8fcd52196c3dfaec94a08918392bebe510a54b1c1bcdbd4f69436b3ccca7cb439c9f3474fa6441374339267fce7dc319d00fb807aa9fac324cbb26bdba83832d9f78a7df41a3d4dc2cc41dbff7b45cc1156bd42eea8e63719f11b7165724469af420d3acac05f2840e8b4a011f2c364d6cb796875be98d8aa74a895ef2172bf554a0725aef6115121654c87e22c53ad7bea30201a5fe57122d51ad8cbbde3bfff9a8f1edb71553043dca8d309440d9e02a876029233998a3db7548ed0fb623526d06419a7af4c21a5b27da89350ce4f6b366760561a129069e96a0cb63d3b604647720d98b79c69e08be9056a36104e3761dff8940572e1f8cbea6e7203ec914a2453bdadbf7fe16331ccbaec826706aead3adcdccf1a57eb86304c39c594a0c370bcf8c3a39c38e03947150dba4f30b2563005dc5164ea74b9ae45b2ac88a1d152a89f2ee1f7e577fa4364f5edf9facb6b34482175eb6f9149d676b7aaba9bb7e47164cf541cc7ae16ae5c23ae9f9125ff522d90b62036d5479f60a51a142da78a45c63feee03596055e3878f610f2b9db6f80d95d033f5aa";"Microsoft Internet Explorer"==navigator.appName?(A.prototype.am=function(e,t,i,r,a,n){for(var o=32767&t,s=t>>15;0<=--n;){var l=32767&this[e],h=this[e++]>>15,c=s*l+h*o;a=((l=o*l+((32767&c)<<15)+i[r]+(1073741823&a))>>>30)+(c>>>15)+s*h+(a>>>30),i[r++]=1073741823&l}return a},at=30):"Netscape"!=navigator.appName?(A.prototype.am=function(e,t,i,r,a,n){for(;0<=--n;){var o=t*this[e++]+i[r]+a;a=Math.floor(o/67108864),i[r++]=67108863&o}return a},at=26):(A.prototype.am=function(e,t,i,r,a,n){for(var o=16383&t,s=t>>14;0<=--n;){var l=16383&this[e],h=this[e++]>>14,c=s*l+h*o;a=((l=o*l+((16383&c)<<14)+i[r]+a)>>28)+(c>>14)+s*h,i[r++]=268435455&l}return a},at=28),A.prototype.DB=at,A.prototype.DM=(1<<at)-1,A.prototype.DV=1<<at,A.prototype.FV=Math.pow(2,52),A.prototype.F1=52-at,A.prototype.F2=2*at-52;var ot,st,lt=new Array;for(ot="0".charCodeAt(0),st=0;st<=9;++st)lt[ot++]=st;for(ot="a".charCodeAt(0),st=10;st<36;++st)lt[ot++]=st;for(ot="A".charCodeAt(0),st=10;st<36;++st)lt[ot++]=st;y.prototype.convert=function(e){return e.s<0||0<=e.compareTo(this.m)?e.mod(this.m):e},y.prototype.revert=function(e){return e},y.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},y.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},y.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},M.prototype.convert=function(e){var t=_();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&0<t.compareTo(A.ZERO)&&this.m.subTo(t,t),t},M.prototype.revert=function(e){var t=_();return e.copyTo(t),this.reduce(t),t},M.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var i=32767&e[t],r=i*this.mpl+((i*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[i=t+this.m.t]+=this.m.am(0,r,e,t,0,this.m.t);e[i]>=e.DV;)e[i]-=e.DV,e[++i]++}e.clamp(),e.drShiftTo(this.m.t,e),0<=e.compareTo(this.m)&&e.subTo(this.m,e)},M.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},M.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},A.prototype.copyTo=function(e){for(var t=this.t-1;0<=t;--t)e[t]=this[t];e.t=this.t,e.s=this.s},A.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,0<e?this[0]=e:e<-1?this[0]=e+DV:this.t=0},A.prototype.fromString=function(e,t){var i;if(16==t)i=4;else if(8==t)i=3;else if(256==t)i=8;else if(2==t)i=1;else if(32==t)i=5;else{if(4!=t)return void this.fromRadix(e,t);i=2}this.t=0,this.s=0;for(var r=e.length,a=!1,n=0;0<=--r;){var o=8==i?255&e[r]:h(e,r);o<0?"-"==e.charAt(r)&&(a=!0):(a=!1,0==n?this[this.t++]=o:n+i>this.DB?(this[this.t-1]|=(o&(1<<this.DB-n)-1)<<n,this[this.t++]=o>>this.DB-n):this[this.t-1]|=o<<n,(n+=i)>=this.DB&&(n-=this.DB))}8==i&&0!=(128&e[0])&&(this.s=-1,0<n&&(this[this.t-1]|=(1<<this.DB-n)-1<<n)),this.clamp(),a&&A.ZERO.subTo(this,this)},A.prototype.clamp=function(){for(var e=this.s&this.DM;0<this.t&&this[this.t-1]==e;)--this.t},A.prototype.dlShiftTo=function(e,t){var i;for(i=this.t-1;0<=i;--i)t[i+e]=this[i];for(i=e-1;0<=i;--i)t[i]=0;t.t=this.t+e,t.s=this.s},A.prototype.drShiftTo=function(e,t){for(var i=e;i<this.t;++i)t[i-e]=this[i];t.t=Math.max(this.t-e,0),t.s=this.s},A.prototype.lShiftTo=function(e,t){var i,r=e%this.DB,a=this.DB-r,n=(1<<a)-1,o=Math.floor(e/this.DB),s=this.s<<r&this.DM;for(i=this.t-1;0<=i;--i)t[i+o+1]=this[i]>>a|s,s=(this[i]&n)<<r;for(i=o-1;0<=i;--i)t[i]=0;t[o]=s,t.t=this.t+o+1,t.s=this.s,t.clamp()},A.prototype.rShiftTo=function(e,t){t.s=this.s;var i=Math.floor(e/this.DB);if(i>=this.t)t.t=0;else{var r=e%this.DB,a=this.DB-r,n=(1<<r)-1;t[0]=this[i]>>r;for(var o=i+1;o<this.t;++o)t[o-i-1]|=(this[o]&n)<<a,t[o-i]=this[o]>>r;0<r&&(t[this.t-i-1]|=(this.s&n)<<a),t.t=this.t-i,t.clamp()}},A.prototype.subTo=function(e,t){for(var i=0,r=0,a=Math.min(e.t,this.t);i<a;)r+=this[i]-e[i],t[i++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r-=e.s;i<this.t;)r+=this[i],t[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<e.t;)r-=e[i],t[i++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t[i++]=this.DV+r:0<r&&(t[i++]=r),t.t=i,t.clamp()},A.prototype.multiplyTo=function(e,t){var i=this.abs(),r=e.abs(),a=i.t;for(t.t=a+r.t;0<=--a;)t[a]=0;for(a=0;a<r.t;++a)t[a+i.t]=i.am(0,r[a],t,a,0,i.t);t.s=0,t.clamp(),this.s!=e.s&&A.ZERO.subTo(t,t)},A.prototype.squareTo=function(e){for(var t=this.abs(),i=e.t=2*t.t;0<=--i;)e[i]=0;for(i=0;i<t.t-1;++i){var r=t.am(i,t[i],e,2*i,0,1);(e[i+t.t]+=t.am(i+1,2*t[i],e,2*i+1,r,t.t-i-1))>=t.DV&&(e[i+t.t]-=t.DV,e[i+t.t+1]=1)}0<e.t&&(e[e.t-1]+=t.am(i,t[i],e,2*i,0,1)),e.s=0,e.clamp()},A.prototype.divRemTo=function(e,t,i){var r=e.abs();if(!(r.t<=0)){var a=this.abs();if(a.t<r.t)return null!=t&&t.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=_());var n=_(),o=this.s,s=e.s,l=this.DB-w(r[r.t-1]);0<l?(r.lShiftTo(l,n),a.lShiftTo(l,i)):(r.copyTo(n),a.copyTo(i));var h=n.t,c=n[h-1];if(0!=c){var u=c*(1<<this.F1)+(1<h?n[h-2]>>this.F2:0),f=this.FV/u,p=(1<<this.F1)/u,d=1<<this.F2,m=i.t,g=m-h,y=null==t?_():t;for(n.dlShiftTo(g,y),0<=i.compareTo(y)&&(i[i.t++]=1,i.subTo(y,i)),A.ONE.dlShiftTo(h,y),y.subTo(n,n);n.t<h;)n[n.t++]=0;for(;0<=--g;){var v=i[--m]==c?this.DM:Math.floor(i[m]*f+(i[m-1]+d)*p);if((i[m]+=n.am(0,v,i,g,0,h))<v)for(n.dlShiftTo(g,y),i.subTo(y,i);i[m]<--v;)i.subTo(y,i)}null!=t&&(i.drShiftTo(h,t),o!=s&&A.ZERO.subTo(t,t)),i.t=h,i.clamp(),0<l&&i.rShiftTo(l,i),o<0&&A.ZERO.subTo(i,i)}}},A.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return 0<(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)?this.DV-t:-t},A.prototype.isEven=function(){return 0==(0<this.t?1&this[0]:this.s)},A.prototype.exp=function(e,t){if(4294967295<e||e<1)return A.ONE;var i=_(),r=_(),a=t.convert(this),n=w(e)-1;for(a.copyTo(i);0<=--n;)if(t.sqrTo(i,r),0<(e&1<<n))t.mulTo(r,a,i);else{var o=i;i=r,r=o}return t.revert(i)},A.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var i,r=(1<<t)-1,a=!1,n="",o=this.t,s=this.DB-o*this.DB%t;if(0<o--)for(s<this.DB&&0<(i=this[o]>>s)&&(a=!0,n=l(i));0<=o;)s<t?(i=(this[o]&(1<<s)-1)<<t-s,i|=this[--o]>>(s+=this.DB-t)):(i=this[o]>>(s-=t)&r,s<=0&&(s+=this.DB,--o)),0<i&&(a=!0),a&&(n+=l(i));return a?n:"0"},A.prototype.negate=function(){var e=_();return A.ZERO.subTo(this,e),e},A.prototype.abs=function(){return this.s<0?this.negate():this},A.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var i=this.t;if(0!=(t=i-e.t))return t;for(;0<=--i;)if(0!=(t=this[i]-e[i]))return t;return 0},A.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+w(this[this.t-1]^this.s&this.DM)},A.prototype.mod=function(e){var t=_();return this.abs().divRemTo(e,null,t),this.s<0&&0<t.compareTo(A.ZERO)&&e.subTo(t,t),t},A.prototype.modPowInt=function(e,t){var i;return i=e<256||t.isEven()?new y(t):new M(t),this.exp(e,i)},A.ZERO=g(0),A.ONE=g(1),P.prototype.convert=e,P.prototype.revert=e,P.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i)},P.prototype.sqrTo=function(e,t){e.squareTo(t)},T.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=_();return e.copyTo(t),this.reduce(t),t},T.prototype.revert=function(e){return e},T.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);0<=e.compareTo(this.m);)e.subTo(this.m,e)},T.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},T.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var ht=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],ct=(1<<26)/ht[ht.length-1];A.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},A.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||36<e)return"0";var t=this.chunkSize(e),i=Math.pow(e,t),r=g(i),a=_(),n=_(),o="";for(this.divRemTo(r,a,n);0<a.signum();)o=(i+n.intValue()).toString(e).substr(1)+o,a.divRemTo(r,a,n);return n.intValue().toString(e)+o},A.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var i=this.chunkSize(t),r=Math.pow(t,i),a=!1,n=0,o=0,s=0;s<e.length;++s){var l=h(e,s);l<0?"-"==e.charAt(s)&&0==this.signum()&&(a=!0):(o=t*o+l,++n>=i&&(this.dMultiply(r),this.dAddOffset(o,0),o=n=0))}0<n&&(this.dMultiply(Math.pow(t,n)),this.dAddOffset(o,0)),a&&A.ZERO.subTo(this,this)},A.prototype.fromNumber=function(e,t,i){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,i),this.testBit(e-1)||this.bitwiseTo(A.ONE.shiftLeft(e-1),f,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(A.ONE.shiftLeft(e-1),this);else{var r=new Array,a=7&e;r.length=1+(e>>3),t.nextBytes(r),0<a?r[0]&=(1<<a)-1:r[0]=0,this.fromString(r,256)}},A.prototype.bitwiseTo=function(e,t,i){var r,a,n=Math.min(e.t,this.t);for(r=0;r<n;++r)i[r]=t(this[r],e[r]);if(e.t<this.t){for(a=e.s&this.DM,r=n;r<this.t;++r)i[r]=t(this[r],a);i.t=this.t}else{for(a=this.s&this.DM,r=n;r<e.t;++r)i[r]=t(a,e[r]);i.t=e.t}i.s=t(this.s,e.s),i.clamp()},A.prototype.changeBit=function(e,t){var i=A.ONE.shiftLeft(e);return this.bitwiseTo(i,t,i),i},A.prototype.addTo=function(e,t){for(var i=0,r=0,a=Math.min(e.t,this.t);i<a;)r+=this[i]+e[i],t[i++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r+=e.s;i<this.t;)r+=this[i],t[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<e.t;)r+=e[i],t[i++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,0<r?t[i++]=r:r<-1&&(t[i++]=this.DV+r),t.t=i,t.clamp()},A.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},A.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},A.prototype.multiplyLowerTo=function(e,t,i){var r,a=Math.min(this.t+e.t,t);for(i.s=0,i.t=a;0<a;)i[--a]=0;for(r=i.t-this.t;a<r;++a)i[a+this.t]=this.am(0,e[a],i,a,0,this.t);for(r=Math.min(e.t,t);a<r;++a)this.am(0,e[a],i,a,0,t-a);i.clamp()},A.prototype.multiplyUpperTo=function(e,t,i){--t;var r=i.t=this.t+e.t-t;for(i.s=0;0<=--r;)i[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)i[this.t+r-t]=this.am(t-r,e[r],i,0,0,this.t+r-t);i.clamp(),i.drShiftTo(1,i)},A.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,i=this.s<0?e-1:0;if(0<this.t)if(0==t)i=this[0]%e;else for(var r=this.t-1;0<=r;--r)i=(t*i+this[r])%e;return i},A.prototype.millerRabin=function(e){var t=this.subtract(A.ONE),i=t.getLowestSetBit();if(i<=0)return!1;var r=t.shiftRight(i);(e=e+1>>1)>ht.length&&(e=ht.length);for(var a=_(),n=0;n<e;++n){a.fromInt(ht[Math.floor(Math.random()*ht.length)]);var o=a.modPow(r,this);if(0!=o.compareTo(A.ONE)&&0!=o.compareTo(t)){for(var s=1;s++<i&&0!=o.compareTo(t);)if(0==(o=o.modPowInt(2,this)).compareTo(A.ONE))return!1;if(0!=o.compareTo(t))return!1}}return!0},A.prototype.clone=function(){var e=_();return this.copyTo(e),e},A.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},A.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},A.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},A.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},A.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var i,r=this.DB-e*this.DB%8,a=0;if(0<e--)for(r<this.DB&&(i=this[e]>>r)!=(this.s&this.DM)>>r&&(t[a++]=i|this.s<<this.DB-r);0<=e;)r<8?(i=(this[e]&(1<<r)-1)<<8-r,i|=this[--e]>>(r+=this.DB-8)):(i=this[e]>>(r-=8)&255,r<=0&&(r+=this.DB,--e)),0!=(128&i)&&(i|=-256),0==a&&(128&this.s)!=(128&i)&&++a,(0<a||i!=this.s)&&(t[a++]=i);return t},A.prototype.equals=function(e){return 0==this.compareTo(e)},A.prototype.min=function(e){return this.compareTo(e)<0?this:e},A.prototype.max=function(e){return 0<this.compareTo(e)?this:e},A.prototype.and=function(e){var t=_();return this.bitwiseTo(e,n,t),t},A.prototype.or=function(e){var t=_();return this.bitwiseTo(e,f,t),t},A.prototype.xor=function(e){var t=_();return this.bitwiseTo(e,p,t),t},A.prototype.andNot=function(e){var t=_();return this.bitwiseTo(e,d,t),t},A.prototype.not=function(){for(var e=_(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},A.prototype.shiftLeft=function(e){var t=_();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},A.prototype.shiftRight=function(e){var t=_();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},A.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+t(this[e]);return this.s<0?this.t*this.DB:-1},A.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,i=0;i<this.t;++i)e+=S(this[i]^t);return e},A.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},A.prototype.setBit=function(e){return this.changeBit(e,f)},A.prototype.clearBit=function(e){return this.changeBit(e,d)},A.prototype.flipBit=function(e){return this.changeBit(e,p)},A.prototype.add=function(e){var t=_();return this.addTo(e,t),t},A.prototype.subtract=function(e){var t=_();return this.subTo(e,t),t},A.prototype.multiply=function(e){var t=_();return this.multiplyTo(e,t),t},A.prototype.divide=function(e){var t=_();return this.divRemTo(e,t,null),t},A.prototype.remainder=function(e){var t=_();return this.divRemTo(e,null,t),t},A.prototype.divideAndRemainder=function(e){var t=_(),i=_();return this.divRemTo(e,t,i),new Array(t,i)},A.prototype.modPow=function(e,t){var i,r,a=e.bitLength(),n=g(1);if(a<=0)return n;i=a<18?1:a<48?3:a<144?4:a<768?5:6,r=a<8?new y(t):t.isEven()?new T(t):new M(t);var o=new Array,s=3,l=i-1,h=(1<<i)-1;if(o[1]=r.convert(this),1<i){var c=_();for(r.sqrTo(o[1],c);s<=h;)o[s]=_(),r.mulTo(c,o[s-2],o[s]),s+=2}var u,f,p=e.t-1,d=!0,m=_();for(a=w(e[p])-1;0<=p;){for(l<=a?u=e[p]>>a-l&h:(u=(e[p]&(1<<a+1)-1)<<l-a,0<p&&(u|=e[p-1]>>this.DB+a-l)),s=i;0==(1&u);)u>>=1,--s;if((a-=s)<0&&(a+=this.DB,--p),d)o[u].copyTo(n),d=!1;else{for(;1<s;)r.sqrTo(n,m),r.sqrTo(m,n),s-=2;0<s?r.sqrTo(n,m):(f=n,n=m,m=f),r.mulTo(m,o[u],n)}for(;0<=p&&0==(e[p]&1<<a);)r.sqrTo(n,m),f=n,n=m,m=f,--a<0&&(a=this.DB-1,--p)}return r.revert(n)},A.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return A.ZERO;for(var i=e.clone(),r=this.clone(),a=g(1),n=g(0),o=g(0),s=g(1);0!=i.signum();){for(;i.isEven();)i.rShiftTo(1,i),t?(a.isEven()&&n.isEven()||(a.addTo(this,a),n.subTo(e,n)),a.rShiftTo(1,a)):n.isEven()||n.subTo(e,n),n.rShiftTo(1,n);for(;r.isEven();)r.rShiftTo(1,r),t?(o.isEven()&&s.isEven()||(o.addTo(this,o),s.subTo(e,s)),o.rShiftTo(1,o)):s.isEven()||s.subTo(e,s),s.rShiftTo(1,s);0<=i.compareTo(r)?(i.subTo(r,i),t&&a.subTo(o,a),n.subTo(s,n)):(r.subTo(i,r),t&&o.subTo(a,o),s.subTo(n,s))}return 0!=r.compareTo(A.ONE)?A.ZERO:0<=s.compareTo(e)?s.subtract(e):s.signum()<0?(s.addTo(e,s),s.signum()<0?s.add(e):s):s},A.prototype.pow=function(e){return this.exp(e,new P)},A.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),i=e.s<0?e.negate():e.clone();if(t.compareTo(i)<0){var r=t;t=i,i=r}var a=t.getLowestSetBit(),n=i.getLowestSetBit();if(n<0)return t;for(a<n&&(n=a),0<n&&(t.rShiftTo(n,t),i.rShiftTo(n,i));0<t.signum();)0<(a=t.getLowestSetBit())&&t.rShiftTo(a,t),0<(a=i.getLowestSetBit())&&i.rShiftTo(a,i),0<=t.compareTo(i)?(t.subTo(i,t),t.rShiftTo(1,t)):(i.subTo(t,i),i.rShiftTo(1,i));return 0<n&&i.lShiftTo(n,i),i},A.prototype.isProbablePrime=function(e){var t,i=this.abs();if(1==i.t&&i[0]<=ht[ht.length-1]){for(t=0;t<ht.length;++t)if(i[0]==ht[t])return!0;return!1}if(i.isEven())return!1;for(t=1;t<ht.length;){for(var r=ht[t],a=t+1;a<ht.length&&r<ct;)r*=ht[a++];for(r=i.modInt(r);t<a;)if(r%ht[t++]==0)return!1}return i.millerRabin(e)},A.prototype.square=function(){var e=_();return this.squareTo(e),e},C.prototype.init=function(e){var t,i,r;for(t=0;t<256;++t)this.S[t]=t;for(t=i=0;t<256;++t)i=i+this.S[t]+e[t%e.length]&255,r=this.S[t],this.S[t]=this.S[i],this.S[i]=r;this.i=0,this.j=0},C.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]};var ut,ft,pt,dt=256;if(null==ft){var mt;if(ft=new Array,pt=0,"Netscape"==navigator.appName&&navigator.appVersion<"5"&&q.crypto){var gt=q.crypto.random(32);for(mt=0;mt<gt.length;++mt)ft[pt++]=255&gt.charCodeAt(mt)}for(;pt<dt;)mt=Math.floor(65536*Math.random()),ft[pt++]=mt>>>8,ft[pt++]=255&mt;pt=0,E()}D.prototype.nextBytes=function(e){var t;for(t=0;t<e.length;++t)e[t]=z()},R.prototype.doPublic=function(e){return e.modPowInt(this.e,this.n)},R.prototype.setPublic=function(e,t){this.n=L(e,16),this.e=parseInt(t,16)},R.prototype.encrypt=function(e){var t=function(e,t){if(t<e.length+11)return null;for(var i=new Array,r=e.length-1;0<=r&&0<t;){var a=e.charCodeAt(r--);a<128?i[--t]=a:127<a&&a<2048?(i[--t]=63&a|128,i[--t]=a>>6|192):(i[--t]=63&a|128,i[--t]=a>>6&63|128,i[--t]=a>>12|224)}i[--t]=0;for(var n=new D,o=new Array;2<t;){for(o[0]=0;0==o[0];)n.nextBytes(o);i[--t]=o[0]}return i[--t]=2,i[--t]=0,new A(i)}(e,this.n.bitLength()+7>>3);if(null==t)return null;var i=this.doPrivate(t);if(null==i)return null;var r=i.toString(16);return 0==(1&r.length)?r:"0"+r},R.prototype.doPrivate=function(e){if(null==this.p||null==this.q)return e.modPow(this.d,this.n);for(var t=e.mod(this.p).modPow(this.dmp1,this.p),i=e.mod(this.q).modPow(this.dmq1,this.q);t.compareTo(i)<0;)t=t.add(this.p);return t.subtract(i).multiply(this.coeff).mod(this.p).multiply(this.q).add(i)},R.prototype.setPrivate=function(e,t,i){this.n=L(e,16),this.e=parseInt(t,16),this.d=L(i,16)},R.prototype.setPrivateEx=function(e,t,i,r,a,n,o,s){this.n=L(e,16),this.e=parseInt(t,16),this.d=L(i,16),this.p=L(r,16),this.q=L(a,16),this.dmp1=L(n,16),this.dmq1=L(o,16),this.coeff=L(s,16)},R.prototype.decrypt=function(e){var t=L(e,16),i=this.doPublic(t);return null==i?null:function(e,t){for(var i=e.toByteArray(),r=0;r<i.length&&0==i[r];)++r;if(i.length-r!=t-1||2!=i[r])return null;for(++r;0!=i[r];)if(++r>=i.length)return null;for(var a="";++r<i.length;){var n=255&i[r];n<128?a+=String.fromCharCode(n):191<n&&n<224?(a+=String.fromCharCode((31&n)<<6|63&i[r+1]),++r):(a+=String.fromCharCode((15&n)<<12|(63&i[r+1])<<6|63&i[r+2]),r+=2)}return a}(i,this.n.bitLength()+7>>3)};var yt=function(){vt.v(nt)},vt={},xt="6a384c1259bdb5e731ec96b3174683f48a2c56a85e52e7a5bb20b58711ce50c1a294bd5e1d1752e766085e9ae94bae6d217c25dbb5fcdb86a8a9a7e180fa066723d00fcb85fcf7c9d29f8cc8859f53244a49c0bc30dcc45156daf8843ce1d24fe8ebc9a3c186bb26e9d0714041aef160304c1db8cc5728cf4acb39d29755f319",At="10001",_t="61a921483dfa8f24e26204ace4d990b965d11e5bef5d8a5e768ebc5853a6bdd94b02369a3165207460fb91001d3fd83fbe69c6e51b8e40c8ae8a4e30a7c539dca98b44858bdc0b76f25af6803d4d13dacd9fa1a28f66cf561fa36309d4239a2cf50fe20ef0e99e01fc8701090f0685a524f411e00ca91f877d3b49d2d0052f9",wt="b881f568eb43e7a60c256a8a90e08b7c7638fd66ce3cded9005c72e283ca4f2b8601e2edc687d7f898348a05723b515d9edeb626af7b499a56ddaea93b0c2047";vt.cross=function(e){if(e){for(var t="",i=0;i<e.length;)i+1<e.length&&(t+=e[i+1]),t+=e[i],i+=2;return t}return null},vt.reverse=function(e){if(e){for(var t="",i=e.length;0<i;i--)t+=e[i-1];return t}return null},vt.v=function(e){if(e){var t=vt;if(t.start=null,t.beginDate=null,t.end=null,t.endDate=null,t.gis=null,t["3D"]=null,t["3d"]=null,t.l=null,t.__li__=null,0<e.indexOf("signature=")){var i=e.split("signature="),r=i[0],a=i[1],n=new R;n.setPublic(xt,At);for(var o=a,s=o.length,l=0,h="",c="";l<s;)h=o.substr(l,256),c+=n.decrypt(h),l+=256;if(c===r)return t.i(e),!0}}return!1},vt.i=function(e){var t,i,r,a,n=vt,o=(n.__li__=e).split("\n");for(t=0;t<o.length;t++)i=(a=o[t].split("="))[0],r=a[1],n[i]=r;n.start!=Me&&(n.beginDate=new Date(Date.parse(n.start.replace(/-/g,"/")))),n.end!=Me&&(n.endDate=new Date(Date.parse(n.end.replace(/-/g,"/"))));var s=n.gis;s!=Me&&(s=parseInt(s)),s&&(n._isPermissionGIS=!0);var l=n["3D"]||n["3d"];l!=Me&&(l=parseInt(l)),l&&(n._isPermission3D=!0),n.l!=Me&&(n.version=n.l)};var bt=function(e){if((t=e).__li__===Me||!t._isPermission3D)return!0;var t,i=new Date;return null!=e.beginDate&&0<=e.beginDate.getTime()-i.getTime()||null!=e.endDate&&e.endDate.getTime()-i.getTime()<=0};vt.$z=function(e){var t=new R;t.setPublic(xt,At);for(var i=e,r=i.length,a=0,n="",o="";a<r;)n=i.substr(a,256),o+=t.decrypt(n),a+=256;return o},vt.twm=function(e){var t=vt,i=t.$z("4cd18113d0c7046bfe51f7a3fbd41c2b7cf14dd785d6ea7cec9da17710d3acfb8ce0cb9cf10839f4bd51e88819de19cdc0db09278584396156fcb65abe0353ac49d01326b30efa0ea98a07da9f8ceeb7572fc1b37b5965ba6103ccba4913b62e36e49425c6ff21a2f008830c59cff8f29058769f858c8a9f0bab3eaea7fb8a9e"),r=this.type,a=this.markText;e[t.$z("648be38cd61c870e95ffc1ea0676af40736c1365015abc326e891a4de67b4de3d4b05da70b9aebedc83ec26ecf71eb74c72f42f6d9a4be2d507d2f67d2860b7b66e3ba1d565e15923f2db335ff922eef17c01b59818b583d5656412d6cc9d9ba70001c2c88e3efd492c6b13a07fda5f325b333138a2036f4696542ec137cc341")]=t.__li__;var n=e;if(n._xyz=null,"3"!==r||bt(vt)||a!==Me){e.DEBUG&&(console.log("license: "+vt.__li__),console.log("license Type : "+r),console.log("beginDate: "+vt.beginDate),console.log("endDate: "+vt.endDate),console.log("mark: "+a)),e.__liLabel==Me&&(e.__liLabel=document.createElement("div")),t.startDate===Me&&(t.startDate=new Date);var o=(new Date).getTime()-t.startDate.getTime(),s="2"===r?7200:300;if(!(o<1e3*s)){var l=bt(t)&&1e3*s<o,h=a;if(l?h=t.$z("0dd629dbd0ce341ecdd447e35ddc3135a0b46916f7571a687f38ae665cf0ae095fee885e14329caa75112d8787508da17285b0897845d8ccae73e6a2727dd19f1ca335fe139d0e60d240f9ececc78f81c2c5667f51aeed4135b9c4bb436b8acb7cd418eeeb404bc4f3bcdedb481ac0edff7644435ce2b9f2bda78c892bd56d73"):"2"!=r||h!==Me&&""!=h?"1"!=r||a||(h=i):h=t.$z("644d54bf9c59afbd8a742a9e7e2731f23f149ccb7f04c3547548c50ac2d77faea108b55f1f6261e99869f1c06b84e8abdefdf45b5170048531421f3d528123972ba2f03d70f37c33f1341dc12f986e0089e42bab517e2a05b455d12d90991bbba9bc45c715a81943062ea5fa5408c8b1b9270d260cc5a67b38ecc4178ce512fc"),h!==Me){var c=n.__liLabel;c.innerHTML=h,c.type=r,c.mark=a,c.expired=l,n._xyz=c,l&&(n.getView().style.opacity=.1)}}}},je.validateLicense(nt),Se.Material=function(e){Se.PropertyChangeDispatcher.call(this),this.id=Se.MaterialIdCount++,this.type="basic",this.shaderID="",this.uniforms=Me,this.vertexShader="",this.fragmentShader="",this.alarmColor=null,this.name="",this.side=Se.FrontSide,this.fog=!0,this.normalType=Me,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecolor=new Se.Color(16777215),this.wireframeLineopacity=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=2,this.gradientColors=3,this.blendMode=Se.NormalBlending,this.blendSrc=Se.SrcAlphaFactor,this.blendDst=Se.OneMinusSrcAlphaFactor,this.blendEquation=Se.AddEquation,this.depthTest=!0,this.depthMask=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.transparent=!1,this.opacity=1,this.visible=!0,this.needsUpdate=!0,this.setValues(e),this.useCount=0,this.styleMap={},this.offset=new pe(0,0),this.repeat=new pe(1,1),this.gradient={},this.gradientType=1,this.gradientCenter=new pe(.5,.5),this.outline=0},Se.extend(Se.Material,Se.PropertyChangeDispatcher,{generateKey:function(){},setMap:function(e,t){if(null==t&&(t="map"),this[t]!==e){var i=this[t];this[t]=e,this.firePropertyChange(t,i,e),this.onMapChanged(i,e)}},handleTextureChange:function(e){"image"===e.property?this.firePropertyChange("needsUpdate",!1,!0):e.property},onPropertyChange:function(e,t,i){},onMapChanged:function(e,t){},setColor:function(e){if(this.color!==e){var t=this.color.clone();e instanceof Se.Color?this.color.copy(e):this.color.set(e),this.firePropertyChange("color",t,e)}},setPropertyValue:function(e,t){if(this[e]!==t){var i=this[e];if(i instanceof Se.Color)null!=t&&(i=i.clone(),t instanceof Se.Color?this[e].copy(t):this[e].set(t));else if("gradient"==e){var r={};for(var a in t)t[a]instanceof Se.Color?r[a]=t[a]:r[a]=new Se.Color(t[a]);this[e]=r}else this[e]=t;this._uniqueCode=null,this.onPropertyChange(e,i,t),this.firePropertyChange(e,i,t)}},isTextureStyle:function(e){return"terrain"===this._type?e.startsWith("texture1.")||e.startsWith("texture2.")||e.startsWith("textureb.")||e.startsWith("texturen.")||e.startsWith("texturebp."):e.startsWith("texture.")||e.startsWith("lightmap")||e.startsWith("envmap")||e.startsWith("normalmap")||e.startsWith("specularmap")},setNeedsUpdate:function(e){},getShaderID:function(){return this instanceof Se.BasicMaterial&&(this.shaderID="basic"),this.shaderID},setupMaterialShader:function(){var e=this.getShaderID(),t=Se.ShaderLib[e];t&&(this.uniforms=Se.UniformsUtils.clone(t.uniforms),this.vertexShader=t.vertexShader,this.fragmentShader=t.fragmentShader)},refreshUniforms:function(e,t){this.refreshUniformsCommon(e,t),this.refreshUniformsSpecific(e,t)},loadCameraPosition:function(e,t,i){if((this instanceof Se.ShaderMaterial||this instanceof Se.PhongMaterial||this.envMap||"phong"===this._type)&&null!=e.cameraPosition){var r=t.worldMatrix.getPosition();i.uniform3f(e.cameraPosition,r.x,r.y,r.z)}},loadViewMatrix:function(e,t,i){("lambert"===this.type||"phong"===this.type||material.skinning)&&null!==e.viewMatrix&&i.uniformMatrix4fv(p_uniforms.viewMatrix,!1,t.worldMatrixInverse.elements)},refreshUniformsSpecific:function(e){},refreshUniformsGradient:function(){var e=this.uniforms;if(0<je.getObjectCount(this.gradient)){var t=[],i=[];for(var r in this.gradient)t.push(r);t.sort();for(var a=0;a<t.length;a++)i.push(this.gradient[t[a]]);e.gradientColor.value=i,e.gradientStop.value=t,e.gradientType.value=this.gradientType}},refreshUniformsCommon:function(e){var t,i=this.uniforms,r=this;if(i.opacity.value=r.opacity,i.wireframeLinecolor.value=r.wireframeLinecolor,i.wireframeLineopacity.value=r.wireframeLineopacity,r.clipPlane&&i.clipPlane.value.set(r.clipPlane.x,r.clipPlane.y,r.clipPlane.z,r.clipPlane.w),e?i.diffuse.value.copyGammaToLinear(this.alarmColor?this.alarmColor:this.color):i.diffuse.value=this.alarmColor?this.alarmColor:this.color,this.refreshUniformsGradient(),i.map.value=r.map,i.lightMap.value=r.lightMap,i.specularMap.value=r.specularMap,r.bumpMap&&(i.bumpMap.value=r.bumpMap,i.bumpScale.value=r.bumpScale),r.normalMap&&"phong"===r._type&&(i.normalMap.value=r.normalMap,i.normalScale.value.copy(r.normalScale)),r.map?t=r.map:r.specularMap?t=r.specularMap:r.normalMap&&"phong"===r._type?t=r.normalMap:r.bumpMap&&"phong"===r._type&&(t=r.bumpMap),t!=Me){var a=this.offset,n=this.repeat;i.offsetRepeat.value.set(a.x,a.y,n.x,n.y),i.flipX.value=t.flipX?1:0,t instanceof Se.CompressedTexture?i.flipY.value=t.flipY?0:1:i.flipY.value=0,i.mapLoaded.value=1,t._image&&!t._image.loaded&&i.offsetRepeat.value.set(0,0,1,1)}i.envMap.value=r.envMap,i.flipEnvMap.value=1,i.reflectivity.value=e?r.reflectRatio*r.reflectRatio:r.reflectRatio,i.refractionRatio.value=r.refractionRatio,i.combine.value=r.combine,i.useRefract.value=r.envMap&&r.envMap.mapping instanceof Se.CubeRefractionMapping},loadGeneralUniforms:function(){},getNormalType:function(){return this&&this.normalType!==Me&&this.normalType===Se.NormalTypeSmooth?Se.SmoothShading:Se.FlatShading},isVertexColor:function(){return!!this.vertexColors&&this.vertexColors},isGradientColor:function(){return!!this.gradientColors&&this.gradientColors},needUV:function(){return this.map||this.lightMap||this.bumpMap||this.normalMap||this.specularMap,!0},setValues:function(e){if(e!==Me)for(var t in e){var i=e[t];if(i!==Me){if(t in this){var r=this[t];r instanceof Se.Color&&i instanceof Se.Color?r.copy(i):r instanceof Se.Color?r.set(i):r instanceof Se.Vec3&&i instanceof Se.Vec3?r.copy(i):this[t]=i}}else console.warn("TGL.Material: '"+t+"' parameter is undefined.")}},isCustomAttributesNeedUpdate:function(){if(!this.attributes)return!1;for(var e in this.attributes)if(this.attributes[e].needsUpdate)return!0;return!1},clearCustomAttributes:function(){if(this.attributes)for(var e in this.attributes)this.attributes[e].needsUpdate=!1},clone:function(e){return e===Me&&(e=new Se.Material),e.name=this.name,e.side=this.side,e.blendMode=this.blendMode,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthMask=this.depthMask,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.transparent=this.transparent,e.opacity=this.opacity,e.visible=this.visible,e.normalType=this.normalType,e.wireframe=this.wireframe,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecolor=this.wireframeLinecolor.clone(),e.wireframeLineopacity=this.wireframeLineopacity,e.gradient=this.gradient,e.gradientType=this.gradientType,e.outline=this.outline,e},dispose:function(){this.firePropertyChange("disposed",!1,!0)}}),Se.MaterialIdCount=0,Se.EntityMaterial=function(e){Se.Material.call(this),this._type="basic",this.color=new Se.Color(16777215),this.map=null,this.ambient=new Se.Color(16777215),this.emissive=new Se.Color(0),this.specular=new Se.Color(1118481),this.specularStrength=1,this.shininess=30,this.wrapAround=!1,this.wrapRGB=new Se.Vec3(1,1,1),this.lightMap=null,this.specularMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Se.Vec2(1,1),this.envMap=null,this.combine=Se.MultiplyOperation,this.reflectRatio=1,this.refractionRatio=.98,this.fog=!0,this.shading=Se.SmoothShading,this.skinning=!1,this.maxBones=0,this.morphTargets=!1,this.morphNormals=!1,this.metal=!1,this.perPixel=!0,this.map1=null,this.map2=null,this.blendMap=null,this.detailMap=null,this.specularMap=null,this.blendRange=new pe(0,1),this.setValues(e),this.bakeLightMap=!1,this.metalness=0,this.roughness=0},Se.extend(Se.EntityMaterial,Se.Material,{getShaderID:function(){return this.getType()},getUniqueCode:function(){if(null!=this._uniqueCode)return this._uniqueCode;var e=this._type+" "+this.color.r+this.color.g+this.color.b+" "+this.ambient.getUniqueCode()+" "+this.emissive.getUniqueCode()+this.specular.getUniqueCode()+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth+" "+this.wireframeLinecolor+" "+this.wireframeLineopacity+" "+this.polygonOffset+" "+this.polygonOffsetFactor+" "+this.polygonOffsetUnits+" "+this.overdraw+" "+this.shininess+" "+this.metal+" "+this.specularStrength;if(this.clipPlane&&(e+=" "+this.clipPlane+" "),this.alphaTest&&(e+=this.alphaTest),e+=" "+this.normalType+" ",e+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,e+=" "+this.blendRange.x+" "+this.blendRange.y,e+=" "+this.normalScale.x+" "+this.normalScale.y,e+=" "+this.reflectRatio,this.map&&(e+=this.map.getUniqueCode()),this.map1&&(e+=this.map1.getUniqueCode()),this.map2&&(e+=this.map2.getUniqueCode()),this.blendMap&&(e+=this.blendMap.getUniqueCode()),this.normalMap&&(e+=this.normalMap.getUniqueCode()),this.lightMap&&(e+=this.lightMap.getUniqueCode()),this.envMap&&(e+=this.envMap.getUniqueCode()),this.specularMap&&(e+=this.specularMap.getUniqueCode()),this.alarmColor&&(e+=" "+this.alarmColor.getUniqueCode()),this.roughness&&(e+=" "+this.roughness),this.metalness&&(e+=" "+this.metalness),this.skinning&&(e+="skinning "+this.maxBones),this.morphTargets&&(e+="morphTargets"),this.morphNormals&&(e+="morphNormals"),this.gradient)for(var t in this.gradient)e+=" "+t+":"+this.gradient[t].getUniqueCode();return e+=" "+this.gradientType,e+=" "+this.outline,e+=this.combine,e+=this.bakeLightMap?" bakeLightMap ":"",this._uniqueCode=e},loadViewMatrix:function(e,t,i){("lambert"===this._type||"phong"===this._type||material.skinning)&&null!==e.viewMatrix&&i.uniformMatrix4fv(p_uniforms.viewMatrix,!1,t.worldMatrixInverse.elements)},onMapChanged:function(e,t){if(Se.TexturePool.useTexture(t),Se.TexturePool.unUseTexture(e),t){var i=t.getUniqueCode();null==Se.TexturePool.getTexture(i)&&Se.TexturePool.setTexture(i,t)}},setType:function(e){if(this._type!==e){var t=this._type;this._type=e,this.firePropertyChange("type",t,e),this.onTypeChanged(t,e)}},onTypeChanged:function(){},getType:function(){return this._type},setStyle:function(e,t){if(null!=e){null==this.styleMap&&(this.styleMap={});var i=this.styleMap[e];return null==t?delete this.styleMap[e]:this.styleMap[e]=t,this.firePropertyChange(Se.Styles.PREFIX_STYLE+e,i,t),this.onStyleChanged(e,i,t),this}},getStyle:function(e,t){var i;return null==t&&(t=!0),null!=this.styleMap&&(i=this.styleMap[e]),null==i&&t&&(i=Se.Styles.getStyle(e)),i},clone:function(e){return e=e||new Se.EntityMaterial,Se.Material.prototype.clone.call(this,e),e._type=this._type,e.color.copy(this.color),e.wireframeLinecolor.copy(this.wireframeLinecolor),this.clipPlane&&(e.clipPlane=this.clipPlane.clone()),e.setMap(this.map,"map"),e.setMap(this.map1,"map1"),e.setMap(this.map2,"map2"),e.setMap(this.blendMap,"blendMap"),e.setMap(this.normalMap,"normalMap"),e.setMap(this.specularMap,"specularMap"),e.setMap(this.envMap,"envMap"),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.setMap(this.lightMap,"lightMap"),e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalScale.copy(this.normalScale),e.combine=this.combine,e.reflectRatio=this.reflectRatio,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.skinning=this.skinning,e.maxBones=this.maxBones,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e.specularStrength=this.specularStrength,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.blendRange.copy(this.blendRange),e.metalness=this.metalness,e.roughness=this.roughness,e},refreshUniformsSpecific:function(e){var t=this.uniforms;"lambert"===this._type?(e?(t.ambient.value.copyGammaToLinear(this.ambient),t.emissive.value.copyGammaToLinear(this.emissive)):(t.ambient.value=this.ambient,t.emissive.value=this.emissive),this.wrapAround&&t.wrapRGB.value.copy(this.wrapRGB)):"phong"===this._type?(t.shininess.value=this.shininess,e?(t.ambient.value.copyGammaToLinear(this.alarmColor?this.alarmColor:this.ambient),t.emissive.value.copyGammaToLinear(this.emissive),t.specular.value.copyGammaToLinear(this.specular)):(t.ambient.value=this.alarmColor?this.alarmColor:this.ambient,t.emissive.value=this.emissive,t.specular.value=this.specular),t.uspecularStrength.value=this.specularStrength,this.wrapAround&&t.wrapRGB.value.copy(this.wrapRGB)):"physic"===this._type&&(t.metalness.value=this.metalness,t.roughness.value=this.roughness)},refreshUniformsCommon:function(e){if("terrain"===this._type)(t=this.uniforms).enableDiffuse1.value=this.map?1:0,t.tDiffuse1.value=this.map,t.enableDiffuse2.value=this.map1?1:0,t.tDiffuse2.value=this.map1,t.enableDiffuse3.value=this.map2?1:0,t.tDiffuse3.value=this.map2,t.enableDisplacement.value=this.blendMap?1:0,t.tDisplacement.value=this.blendMap,t.uRepeatOverlay.value=this.repeat,null==this.blendRangeArray&&(this.blendRangeArray=[0,1]),this.blendRangeArray[0]=this.blendRange.x,this.blendRangeArray[1]=this.blendRange.y,t.blendRange.value=this.blendRangeArray,t.uOpacity.value=this.opacity;else if("outline"===this._type){var t=this.uniforms;t.diffuse.value=this.color,t.outline_offset.value=this.outline}else Se.Material.prototype.refreshUniformsCommon.call(this,e)}}),Se.BlurMaterial=function(){Se.Material.call(this),this.orientation=0,this.blurAmount=5,this.blurScale=1,this.blurStrength=1,this.useBlur=1,this.texelSize=new pe(512,512),this.blurGlobalAlpha=1},Se.extend(Se.BlurMaterial,Se.Material,{refreshUniformsCommon:function(e){var t=this.uniforms;t.map.value=this.map,t.orientation.value=this.orientation,t.blurAmount.value=this.blurAmount,t.blurScale.value=this.blurScale,t.blurStrength.value=this.blurStrength,t.useBlur.value=this.useBlur,t.texelSize.value=this.texelSize,t.blurGlobalAlpha.value=this.blurGlobalAlpha},getShaderID:function(){return"blur"}}),Se.DeferredMaterial=function(e){e=e||{},Se.Material.call(this,e),this.linearDepth=30,this.isNormal=e.isNormal!==Me?e.isNormal:0},Se.extend(Se.DeferredMaterial,Se.Material,{getShaderID:function(){return"deferred"},refreshUniformsCommon:function(e){var t=this.uniforms;t.linearDepth.value=this.linearDepth,t.isNormal.value=this.isNormal}}),Se.SSAOMaterial=function(e){Se.Material.call(this),this.map1=null,this.map2=null,this.occluderBias=.05,this.samplingRadius=20,this.attenuation=new pe(1,.02),this.texelSize=new pe(1/512,1/512)},Se.extend(Se.SSAOMaterial,Se.Material,{getShaderID:function(){return"ssao"},refreshUniformsCommon:function(e){var t=this.uniforms;t.map0.value=this.map,t.map1.value=this.map1,t.map2.value=this.map2,t.occluderBias.value=this.occluderBias,t.samplingRadius.value=this.samplingRadius,t.attenuation.value=this.attenuation,t.texelSize.value=this.texelSize}}),Se.BasicMaterial=function(e){Se.Material.call(this),this._type="basic",this.color=new Se.Color(16777215),this.map=null,this.setValues(e),this.offset=new pe(0,0),this.repeat=new pe(1,1)},Se.extend(Se.BasicMaterial,Se.Material,{getShaderID:function(){return"basic"},clone:function(){var e=new Se.BasicMaterial;return Se.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e},getUniqueCode:function(){var e=this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return e+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,this.map&&(e+=this.map.getUniqueCode()),e}}),Se.LambertMaterial=function(e){Se.Material.call(this),this._type="basic",this.color=new Se.Color(16777215),this.ambient=new Se.Color(16777215),this.emissive=new Se.Color(0),this.wrapAround=!1,this.wrapRGB=new Se.Vec3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=Se.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=Se.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Se.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},Se.extend(Se.LambertMaterial,Se.Material,{clone:function(){var e=new Se.LambertMaterial;return Se.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},getShaderID:function(){return"lambert"},refreshUniformsSpecific:function(e){var t=this.uniforms;e?(t.ambient.value.copyGammaToLinear(this.ambient),t.emissive.value.copyGammaToLinear(this.emissive)):(t.ambient.value=this.ambient,t.emissive.value=this.emissive),this.wrapAround&&t.wrapRGB.value.copy(this.wrapRGB)}}),Se.PhongMaterial=function(e){Se.Material.call(this),this._type="basic",this.color=new Se.Color(16777215),this.ambient=new Se.Color(16777215),this.emissive=new Se.Color(0),this.specular=new Se.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new Se.Vec3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Se.Vec2(1,1),this.specularMap=null,this.envMap=null,this.combine=Se.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=Se.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=Se.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e),this.offset=new pe(0,0),this.repeat=new pe(1,1)},Se.extend(Se.PhongMaterial,Se.Material,{getUniqueCode:function(){var e="phong "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return e+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,this.map&&(e+=this.map.getUniqueCode()),e},clone:function(){var e=new Se.PhongMaterial;return Se.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},getShaderID:function(){return"phong"},refreshUniformsSpecific:function(e){var t=this.uniforms;t.shininess.value=this.shininess,e?(t.ambient.value.copyGammaToLinear(this.ambient),t.emissive.value.copyGammaToLinear(this.emissive),t.specular.value.copyGammaToLinear(this.specular)):(t.ambient.value=this.ambient,t.emissive.value=this.emissive,t.specular.value=this.specular),this.wrapAround&&t.wrapRGB.value.copy(material.wrapRGB)}}),Se.LineMaterial=function(e){Se.Material.call(this),this.color=new Se.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.dashed=!0,this.scale=1,this.dashSize=3,this.gapSize=1,this.skyY=0,this.horizonY=0,this.earthY=0,this.skyColor=new Se.Color(16777215),this.horizonColor=new Se.Color(16777215),this.earthColor=new Se.Color(16777215),this.vertexColors=!1,this.gradientColors=!0,this.fog=!0,this.setValues(e)},Se.extend(Se.LineMaterial,Se.Material,{getUniqueCode:function(){if(null!=this._uniqueCode)return this._uniqueCode;var e=this.color.getUniqueCode()+" "+this.linewidth+" "+this.dashed+" "+this.visible;return e+=this.transparent+" "+this.opacity,e+=this.skyY+" "+this.horizonY+" "+this.earthY,e+=this.skyColor.getUniqueCode(),e+=this.horizonColor.getUniqueCode(),e+=this.earthColor.getUniqueCode(),this._uniqueCode=e},clone:function(){var e=new Se.LineMaterial;return Se.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.dashed=this.dashed,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},getShaderID:function(){return this.dashed?"dashed":"basic"},refreshUniforms:function(e){var t,i,r,a;r=this.uniforms,a=this,r.diffuse.value=a.color,r.opacity.value=a.opacity,r.skyY.value=a.skyY,r.horizonY.value=a.horizonY,r.earthY.value=a.earthY,r.skyColor.value=a.skyColor,r.horizonColor.value=a.horizonColor,r.earthColor.value=a.earthColor,this.dashed&&(t=this.uniforms,i=this,t.dashSize.value=i.dashSize,t.totalSize.value=i.dashSize+i.gapSize,t.scale.value=i.scale)}}),Se.LineXMaterial=function(e){Se.Material.call(this),this.color=new Se.Color(16777215),this.side=Se.DoubleSide,this.attributes={positionPrev:{type:"v3",ref:"verticesPrev"},positionNext:{type:"v3",ref:"verticesNext"},offset:{type:"f",ref:"offset"},lineDistances:{type:"f",ref:"lineDistances"}},this.useVertexColor=!1,this.totalSize=0,this.dashSize=0,this.map=null,this.transparent=!1,this.opacity=1,this.repeat=new pe(1,1),this.offset=new pe(0,0)},Se.extend(Se.LineXMaterial,Se.Material,{getUniqueCode:function(){var e=this.color.getUniqueCode()+this.visible;if(e+=this.transparent+" "+this.opacity,e+=this.side,e+=this.useVertexColor,this.totalSize&&(e+=this.totalSize),this.dashSize&&(e+=this.dashSize),this.map&&(e+=this.map.getUniqueCode()),e+=this.transparent,e+=this.opacity,e+=this.repeat.x+" "+this.repeat.y,e+=this.offset.x+" "+this.offset.y,this.gradient)for(var t in this.gradient)e+=" "+t+":"+this.gradient[t].getUniqueCode();return e+" "+this.gradientType},clone:function(){var e=new Se.LineXMaterial;return Se.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.useVertexColor=this.useVertexColor,e.dashSize=this.dashSize,e.totalSize=this.totalSize,e.transparent=this.transparent,e.opacity=this.opacity,e.repeat.copy(this.repeat),e.offset.copy(this.offset),e.setMap(this.map,"map"),e.gradient=this.gradient,e.gradientType=this.gradientType,e},getShaderID:function(){return"linex"},refreshUniforms:function(e,t){if(this.uniforms.lineColor.value=this.color,this.uniforms.opacity.value=this.opacity,t.network){var i=t.network.getView();this.uniforms.viewport.value=new Se.Vec4(0,0,i.width,i.height)}if(t.camera&&(this.uniforms.near.value=t.camera.near||1),this.uniforms.useVertexColor.value=this.useVertexColor?1:0,this.uniforms.dashSize.value=this.dashSize,this.uniforms.totalSize.value=this.totalSize,this.map){this.uniforms.map.value=this.map;var r=this.offset,a=this.repeat;this.uniforms.offsetRepeat.value.set(r.x,r.y,a.x,a.y)}this.refreshUniformsGradient()}}),Se.SurfaceMaterial=function(e){Se.EntityMaterial.call(this),this.skyY=0,this.horizonY=0,this.earthY=0,this.skyColor=new Se.Color(16777215),this.horizonColor=new Se.Color(16777215),this.earthColor=new Se.Color(16777215)},Se.extend(Se.SurfaceMaterial,Se.EntityMaterial,{getUniqueCode:function(){var e=Se.EntityMaterial.prototype.getUniqueCode.call(this);return this.skyColor&&(e+=" "+this.skyColor.getUniqueCode()),this.horizonColor&&(e+=" "+this.horizonColor.getUniqueCode()),this.earthColor&&(e+=" "+this.earthColor.getUniqueCode()),e+=" "+this.skyY,e+=" "+this.horizonY,e+=" "+this.earthY,this._uniqueCode=e},clone:function(){var e=new Se.SurfaceMaterial;return Se.EntityMaterial.prototype.clone.call(this,e),e.skyY=this.skyY,e.horizonY=this.horizonY,e.earthY=this.earthY,e.skyColor=this.skyColor,e.horizonColor=this.horizonColor,e.earthColor=this.earthColor,e},refreshUniforms:function(e){var t,i;Se.EntityMaterial.prototype.refreshUniforms.call(this,e),t=this.uniforms,i=this,t&&t.skyY&&(t.skyY.value=i.skyY,t.horizonY.value=i.horizonY,t.earthY.value=i.earthY,t.skyColor.value=i.skyColor,t.horizonColor.value=i.horizonColor,t.earthColor.value=i.earthColor)}}),Se.ArrayMaterial=function(e){this.materials=e||[]},Se.extend(Se.ArrayMaterial,Object,{clone:function(){for(var e=new Se.ArrayMaterial,t=0;t<this.materials.length;t++){var i=this.materials[t],r=this.materials.indexOf(i);null!=e.materials[r]?e.materials.push(e.materials[r]):e.materials.push(i.clone())}return e}}),Se.BillboardMaterial=function(e){Se.Material.call(this),this.alignment=Se.BillboardAlignment.center.clone(),this.fog=!1,this.color=new Se.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.offset=new Se.Vec2(0,0),this.repeat=new Se.Vec2(1,1),this.transparent=!0,this.setValues(e),this.depthMask=!0,this.vertical=!1,this.fixedSize=0,this.alphaTest=0},Se.extend(Se.BillboardMaterial,Se.Material,{clone:function(e){return e=e||new Se.BillboardMaterial,Se.Material.prototype.clone.call(this,e),e.alignment.copy(this.alignment),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.fog=this.fog,e.vertical=this.vertical,e.transparent=this.transparent,e.alphaTest=this.alphaTest,e.blendMode=this.blendMode,e.fixedSize=this.fixedSize,e},getUniqueCode:function(){var e="Billboard "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return e+=this.vertical+" "+this.alphaTest+" "+this.alignment.x+" "+this.alignment.y,e+=this.fixedSize,e+=this.repeat.x+" "+this.repeat.y,e+=this.offset.x+" "+this.offset.y,e+=" "+this.blendMode,this.map&&(e+=this.map.getUniqueCode()),e}}),Se.BillboardAlignment={},Se.BillboardAlignment.topLeft=new Se.Vec2(.5,-.5),Se.BillboardAlignment.topCenter=new Se.Vec2(0,-.5),Se.BillboardAlignment.topRight=new Se.Vec2(-.5,-.5),Se.BillboardAlignment.centerLeft=new Se.Vec2(.5,0),Se.BillboardAlignment.center=new Se.Vec2(0,0),Se.BillboardAlignment.centerRight=new Se.Vec2(-.5,0),Se.BillboardAlignment.bottomLeft=new Se.Vec2(.5,.5),Se.BillboardAlignment.bottomCenter=new Se.Vec2(0,.5),Se.BillboardAlignment.bottomRight=new Se.Vec2(-.5,.5);var Mt=function(e){Se.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms=e&&e.uniforms||{},this.defines={},this.attributes=null,this._type="shader",this.shading=Se.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=Se.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName="position",this.setValues(e)};Se.ShaderMaterial=Mt,Se.extend(Se.ShaderMaterial,Se.Material,{clone:function(){var e=new Se.ShaderMaterial;return Se.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=Se.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},setupMaterialShader:function(){},needUV:function(){return!0},getShaderID:function(){return this.shaderID},refreshUniformsCommon:function(e,t){var i=this.uniforms;for(var r in i)i[r].value=this[r]},onPropertyChange:function(e,t,i){this._needRefreshUniform=!0}}),Se.TransformGizmoMaterial=function(e){Se.BasicMaterial.call(this),this.depthTest=!1,this.depthMask=!1,this.side=Se.DoubleSide,this.transparent=!0,this.setValues(e)},Se.extend(Se.TransformGizmoMaterial,Se.BasicMaterial,{getUniqueCode:function(){var e=this.id+"TransformGizmo "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return this.map&&(e+=this.map.getUniqueCode()),e}});var St,Pt,Tt,Ct,Et,zt,Dt,Lt,Rt,Nt,Bt,It,Ft,Vt,Ut={pools:{},useTimes:{},size:0,getMaterial:function(e){return Ut.pools[e]},setMaterial:function(e,t){e&&(Ut.size++,Ut.pools[e]=t)},useMaterial:function(e){if(e){var t=e.id,i=Ut.useTimes[t]||0;i++,Ut.useTimes[t]=i}},unUseMaterial:function(e){if(e){var t=e.id,i=Ut.useTimes[t]||0;if(i--,(Ut.useTimes[t]=i)<=0){var r=e.getUniqueCode&&e.getUniqueCode();delete Ut.pools[r],Ut.size--,e.dispose()}}},clear:function(){this.pools={},this.useTimes={},this.size=0}};(Se.MaterialPool=Ut).DefaultMaterial=new Se.EntityMaterial,Ut.TestMaterial=new Se.EntityMaterial,Ut.DefaultBillBoardMaterial=new Se.BillboardMaterial,Ut.DefaultLineMaterial=new Se.LineMaterial,Se.ParticleMaterial=function(e){Se.Material.call(this),this.color=new Se.Color(16777215),this.map=null,this.size=2,this.sizeAttenuation=!1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},Se.extend(Se.ParticleMaterial,Se.Material,{clone:function(){var e=new Se.ParticleMaterial;return Se.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},getShaderID:function(){return this.shaderID="particle_basic",this.shaderID},getUniqueCode:function(){var e=this.color.getUniqueCode();return e+=map?map.getUniqueCode():"",e+=" "+this.size,e+=" "+this.fog,e+=" "+this.sizeAttenuation,e+=" "+this.transparent,e+=" "+this.opacity,(e+=" "+this.depthTest)+" "+this.alphaTest},refreshUniforms:function(e){var t,i;t=this.uniforms,i=this,t.psColor.value=i.color,t.opacity.value=i.opacity,t.size.value=i.size,t.scale.value=i.scale||1,t.map.value=i.map}}),Se.Light=function(e,t){Se.Element.call(this,t),this.color=new Se.Color(e),this.ambient=new Se.Color,this.diffuse=new Se.Color,this.specular=new Se.Color,this.castShadow=!1,this.onlyShadow=!1},Se.extend(Se.Light,Se.Element,{__accessor:["color","ambient","diffuse","specular"],constructor:Se.Light,className:"TGL.Light",setCastShadow:function(e){this.castShadow=e},setOnlyShadow:function(e){this.onlyShadow=e},refreshShadowUniforms:function(e,t){if(e.shadowMatrix&&this.castShadow&&(this instanceof Se.SpotLight||this instanceof Se.DirectionalLight&&!this.shadowCascade))return e.shadowMap.value[t]=this.shadowMap,e.shadowMapSize.value[t]=this.shadowMapSize,e.shadowMatrix.value[t]=this.shadowMatrix,e.shadowDarkness.value[t]=this.shadowDarkness,e.shadowBias.value[t]=this.shadowBias,!0},refreshUniformsPointShadow:function(e,t){var i=this;if(e.pShadowMap&&i.castShadow&&i instanceof Se.PointLight)return e.pShadowMap.value[t]=i.shadowMap,e.pShadowMapSize.value[t]=i.shadowMapSize,e.pShadowDarkness.value[t]=i.shadowDarkness||.5,e.pPosition.value[t]=i.getPosition(),e.pShadowRadius.value[t]=i.shadowRadius||1,e.shadowCameraNear.value=i.shadowCameraNear,e.shadowCameraFar.value=i.shadowCameraFar,e.pShadowBias.value[t]=i.shadowBias,!0}}),Se.PointLight=function(e,t,i,r){if(1===arguments.length&&e instanceof Object&&!Array.isArray(e)){var a=e;e=a.hex,t=a.intensity,i=a.distance,r=a.id}Se.Light.call(this,e,r),this.position=new Se.Vec3(0,0,0),this.intensity=t!==Me?t:1,this.distance=i!==Me?i:0,this.shadowCameraNear=10,this.shadowCameraFar=1e3,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowDarkness=.5,this.shadowBias=0},Se.extend(Se.PointLight,Se.Light,{constructor:Se.PointLight,className:"TGL.PointLight",__accessor:["intensity","distance"]}),Se.SpotLight=function(e,t,i,r,a){Se.Light.call(this,e),this._position=new Se.Vec3(0,1,0),this.target=new Se.Element,this.intensity=t!==Me?t:1,this.distance=i!==Me?i:0,this.angle=r!==Me?r:Math.PI/2,this.exponent=a!==Me?a:10,this.shadowCameraNear=100,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},Se.extend(Se.SpotLight,Se.Light,{__accessor:["color","ambient","diffuse","specular","intensity","distance","angle","exponent"],constructor:Se.SpotLight,className:"TGL.SpotLight"}),Se.DirectionalLight=function(e,t,i){if(1===arguments.length&&e instanceof Object&&!Array.isArray(e)){var r=e;e=r.hex,t=r.intensity,i=r.id}Se.Light.call(this,e,i),this.direction=new Se.Vec3(0,1,0),this.position=new Se.Vec3(0,1,0),this.target=new Se.Element,this.intensity=t!==Me?t:1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new Se.Vec3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},Se.extend(Se.DirectionalLight,Se.Light,{className:"TGL.DirectionalLight",__accessor:["direction"]}),Se.AmbientLight=function(e,t){if(1===arguments.length&&e instanceof Object&&!Array.isArray(e)){var i=e;e=i.hex,t=i.id}Se.Light.call(this,e,t)},Se.extend(Se.AmbientLight,Se.Light,{constructor:Se.AmbientLight,className:"TGL.AmbientLight",clone:function(){var e=new Se.AmbientLight;return Se.Light.prototype.clone.call(this,e),e}}),Se.Camera=function(){Se.Element.call(this),this.projectionMatrix=new Se.Mat4,this.projectionMatrixInverse=new Se.Mat4,this.worldMatrixInverse=new Se.Mat4,this.target=new Se.Vec3,this.setPosition(0,0,500),this.lookat=this.lookAt},Se.extend(Se.Camera,Se.Element,{constructor:Se.Camera,updateCameraMatrix:function(e){var t=this.matrix.clone();this.matrix.lookAt(this._position,this.target,this.up),this.rotationAutoUpdate&&this._rotation.setEulerFromRotationMatrix(this.matrix),!t.equals(this.matrix)&&e&&this.firePropertyChange("matrix",t,this.matrix)},lookAt:function(e,t){3===arguments.length&&e.x===Me?(e=new mono.Vec3(e,t,arguments[2]),t=Me):4===arguments.length&&e.x===Me&&(e=new mono.Vec3(e,t,arguments[2]),t=arguments[4]),t===Me&&(t=!0),this.target=e,this.updateCameraMatrix(t)},look:function(e){3===arguments.length&&e.x===Me&&(e=new mono.Vec3(e,arguments[1],arguments[2])),this.lookAt(e,!0)},onUpChanged:function(e,t){this.updateCameraMatrix()},getTarget:function(){return this.target},t:function(){return this.getTarget()},getDistance:function(){return(new Q).subVectors(this._position,this.target).length()},setDistance:function(e){var t=this.getDistance();this.zoom(e/t)},lookAtElement:function(e,t,i){t instanceof Q?(i=t,t=this.getDistance()):i=i||new Q(0,0,1),e instanceof Se.Element&&(t=t||this.getDistance(),this.setPosition(e.worldPosition(i,t)),this.look(e.getWorldPosition()))},zoomOut:function(e){this.zoom(1.1,e)},zoomIn:function(e){this.zoom(.9,e)},zoom:function(e,t){if(0<e){var i=t||this.getDistance();i*=e;var r=(new Q).addVectors(this.target,(new Q).subVectors(this._position,this.target).setLength(i));this.setPosition(r)}}}),Se.OrthoCamera=function(e,t,i,r){Se.Camera.call(this),this.width=e||1,this.aspect=t||1,this.near=i||.1,this.far=r||1e4,this.updateProjectionMatrix()},Se.extend(Se.OrthoCamera,Se.Camera,{constructor:Se.OrthoCamera,className:"TGL.OrthoCamera",__accessor:["width","aspect","near","far"],updateProjectionMatrix:function(){var e=this.getDistance(),t=e*this.width/2,i=-t,r=e/this.aspect*this.width/2,a=-r;this.projectionMatrix.makeOrthographic(i,t,r,a,this.near,this.far)},onPropertyChange:function(){this.updateProjectionMatrix()},updateCameraMatrix:function(e){Se.Camera.prototype.updateCameraMatrix.call(this,e),this.updateProjectionMatrix()}}),Se.PerspectiveCamera=function(e,t,i,r){Se.Camera.call(this),this.fov=e!==Me?e:50,this.aspect=t!==Me?t:1,this.near=i!==Me?i:1,this.far=r!==Me?r:5e4,this.updateProjectionMatrix()},Se.extend(Se.PerspectiveCamera,Se.Camera,{constructor:Se.PerspectiveCamera,className:"TGL.PerspectiveCamera",__accessor:["fov","aspect","near","far"],updateProjectionMatrix:function(){this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},onPropertyChange:function(){this.updateProjectionMatrix()}}),Se.VRCamera=function(e,t,i){Se.Camera.call(this),this.network=e,this.vrDisplay=e._vrDisplay,this.near=t!==Me?t:.01,this.far=i!==Me?i:1e4,this.orientation=[0,0,0,1],this.leftPm=new ie,this.rightPm=new ie,this.leftVm=new ie,this.leftVmInverse=new ie,this.rightVm=new ie,this.rightVmInverse=new ie,this.speed=.01,this.lockY=!1,this.updateProjectionMatrix()},Se.extend(Se.VRCamera,Se.Camera,{constructor:Se.VRCamera,className:"TGL.VRCamera",__accessor:["near","far","lockY","speed"],updateCameraMatrix:function(e){},updateMatrix:function(){},updateWorldMatrix:function(e,t){},updateProjectionMatrix:(Dt=new ie,Lt=new ie,Rt=new ie,Nt=new Q,Bt=new ie,It=[0,1.65,0],Ft=new mono.Quat,Vt=new mono.Quat,function(){var e=this,t=e.leftVm,i=e.rightVm,r=e.leftVmInverse,a=e.rightVmInverse,n=e.leftPm,o=e.rightPm,s=e._frameData,l=e.vrDisplay;if(l){l.depthNear=e.near,l.depthFar=e.far,s||(s=e._frameData=new VRFrameData),l.getFrameData(s),function(){if(zt=Et=Ct=null,navigator.getGamepads)for(var e=navigator.getGamepads(),t=0;t<e.length;t++){var i=e[t];i&&i.pose&&("right"===i.hand?Et=i:Ct=i,i.buttons.some(function(e,t){if(e.pressed)return zt=i,!0}))}}(),l.stageParameters?Bt.set(l.stageParameters.sittingToStandingTransform):(Bt.identity(),Bt.translate(It));var h=-1;if(zt&&(zt.buttons.some(function(e,t){if(e.pressed)return h=t,!0}),2===h)){Nt.set(0,0,-e.speed),Vt.setFromRotationMatrix(Bt);var c=zt.pose.orientation;Ft.set(c[0],c[1],c[2],c[3]),Ft.multiplyQuaternions(Vt,Ft),Nt.applyQuaternion(Ft),e.lockY&&Nt.setY(0),e.getPosition(!1).add(Nt)}e.network.onGamepadChanged&&e.network.onGamepadChanged(Ct,Et,zt,h),Dt.identity(),Dt.setPosition(e.getPosition()),Dt.multiplyMatrices(Dt,Bt),Lt.getInverse(Dt),Rt.set(s.leftViewMatrix),r.multiplyMatrices(Rt,Lt),t.getInverse(r),Rt.set(s.rightViewMatrix),a.multiplyMatrices(Rt,Lt),i.getInverse(a),n.set(s.leftProjectionMatrix),o.set(s.rightProjectionMatrix)}}),onPropertyChange:function(){this.updateProjectionMatrix()}}),Se.CameraHelper=function(e){function t(e,t,i){r(e,i),r(t,i)}function r(e,t){i.vertices.push(new Se.Vec3),i.colors.push(new Se.Color(t)),n[e]===Me&&(n[e]=[]),n[e].push(i.vertices.length-1)}var i=new Se.Entity,a=new Se.LineMaterial({color:16777215,vertexColors:Se.FaceColors}),n={};t("n1","n2",16755200),t("n2","n4",16755200),t("n4","n3",16755200),t("n3","n1",16755200),t("f1","f2",16755200),t("f2","f4",16755200),t("f4","f3",16755200),t("f3","f1",16755200),t("n1","f1",16755200),t("n2","f2",16755200),t("n3","f3",16755200),t("n4","f4",16755200),t("p","n1",16711680),t("p","n2",16711680),t("p","n3",16711680),t("p","n4",16711680),t("u1","u2",43775),t("u2","u3",43775),t("u3","u1",43775),t("c","t",16777215),t("p","c",3355443),t("cn1","cn2",3355443),t("cn3","cn4",3355443),t("cf1","cf2",3355443),t("cf3","cf4",3355443),Se.Line.call(this,i.vertices,i.colors,a,Se.LinePieces),this.camera=e,this.worldMatrix=e.worldMatrix,this.matrixAutoUpdate=!1,this.pointMap=n,this.update()},Se.CameraHelper.prototype=Object.create(Se.Line.prototype),Se.CameraHelper.prototype.update=(St=new Se.Vec3,Pt=new Se.Camera,Tt=new Se.Projector,function(){function e(e,t,i,r){St.set(t,i,r),Tt.unprojectVector(St,Pt);var a=s.pointMap[e];if(a!==Me)for(var n=0,o=a.length;n<o;n++)s.vertices[a[n]].copy(St)}var s=this;Pt.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),this.verticesNeedUpdate=!0});var kt=function(){Se.Element.call(this)};(kt.prototype=Object.create(Se.Element.prototype)).updateworldMatrix=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||e)&&(this._parent?(this.worldMatrix.multiplyMatrices(this._parent.worldMatrix,this.matrix),this.worldMatrix.decompose(this.translationWorld,this.QuatWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.QuatObject,this.scaleObject),this.worldMatrix.compose(this.translationWorld,this.QuatObject,this.scaleWorld)):this.worldMatrix.copy(this.matrix),e=!(this.worldMatrixNeedsUpdate=!1));for(var t=0,i=this.getChildren().size();t<i;t++)this.getChildren().get(t).updateworldMatrix(e)},kt.prototype.translationWorld=new Se.Vec3,kt.prototype.translationObject=new Se.Vec3,kt.prototype.QuatWorld=new Se.Quat,kt.prototype.QuatObject=new Se.Quat,kt.prototype.scaleWorld=new Se.Vec3,kt.prototype.scaleObject=new Se.Vec3;var Ot=function(){function B(e,t){var i=new Se.DirectionalLight;i.isVirtual=!0,i.onlyShadow=!0,i.castShadow=!0,i.shadowCameraNear=e.shadowCameraNear,i.shadowCameraFar=e.shadowCameraFar,i.shadowCameraLeft=e.shadowCameraLeft,i.shadowCameraRight=e.shadowCameraRight,i.shadowCameraBottom=e.shadowCameraBottom,i.shadowCameraTop=e.shadowCameraTop,i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t],i.shadowMapWidth=e.shadowCascadeWidth[t],i.shadowMapHeight=e.shadowCascadeHeight[t],i.pointsWorld=[],i.pointsFrustum=[];for(var r=i.pointsWorld,a=i.pointsFrustum,n=0;n<8;n++)r[n]=new Se.Vec3,a[n]=new Se.Vec3;var o=e.shadowCascadeNearZ[t],s=e.shadowCascadeFarZ[t];return a[0].set(-1,-1,o),a[1].set(1,-1,o),a[2].set(-1,1,o),a[3].set(1,1,o),a[4].set(-1,-1,s),a[5].set(1,-1,s),a[6].set(-1,1,s),a[7].set(1,1,s),i}function I(e,t){var i=e.shadowCascadeArray[t];i.position.copy(e.position),i.target.position.copy(e.target.position),i.lookAt(i.target),i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t];var r=e.shadowCascadeNearZ[t],a=e.shadowCascadeFarZ[t],n=i.pointsFrustum;n[0].z=r,n[1].z=r,n[2].z=r,n[3].z=r,n[4].z=a,n[5].z=a,n[6].z=a,n[7].z=a}function F(e,t){var i=t.shadowCamera,r=t.pointsFrustum,a=t.pointsWorld;s.set(1/0,1/0,1/0),l.set(-1/0,-1/0,-1/0);for(var n=0;n<8;n++){var o=a[n];o.copy(r[n]),Ot.__projector.unprojectVector(o,e),o.applyMatrix4(i.worldMatrixInverse),o.x<s.x&&(s.x=o.x),o.x>l.x&&(l.x=o.x),o.y<s.y&&(s.y=o.y),o.y>l.y&&(l.y=o.y),o.z<s.z&&(s.z=o.z),o.z>l.z&&(l.z=o.z)}i.left=s.x,i.right=l.x,i.top=l.y,i.bottom=s.y,i.updateProjectionMatrix()}var V,U,k,r,a,n,O=new Se.Frustum,X=new Se.Mat4,s=new Se.Vec3,l=new Se.Vec3,G=new Se.Vec3;this.init=function(e){V=e._gl,U=e;var t=Se.ShaderLib.depthRGBA,i=Se.UniformsUtils.clone(t.uniforms);k=new Mt({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i}),_depthCubeMaterial=new Mt({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,refreshUniformsCommon:function(e){this.uniforms.isCube.value=1,this.uniforms.nearDistance.value=this.nearDistance,this.uniforms.farDistance.value=this.farDistance,this.uniforms.referencePosition.value=this.referencePosition}}),r=new Mt({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,morphTargets:!0}),a=new Mt({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,skinning:!0}),n=new Mt({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,morphTargets:!0,skinning:!0}),k._shadowPass=!0,r._shadowPass=!0,a._shadowPass=!0,n._shadowPass=!0};var Y=[new mono.Vec3(1,0,0),new mono.Vec3(-1,0,0),new mono.Vec3(0,0,1),new mono.Vec3(0,0,-1),new mono.Vec3(0,1,0),new mono.Vec3(0,-1,0)],W=[new mono.Vec3(0,1,0),new mono.Vec3(0,1,0),new mono.Vec3(0,1,0),new mono.Vec3(0,1,0),new mono.Vec3(0,0,1),new mono.Vec3(0,0,-1)],j=[new mono.Vec4,new mono.Vec4,new mono.Vec4,new mono.Vec4,new mono.Vec4,new mono.Vec4];this.dirty=!0,this.dirtyShadowMap=function(){this.dirty=!0},this.render=function(e,t){U._shadowMapEnable&&this.update(e,t)},this.handleDataPropertyChange=function(e){var t=e.source,i=e.property;(t.isSizeChangedProperty&&t.isSizeChangedProperty(i)||"parent"==i||t.isSpaceChangedProperty(i))&&this.dirtyShadowMap()},this.handleDataBoxChange=function(e){this.dirtyShadowMap()},this.update=function(e,t){if(this.dirty){this.dirty=!1;var i,r,a,n,o,s,l,h,c,u,f,p,d,m,g=[],y=0;V.clearColor(1,1,1,1),V.disable(V.BLEND),V.enable(V.CULL_FACE),V.frontFace(V.CCW),U.shadowMapCullFace===Se.CullFaceFront?V.cullFace(V.FRONT):V.cullFace(V.BACK),U.setDepthTest(!0);var v=e.getLights();for(i=0,r=v.size();i<r;i++)if((d=v.get(i)).castShadow)if(d instanceof Se.DirectionalLight&&d.shadowCascade)for(o=0;o<d.shadowCascadeCount;o++){var x;if(d.shadowCascadeArray[o])x=d.shadowCascadeArray[o];else{(x=B(d,o)).originalCamera=t;var A=new kt;A.position=d.shadowCascadeOffset,A.add(x),A.add(x.target),t.add(A),d.shadowCascadeArray[o]=x}I(d,o),g[y]=x,y++}else g[y]=d,y++;for(i=0,r=g.length;i<r;i++){var _=(d=g[i])instanceof Se.PointLight,w=_?6:1;if(!d.shadowMap){var b=Se.NearestFilter;U.shadowMapType===Se.PCFSoftShadowMap&&(b=Se.NearestFilter);var M={minFilter:b,magFilter:b,format:Se.RGBAFormat},S=new mono.Vec2(d.shadowMapWidth,d.shadowMapHeight);if(_){var P=S.x,T=S.y;j[0].set(2*P,T,P,T),j[1].set(0,T,P,T),j[2].set(3*P,T,P,T),j[3].set(P,T,P,T),j[4].set(3*P,0,P,T),j[5].set(P,0,P,T),S.x*=4,S.y*=2,d.shadowMap=new $e(S.x,S.y,M),d.shadowMapSize=new pe(S.x,S.y),d.shadowMatrix=new Se.Mat4}else d.shadowMap=new $e(d.shadowMapWidth,d.shadowMapHeight,M),d.shadowMapSize=new pe(d.shadowMapWidth,d.shadowMapHeight),d.shadowMatrix=new Se.Mat4}if(!d.shadowCamera){if(d instanceof Se.SpotLight)d.shadowCamera=new Se.PerspectiveCamera(d.shadowCameraFov,d.shadowMapWidth/d.shadowMapHeight,d.shadowCameraNear,d.shadowCameraFar);else if(d instanceof Se.DirectionalLight)d.shadowCamera=new Se.OrthoCamera(d.shadowCameraLeft,d.shadowMapWidth/d.shadowMapHeight,d.shadowCameraNear,d.shadowCameraFar);else{if(!(d instanceof Se.PointLight)){console.error("Unsupported light type for shadow");continue}d.shadowCamera=new Se.PerspectiveCamera(90,1,d.shadowCameraNear,d.shadowCameraFar)}d.shadowCamera.updateWorldMatrix();for(var C=e.getRoots(),E=C.size(),z=0;z<E;z++)C.get(z).updateWorldMatrix()}for(d.shadowCameraVisible&&!d.cameraHelper&&(d.cameraHelper=new Se.CameraHelper(d.shadowCamera),d.shadowCamera.addChild(d.cameraHelper),d.shadowCamera.updateWorldMatrix(!0),U.helperBox.add(d.shadowCamera),U.helperBox.add(d.cameraHelper)),d.isVirtual&&x.originalCamera==t&&F(t,d),new Q(1,0,0),new Q(-1,0,0),new Q(0,1,0),new Q(0,-1,0),new Q(0,0,1),new Q(0,0,-1),s=d.shadowMap,l=d.shadowMatrix,h=d.shadowCamera,U.debugPointLight==Me&&U.setRenderTarget(s),U.clear(),y=0;y<w;y++)if(null==d.debugFace||y==d.debugFace){if(h._position.setFromMatrixPosition(d.worldMatrix),d.target?(G.setFromMatrixPosition(d.target.worldMatrix),h.lookAt(G),h.updateWorldMatrix(!0)):G=h.p().clone().add(Y[y]),h.worldMatrixInverse.getInverse(h.worldMatrix),d.cameraHelper&&(d.cameraHelper.visible=d.shadowCameraVisible),d.shadowCameraVisible&&d.cameraHelper.update(),_){l.translate(h._position.clone().negate()),h.setUp(W[y]),h.lookAt(G),h.updateWorldMatrix(!0),h.setNear(d.shadowCameraNear),h.setFar(d.shadowCameraFar),_depthCubeMaterial.nearDistance=d.shadowCameraNear,_depthCubeMaterial.farDistance=d.shadowCameraFar,_depthCubeMaterial.referencePosition=h._position.clone();var D=j[y];h.worldMatrixInverse.getInverse(h.worldMatrix),U.setViewport(D.x,D.y,D.z,D.w)}else l.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),l.multiply(h.projectionMatrix),l.multiply(h.worldMatrixInverse);for(X.multiplyMatrices(h.projectionMatrix,h.worldMatrixInverse),O.setFromMatrix(X),a=0,n=(m=U.glNodeList).length;a<n;a++)p=(f=m[a]).node,f.render=!1,p._visible&&p.castShadow&&((p instanceof Se.Node||p instanceof Se.Particle)&&p.frustumCulled&&!O.intersectsObject(p)||(p._modelViewMatrix.multiplyMatrices(h.worldMatrixInverse,p.worldMatrix),f.render=!0));for(a=0,n=m.length;a<n;a++)(f=m[a]).render&&(p=f.node,c=f.group,(N=p).material instanceof Se.ArrayMaterial?N.material.materials[0]:N.material,!1,u=p.customDepthMaterial?p.customDepthMaterial:1==w?k:_depthCubeMaterial,p instanceof Se.BufferNode||U.renderGroup(h,e.getLights(),u,c,p))}}var L=U.getClearColor(),R=U.getClearAlpha();V.clearColor(L.r,L.g,L.b,R),V.enable(V.BLEND),U.shadowMapCullFace===Se.CullFaceFront&&V.cullFace(V.BACK)}var N}};Ot.__projector=new Se.Projector,Se.Picking=function(e,t,i,r,a,n){this.network=n,this.origin=e,this.cameraUp=i,this.direction=t,this.near=r||0,this.far=a||1/0,this.ray=new Se.Ray(e,t),0<this.ray.direction.length&&this.ray.direction.normalize()},Se.Picking.testPlane=new Se.Plane(1,1),Se.Picking.prototype={constructor:Se.Picking,precision:1e-4,linePrecision:2,matrixPosition:new Se.Vec3,set:function(e,t){this.origin=e,this.direction=t,this.ray.set(e,t),0<this.ray.direction.length&&this.ray.direction.normalize()},intersectObject:function(e,t,i){var r=[];return!0===t&&I(e,this,r,i),B(e,this,r,i),r.sort(N),r},intersectObjects:function(e,t,i){e._as&&(e=e._as);for(var r=[],a=0,n=e.length;a<n;a++)B(e[a],this,r,i,this.network),!0===t&&I(e[a],this,r,i,this.network);return r.sort(N),r}};var Xt=new Se.Ray,Gt=new Se.Mat4,Yt=new Se.math.Plane,Wt=new Se.Vec3,jt=new Se.BoundingSphere,Ht=function(e){0<arguments.length&&this.init(e)};Ht.prototype.init=function(e){this.status=e,this.points=new Array},Ht.prototype.appendPoint=function(e){this.points.push(e)},Ht.prototype.appendPoints=function(e){this.points=this.points.concat(e)},Ht.intersectShapes=function(e,t){var i,r=e.getIntersectionParams(),a=t.getIntersectionParams();if(null!=r&&null!=a)if("Path"==r.name)i=Ht.intersectPathShape(e,t);else if("Path"==a.name)i=Ht.intersectPathShape(t,e);else{var n,o;if(r.name<a.name?(n="intersect"+r.name+a.name,o=r.params.concat(a.params)):(n="intersect"+a.name+r.name,o=a.params.concat(r.params)),!(n in Ht))throw new Error("Intersection not available: "+n);i=Ht[n].apply(null,o)}else i=new Ht("No Intersection");return i},Ht.intersectPathShape=function(e,t){return e.intersectShape(t)},Ht.intersectBezier2Bezier2=function(e,t,i,r,a,n){var o,s,l,h,c,u,f,p,d,m=new Ht("No Intersection");if(o=t.multiply(-2),l=e.add(o.add(i)),o=e.multiply(-2),s=t.multiply(2),h=o.add(s),c=new pe(e.x,e.y),o=a.multiply(-2),u=r.add(o.add(n)),o=r.multiply(-2),s=a.multiply(2),f=o.add(s),p=new pe(r.x,r.y),0==l.y){var g=(v=l.x*(c.y-p.y))+(x=v-h.x*h.y),y=h.y*h.y;d=new Polynomial(l.x*u.y*u.y,2*l.x*f.y*u.y,l.x*f.y*f.y-u.x*y-u.y*v-u.y*x,-f.x*y-f.y*v-f.y*x,(c.x-p.x)*y+(c.y-p.y)*x)}else{var v=l.x*u.y-l.y*u.x,x=l.x*f.y-f.x*l.y,A=(g=h.x*l.y-h.y*l.x,y=c.y-p.y,l.y*(c.x-p.x)-l.x*y),_=-h.y*g+l.y*A,w=g*g;d=new Polynomial(v*v,2*v*x,(-u.y*w+l.y*x*x+l.y*v*A+v*_)/l.y,(-f.y*w+l.y*x*A+x*_)/l.y,(y*w+A*_)/l.y)}for(var b=d.getRoots(),M=0;M<b.length;M++){var S=b[M];if(0<=S&&S<=1){var P=new Polynomial(l.x,h.x,c.x-p.x-S*f.x-S*S*u.x).getRoots(),T=new Polynomial(l.y,h.y,c.y-p.y-S*f.y-S*S*u.y).getRoots();if(0<P.length&&0<T.length)e:for(var C=0;C<P.length;C++){var E=P[C];if(0<=E&&E<=1)for(var z=0;z<T.length;z++)if(Math.abs(E-T[z])<1e-4){m.points.push(u.multiply(S*S).add(f.multiply(S).add(p)));break e}}}}return 0<m.points.length&&(m.status="$Intersection"),m},Ht.intersectBezier2Bezier3=function(e,t,i,r,a,n,o){var s,l,h,c,u,f,p,d,m,g,y,v=new Ht("No Intersection");s=t.multiply(-2),u=e.add(s.add(i)),s=e.multiply(-2),l=t.multiply(2),f=s.add(l),p=new pe(e.x,e.y),s=r.multiply(-1),l=a.multiply(3),h=n.multiply(-3),c=s.add(l.add(h.add(o))),d=new Vector2D(c.x,c.y),s=r.multiply(3),l=a.multiply(-6),h=n.multiply(3),c=s.add(l.add(h)),m=new Vector2D(c.x,c.y),s=r.multiply(-3),l=a.multiply(3),h=s.add(l),g=new Vector2D(h.x,h.y),y=new Vector2D(r.x,r.y);for(var x=p.x*p.x,A=p.y*p.y,_=f.x*f.x,w=f.y*f.y,b=u.x*u.x,M=u.y*u.y,S=y.x*y.x,P=y.y*y.y,T=g.x*g.x,C=g.y*g.y,E=m.x*m.x,z=m.y*m.y,D=d.x*d.x,L=d.y*d.y,R=new Polynomial(-2*u.x*u.y*d.x*d.y+b*L+M*D,-2*u.x*u.y*m.x*d.y-2*u.x*u.y*m.y*d.x+2*M*m.x*d.x+2*b*m.y*d.y,-2*u.x*g.x*u.y*d.y-2*u.x*u.y*g.y*d.x-2*u.x*u.y*m.x*m.y+2*g.x*M*d.x+M*E+b*(2*g.y*d.y+z),2*p.x*u.x*u.y*d.y+2*p.y*u.x*u.y*d.x+f.x*f.y*u.x*d.y+f.x*f.y*u.y*d.x-2*y.x*u.x*u.y*d.y-2*u.x*y.y*u.y*d.x-2*u.x*g.x*u.y*m.y-2*u.x*u.y*g.y*m.x-2*p.x*M*d.x-2*p.y*b*d.y+2*y.x*M*d.x+2*g.x*M*m.x-w*u.x*d.x-_*u.y*d.y+b*(2*y.y*d.y+2*g.y*m.y),2*p.x*u.x*u.y*m.y+2*p.y*u.x*u.y*m.x+f.x*f.y*u.x*m.y+f.x*f.y*u.y*m.x-2*y.x*u.x*u.y*m.y-2*u.x*y.y*u.y*m.x-2*u.x*g.x*u.y*g.y-2*p.x*M*m.x-2*p.y*b*m.y+2*y.x*M*m.x-w*u.x*m.x-_*u.y*m.y+T*M+b*(2*y.y*m.y+C),2*p.x*u.x*u.y*g.y+2*p.y*u.x*g.x*u.y+f.x*f.y*u.x*g.y+f.x*f.y*g.x*u.y-2*y.x*u.x*u.y*g.y-2*u.x*y.y*g.x*u.y-2*p.x*g.x*M-2*p.y*b*g.y+2*y.x*g.x*M-w*u.x*g.x-_*u.y*g.y+2*b*y.y*g.y,-2*p.x*p.y*u.x*u.y-p.x*f.x*f.y*u.y-p.y*f.x*f.y*u.x+2*p.x*u.x*y.y*u.y+2*p.y*y.x*u.x*u.y+f.x*y.x*f.y*u.y+f.x*f.y*u.x*y.y-2*y.x*u.x*y.y*u.y-2*p.x*y.x*M+p.x*w*u.x+p.y*_*u.y-2*p.y*b*y.y-y.x*w*u.x-_*y.y*u.y+x*M+A*b+S*M+b*P).getRootsInInterval(0,1),N=0;N<R.length;N++){var B=R[N],I=new Polynomial(u.x,f.x,p.x-y.x-B*g.x-B*B*m.x-B*B*B*d.x).getRoots(),F=new Polynomial(u.y,f.y,p.y-y.y-B*g.y-B*B*m.y-B*B*B*d.y).getRoots();if(0<I.length&&0<F.length)e:for(var V=0;V<I.length;V++){var U=I[V];if(0<=U&&U<=1)for(var k=0;k<F.length;k++)if(Math.abs(U-F[k])<1e-4){v.points.push(d.multiply(B*B*B).add(m.multiply(B*B).add(g.multiply(B).add(y))));break e}}}return 0<v.points.length&&(v.status="Intersection"),v},Ht.intersectBezier2Circle=function(e,t,i,r,a){return Ht.intersectBezier2Ellipse(e,t,i,r,a,a)},Ht.intersectBezier2Ellipse=function(e,t,i,r,a,n){var o,s,l,h,c,u=new Ht("No Intersection");o=t.multiply(-2),l=e.add(o.add(i)),o=e.multiply(-2),s=t.multiply(2),h=o.add(s),c=new pe(e.x,e.y);for(var f=a*a,p=n*n,d=new Polynomial(p*l.x*l.x+f*l.y*l.y,2*(p*l.x*h.x+f*l.y*h.y),p*(2*l.x*c.x+h.x*h.x)+f*(2*l.y*c.y+h.y*h.y)-2*(p*r.x*l.x+f*r.y*l.y),2*(p*h.x*(c.x-r.x)+f*h.y*(c.y-r.y)),p*(c.x*c.x+r.x*r.x)+f*(c.y*c.y+r.y*r.y)-2*(p*r.x*c.x+f*r.y*c.y)-f*p).getRoots(),m=0;m<d.length;m++){var g=d[m];0<=g&&g<=1&&u.points.push(l.multiply(g*g).add(h.multiply(g).add(c)))}return 0<u.points.length&&(u.status="Intersection"),u},Ht.intersectBezier2Line=function(e,t,i,r,a){var n,o,s,l,h,c,u,f=r.min(a),p=r.max(a),d=new Ht("No Intersection");n=t.multiply(-2),s=e.add(n.add(i)),n=e.multiply(-2),o=t.multiply(2),l=n.add(o),h=new pe(e.x,e.y),u=new Vector2D(r.y-a.y,a.x-r.x),c=r.x*a.y-a.x*r.y,roots=new Polynomial(u.dot(s),u.dot(l),u.dot(h)+c).getRoots();for(var m=0;m<roots.length;m++){var g=roots[m];if(0<=g&&g<=1){var y=e.lerp(t,g),v=t.lerp(i,g),x=y.lerp(v,g);r.x==a.x?f.y<=x.y&&x.y<=p.y&&(d.status="Intersection",d.appendPoint(x)):r.y==a.y?f.x<=x.x&&x.x<=p.x&&(d.status="Intersection",d.appendPoint(x)):x.gte(f)&&x.lte(p)&&(d.status="Intersection",d.appendPoint(x))}}return d},Ht.intersectBezier2Polygon=function(e,t,i,r){for(var a=new Ht("No Intersection"),n=r.length,o=0;o<n;o++){var s=r[o],l=r[(o+1)%n],h=Ht.intersectBezier2Line(e,t,i,s,l);a.appendPoints(h.points)}return 0<a.points.length&&(a.status="Intersection"),a},Ht.intersectBezier2Rectangle=function(e,t,i,r,a){var n=r.min(a),o=r.max(a),s=new pe(o.x,n.y),l=new pe(n.x,o.y),h=Ht.intersectBezier2Line(e,t,i,n,s),c=Ht.intersectBezier2Line(e,t,i,s,o),u=Ht.intersectBezier2Line(e,t,i,o,l),f=Ht.intersectBezier2Line(e,t,i,l,n),p=new Ht("No Intersection");return p.appendPoints(h.points),p.appendPoints(c.points),p.appendPoints(u.points),p.appendPoints(f.points),0<p.points.length&&(p.status="Intersection"),p},Ht.intersectBezier3Bezier3=function(e,t,i,r,a,n,o,s){var l,h,c,u,f,p,d,m,g,y,v,x,A=new Ht("No Intersection");l=e.multiply(-1),h=t.multiply(3),c=i.multiply(-3),u=l.add(h.add(c.add(r))),f=new Vector2D(u.x,u.y),l=e.multiply(3),h=t.multiply(-6),c=i.multiply(3),u=l.add(h.add(c)),p=new Vector2D(u.x,u.y),l=e.multiply(-3),h=t.multiply(3),c=l.add(h),d=new Vector2D(c.x,c.y),m=new Vector2D(e.x,e.y),l=a.multiply(-1),h=n.multiply(3),c=o.multiply(-3),u=l.add(h.add(c.add(s))),g=new Vector2D(u.x,u.y),l=a.multiply(3),h=n.multiply(-6),c=o.multiply(3),u=l.add(h.add(c)),y=new Vector2D(u.x,u.y),l=a.multiply(-3),h=n.multiply(3),c=l.add(h),v=new Vector2D(c.x,c.y),x=new Vector2D(a.x,a.y);for(var _=m.x*m.x,w=m.x*m.x*m.x,b=m.y*m.y,M=m.y*m.y*m.y,S=d.x*d.x,P=d.x*d.x*d.x,T=d.y*d.y,C=d.y*d.y*d.y,E=p.x*p.x,z=p.x*p.x*p.x,D=p.y*p.y,L=p.y*p.y*p.y,R=f.x*f.x,N=f.x*f.x*f.x,B=f.y*f.y,I=f.y*f.y*f.y,F=x.x*x.x,V=x.x*x.x*x.x,U=x.y*x.y,k=x.y*x.y*x.y,O=v.x*v.x,X=v.x*v.x*v.x,G=v.y*v.y,Y=y.x*y.x,W=y.x*y.x*y.x,j=y.y*y.y,H=g.x*g.x,q=g.x*g.x*g.x,Z=g.y*g.y,Q=g.y*g.y*g.y,K=new Polynomial(-N*Q+I*q-3*f.x*B*H*g.y+3*R*f.y*g.x*Z,-6*f.x*y.x*B*g.x*g.y+6*R*f.y*y.y*g.x*g.y+3*y.x*I*H-3*N*y.y*Z-3*f.x*B*y.y*H+3*R*y.x*f.y*Z,-6*v.x*f.x*B*g.x*g.y-6*f.x*y.x*B*y.y*g.x+6*R*y.x*f.y*y.y*g.y+3*v.x*I*H+3*Y*I*g.x+3*v.x*R*f.y*Z-3*f.x*v.y*B*H-3*f.x*Y*B*g.y+R*f.y*g.x*(6*v.y*g.y+3*j)+N*(-v.y*Z-2*j*g.y-g.y*(2*v.y*g.y+j)),d.x*p.y*f.x*f.y*g.x*g.y-d.y*p.x*f.x*f.y*g.x*g.y+6*v.x*y.x*I*g.x+3*d.x*p.x*f.x*f.y*Z+6*m.x*f.x*B*g.x*g.y-3*d.x*p.x*B*g.x*g.y-3*d.y*p.y*f.x*f.y*H-6*m.y*R*f.y*g.x*g.y-6*x.x*f.x*B*g.x*g.y+3*d.y*p.y*R*g.x*g.y-2*p.x*D*f.x*g.x*g.y-6*v.x*f.x*y.x*B*g.y-6*v.x*f.x*B*y.y*g.x-6*f.x*v.y*y.x*B*g.x+6*v.x*R*f.y*y.y*g.y+2*E*p.y*f.y*g.x*g.y+W*I-3*m.x*I*H+3*m.y*N*Z+3*x.x*I*H+L*f.x*H-z*f.y*Z-3*m.x*R*f.y*Z+3*m.y*f.x*B*H-2*d.x*p.y*R*Z+d.x*p.y*B*H-d.y*p.x*R*Z+2*d.y*p.x*B*H+3*x.x*R*f.y*Z-p.x*D*f.y*H-3*x.y*f.x*B*H+E*p.y*f.x*Z-3*f.x*Y*B*y.y+R*f.y*g.x*(6*x.y*g.y+6*v.y*y.y)+R*y.x*f.y*(6*v.y*g.y+3*j)+N*(-2*v.y*y.y*g.y-x.y*Z-y.y*(2*v.y*g.y+j)-g.y*(2*x.y*g.y+2*v.y*y.y)),6*d.x*p.x*f.x*f.y*y.y*g.y+d.x*p.y*f.x*y.x*f.y*g.y+d.x*p.y*f.x*f.y*y.y*g.x-d.y*p.x*f.x*y.x*f.y*g.y-d.y*p.x*f.x*f.y*y.y*g.x-6*d.y*p.y*f.x*y.x*f.y*g.x-6*m.x*y.x*I*g.x+6*x.x*y.x*I*g.x+6*m.y*N*y.y*g.y+2*L*f.x*y.x*g.x-2*z*f.y*y.y*g.y+6*m.x*f.x*y.x*B*g.y+6*m.x*f.x*B*y.y*g.x+6*m.y*f.x*y.x*B*g.x-3*d.x*p.x*y.x*B*g.y-3*d.x*p.x*B*y.y*g.x+2*d.x*p.y*y.x*B*g.x+4*d.y*p.x*y.x*B*g.x-6*m.x*R*f.y*y.y*g.y-6*m.y*R*y.x*f.y*g.y-6*m.y*R*f.y*y.y*g.x-4*d.x*p.y*R*y.y*g.y-6*x.x*f.x*y.x*B*g.y-6*x.x*f.x*B*y.y*g.x-2*d.y*p.x*R*y.y*g.y+3*d.y*p.y*R*y.x*g.y+3*d.y*p.y*R*y.y*g.x-2*p.x*D*f.x*y.x*g.y-2*p.x*D*f.x*y.y*g.x-2*p.x*D*y.x*f.y*g.x-6*x.y*f.x*y.x*B*g.x-6*v.x*f.x*v.y*B*g.x-6*v.x*f.x*y.x*B*y.y+6*x.x*R*f.y*y.y*g.y+2*E*p.y*f.x*y.y*g.y+2*E*p.y*y.x*f.y*g.y+2*E*p.y*f.y*y.y*g.x+3*v.x*Y*I+3*O*I*g.x-3*f.x*v.y*Y*B-3*O*f.x*B*g.y+R*y.x*f.y*(6*x.y*g.y+6*v.y*y.y)+R*f.y*g.x*(6*x.y*y.y+3*G)+v.x*R*f.y*(6*v.y*g.y+3*j)+N*(-2*x.y*y.y*g.y-g.y*(2*x.y*y.y+G)-v.y*(2*v.y*g.y+j)-y.y*(2*x.y*g.y+2*v.y*y.y)),d.x*v.x*p.y*f.x*f.y*g.y+d.x*p.y*f.x*v.y*f.y*g.x+d.x*p.y*f.x*y.x*f.y*y.y-d.y*p.x*v.x*f.x*f.y*g.y-d.y*p.x*f.x*v.y*f.y*g.x-d.y*p.x*f.x*y.x*f.y*y.y-6*d.y*v.x*p.y*f.x*f.y*g.x-6*m.x*v.x*I*g.x+6*x.x*v.x*I*g.x+2*v.x*L*f.x*g.x+6*m.x*v.x*f.x*B*g.y+6*m.x*f.x*v.y*B*g.x+6*m.x*f.x*y.x*B*y.y+6*m.y*v.x*f.x*B*g.x-3*d.x*p.x*v.x*B*g.y-3*d.x*p.x*v.y*B*g.x-3*d.x*p.x*y.x*B*y.y+2*d.x*v.x*p.y*B*g.x+4*d.y*p.x*v.x*B*g.x-6*m.y*v.x*R*f.y*g.y-6*m.y*R*v.y*f.y*g.x-6*m.y*R*y.x*f.y*y.y-6*x.x*v.x*f.x*B*g.y-6*x.x*f.x*v.y*B*g.x-6*x.x*f.x*y.x*B*y.y+3*d.y*v.x*p.y*R*g.y-3*d.y*p.y*f.x*Y*f.y+3*d.y*p.y*R*v.y*g.x+3*d.y*p.y*R*y.x*y.y-2*p.x*v.x*D*f.x*g.y-2*p.x*v.x*D*f.y*g.x-2*p.x*D*f.x*v.y*g.x-2*p.x*D*f.x*y.x*y.y-6*x.y*v.x*f.x*B*g.x-6*v.x*f.x*v.y*y.x*B+6*x.y*R*v.y*f.y*g.x+2*E*v.x*p.y*f.y*g.y+2*E*p.y*v.y*f.y*g.x+2*E*p.y*y.x*f.y*y.y-3*m.x*Y*I+3*x.x*Y*I+3*O*y.x*I+L*f.x*Y+3*m.y*f.x*Y*B+d.x*p.y*Y*B+2*d.y*p.x*Y*B-p.x*D*Y*f.y-3*x.y*f.x*Y*B-3*O*f.x*B*y.y+E*p.y*f.x*(2*v.y*g.y+j)+d.x*p.x*f.x*f.y*(6*v.y*g.y+3*j)+v.x*R*f.y*(6*x.y*g.y+6*v.y*y.y)+z*f.y*(-2*v.y*g.y-j)+m.y*N*(6*v.y*g.y+3*j)+d.y*p.x*R*(-2*v.y*g.y-j)+d.x*p.y*R*(-4*v.y*g.y-2*j)+m.x*R*f.y*(-6*v.y*g.y-3*j)+R*y.x*f.y*(6*x.y*y.y+3*G)+x.x*R*f.y*(6*v.y*g.y+3*j)+N*(-2*x.y*v.y*g.y-y.y*(2*x.y*y.y+G)-x.y*(2*v.y*g.y+j)-v.y*(2*x.y*g.y+2*v.y*y.y)),-m.x*d.x*p.y*f.x*f.y*g.y+m.x*d.y*p.x*f.x*f.y*g.y+6*m.x*d.y*p.y*f.x*f.y*g.x-6*m.y*d.x*p.x*f.x*f.y*g.y-m.y*d.x*p.y*f.x*f.y*g.x+m.y*d.y*p.x*f.x*f.y*g.x+d.x*d.y*p.x*p.y*f.x*g.y-d.x*d.y*p.x*p.y*f.y*g.x+d.x*x.x*p.y*f.x*f.y*g.y+d.x*x.y*p.y*f.x*f.y*g.x+d.x*v.x*p.y*f.x*f.y*y.y+d.x*p.y*f.x*v.y*y.x*f.y-x.x*d.y*p.x*f.x*f.y*g.y-6*x.x*d.y*p.y*f.x*f.y*g.x-d.y*p.x*x.y*f.x*f.y*g.x-d.y*p.x*v.x*f.x*f.y*y.y-d.y*p.x*f.x*v.y*y.x*f.y-6*d.y*v.x*p.y*f.x*y.x*f.y-6*m.x*x.x*I*g.x-6*m.x*v.x*y.x*I-2*m.x*L*f.x*g.x+6*x.x*v.x*y.x*I+2*x.x*L*f.x*g.x+2*v.x*L*f.x*y.x+2*m.y*z*f.y*g.y-6*m.x*m.y*f.x*B*g.x+3*m.x*d.x*p.x*B*g.y-2*m.x*d.x*p.y*B*g.x-4*m.x*d.y*p.x*B*g.x+3*m.y*d.x*p.x*B*g.x+6*m.x*m.y*R*f.y*g.y+6*m.x*x.x*f.x*B*g.y-3*m.x*d.y*p.y*R*g.y+2*m.x*p.x*D*f.x*g.y+2*m.x*p.x*D*f.y*g.x+6*m.x*x.y*f.x*B*g.x+6*m.x*v.x*f.x*B*y.y+6*m.x*f.x*v.y*y.x*B+4*m.y*d.x*p.y*R*g.y+6*m.y*x.x*f.x*B*g.x+2*m.y*d.y*p.x*R*g.y-3*m.y*d.y*p.y*R*g.x+2*m.y*p.x*D*f.x*g.x+6*m.y*v.x*f.x*y.x*B-3*d.x*x.x*p.x*B*g.y+2*d.x*x.x*p.y*B*g.x+d.x*d.y*D*f.x*g.x-3*d.x*p.x*x.y*B*g.x-3*d.x*p.x*v.x*B*y.y-3*d.x*p.x*v.y*y.x*B+2*d.x*v.x*p.y*y.x*B+4*x.x*d.y*p.x*B*g.x+4*d.y*p.x*v.x*y.x*B-2*m.x*E*p.y*f.y*g.y-6*m.y*x.x*R*f.y*g.y-6*m.y*x.y*R*f.y*g.x-6*m.y*v.x*R*f.y*y.y-2*m.y*E*p.y*f.x*g.y-2*m.y*E*p.y*f.y*g.x-6*m.y*R*v.y*y.x*f.y-d.x*d.y*E*f.y*g.y-2*d.x*T*f.x*f.y*g.x+3*x.x*d.y*p.y*R*g.y-2*x.x*p.x*D*f.x*g.y-2*x.x*p.x*D*f.y*g.x-6*x.x*x.y*f.x*B*g.x-6*x.x*v.x*f.x*B*y.y-6*x.x*f.x*v.y*y.x*B+3*d.y*x.y*p.y*R*g.x+3*d.y*v.x*p.y*R*y.y+3*d.y*p.y*R*v.y*y.x-2*p.x*x.y*D*f.x*g.x-2*p.x*v.x*D*f.x*y.y-2*p.x*v.x*D*y.x*f.y-2*p.x*D*f.x*v.y*y.x-6*x.y*v.x*f.x*y.x*B-T*p.x*p.y*f.x*g.x+2*x.x*E*p.y*f.y*g.y+6*x.y*R*v.y*y.x*f.y+2*S*d.y*f.x*f.y*g.y+S*p.x*p.y*f.y*g.y+2*E*x.y*p.y*f.y*g.x+2*E*v.x*p.y*f.y*y.y+2*E*p.y*v.y*y.x*f.y+X*I+3*_*I*g.x-3*b*N*g.y+3*F*I*g.x+C*R*g.x-P*B*g.y-d.x*T*R*g.y+S*d.y*B*g.x-3*_*f.x*B*g.y+3*b*R*f.y*g.x-S*D*f.x*g.y+T*E*f.y*g.x-3*O*f.x*v.y*B-3*F*f.x*B*g.y+3*U*R*f.y*g.x+d.x*p.x*f.x*f.y*(6*x.y*g.y+6*v.y*y.y)+z*f.y*(-2*x.y*g.y-2*v.y*y.y)+m.y*N*(6*x.y*g.y+6*v.y*y.y)+d.y*p.x*R*(-2*x.y*g.y-2*v.y*y.y)+E*p.y*f.x*(2*x.y*g.y+2*v.y*y.y)+d.x*p.y*R*(-4*x.y*g.y-4*v.y*y.y)+m.x*R*f.y*(-6*x.y*g.y-6*v.y*y.y)+x.x*R*f.y*(6*x.y*g.y+6*v.y*y.y)+v.x*R*f.y*(6*x.y*y.y+3*G)+N*(-2*x.y*v.y*y.y-U*g.y-v.y*(2*x.y*y.y+G)-x.y*(2*x.y*g.y+2*v.y*y.y)),-m.x*d.x*p.y*f.x*f.y*y.y+m.x*d.y*p.x*f.x*f.y*y.y+6*m.x*d.y*p.y*f.x*y.x*f.y-6*m.y*d.x*p.x*f.x*f.y*y.y-m.y*d.x*p.y*f.x*y.x*f.y+m.y*d.y*p.x*f.x*y.x*f.y+d.x*d.y*p.x*p.y*f.x*y.y-d.x*d.y*p.x*p.y*y.x*f.y+d.x*x.x*p.y*f.x*f.y*y.y+d.x*x.y*p.y*f.x*y.x*f.y+d.x*v.x*p.y*f.x*v.y*f.y-x.x*d.y*p.x*f.x*f.y*y.y-6*x.x*d.y*p.y*f.x*y.x*f.y-d.y*p.x*x.y*f.x*y.x*f.y-d.y*p.x*v.x*f.x*v.y*f.y-6*m.x*x.x*y.x*I-2*m.x*L*f.x*y.x+2*x.x*L*f.x*y.x+2*m.y*z*f.y*y.y-6*m.x*m.y*f.x*y.x*B+3*m.x*d.x*p.x*B*y.y-2*m.x*d.x*p.y*y.x*B-4*m.x*d.y*p.x*y.x*B+3*m.y*d.x*p.x*y.x*B+6*m.x*m.y*R*f.y*y.y+6*m.x*x.x*f.x*B*y.y-3*m.x*d.y*p.y*R*y.y+2*m.x*p.x*D*f.x*y.y+2*m.x*p.x*D*y.x*f.y+6*m.x*x.y*f.x*y.x*B+6*m.x*v.x*f.x*v.y*B+4*m.y*d.x*p.y*R*y.y+6*m.y*x.x*f.x*y.x*B+2*m.y*d.y*p.x*R*y.y-3*m.y*d.y*p.y*R*y.x+2*m.y*p.x*D*f.x*y.x-3*d.x*x.x*p.x*B*y.y+2*d.x*x.x*p.y*y.x*B+d.x*d.y*D*f.x*y.x-3*d.x*p.x*x.y*y.x*B-3*d.x*p.x*v.x*v.y*B+4*x.x*d.y*p.x*y.x*B-2*m.x*E*p.y*f.y*y.y-6*m.y*x.x*R*f.y*y.y-6*m.y*x.y*R*y.x*f.y-6*m.y*v.x*R*v.y*f.y-2*m.y*E*p.y*f.x*y.y-2*m.y*E*p.y*y.x*f.y-d.x*d.y*E*f.y*y.y-2*d.x*T*f.x*y.x*f.y+3*x.x*d.y*p.y*R*y.y-2*x.x*p.x*D*f.x*y.y-2*x.x*p.x*D*y.x*f.y-6*x.x*x.y*f.x*y.x*B-6*x.x*v.x*f.x*v.y*B+3*d.y*x.y*p.y*R*y.x+3*d.y*v.x*p.y*R*v.y-2*p.x*x.y*D*f.x*y.x-2*p.x*v.x*D*f.x*v.y-T*p.x*p.y*f.x*y.x+2*x.x*E*p.y*f.y*y.y-3*d.y*O*p.y*f.x*f.y+6*x.y*v.x*R*v.y*f.y+2*S*d.y*f.x*f.y*y.y+S*p.x*p.y*f.y*y.y+2*E*x.y*p.y*y.x*f.y+2*E*v.x*p.y*v.y*f.y-3*m.x*O*I+3*x.x*O*I+3*_*y.x*I-3*b*N*y.y+3*F*y.x*I+O*L*f.x+C*R*y.x-P*B*y.y+3*m.y*O*f.x*B-d.x*T*R*y.y+d.x*O*p.y*B+2*d.y*p.x*O*B+S*d.y*y.x*B-p.x*O*D*f.y-3*x.y*O*f.x*B-3*_*f.x*B*y.y+3*b*R*y.x*f.y-S*D*f.x*y.y+T*E*y.x*f.y-3*F*f.x*B*y.y+3*U*R*y.x*f.y+E*p.y*f.x*(2*x.y*y.y+G)+d.x*p.x*f.x*f.y*(6*x.y*y.y+3*G)+z*f.y*(-2*x.y*y.y-G)+m.y*N*(6*x.y*y.y+3*G)+d.y*p.x*R*(-2*x.y*y.y-G)+d.x*p.y*R*(-4*x.y*y.y-2*G)+m.x*R*f.y*(-6*x.y*y.y-3*G)+x.x*R*f.y*(6*x.y*y.y+3*G)+N*(-2*x.y*G-U*y.y-x.y*(2*x.y*y.y+G)),-m.x*d.x*p.y*f.x*v.y*f.y+m.x*d.y*p.x*f.x*v.y*f.y+6*m.x*d.y*v.x*p.y*f.x*f.y-6*m.y*d.x*p.x*f.x*v.y*f.y-m.y*d.x*v.x*p.y*f.x*f.y+m.y*d.y*p.x*v.x*f.x*f.y-d.x*d.y*p.x*v.x*p.y*f.y+d.x*d.y*p.x*p.y*f.x*v.y+d.x*x.x*p.y*f.x*v.y*f.y+6*d.x*p.x*x.y*f.x*v.y*f.y+d.x*x.y*v.x*p.y*f.x*f.y-x.x*d.y*p.x*f.x*v.y*f.y-6*x.x*d.y*v.x*p.y*f.x*f.y-d.y*p.x*x.y*v.x*f.x*f.y-6*m.x*x.x*v.x*I-2*m.x*v.x*L*f.x+6*m.y*x.y*N*v.y+2*x.x*v.x*L*f.x+2*m.y*z*v.y*f.y-2*z*x.y*v.y*f.y-6*m.x*m.y*v.x*f.x*B+3*m.x*d.x*p.x*v.y*B-2*m.x*d.x*v.x*p.y*B-4*m.x*d.y*p.x*v.x*B+3*m.y*d.x*p.x*v.x*B+6*m.x*m.y*R*v.y*f.y+6*m.x*x.x*f.x*v.y*B-3*m.x*d.y*p.y*R*v.y+2*m.x*p.x*v.x*D*f.y+2*m.x*p.x*D*f.x*v.y+6*m.x*x.y*v.x*f.x*B+4*m.y*d.x*p.y*R*v.y+6*m.y*x.x*v.x*f.x*B+2*m.y*d.y*p.x*R*v.y-3*m.y*d.y*v.x*p.y*R+2*m.y*p.x*v.x*D*f.x-3*d.x*x.x*p.x*v.y*B+2*d.x*x.x*v.x*p.y*B+d.x*d.y*v.x*D*f.x-3*d.x*p.x*x.y*v.x*B+4*x.x*d.y*p.x*v.x*B-6*m.x*x.y*R*v.y*f.y-2*m.x*E*p.y*v.y*f.y-6*m.y*x.x*R*v.y*f.y-6*m.y*x.y*v.x*R*f.y-2*m.y*E*v.x*p.y*f.y-2*m.y*E*p.y*f.x*v.y-d.x*d.y*E*v.y*f.y-4*d.x*x.y*p.y*R*v.y-2*d.x*T*v.x*f.x*f.y+3*x.x*d.y*p.y*R*v.y-2*x.x*p.x*v.x*D*f.y-2*x.x*p.x*D*f.x*v.y-6*x.x*x.y*v.x*f.x*B-2*d.y*p.x*x.y*R*v.y+3*d.y*x.y*v.x*p.y*R-2*p.x*x.y*v.x*D*f.x-T*p.x*v.x*p.y*f.x+6*x.x*x.y*R*v.y*f.y+2*x.x*E*p.y*v.y*f.y+2*S*d.y*f.x*v.y*f.y+S*p.x*p.y*v.y*f.y+2*E*x.y*v.x*p.y*f.y+2*E*x.y*p.y*f.x*v.y+3*_*v.x*I-3*b*N*v.y+3*F*v.x*I+C*v.x*R-P*v.y*B-3*U*N*v.y-d.x*T*R*v.y+S*d.y*v.x*B-3*_*f.x*v.y*B+3*b*v.x*R*f.y-S*D*f.x*v.y+T*E*v.x*f.y-3*F*f.x*v.y*B+3*U*v.x*R*f.y,m.x*m.y*d.x*p.y*f.x*f.y-m.x*m.y*d.y*p.x*f.x*f.y+m.x*d.x*d.y*p.x*p.y*f.y-m.y*d.x*d.y*p.x*p.y*f.x-m.x*d.x*x.y*p.y*f.x*f.y+6*m.x*x.x*d.y*p.y*f.x*f.y+m.x*d.y*p.x*x.y*f.x*f.y-m.y*d.x*x.x*p.y*f.x*f.y-6*m.y*d.x*p.x*x.y*f.x*f.y+m.y*x.x*d.y*p.x*f.x*f.y-d.x*x.x*d.y*p.x*p.y*f.y+d.x*d.y*p.x*x.y*p.y*f.x+d.x*x.x*x.y*p.y*f.x*f.y-x.x*d.y*p.x*x.y*f.x*f.y-2*m.x*x.x*L*f.x+2*m.y*z*x.y*f.y-3*m.x*m.y*d.x*p.x*B-6*m.x*m.y*x.x*f.x*B+3*m.x*m.y*d.y*p.y*R-2*m.x*m.y*p.x*D*f.x-2*m.x*d.x*x.x*p.y*B-m.x*d.x*d.y*D*f.x+3*m.x*d.x*p.x*x.y*B-4*m.x*x.x*d.y*p.x*B+3*m.y*d.x*x.x*p.x*B+6*m.x*m.y*x.y*R*f.y+2*m.x*m.y*E*p.y*f.y+2*m.x*d.x*T*f.x*f.y+2*m.x*x.x*p.x*D*f.y+6*m.x*x.x*x.y*f.x*B-3*m.x*d.y*x.y*p.y*R+2*m.x*p.x*x.y*D*f.x+m.x*T*p.x*p.y*f.x+m.y*d.x*d.y*E*f.y+4*m.y*d.x*x.y*p.y*R-3*m.y*x.x*d.y*p.y*R+2*m.y*x.x*p.x*D*f.x+2*m.y*d.y*p.x*x.y*R+d.x*x.x*d.y*D*f.x-3*d.x*x.x*p.x*x.y*B-2*m.x*E*x.y*p.y*f.y-6*m.y*x.x*x.y*R*f.y-2*m.y*x.x*E*p.y*f.y-2*m.y*S*d.y*f.x*f.y-m.y*S*p.x*p.y*f.y-2*m.y*E*x.y*p.y*f.x-2*d.x*x.x*T*f.x*f.y-d.x*d.y*E*x.y*f.y+3*x.x*d.y*x.y*p.y*R-2*x.x*p.x*x.y*D*f.x-x.x*T*p.x*p.y*f.x+3*b*d.x*p.x*f.x*f.y+3*d.x*p.x*U*f.x*f.y+2*x.x*E*x.y*p.y*f.y-3*_*d.y*p.y*f.x*f.y+2*S*d.y*x.y*f.x*f.y+S*p.x*x.y*p.y*f.y-3*F*d.y*p.y*f.x*f.y-w*I+M*N+V*I-k*N-3*m.x*F*I-m.x*C*R+3*_*x.x*I+m.y*P*B+3*m.y*U*N+x.x*C*R+_*L*f.x-3*b*x.y*N-b*z*f.y+F*L*f.x-P*x.y*B-z*U*f.y-m.x*S*d.y*B+m.y*d.x*T*R-3*m.x*b*R*f.y-m.x*T*E*f.y+m.y*S*D*f.x-d.x*T*x.y*R+3*_*m.y*f.x*B+_*d.x*p.y*B+2*_*d.y*p.x*B-2*b*d.x*p.y*R-b*d.y*p.x*R+S*x.x*d.y*B-3*m.x*U*R*f.y+3*m.y*F*f.x*B+d.x*F*p.y*B-2*d.x*U*p.y*R+x.x*T*E*f.y-d.y*p.x*U*R-_*p.x*D*f.y-3*_*x.y*f.x*B+3*b*x.x*R*f.y+b*E*p.y*f.x-S*x.y*D*f.x+2*F*d.y*p.x*B+3*x.x*U*R*f.y-F*p.x*D*f.y-3*F*x.y*f.x*B+E*U*p.y*f.x).getRootsInInterval(0,1),J=0;J<K.length;J++){var $=K[J],ee=new Polynomial(f.x,p.x,d.x,m.x-x.x-$*v.x-$*$*y.x-$*$*$*g.x).getRoots(),te=new Polynomial(f.y,p.y,d.y,m.y-x.y-$*v.y-$*$*y.y-$*$*$*g.y).getRoots();if(0<ee.length&&0<te.length)e:for(var ie=0;ie<ee.length;ie++){var re=ee[ie];if(0<=re&&re<=1)for(var ae=0;ae<te.length;ae++)if(Math.abs(re-te[ae])<1e-4){A.points.push(g.multiply($*$*$).add(y.multiply($*$).add(v.multiply($).add(x))));break e}}}return 0<A.points.length&&(A.status="Intersection"),A},Ht.intersectBezier3Circle=function(e,t,i,r,a,n){return Ht.intersectBezier3Ellipse(e,t,i,r,a,n,n)},Ht.intersectBezier3Ellipse=function(e,t,i,r,a,n,o){var s,l,h,c,u,f,p,d,m=new Ht("No Intersection");s=e.multiply(-1),l=t.multiply(3),h=i.multiply(-3),c=s.add(l.add(h.add(r))),u=new Vector2D(c.x,c.y),s=e.multiply(3),l=t.multiply(-6),h=i.multiply(3),c=s.add(l.add(h)),f=new Vector2D(c.x,c.y),s=e.multiply(-3),l=t.multiply(3),h=s.add(l),p=new Vector2D(h.x,h.y),d=new Vector2D(e.x,e.y);for(var g=n*n,y=o*o,v=new Polynomial(u.x*u.x*y+u.y*u.y*g,2*(u.x*f.x*y+u.y*f.y*g),2*(u.x*p.x*y+u.y*p.y*g)+f.x*f.x*y+f.y*f.y*g,2*u.x*y*(d.x-a.x)+2*u.y*g*(d.y-a.y)+2*(f.x*p.x*y+f.y*p.y*g),2*f.x*y*(d.x-a.x)+2*f.y*g*(d.y-a.y)+p.x*p.x*y+p.y*p.y*g,2*p.x*y*(d.x-a.x)+2*p.y*g*(d.y-a.y),d.x*d.x*y-2*d.y*a.y*g-2*d.x*a.x*y+d.y*d.y*g+a.x*a.x*y+a.y*a.y*g-g*y).getRootsInInterval(0,1),x=0;x<v.length;x++){var A=v[x];m.points.push(u.multiply(A*A*A).add(f.multiply(A*A).add(p.multiply(A).add(d))))}return 0<m.points.length&&(m.status="Intersection"),m},Ht.intersectBezier3Line=function(e,t,i,r,a,n){var o,s,l,h,c,u,f,p,d,m,g=a.min(n),y=a.max(n),v=new Ht("No Intersection");o=e.multiply(-1),s=t.multiply(3),l=i.multiply(-3),h=o.add(s.add(l.add(r))),c=new Vector2D(h.x,h.y),o=e.multiply(3),s=t.multiply(-6),l=i.multiply(3),h=o.add(s.add(l)),u=new Vector2D(h.x,h.y),o=e.multiply(-3),s=t.multiply(3),l=o.add(s),f=new Vector2D(l.x,l.y),p=new Vector2D(e.x,e.y),m=new Vector2D(a.y-n.y,n.x-a.x),d=a.x*n.y-n.x*a.y,roots=new Polynomial(m.dot(c),m.dot(u),m.dot(f),m.dot(p)+d).getRoots();for(var x=0;x<roots.length;x++){var A=roots[x];if(0<=A&&A<=1){var _=e.lerp(t,A),w=t.lerp(i,A),b=i.lerp(r,A),M=_.lerp(w,A),S=w.lerp(b,A),P=M.lerp(S,A);a.x==n.x?g.y<=P.y&&P.y<=y.y&&(v.status="Intersection",v.appendPoint(P)):a.y==n.y?g.x<=P.x&&P.x<=y.x&&(v.status="Intersection",v.appendPoint(P)):P.gte(g)&&P.lte(y)&&(v.status="Intersection",v.appendPoint(P))}}return v},Ht.intersectBezier3Polygon=function(e,t,i,r,a){for(var n=new Ht("No Intersection"),o=a.length,s=0;s<o;s++){var l=a[s],h=a[(s+1)%o],c=Ht.intersectBezier3Line(e,t,i,r,l,h);n.appendPoints(c.points)}return 0<n.points.length&&(n.status="Intersection"),n},Ht.intersectBezier3Rectangle=function(e,t,i,r,a,n){var o=a.min(n),s=a.max(n),l=new pe(s.x,o.y),h=new pe(o.x,s.y),c=Ht.intersectBezier3Line(e,t,i,r,o,l),u=Ht.intersectBezier3Line(e,t,i,r,l,s),f=Ht.intersectBezier3Line(e,t,i,r,s,h),p=Ht.intersectBezier3Line(e,t,i,r,h,o),d=new Ht("No Intersection");return d.appendPoints(c.points),d.appendPoints(u.points),d.appendPoints(f.points),d.appendPoints(p.points),0<d.points.length&&(d.status="Intersection"),d},Ht.intersectCircleCircle=function(e,t,i,r){var a,n=t+r,o=Math.abs(t-r),s=e.distanceFrom(i);if(n<s)a=new Ht("Outside");else if(s<o)a=new Ht("Inside");else{a=new Ht("Intersection");var l=(t*t-r*r+s*s)/(2*s),h=Math.sqrt(t*t-l*l),c=e.lerp(i,l/s),u=h/s;a.points.push(new pe(c.x-u*(i.y-e.y),c.y+u*(i.x-e.x))),a.points.push(new pe(c.x+u*(i.y-e.y),c.y-u*(i.x-e.x)))}return a},Ht.intersectCircleEllipse=function(e,t,i,r,a){return Ht.intersectEllipseEllipse(e,t,t,i,r,a)},Ht.intersectCircleLine=function(e,t,i,r){var a,n=(r.x-i.x)*(r.x-i.x)+(r.y-i.y)*(r.y-i.y),o=2*((r.x-i.x)*(i.x-e.x)+(r.y-i.y)*(i.y-e.y)),s=o*o-4*n*(e.x*e.x+e.y*e.y+i.x*i.x+i.y*i.y-2*(e.x*i.x+e.y*i.y)-t*t);if(s<0)a=new Ht("Outside");else if(0==s)a=new Ht("Tangent");else{var l=Math.sqrt(s),h=(-o+l)/(2*n),c=(-o-l)/(2*n);(h<0||1<h)&&(c<0||1<c)?a=new Ht(h<0&&c<0||1<h&&1<c?"Outside":"Inside"):(a=new Ht("Intersection"),0<=h&&h<=1&&a.points.push(i.lerp(r,h)),0<=c&&c<=1&&a.points.push(i.lerp(r,c)))}return a},Ht.intersectCirclePolygon=function(e,t,i){for(var r,a=new Ht("No Intersection"),n=i.length,o=0;o<n;o++){var s=i[o],l=i[(o+1)%n];r=Ht.intersectCircleLine(e,t,s,l),a.appendPoints(r.points)}return 0<a.points.length?a.status="Intersection":a.status=r.status,a},Ht.intersectCircleRectangle=function(e,t,i,r){var a=i.min(r),n=i.max(r),o=new pe(n.x,a.y),s=new pe(a.x,n.y),l=Ht.intersectCircleLine(e,t,a,o),h=Ht.intersectCircleLine(e,t,o,n),c=Ht.intersectCircleLine(e,t,n,s),u=Ht.intersectCircleLine(e,t,s,a),f=new Ht("No Intersection");return f.appendPoints(l.points),f.appendPoints(h.points),f.appendPoints(c.points),f.appendPoints(u.points),0<f.points.length?f.status="Intersection":f.status=l.status,f},Ht.intersectEllipseEllipse=function(e,t,i,r,a,n){for(var o=[i*i,0,t*t,-2*i*i*e.x,-2*t*t*e.y,i*i*e.x*e.x+t*t*e.y*e.y-t*t*i*i],s=[n*n,0,a*a,-2*n*n*r.x,-2*a*a*r.y,n*n*r.x*r.x+a*a*r.y*r.y-a*a*n*n],l=Ht.bezout(o,s).getRoots(),h=.001*(o[0]*o[0]+2*o[1]*o[1]+o[2]*o[2]),c=.001*(s[0]*s[0]+2*s[1]*s[1]+s[2]*s[2]),u=new Ht("No Intersection"),f=0;f<l.length;f++)for(var p=new Polynomial(o[0],o[3]+l[f]*o[1],o[5]+l[f]*(o[4]+l[f]*o[2])).getRoots(),d=0;d<p.length;d++){var m=(o[0]*p[d]+o[1]*l[f]+o[3])*p[d]+(o[2]*l[f]+o[4])*l[f]+o[5];Math.abs(m)<h&&(m=(s[0]*p[d]+s[1]*l[f]+s[3])*p[d]+(s[2]*l[f]+s[4])*l[f]+s[5],Math.abs(m)<c&&u.appendPoint(new pe(p[d],l[f])))}return 0<u.points.length&&(u.status="Intersection"),u},Ht.intersectEllipseLine=function(e,t,i,r,a){var n,o=new Vector2D(r.x,r.y),s=Vector2D.fromPoints(r,a),l=new Vector2D(e.x,e.y),h=o.subtract(l),c=new Vector2D(s.x/(t*t),s.y/(i*i)),u=new Vector2D(h.x/(t*t),h.y/(i*i)),f=s.dot(c),p=s.dot(u),d=p*p-f*(e=h.dot(u)-1);if(d<0)n=new Ht("Outside");else if(0<d){var m=Math.sqrt(d),g=(-p-m)/f,y=(-p+m)/f;(g<0||1<g)&&(y<0||1<y)?n=new Ht(g<0&&y<0||1<g&&1<y?"Outside":"Inside"):(n=new Ht("Intersection"),0<=g&&g<=1&&n.appendPoint(r.lerp(a,g)),0<=y&&y<=1&&n.appendPoint(r.lerp(a,y)))}else{var v=-p/f;0<=v&&v<=1?(n=new Ht("Intersection")).appendPoint(r.lerp(a,v)):n=new Ht("Outside")}return n},Ht.intersectEllipsePolygon=function(e,t,i,r){for(var a=new Ht("No Intersection"),n=r.length,o=0;o<n;o++){var s=r[o],l=r[(o+1)%n],h=Ht.intersectEllipseLine(e,t,i,s,l);a.appendPoints(h.points)}return 0<a.points.length&&(a.status="Intersection"),a},Ht.intersectEllipseRectangle=function(e,t,i,r,a){var n=r.min(a),o=r.max(a),s=new pe(o.x,n.y),l=new pe(n.x,o.y),h=Ht.intersectEllipseLine(e,t,i,n,s),c=Ht.intersectEllipseLine(e,t,i,s,o),u=Ht.intersectEllipseLine(e,t,i,o,l),f=Ht.intersectEllipseLine(e,t,i,l,n),p=new Ht("No Intersection");return p.appendPoints(h.points),p.appendPoints(c.points),p.appendPoints(u.points),p.appendPoints(f.points),0<p.points.length&&(p.status="Intersection"),p},Ht.intersectLineLine=function(e,t,i,r){var a,n=(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x),o=(t.x-e.x)*(e.y-i.y)-(t.y-e.y)*(e.x-i.x),s=(r.y-i.y)*(t.x-e.x)-(r.x-i.x)*(t.y-e.y);if(0!=s){var l=n/s,h=o/s;0<=l&&l<=1&&0<=h&&h<=1?(a=new Ht("Intersection")).points.push(new pe(e.x+l*(t.x-e.x),e.y+l*(t.y-e.y))):a=new Ht("No Intersection")}else a=new Ht(0==n||0==o?"Coincident":"Parallel");return a},Ht.intersectLinePolygon=function(e,t,i){for(var r=new Ht("No Intersection"),a=i.length,n=0;n<a;n++){var o=i[n],s=i[(n+1)%a],l=Ht.intersectLineLine(e,t,o,s);r.appendPoints(l.points)}return 0<r.points.length&&(r.status="Intersection"),r},Ht.intersectLineRectangle=function(e,t,i,r){var a=i.min(r),n=i.max(r),o=new pe(n.x,a.y),s=new pe(a.x,n.y),l=Ht.intersectLineLine(a,o,e,t),h=Ht.intersectLineLine(o,n,e,t),c=Ht.intersectLineLine(n,s,e,t),u=Ht.intersectLineLine(s,a,e,t),f=new Ht("No Intersection");return f.appendPoints(l.points),f.appendPoints(h.points),f.appendPoints(c.points),f.appendPoints(u.points),0<f.points.length&&(f.status="Intersection"),f},Ht.intersectPolygonPolygon=function(e,t){for(var i=new Ht("No Intersection"),r=e.length,a=0;a<r;a++){var n=e[a],o=e[(a+1)%r],s=Ht.intersectLinePolygon(n,o,t);i.appendPoints(s.points)}return 0<i.points.length&&(i.status="Intersection"),i},Ht.intersectPolygonRectangle=function(e,t,i){var r=t.min(i),a=t.max(i),n=new pe(a.x,r.y),o=new pe(r.x,a.y),s=Ht.intersectLinePolygon(r,n,e),l=Ht.intersectLinePolygon(n,a,e),h=Ht.intersectLinePolygon(a,o,e),c=Ht.intersectLinePolygon(o,r,e),u=new Ht("No Intersection");return u.appendPoints(s.points),u.appendPoints(l.points),u.appendPoints(h.points),u.appendPoints(c.points),0<u.points.length&&(u.status="Intersection"),u},Ht.intersectRayRay=function(e,t,i,r){var a,n=(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x),o=(t.x-e.x)*(e.y-i.y)-(t.y-e.y)*(e.x-i.x),s=(r.y-i.y)*(t.x-e.x)-(r.x-i.x)*(t.y-e.y);if(0!=s){var l=n/s;(a=new Ht("Intersection")).points.push(new pe(e.x+l*(t.x-e.x),e.y+l*(t.y-e.y)))}else a=new Ht(0==n||0==o?"Coincident":"Parallel");return a},Ht.intersectRectangleRectangle=function(e,t,i,r){var a=e.min(t),n=e.max(t),o=new pe(n.x,a.y),s=new pe(a.x,n.y),l=Ht.intersectLineRectangle(a,o,i,r),h=Ht.intersectLineRectangle(o,n,i,r),c=Ht.intersectLineRectangle(n,s,i,r),u=Ht.intersectLineRectangle(s,a,i,r),f=new Ht("No Intersection");return f.appendPoints(l.points),f.appendPoints(h.points),f.appendPoints(c.points),f.appendPoints(u.points),0<f.points.length&&(f.status="Intersection"),f},Ht.bezout=function(e,t){var i=e[0]*t[1]-t[0]*e[1],r=e[0]*t[2]-t[0]*e[2],a=e[0]*t[3]-t[0]*e[3],n=e[0]*t[4]-t[0]*e[4],o=e[0]*t[5]-t[0]*e[5],s=e[1]*t[2]-t[1]*e[2],l=e[1]*t[4]-t[1]*e[4],h=e[1]*t[5]-t[1]*e[5],c=e[2]*t[3]-t[2]*e[3],u=e[3]*t[4]-t[3]*e[4],f=e[3]*t[5]-t[3]*e[5],p=h+u,d=l-c;return new Polynomial(i*s-r*r,i*d+a*s-2*r*n,i*p+a*d-n*n-2*r*o,i*f+a*p-2*n*o,a*f-o*o)},Se.Intersection=Ht,Se.AreaPicking=function(e,t){this.network=e,this.bounding=t,this.cache={}},Se.extend(Se.AreaPicking,Object,{intersectObjects:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];this.intersectObject(r,t)}return t},getViewPoint:function(e,t){var i=t.vertices[e].clone(),r=this.cache[t.getId()][i.x+" "+i.y+" "+i.z];return r||(i.applyMatrix4(t.worldMatrix),(r=this.network.getViewPosition(i)).y=r.h-r.y,r)},intersectObject:function(e,t){if(e instanceof Se.Entity){this.cache[e.getId()]={};for(var i=0;i<e.vertices.length;i++){var r=e.vertices[i].clone();r.applyMatrix4(e.worldMatrix);var a=this.network.getViewPosition(r);if(a.y=a.h-a.y,(this.cache[e.getId()][r.x+" "+r.y+" "+r.z]=a).x>this.bounding.x&&a.y>this.bounding.y&&a.x<this.bounding.x+this.bounding.w&&a.y<this.bounding.y+this.bounding.h){var n={element:e};return void t.push(n)}}}}}),Se.BaseInteraction=function(e){this.network=e,this.view=e.getView()||document},Se.addEventListener=function(e,t,i,r){var a="_"+e+"_";if(!r[a]){var n=function(e){r[t](e)};r[a]=n,i.addEventListener(e,n,!1)}},Se.removeEventListener=function(e,t,i){var r="_"+e+"_",a=i[r];a&&(t.removeEventListener(e,a,!1),delete i[r])},Se.extend(Se.BaseInteraction,Object,{onPropertyChange:function(){},firePropertyChange:function(){},setUp:function(){},tearDown:function(){},update:function(){},addListener:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];Se.addEventListener(t,"handle_"+t,this.network.getRootView(),this)}},removeListener:function(){for(var e=0;e<arguments.length;e++)arguments[e],Se.removeEventListener(arguments[e],this.network.getRootView(),this)},isCtrlDown:function(e){return e.ctrlKey||e.metaKey},isFinished:function(){return!0}}),Se.DefaultInteraction=function(e){Se.BaseInteraction.call(this,e),this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=this.screen.width/4,this.domElement=this.network.getRootView(),this.rotateSpeed=1,this.zoomSpeed=10,this.panSpeed=3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.easing=!0,this.dynamicDampingFactor=.05,this.timeInterval=2e3,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.lastPosition=new Se.Vec3;var l,h,r=this.STATE.NONE,c=(this.STATE.NONE,new Se.Vec3),u=new Se.Vec3,f=new Se.Vec3,i=new Se.Vec2,a=new Se.Vec2,n=0,o=0,s=new Se.Vec2,p=new Se.Vec2;this.object=this.network._camera,this.object.target||(this.object.target=new Se.Vec3),this.movementSpeed=1,this.lookSpeed=.005,this.verticalLookRatio=.1,this.keyboardEnable=!0,this.lookVertical=!0,this.autoForward=!1,this.fpsMode=!1,this.dragMode=!0,this.activeLook=!1,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalFixed=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.freeze=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.lastX=0,this.lastY=0,this.touchSeq=[1,2,3],this.fpsMinDistance=100,this.network.getRootView().addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.yRistrict=!0,this.yLowerLimitAngle=-Math.PI/2,this.yUpLimitAngle=Math.PI/2,this.updateIntervalTime=0;var d=null;this.handleResize=function(){this.screen.width=q.innerWidth,this.screen.height=q.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleResize(),this.handle_mousedown=function(e){if(!re.isCtrlDown(e)){if(e.preventDefault(),this.fpsMode){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.lastX=e.pageX,this.lastY=e.pageY,this.mouseDragOn=!0}else r===this.STATE.NONE&&(r=e.button),r!==this.STATE.ROTATE||this.noRotate?this.state!==this.STATE.ZOOM||this.noZoom?r!==this.STATE.PAN||this.noPan||(s=p=this.getMouseOnScreen(e.clientX,e.clientY)):i=a=this.getMouseOnScreen(e.clientX,e.clientY):(u=f=this.getMouseProjectionOnBall(e.clientX,e.clientY),l=h=this.getRotateY(e.clientX,e.clientY));this.beforeUpdate(),this.addListener("mousemove","mouseup")}},this.handle_mousemove=function(e){if(!e.stop){e.preventDefault(),this.fpsMode?this.dragMode?this.mouseDragOn?(this.mouseX=300*(e.pageX-this.lastX),this.mouseY=300*(e.pageY-this.lastY),this.lastX=e.pageX,this.lastY=e.pageY):(this.mouseX=0,this.mouseY=0):this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY):r!==this.STATE.ROTATE||this.noRotate?r!==this.STATE.ZOOM||this.noZoom?r!==this.STATE.PAN||this.noPan||(p=this.getMouseOnScreen(e.clientX,e.clientY)):a=this.getMouseOnScreen(e.clientX,e.clientY):(f=this.getMouseProjectionOnBall(e.clientX,e.clientY),h=this.getRotateY(e.clientX,e.clientY));var t=(new Date).getTime();if(null==this._lt)this.update();else{if(t-this._lt<this.updateIntervalTime)return;this.update()}this._lt=t}},this.handle_mouseup=function(e){if(e.preventDefault(),this.fpsMode){if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.lastX=0,this.lastY=0,this.dragMode&&(this.mouseX=0,this.mouseY=0),this.mouseDragOn=!1}else r=this.STATE.NONE;this.removeListener("mousemove","mouseup"),this.update(),this.afterHandleMouseup()},this.afterHandleMouseup=function(){},this.handle_touchstart=function(e){if(!1!==this.enabled){switch(e.touches.length){case this.touchSeq[0]:r=this.STATE.TOUCH_ROTATE,u=this.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY),l=h=this.getRotateY(e.touches[0].pageX,e.touches[0].pageY),f.copy(u);break;case this.touchSeq[1]:r=this.STATE.TOUCH_ZOOM;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;o=n=Math.sqrt(t*t+i*i);break;case this.touchSeq[2]:r=this.STATE.TOUCH_PAN,s.copy(this.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY)),p.copy(s);break;default:r=this.STATE.NONE}this.update()}},this.handle_touchmove=function(e){if(!1!==this.enabled){switch(e.preventDefault(),e.touches.length){case this.touchSeq[0]:f=this.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY,f),h=this.getRotateY(e.touches[0].pageX,e.touches[0].pageY);break;case this.touchSeq[1]:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;o=Math.sqrt(t*t+i*i);break;case this.touchSeq[2]:p=this.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY,p);break;default:r=this.STATE.NONE}this.update()}},this.handle_touchend=function(e){if(!1!==this.enabled){switch(e.touches.length){case this.touchSeq[0]:u.copy(this.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY,f));break;case this.touchSeq[1]:n=o=0;break;case this.touchSeq[2]:p.copy(this.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY)),s.copy(p)}r=this.STATE.NONE,this.update()}},this.handle_DOMMouseScroll=function(e){this.handle_mousewheel(e)},this.handle_mousewheel=function(e){e.preventDefault();var t=0;e.wheelDelta?t=e.wheelDelta%120==0?e.wheelDelta/40:100<=Math.abs(e.wheelDelta)?e.wheelDelta/40:e.wheelDelta:e.detail&&(t=-e.detail/3),t&&(i.y+=1/t*.01),this.mouseMoving=!0,this.update()},this.handle_dblclick=function(e){if(this.isCtrlDown(e)){var t=this.network.getElementsByMouseEvent(e);0<t.length&&(d=t[0]),this.update()}},this.getMouseOnScreen=function(e,t){return new Se.Vec2((e-this.screen.offsetLeft)/this.radius*.5,(t-this.screen.offsetTop)/this.radius*.5)},this.getRotateY=function(e,t){if(this.yRistrict)return(.5*this.screen.height+this.screen.offsetTop-t)/this.screen.height*2},this.handle_keydown=function(e){if(this.keyboardEnable){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}this.update()}},this.handle_keyup=function(e){if(this.keyboardEnable){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}this.update()}},this.getMouseProjectionOnBall=function(e,t){if(this.yRistrict)return 1<(r=(i=new Se.Vec3((e-.5*this.screen.width-this.screen.offsetLeft)/(.5*this.screen.width),0,0)).length())?i.normalize():i.z=Math.sqrt(1-r*r),i.normalize();var i=new Se.Vec3((e-.5*this.screen.width-this.screen.offsetLeft)/this.radius,(.5*this.screen.height+this.screen.offsetTop-t)/this.radius,0),r=i.length();1<r?i.normalize():i.z=Math.sqrt(1-r*r),c.copy(this.object._position).sub(this.object.target);var a=this.object.up.clone().setLength(i.y);return a.add(this.object.up.clone().cross(c).setLength(i.x)),a.add(c.setLength(i.z)),a},this.rotateSpeedFunction=function(){return this.rotateSpeed},this.rotateCamera=function(){var e=u.dot(f)/u.length()/f.length(),t=Math.acos(e),i=!this.easing||Math.abs(t)<1e-4,r=!1,a=this.rotateSpeedFunction();if(t){var n=(new Se.Vec3).crossVectors(u,f).normalize(),o=new Se.Quat;o.setFromAxisAngle(n,-t*this.dynamicDampingFactor*a),i?(o.setFromAxisAngle(n,-t*a),c.applyQuaternion(o),this.object.up.applyQuaternion(o),u.copy(f)):(o.setFromAxisAngle(n,-t*this.dynamicDampingFactor*a),c.applyQuaternion(o),this.object.up.applyQuaternion(o),o.setFromAxisAngle(n,t*this.dynamicDampingFactor),u.applyQuaternion(o),r=!0)}i=!this.easing||Math.abs(h-l)<1e-4;var s=(h-l)*c.length();je.isNaN(s)||(i?(s&&this.yRistrict&&this.limitY(s),l=h):((s*=this.dynamicDampingFactor)&&this.yRistrict&&this.limitY(s),l+=(h-l)*this.dynamicDampingFactor,r=!0)),r&&this.network.dirtyNetwork()},this.limitY=function(e){var t=c.length();Math.abs(c.x)<=.1*t&&Math.abs(c.z)<=.1*t&&(c.x=.1*t);var i=c.x,r=c.z,a=Math.sqrt(i*i+r*r),n=Math.tan(this.yLowerLimitAngle)*a,o=Math.tan(this.yUpLimitAngle)*a;c.y-=e,c.y>o?c.y=o:c.y<n&&(c.y=n)},this.getValueByTime=function(e,t){var i=(new Date).getTime()-this._timeStart;return i>this.timeInterval?t:e+(t-e)*i/this.timeInterval},this.zoomCamera=function(){if(r===this.STATE.TOUCH_ZOOM)e=n/o,n=o,c.multiplyScalar(e);else{var e,t=this.zoomSpeed;this.easing||(t*=5),1!=(e=1+(a.y-i.y)*t)&&0<e&&(c.multiplyScalar(e),!this.easing||Math.abs(a.y-i.y)<.001?i.copy(a):(i.y+=(a.y-i.y)*this.dynamicDampingFactor,this.network.dirtyNetwork()))}},this.panCamera=function(){var e=p.clone().sub(s);if(e.lengthSq()){e.multiplyScalar(c.length()*this.panSpeed);var t=c.clone().cross(this.object.up).setLength(e.x),i=(new ie).extractRotation(this.object.matrix),r=this.object.up.clone().applyMatrix4(i);t.add(r.setLength(e.y));var a=this.object.p().add(t);this.object.checkPosition(a)&&(this.object.p(a),this.object.target.add(t)),s=p,this.network.dirtyNetwork()}},this.checkAngles=function(){},this.checkDistances=function(){this.noZoom&&this.noPan||(c.lengthSq()>this.maxDistance*this.maxDistance&&this.object._position.addVectors(this.object.target,c.setLength(this.maxDistance)),c.lengthSq()<this.minDistance*this.minDistance&&this.object._position.addVectors(this.object.target,c.setLength(this.minDistance)))},this.updateFPS=function(){if(!this.freeze){if(this.heightSpeed){var e=Se.Math.clamp(this.object._position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*this.heightCoef*2}else this.autoSpeedFactor=0;var t=2*this.movementSpeed;if(this.moveForward||this.autoForward&&!this.moveBackward){o=this.object._position.clone(),this.object.translateZ(-(t+this.autoSpeedFactor));var i=this.object.target;this.verticalFixed&&this.object.setY(o.y);var r=this.object._position,a=new Q,n=new Q;a.subVectors(r,i),n.subVectors(o,i),a.z*n.z<=this.minDistance*this.minDistance&&this.object.target.subVectors(this.object._position,c)}if(this.moveBackward){var o=this.object._position.clone();this.object.translateZ(t),this.verticalFixed&&this.object.setY(o.y)}this.moveLeft&&(this.object.translateX(this.fpsMode?t:-t),this.object.target.subVectors(this.object._position,c)),this.moveRight&&(this.object.translateX(this.fpsMode?-t:t),this.object.target.subVectors(this.object._position,c)),this.moveUp&&(this.object.translateY(t),this.object.target.subVectors(this.object._position,c)),this.moveDown&&(this.object.translateY(-t),this.object.target.subVectors(this.object._position,c));var s=2*this.lookSpeed;this.activeLook||this.dragMode||(s=0);var l=this.verticalLookRatio;if(this.constrainVertical&&(l=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*s,this.dragMode&&(this.mouseX=0),this.lookVertical&&(this.lat-=this.mouseY*s*l),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=Se.Math.degToRad(90-this.lat),this.theta=Se.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=Se.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)),this.fpsMode){var h=this.object.target;r=this.object._position;length=length<this.fpsMinDistance?this.fpsMinDistance:length,h.x=r.x+length*Math.sin(this.phi)*Math.sin(this.theta),h.y=r.y+length*Math.cos(this.phi),h.z=r.z-length*Math.sin(this.phi)*Math.cos(this.theta),this.object.look(h)}}},this.setCameraTarget=function(e){this.Object.p()},this.update=function(){if(c.subVectors(this.object._position,this.object.target),this.noRotate||this.fpsMode||this.rotateCamera(),this.noZoom||this.zoomCamera(),this.noPan||this.fpsMode||this.panCamera(),d&&d.element&&this.network.doubleClickToLookAtFunction(d.element)){this.object.target=d.point;var e=this.object._position.distanceTo(this.object.target),t=d.face.normal.clone();(t=t.applyMatrix4((new Se.Mat4).extractRotation(d.element.worldMatrix))).normalize(),c=t.multiplyScalar(e),d=null}this.object.setPosition(this.object._position.clone().addVectors(this.object.target,c)),this.updateFPS(),this.fpsMode||(this.checkDistances(),this.object.look(this.object.target)),0<this.lastPosition.distanceToSquared(this.object._position)&&this.lastPosition.copy(this.object._position)},this.handleCameraChange=function(e){var t=this.object;if(t){var i=t.p(),r=t.target;if(this.fpsMode){var a=je.getVectorAngles(r,i);this.lat=-a[1],this.lon=-a[0]}}}},Se.extend(Se.DefaultInteraction,Se.BaseInteraction,{STATE:{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5},__accessor:["rotateSpeed","zoomSpeed","panSpeed","yLowerLimitAngle","yUpLimitAngle","minDistance","maxDistance","easing","touchSeq"],__bool:["noRotate","noPan","noZoom","fpsMode","yRistrict","keyboardEnable"],setUp:function(){this.addListener("mousedown","touchstart","touchend","touchmove","mousewheel","DOMMouseScroll","dblclick","keydown","keyup"),this.object&&this.object.addPropertyChangeListener(this.handleCameraChange,this)},tearDown:function(){this.removeListener("mousedown","touchstart","touchend","touchmove","mousewheel","DOMMouseScroll","dblclick","keydown","keyup"),this.object&&this.object.removePropertyChangeListener(this.handleCameraChange,this)},beforeUpdate:function(){},setUpdateIntervalTime:function(e){this.updateIntervalTime=e}}),Se.SelectionInteraction=function(e){Se.BaseInteraction.call(this,e),this.selectUnVisible=!0,this.ctrlDown=!1,this.deleteTimeoutId=null,this._areaPickingLevel=1},Se.extend(Se.SelectionInteraction,Se.BaseInteraction,{constructor:Se.SelectionInteraction,setAreaPickingLevel:function(e){this._areaPickingLevel=e},getAreaPickingLevel:function(){return this._areaPickingLevel},setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},setFocus:function(e){if(document.activeElement!==e){var t,i,r,a=document.documentElement;document.body,a&&(le.isIE||le.isOpera||a.scrollLeft||a.scrollTop)&&(t=a.scrollLeft,i=a.scrollTop,r=a),e.focus(),r&&(r.scrollLeft=t,r.scrollTop=i)}},handle_mousedown:function(e){if(1!=e.stop&&!re.isRightClick(e)){this.setFocus(this.network.getView()),this.isCtrlDown(e)?(this.addListener("mousemove","mouseup"),this.ctrlDownEvent=e):this.network.getDataBox().clearSelection();var t=this.network.getElementByColorPicking(e);!t||this.network.isSelectable(t)&&this.network.getDataBox().getSelectionModel().isSelectable(t)||(t=null),this.network.getDataBox().getSelectionModel().appendSelection(t),this.network.onSelect(t)}},handle_mousemove:function(e){var t=this.getBoundingByMouseEvent(e,this.ctrlDownEvent,this.network.devicePixelRatio);this.mousemoved=!0,this.network.areaPickingRect=t,this.network.paintTopCanvas()},handle_mouseup:function(e){this.network.areaPickingRect=null,this.network.paintTopCanvas();var t=this.getBoundingByMouseEvent(e,this.ctrlDownEvent);if(this.removeListener("mousemove","mouseup"),this.ctrlDownEvent=null,t&&this.mousemoved){var i=this.network.getElementsByBounding(t,!0,this._areaPickingLevel),r=new xe;if(0<i.length)for(var a=0;a<i.length;a++){var n=i[a].element;this.network.selectable(i[a])&&r.add(n)}0<r.size()&&this.network.getDataBox().getSelectionModel().appendSelection(r)}},getBoundingByMouseEvent:function(e,t,i){if(e&&t){var r=this.network.getView().getBoundingClientRect(),a=e.clientX-r.left,n=e.clientY-r.top,o=t.clientX-r.left,s=t.clientY-r.top,l=i||1,h=Math.min(a,o)*l,c=Math.min(n,s)*l,u=Math.abs(a-o)*l,f=Math.abs(n-s)*l;return 0===u&&0===f?null:{x:h,y:c,w:u,h:f}}}}),Se.TransformGizmo=function(){var e=new Se.TransformGizmoMaterial({color:16711680}),t=new Se.TransformGizmoMaterial({color:65280}),i=new Se.TransformGizmoMaterial({color:255});this.handleGizmos={X:[new Se.Cylinder(e,.005,.005,1,4,1,!1,!1),new Q(.5,0,0),new Q(0,0,-Math.PI/2)],Y:[new Se.Cylinder(t,.005,.005,1,4,1,!1,!1),new Q(0,.5,0)],Z:[new Se.Cylinder(i,.005,.005,1,4,1,!1,!1),new Q(0,0,.5),new Q(Math.PI/2,0,0)]},this.showHelpers=!0,this.showable=!0,this.init=function(){Se.Element.call(this),this.handles=new Se.Element,this.pickers=new Se.Element,this.planes=new Se.Element,this.addChild(this.handles),this.addChild(this.pickers),this.addChild(this.planes);var e=new Se.BasicMaterial({wireframe:!1,color:65535,side:Se.DoubleSide}),t=(new Se.Plane(e,5e4,5e4,2,2),{XY:new Se.Plane(e,5e4,5e4,2,2),YZ:new Se.Plane(e,5e4,5e4,2,2),XZ:new Se.Plane(e,5e4,5e4,2,2),XYZE:new Se.Plane(e,5e4,5e4,2,2)});for(var i in t.YZ._rotation.set(0,Math.PI/2,0),t.XZ._rotation.set(-Math.PI/2,0,0),t)t[i].name=i,this.planes.addChild(t[i]),this.planes[i]=t[i],t[i]._visible=!0;for(var i in this.handleGizmos){var r=this.handleGizmos[i][0];if(r.name=i,this.handleGizmos[i][1]&&r._position.set(this.handleGizmos[i][1].x,this.handleGizmos[i][1].y,this.handleGizmos[i][1].z),this.handleGizmos[i][2]&&r._rotation.set(this.handleGizmos[i][2].x,this.handleGizmos[i][2].y,this.handleGizmos[i][2].z),r.mode=this.mode,this.handles.addChild(r),this.pickerGizmos&&this.pickerGizmos[i])a=this.pickerGizmos[i][0],this.pickerGizmos[i][1]&&a._position.set(this.pickerGizmos[i][1].x,this.pickerGizmos[i][1].y,this.pickerGizmos[i][1].z),this.pickerGizmos[i][2]&&a._rotation.set(this.pickerGizmos[i][2].x,this.pickerGizmos[i][2].y,this.pickerGizmos[i][2].z);else var a=r.clone();a.mode=this.mode,a.name=i,this.pickers.addChild(a)}this.iterator(function(e){e instanceof Se.Entity&&Se.Utils.transformElement(e)})},this.hide=function(){this.handles.getChildren().forEach(function(e){e._visible=!1}),this.pickers.getChildren().forEach(function(e){e._visible=!1}),this.planes.getChildren().forEach(function(e){e._visible=!1})},this.show=function(){var t=this;this.handles.getChildren().forEach(function(e){e._visible=t.showHelpers&&t.showable}),this.pickers.getChildren().forEach(function(e){e._visible=!1}),this.activePlane&&(this.activePlane._visible=!1)},this.highlight=function(e){var t;for(var i in this.handleGizmos)(t=this.handleGizmos[i][0]).oldColor&&(t.material instanceof Se.ArrayMaterial?(t.material.materials[0].color.copy(t.oldColor),t.material.materials[0].opacity=t.oldOpacity):(t.material.color.copy(t.oldColor),t.material.opacity=t.oldOpacity),t.oldColor=null);this.handleGizmos[e]&&((t=this.handleGizmos[e][0]).material instanceof Se.ArrayMaterial?(t.oldColor=t.oldColor||t.material.materials[0].color.clone(),t.oldOpacity=t.oldOpacit!==Me?t.oldOpacity:t.material.materials[0].opacity,t.material.materials[0].opacity=1):(t.oldColor=t.oldColor||t.material.color.clone(),t.oldOpacity=t.material.opacity,t.setStyle("material.opacity",1)))},this.init()},Se.TransformGizmo.prototype=Object.create(Se.Element.prototype),Se.TransformGizmo.prototype.update=function(e,t){for(var i=new Q(0,0,0),r=new Q(0,1,0),a=new ie,n=0;n<this.getChildren().size();n++)for(var o=0;o<this.getChildren().get(n).getChildren().size();o++){var s=this.getChildren().get(n).getChildren().get(o);-1!=s.name.search("E")?s.quaternion.setFromRotationMatrix(a.lookAt(t,i,r)):s.quaternion.setFromEuler(e),s._rotation.setEulerFromQuaternion(s.quaternion)}},Se.TransformGizmoTranslate=function(){Se.TransformGizmo.call(this);var e=new Se.TransformGizmoMaterial({color:16711680,opacity:.2}),t=new Se.TransformGizmoMaterial({color:65280,opacity:.2}),i=new Se.TransformGizmoMaterial({color:255,opacity:.2}),r=new Se.Arrow(e,1,.03,.2,.05,30),a=new Se.Arrow(t,1,.03,.2,.05,30),n=new Se.Arrow(i,1,.03,.2,.05,30),o=new Se.TransformGizmoMaterial({color:255,opacity:.5}),s=new Se.TransformGizmoMaterial({color:16711680,opacity:.5}),l=new Se.TransformGizmoMaterial({color:65280,opacity:.5}),h=new Se.TransformGizmoMaterial({color:16777215,opacity:.5}),c=new Se.Circle(o,.5,10,0,Math.PI/2),u=new Se.Circle(s,.5,10,0,Math.PI/2),f=new Se.Circle(l,.5,10,0,Math.PI/2),p=new Se.Octahedron(h,1e-4,0);this.handleGizmos={X:[r,new Q(1.6,0,0),new Q(0,0,-Math.PI/2)],Y:[a,new Q(0,1.6,0)],Z:[n,new Q(0,0,1.6),new Q(Math.PI/2,0,0)],XYZ:[p],XY:[c,new Q(0,0,0)],YZ:[u,new Q(0,0,0),new Q(Math.PI/2,Math.PI/2,0)],XZ:[f,new Q(0,0,0),new Q(Math.PI/2,0,0)]};h=new Se.TransformGizmoMaterial({color:16711680,opacity:.25});var d=new Se.TransformGizmoMaterial({color:65280,opacity:.25}),m=new Se.TransformGizmoMaterial({color:255,opacity:.25}),g=new Se.Cylinder(h,.075,0,1.2,4,1,!1),y=new Se.Cylinder(d,.075,0,1.2,4,1,!1),v=new Se.Cylinder(m,.075,0,1.2,4,1,!1);p=new Se.Octahedron(h,1e-4,0);this.pickerGizmos={X:[g,new Q(1.6,0,0),new Q(0,0,-Math.PI/2)],Y:[y,new Q(0,1.6,0)],Z:[v,new Q(0,0,1.6),new Q(Math.PI/2,0,0)],XYZ:[p]},this.setActivePlane=function(e,t){var i=new ie;t.applyProjection(i.getInverse(i.extractRotation(this.planes.XY.worldMatrix))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==e&&(this.activePlane=this.planes.XYZE),"XY"==e&&(this.activePlane=this.planes.XY),"YZ"==e&&(this.activePlane=this.planes.YZ),"XZ"==e&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},Se.TransformGizmoTranslate.prototype=Object.create(Se.TransformGizmo.prototype),Se.TransformGizmoTranslate.prototype.mode="translate",Se.TransformGizmoRotate=function(){Se.TransformGizmo.call(this);var e=new Se.TransformGizmoMaterial({color:16711680,opacity:.2}),t=new Se.TransformGizmoMaterial({color:65280,opacity:.2}),i=new Se.TransformGizmoMaterial({color:255,opacity:.2}),r=new Se.TransformGizmoMaterial({color:16776960}),a=new Se.TransformGizmoMaterial({color:7895160,opacity:.25}),n=(a=new Se.TransformGizmoMaterial({color:16711680}),new Se.Torus(e,1,.02,4,32,Math.PI)),o=new Se.Torus(t,1,.02,4,32,Math.PI),s=new Se.Torus(i,1,.02,4,32,Math.PI);new Se.Torus(r,1.25,.01,4,64),new Se.Torus(a,1,.01,4,64),this.handleGizmos={X:[n,new Q(0,0,0),new Q(0,-Math.PI/2,-Math.PI/2)],Y:[o,new Q(0,0,0),new Q(Math.PI/2,0,0)],Z:[s,new Q(0,0,0),new Q(0,0,-Math.PI/2)]};var l=new Se.TransformGizmoMaterial({color:16711680,opacity:.25}),h=new Se.TransformGizmoMaterial({color:65280,opacity:.25}),c=new Se.TransformGizmoMaterial({color:255,opacity:.25}),u=new Se.TransformGizmoMaterial({color:983040,opacity:.25}),f=new Se.Torus(l,1,.05,4,12,Math.PI),p=new Se.Torus(h,1,.05,4,12,Math.PI),d=new Se.Torus(c,1,.05,4,12,Math.PI);new Se.Torus(u,1,.05,2,24),this.pickerGizmos={X:[f,new Q(0,0,0),new Q(0,-Math.PI/2,-Math.PI/2)],Y:[p,new Q(0,0,0),new Q(Math.PI/2,0,0)],Z:[d,new Q(0,0,0),new Q(0,0,-Math.PI/2)]},this.setActivePlane=function(e){"E"==e&&(this.activePlane=this.planes.XYZE),"X"==e&&(this.activePlane=this.planes.YZ),"Y"==e&&(this.activePlane=this.planes.XZ),"Z"==e&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(e,t){Se.TransformGizmo.prototype.update.apply(this,arguments);var i={handles:this.handles,pickers:this.pickers},r=new ie,a=new Se.Euler(0,0,1),n=new Se.Quat,o=new Q(1,0,0),s=new Q(0,1,0),l=new Q(0,0,1),h=new Se.Quat,c=new Se.Quat,u=new Se.Quat,f=t.clone();for(var p in a.copy(this.planes.XY._rotation),n.setFromEuler(a),r.makeRotationFromQuaternion(n).getInverse(r),f.applyProjection(r),i)for(var d=0;d<i[p].getChildren().size;d++){var m=i[p].getChildren().get(d);n.setFromEuler(a),"X"==m.name&&(h.setFromAxisAngle(o,Math.atan2(-f.y,f.z)),n.multiplyQuaternions(n,h),m.quaternion.copy(n)),"Y"==m.name&&(c.setFromAxisAngle(s,Math.atan2(f.x,f.z)),n.multiplyQuaternions(n,c),m.quaternion.copy(n)),"Z"==m.name&&(u.setFromAxisAngle(l,Math.atan2(f.y,f.x)),n.multiplyQuaternions(n,u),m.quaternion.copy(n))}},this.init()},Se.TransformGizmoRotate.prototype=Object.create(Se.TransformGizmo.prototype),Se.TransformGizmoRotate.prototype.mode="rotate",Se.TransformGizmoScale=function(){Se.TransformGizmo.call(this);var e=new Se.TransformGizmoMaterial({color:11184810,opacity:1}),t=new Se.TransformGizmoMaterial({color:16711680,opacity:.2}),i=new Se.TransformGizmoMaterial({color:65280,opacity:.2}),r=new Se.TransformGizmoMaterial({color:255,opacity:.2}),a=new Se.Cube(e,.25,.25,.25),n=new Se.Cylinder(null,.1,.1,1,4,1,!1),o=new Se.Cube(e,.225,.225,.225);(s=new Se.Cylinder(null,.1,0,1,20,1,!0))._position.y=.05;var s=Se.Utils.createElement(n,s,t),l=(Se.Utils.createElement(n,s,i),Se.Utils.createElement(n,s,r),new Se.Cylinder(t,.08,0,1,4,1,!1)),h=new Se.Cylinder(i,.08,0,1,4,1,!1),c=new Se.Cylinder(r,.08,0,1,4,1,!1),u=new Se.Element;u.material=new Se.BasicMaterial;var f=new Se.Element;f.material=new Se.BasicMaterial;var p=new Se.Element;p.material=new Se.BasicMaterial,this.handleGizmos={X:[l,new Q(.5,0,0),new Q(0,0,-Math.PI/2)],Y:[h,new Q(0,.5,0)],Z:[c,new Q(0,0,.5),new Q(Math.PI/2,0,0)],XY:[u],YZ:[f],XZ:[p],XYZ:[a]};var d=new Se.TransformGizmoMaterial({color:16711680,opacity:.25}),m=new Se.TransformGizmoMaterial({color:65280,opacity:.25}),g=new Se.TransformGizmoMaterial({color:255,opacity:.25}),y=new Se.Cylinder(d,.125,0,1,4,1,!1),v=new Se.Cylinder(m,.125,0,1,4,1,!1),x=new Se.Cylinder(g,.125,0,1,4,1,!1);this.pickerGizmos={X:[y,new Q(.6,0,0),new Q(Math.PI/4,0,-Math.PI/2)],Y:[v,new Q(0,.6,0),new Q(0,Math.PI/4,0)],Z:[x,new Q(0,0,.6),new Q(Math.PI/2,Math.PI/4,0)],XYZ:[o]},this.setActivePlane=function(e,t){var i=new ie;t.applyProjection(i.getInverse(i.extractRotation(this.planes.XY.worldMatrix))),"X"==e?(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)):"Y"==e?(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)):"Z"==e?(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)):this.activePlane="XYZ"==e?this.planes.XYZE:this.planes[e],this.hide(),this.show()},this.init()},Se.TransformGizmoScale.prototype=Object.create(Se.TransformGizmo.prototype),Se.TransformGizmoScale.prototype.mode="scale",Se.EditInteraction=function(u){function e(e){m.network._keyboardRemoveEnabled&&46==e.keyCode&&0<u.getDataBox().getSelectionModel().size()&&q.confirm("Delete?")&&u.getDataBox().removeSelection()}function t(i){1===i.touches.length&&(m.deleteTimeoutId=setTimeout(function(){var e=m.network.getElementsByMouseEvent(i,m.selectUnVisible);if(0<e.length){var t=e[0];q.confirm("Delete?")&&m.network.getDataBox().remove(t.element)}},1e3))}function i(e){clearTimeout(m.deleteTimeoutId)}function r(e){clearTimeout(m.deleteTimeoutId)}function a(e){m.update()}function o(e){if(m.object&&!g){e.preventDefault(),e.stopPropagation();var t=f(e.touches?e.touches[0]:e,m.filterIntersectPicker(m.pickers));if(t)m.axis=t.object.name,m.setMode(t.object.mode);else{var i=l(e);i===m.object||null!=i&&i.editTransformToParent&&i.isDescendantOf(m.object)?(m.axis=m.getAxis(),m.setMode(m.getMode())):m.axis=!1}m.update(!0)}}function n(e){if(!e.stop)if(H.set(e.clientX,e.clientY),m.showHelpers&&m.axis||(h(e),o(e)),m.object&&!g){e.preventDefault(),e.stopPropagation();var t=e.touches?e.touches[0]:e;if(0===t.button||t.button==Me){var i=f(t,m.filterIntersectPicker(m.pickers)),r=l(e);if(i||(r===m.object||null!=r&&r.editTransformToParent&&r.isDescendantOf(m.object))&&m.getDefaultPickers()&&(i={object:m.getDefaultPickers()}),i){m.axis=i.object.name,M.copy(Y).sub(O).normalize(),m.gizmo[y].setActivePlane(m.axis,M);var a=f(t,[m.gizmo[y].activePlane]);if(!a&&r&&(a=f(t,[r])),a){I.copy(m.object._position),F.copy(m.object._scale),V.extractRotation(m.object.matrix),G.extractRotation(m.object.worldMatrix);var n=m.object.getParent();n==Me&&(n=u),U.extractRotation(n.worldMatrix),k.getScaleFromMatrix(S.getInverse(n.worldMatrix)),x.copy(a.point)}}}m.update(!0),g=!0}else m.network.dirtyNetwork()}function s(e){if(m.object&&m.axis&&g){e.preventDefault(),e.stopPropagation(),e.stop=!0;var t=e.touches?e.touches[0]:e,i=f(t,[m.gizmo[y].activePlane]);if(i||(i=f(t,[m.object])),i){if(m.moving?u.fireInteractionEvent({kind:"liveMoveBetween",event:At}):(u.fireInteractionEvent({kind:"liveMoveStart",event:At}),m.moving=!0),v.copy(i.point),"translate"==y&&m.translateable){if(v.sub(x),v.multiply(k),"local"==m.space&&(v.applyMatrix4(S.getInverse(G)),-1==m.axis.search("X")&&(v.x=0),-1==m.axis.search("Y")&&(v.y=0),-1==m.axis.search("Z")&&(v.z=0),v.applyMatrix4(V),m.object.setPosition(I.clone().add(v))),"world"==m.space||-1!=m.axis.search("XYZ")){-1==m.axis.search("X")&&(v.x=0),-1==m.axis.search("Y")&&(v.y=0),-1==m.axis.search("Z")&&(v.z=0),v.applyMatrix4(S.getInverse(U)),m.object._position.copy(I);var r=m.object._position.clone().add(v);m.snap&&(-1!=m.axis.search("X")&&(r.x=Math.round(m.object._position.x/m.snap)*m.snap),-1!=m.axis.search("Y")&&(r.y=Math.round(m.object._position.y/m.snap)*m.snap),-1!=m.axis.search("Z")&&(r.z=Math.round(m.object._position.z/m.snap)*m.snap)),m.object.setPosition(r)}}else if("scale"==y&&m.scaleable){v.sub(x),v.multiply(k);var a=m.object._scale.clone(),n=(m.scaleRate||1)/10;if("XYZ"==m.axis)h=1+v.y*n,a.x=F.x*h,a.y=F.y*h,a.z=F.z*h;else if("XY"===m.axis){var o=1+v.x*n,s=1+v.y*n;m.forceSameScale?(h=Math.max(o,s),a.x=F.x*h,a.y=F.y*h):(a.x=F.x*o,a.y=F.y*s)}else if("YZ"===m.axis){var l=1+v.z*n;s=1+v.y*n;m.forceSameScale?(h=Math.max(l,s),a.z=F.z*h,a.y=F.y*h):(a.z=F.z*l,a.y=F.y*s)}else if("XZ"===m.axis){o=1+v.x*n,l=1+v.z*n;if(m.forceSameScale){var h=Math.max(o,s);a.x=F.x*h,a.z=F.z*h}else a.x=F.x*o,a.z=F.z*l}else v.applyMatrix4(S.getInverse(G)),"X"==m.axis&&(a.x=F.x*(1+v.x*n)),"Y"==m.axis&&(a.y=F.y*(1+v.y*n)),"Z"==m.axis&&(a.z=F.z*(1+v.z*n));m.object.setScale(a)}else if("rotate"==y&&m.rotateable)if(v.sub(O),v.multiply(k),P.copy(x).sub(O),P.multiply(k),"E"==m.axis)v.applyMatrix4(S.getInverse(b)),P.applyMatrix4(S.getInverse(b)),A.set(Math.atan2(v.z,v.y),Math.atan2(v.x,v.z),Math.atan2(v.y,v.x)),_.set(Math.atan2(P.z,P.y),Math.atan2(P.x,P.z),Math.atan2(P.y,P.x)),T.setFromRotationMatrix(S.getInverse(U)),B.setFromAxisAngle(M,A.z-_.z),D.setFromRotationMatrix(G),T.multiplyQuaternions(T,B),T.multiplyQuaternions(T,D),m.object.quaternion.copy(T);else if("XYZE"==m.axis)B.setFromEuler(v.clone().cross(P).normalize()),T.setFromRotationMatrix(S.getInverse(U)),L.setFromAxisAngle(B,-v.clone().angleTo(P)),D.setFromRotationMatrix(G),T.multiplyQuaternions(T,L),T.multiplyQuaternions(T,D),m.object.quaternion.copy(T);else if("local"==m.space)v.applyMatrix4(S.getInverse(G)),P.applyMatrix4(S.getInverse(G)),A.set(Math.atan2(v.z,v.y),Math.atan2(v.x,v.z),Math.atan2(v.y,v.x)),_.set(Math.atan2(P.z,P.y),Math.atan2(P.x,P.z),Math.atan2(P.y,P.x)),D.setFromRotationMatrix(V),L.setFromAxisAngle(C,A.x-_.x),R.setFromAxisAngle(E,A.y-_.y),N.setFromAxisAngle(z,A.z-_.z),"X"==m.axis&&D.multiplyQuaternions(D,L),"Y"==m.axis&&D.multiplyQuaternions(D,R),"Z"==m.axis&&D.multiplyQuaternions(D,N),m.object.quaternion.copy(D),(c=m.object._rotation.clone()).setEulerFromQuaternion(D),m.object.setRotation(c);else if("world"==m.space){A.set(Math.atan2(v.z,v.y),Math.atan2(v.x,v.z),Math.atan2(v.y,v.x)),_.set(Math.atan2(P.z,P.y),Math.atan2(P.x,P.z),Math.atan2(P.y,P.x)),T.setFromRotationMatrix(S.getInverse(U)),L.setFromAxisAngle(C,A.x-_.x),R.setFromAxisAngle(E,A.y-_.y),N.setFromAxisAngle(z,A.z-_.z),D.setFromRotationMatrix(G),"X"==m.axis&&T.multiplyQuaternions(T,L),"Y"==m.axis&&T.multiplyQuaternions(T,R),"Z"==m.axis&&T.multiplyQuaternions(T,N),T.multiplyQuaternions(T,D),m.object.quaternion.copy(T);var c=m.object._rotation.clone();c.setEulerFromQuaternion(T),m.object.setRotation(c)}m.changed=!0}m.update(!0),m.updateTextNote(e,m.object)}}function l(e){var t=m.network.getElementsByMouseEvent(e);return u.getFirstEditElement(t)}function h(e){if(null===j&&(j=new pe),j.set(e.clientX,e.clientY),u.getDataBox().clearEditing(),0===j.distanceTo(H)){var t=m.network.getElementsByMouseEvent(e),i=u.getFirstEditElement(t);i&&(m.object,m.object=i,m.translateable&&m.gizmo.translate.show(),m.rotateable&&m.gizmo.rotate.show(),m.scaleable&&m.gizmo.scale.show()),i||(m.gizmo[y].hide(),m.gizmo.translate.hide(),m.gizmo.rotate.hide(),m.gizmo.scale.hide(),m.object=null)}else m.changed&&m.onElementPropertyChanged&&(m.changed=!1,m.moving=!1,m.onElementPropertyChanged(e,m.object),u.fireInteractionEvent({kind:"liveMoveEnd",event:{e:e,source:m.object,time:(new Date).getTime()}}));m.axis=!1,g=!1,m.update(!0),m.hideTextNote()}function f(e,t){if(!t)return null;var i=m.network.getPickingByEvent(e).intersectObjects(t,!0,!0);return!!i[0]&&i[0]}Se.BaseInteraction.call(this,u);var c=new Se.Element,p=u.getCamera(),d=u.getRootView();d=d!==Me?d:document,this.domElement=d,this.gizmo={},this.gizmo.translate=new Se.TransformGizmoTranslate,this.gizmo.rotate=new Se.TransformGizmoRotate,this.gizmo.scale=new Se.TransformGizmoScale,c.addChild(this.gizmo.translate),c.addChild(this.gizmo.rotate),c.addChild(this.gizmo.scale),this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide(),this.object=!1,this.snap=!1,this.space="local",this.size=1,this.axis=!1;var m=this;this.scaleable=!0,this.rotateable=!0,this.translateable=!0,this.setShowHelpers(!0);var g=!1,y="translate",v=(new Se.Picking,new Se.Projector,new Q,new Q),x=new Q,A=new Q,_=new Q,w=1,b=new ie,M=new Q,S=new ie,P=new Q,T=new Se.Quat,C=new Q(1,0,0),E=new Q(0,1,0),z=new Q(0,0,1),D=new Se.Quat,L=new Se.Quat,R=new Se.Quat,N=new Se.Quat,B=new Se.Quat,I=new Q,F=new Q,V=new ie,U=new ie,k=new Q,O=new Q,X=new Se.Euler,G=new ie,Y=new Q,W=new Se.Euler;this.showNote=!0,this.handleDataBoxChange=function(e){"remove"==e.kind?e.data==m.object&&(m.gizmo.translate.hide(),m.gizmo.rotate.hide(),m.gizmo.scale.hide()):"clear"==e.kind&&(m.gizmo.translate.hide(),m.gizmo.rotate.hide(),m.gizmo.scale.hide())},this.network.getDataBox().addDataBoxChangeListener(this.handleDataBoxChange,this),this.network.addPropertyChangeListener(function(e){if("dataBox"==e.property){var t=e.oldValue,i=e.value;t.removeDataBoxChangeListener(this.handleDataBoxChange),i.addDataBoxChangeListener(this.handleDataBoxChange,this)}}),this.defaultMode="TranslateXY",this.pickers=[],this.gizmo.translate.pickers.getChildren().forEach(function(e){m.pickers.push(e)}),this.gizmo.rotate.pickers.getChildren().forEach(function(e){m.pickers.push(e)}),this.gizmo.scale.pickers.getChildren().forEach(function(e){m.pickers.push(e)}),this.attach=function(e){m.object=e,this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide(),this.gizmo[y].show(),m.update()},this.detach=function(e){m.object=!1,this.axis=!1,this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide()},this.setMode=function(e){y=e||y,this.update()},this.setUp=function(){d.addEventListener("mousedown",n,!1),d.addEventListener("touchstart",n,!1),d.addEventListener("mousemove",o,!1),d.addEventListener("touchmove",o,!1),d.addEventListener("mousemove",s,!1),d.addEventListener("touchmove",s,!1),d.addEventListener("mouseup",h,!1),d.addEventListener("mouseout",h,!1),d.addEventListener("touchend",h,!1),d.addEventListener("touchcancel",h,!1),d.addEventListener("touchleave",h,!1),d.addEventListener("keydown",e,!1),d.addEventListener("touchstart",t,!1),d.addEventListener("touchmove",i,!1),d.addEventListener("touchend",r,!1),d.addEventListener("mousewheel",a,!1),m.network.helperBox.addByDescendant(c)},this.tearDown=function(){d.removeEventListener("mousedown",n,!1),d.removeEventListener("touchstart",n,!1),d.removeEventListener("mousemove",o,!1),d.removeEventListener("touchmove",o,!1),d.removeEventListener("mousemove",s,!1),d.removeEventListener("touchmove",s,!1),d.removeEventListener("mouseup",h,!1),d.removeEventListener("mouseout",h,!1),d.removeEventListener("touchend",h,!1),d.removeEventListener("touchcancel",h,!1),d.removeEventListener("touchleave",h,!1),d.removeEventListener("keydown",e,!1),d.removeEventListener("touchstart",t,!1),d.removeEventListener("touchmove",i,!1),d.removeEventListener("touchend",r,!1),d.removeEventListener("mousewheel",a,!1),m.gizmo.translate.hide(),m.gizmo.rotate.hide(),m.gizmo.scale.hide(),m.network.helperBox.removeByDescendant(c)},this.setSnap=function(e){m.snap=e},this.setSize=function(e){m.size=e,this.update()},this.setSpace=function(e){m.space=e,this.update()},this.update=function(e){m.object&&(m.object.updateWorldMatrix(),O.getPositionFromMatrix(m.object.worldMatrix),X.setFromRotationMatrix(S.extractRotation(m.object.worldMatrix)),p.updateWorldMatrix(),Y.getPositionFromMatrix(p.worldMatrix),W.setFromRotationMatrix(S.extractRotation(p.worldMatrix)),w=O.distanceTo(Y)/12*m.size,c.setPosition(O),c.setScale(w,w,w),M.copy(Y).sub(O).normalize(),this.gizmo.scale.update(X,M),"local"==m.space?(this.gizmo.translate.update(X,M),this.gizmo.rotate.update(X,M)):(this.gizmo.translate.update(new Se.Euler,M),this.gizmo.rotate.update(new Se.Euler,M)),this.gizmo.translate.highlight(null),this.gizmo.rotate.highlight(null),this.gizmo.scale.highlight(null),this.gizmo[y].highlight(m.axis),c.updateWorldMatrix(!0),e&&m.network.dirtyNetwork())},this.getDefaultPickers=function(){return"TranslateX"===this.defaultMode?m.gizmo.translate.pickers.getChildren().get(0):"TranslateY"===this.defaultMode?m.gizmo.translate.pickers.getChildren().get(1):"TranslateZ"===this.defaultMode?m.gizmo.translate.pickers.getChildren().get(2):"TranslateXY"===this.defaultMode?m.gizmo.translate.pickers.getChildren().get(4):"TranslateYZ"===this.defaultMode?m.gizmo.translate.pickers.getChildren().get(5):"TranslateXZ"===this.defaultMode?m.gizmo.translate.pickers.getChildren().get(6):"TranslateXYZ"===this.defaultMode?m.gizmo.translate.pickers.getChildren().get(3):"RotateX"===this.defaultMode?m.gizmo.rotate.pickers.getChildren().get(0):"RotateY"===this.defaultMode?m.gizmo.rotate.pickers.getChildren().get(1):"RotateZ"===this.defaultMode?m.gizmo.rotate.pickers.getChildren().get(2):"ScaleX"===this.defaultMode?m.gizmo.scale.pickers.getChildren().get(0):"ScaleY"===this.defaultMode?m.gizmo.scale.pickers.getChildren().get(1):"ScaleZ"===this.defaultMode?m.gizmo.scale.pickers.getChildren().get(2):"ScaleXYZ"===this.defaultMode?m.gizmo.scale.pickers.getChildren().get(6):"ScaleXY"===this.defaultMode?m.gizmo.scale.pickers.getChildren().get(3):"ScaleYZ"===this.defaultMode?m.gizmo.scale.pickers.getChildren().get(4):"ScaleXZ"===this.defaultMode?m.gizmo.scale.pickers.getChildren().get(5):null},this.getMode=function(){var e=this.defaultMode;return e.startsWith("Translate")?"translate":e.startsWith("Rotate")?"rotate":e.startsWith("Scale")?"scale":"translate"},this.getAxis=function(){var e=this.defaultMode;return e.endsWith("XYZ")?"XYZ":e.endsWith("XY")?"XY":e.endsWith("YZ")?"YZ":e.endsWith("XZ")?"XZ":e.endsWith("Y")?"X":e.endsWith("Y")?"Y":e.endsWith("Z")?"Z":""};var j=null,H=new pe;this.filterIntersectPicker=function(e){var t=[];if(!this.showHelpers)return t;for(var i=0;i<e.length;i++){var r=e[i];r.getParent()===this.gizmo.translate.pickers&&this.translateable&&t.push(r),r.getParent()===this.gizmo.rotate.pickers&&this.rotateable&&t.push(r),r.getParent()===this.gizmo.scale.pickers&&this.scaleable&&t.push(r)}return t}},Se.extend(Se.EditInteraction,Se.BaseInteraction,{setShowHelpers:function(e){this.showHelpers=e,this.gizmo.translate.showHelpers=e,this.gizmo.rotate.showHelpers=e,this.gizmo.scale.showHelpers=e,this.resetHelpers()},onElementPropertyChanged:function(e,t){},resetHelpers:function(){this.showHelpers&&this.translateable&&this.object?this.gizmo.translate.show():this.gizmo.translate.hide(),this.showHelpers&&this.rotateable&&this.object?this.gizmo.rotate.show():this.gizmo.rotate.hide(),this.showHelpers&&this.scaleable&&this.object?this.gizmo.scale.show():this.gizmo.scale.hide(),this.update(!0)},setShowNote:function(e){this.showNote=e},setScaleable:function(e){this.scaleable=e,this.gizmo.scale.showable=e,this.resetHelpers()},setRotateable:function(e){this.rotateable=e,this.gizmo.rotate.showable=e,this.resetHelpers()},setTranslateable:function(e){this.translateable=e,this.gizmo.translate.showable=e,this.resetHelpers()},setDefaultMode:function(e){this.defaultMode=e},setScaleRate:function(e){this.scaleRate=e||1},setForceSameScale:function(e){this.forceSameScale=e},setSpaceMode:function(e){this.space="world"==e?"world":"local",this.update()},createTextNote:function(){this.textNote=document.createElement("div"),this.textNote.style.position="relative",this.textNote.style.color="black",this.textNote.style.height="0px",this.textNote.style.zIndex="1000",this.domElement.appendChild(this.textNote);var e=document.createElement("table");this.noteTable=e,this.textNote.appendChild(this.noteTable),e.createTHead(),e.style.borderLeft="1px solid #ffa500",e.style.borderTop="1px solid #ffa500",e.style.fontSize="14px",e.style.backgroundColor="rgba(255, 170, 13, 0.5)",e.setAttribute("border",0),e.setAttribute("cellspacing",0),e.setAttribute("cellpadding",0);for(var t=0;t<4;t++){for(var i=document.createElement("tr"),r=0;r<4;r++){var a=document.createElement("td");a.style.borderRight="1px solid #ffa500",a.style.borderBottom="1px solid #ffa500",a.style.paddingLeft="5px",a.style.paddingRight="5px",a.style.paddingTop="2px",a.style.paddingBottom="2px",0==t&&0<r||0<t&&0==r?(a.style.textAlign="center",a.style.fontWeight="bold"):a.style.textAlign="right",i.appendChild(a)}e.appendChild(i)}},showTextNote:function(){this.showNote&&(null==this.textNote&&this.createTextNote(),this.textNote.style.display="")},hideTextNote:function(){this.textNote&&(this.textNote.style.display="none")},updateTextNote:function(e,t){if(null!=t&&this.showNote){var i=this.network.getRootView().getBoundingClientRect();this.showTextNote(),this.textNote.style.top=e.clientY-i.top+20+"px",this.textNote.style.left=e.clientX-i.left+20+"px";for(var r=t.getRotation(),a=t.getPosition(),n=t.getScale(),o=[[" ","x","y","z"],["p",a.x,a.y,a.z],["r",r.x,r.y,r.z],["s",n.x,n.y,n.z]],s=this.noteTable,l=0;l<4;l++)for(var h=0;h<4;h++){var c=o[l][h];0<l&&0<h&&(c=2==l?(180*c/Math.PI).toFixed(0)+"&deg;":c.toFixed(2)),s.rows[l].cells[h].innerHTML=""+c}}}}),Se.CSG=function(e){var t,i,r,a,n,o,s=[];if(!(e instanceof Se.Element)){if(e instanceof Qt)return this.tree=e,this.matrix=new ie,this;throw"TGL.CSG: Given geometry is unsupported"}for(e.computeNodeData&&e.computeNodeData(),e.updateWorldMatrix(!0),this.matrix=e.worldMatrix.clone(),h=0,t=e.faces.length;h<t;h++){if(i=e.faces[h],a=e.uvs[h],n=e.uv2s[h],o=new qt,i instanceof Ce)r=e.vertices[i.a],(r=new Zt(r.x,r.y,r.z,i.vertexNormals[0],new pe(a[0].x,a[0].y),n[0].clone())).materialIndex=i.materialIndex,r.applyMatrix4(this.matrix),o.vertices.push(r),r=e.vertices[i.b],(r=new Zt(r.x,r.y,r.z,i.vertexNormals[1],new pe(a[1].x,a[1].y),n[1].clone())).materialIndex=i.materialIndex,r.applyMatrix4(this.matrix),o.vertices.push(r),r=e.vertices[i.c],(r=new Zt(r.x,r.y,r.z,i.vertexNormals[2],new pe(a[2].x,a[2].y),n[2].clone())).applyMatrix4(this.matrix),r.materialIndex=i.materialIndex,o.vertices.push(r);else{if(!(i instanceof Ee))throw"Invalid face type at index "+h;r=e.vertices[i.a],(r=new Zt(r.x,r.y,r.z,i.vertexNormals[0],new pe(a[0].x,a[0].y),n[0].clone())).materialIndex=i.materialIndex,r.applyMatrix4(this.matrix),o.vertices.push(r),r=e.vertices[i.b],(r=new Zt(r.x,r.y,r.z,i.vertexNormals[1],new pe(a[1].x,a[1].y),n[1].clone())).materialIndex=i.materialIndex,r.applyMatrix4(this.matrix),o.vertices.push(r),r=e.vertices[i.c],(r=new Zt(r.x,r.y,r.z,i.vertexNormals[2],new pe(a[2].x,a[2].y),n[2].clone())).materialIndex=i.materialIndex,r.applyMatrix4(this.matrix),o.vertices.push(r),r=e.vertices[i.d],(r=new Zt(r.x,r.y,r.z,i.vertexNormals[3],new pe(a[3].x,a[3].y),n[3].clone())).applyMatrix4(this.matrix),r.materialIndex=i.materialIndex,o.vertices.push(r)}isNaN(o.calculateProperties().w)?console.log("Not right polygon"):s.push(o)}if(this.tree=new Qt(s),this.tree.materialSize=e.getMaterialSize?e.getMaterialSize():0,e.material instanceof Se.ArrayMaterial)this.tree.material=e.material;else{var l=new Se.ArrayMaterial;this.tree.material=l;for(var h=0;h<this.tree.materialSize;h++)l.push(e.material)}},Se.CSG.prototype.substract=function(e){var t=this.tree.clone(),i=e.tree.clone();return t.sumMateriaSize(i),t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),(t=new Se.CSG(t)).matrix=this.matrix,t},Se.CSG.prototype.union=function(e){var t=this.tree.clone(),i=e.tree.clone();return t.sumMateriaSize(i),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),(t=new Se.CSG(t)).matrix=this.matrix,t},Se.CSG.prototype.intersect=function(e){var t=this.tree.clone(),i=e.tree.clone();return t.sumMateriaSize(i),t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),(t=new Se.CSG(t)).matrix=this.matrix,t},Se.CSG.prototype.inverse=function(){var e=this.tree.clone();return e.polygons.map(function(e){e.flip()}),new Se.CSG(e)},Se.CSG.prototype.toGeometry=function(e){(new ie).getInverse(this.matrix);var t,i,r,a,n,o,s,l,h,c,u,f=new Se.Entity(this.tree.material,e),p=this.tree.allPolygons(),d=p.length,m={};for(t=0;t<d;t++)for(a=(r=p[t]).vertices.length,i=2;i<a;i++){c=[],u=[],l=r.vertices[0],c.push(new pe(l.uv.x,l.uv.y)),u.push(l.uv2.clone());var g=l.materialIndex;void 0!==m[(l=new Q(l.x,l.y,l.z)).x+","+l.y+","+l.z]?n=m[l.x+","+l.y+","+l.z]:(f.vertices.push(l),n=m[l.x+","+l.y+","+l.z]=f.vertices.length-1),l=r.vertices[i-1],c.push(new pe(l.uv.x,l.uv.y)),u.push(l.uv2.clone()),void 0!==m[(l=new Q(l.x,l.y,l.z)).x+","+l.y+","+l.z]?o=m[l.x+","+l.y+","+l.z]:(f.vertices.push(l),o=m[l.x+","+l.y+","+l.z]=f.vertices.length-1),l=r.vertices[i],c.push(new pe(l.uv.x,l.uv.y)),u.push(l.uv2.clone()),void 0!==m[(l=new Q(l.x,l.y,l.z)).x+","+l.y+","+l.z]?s=m[l.x+","+l.y+","+l.z]:(f.vertices.push(l),s=m[l.x+","+l.y+","+l.z]=f.vertices.length-1),(h=new Ce(n,o,s,new Q(r.normal.x,r.normal.y,r.normal.z))).materialIndex=g||0,f.faces.push(h),f.uvs.push(c),f.uv2s.push(u)}return f},Se.CSG.prototype.toMesh=function(e){var t=this.toGeometry(e);return t.computeBoundingBox(),t};var qt=function(e,t,i){e instanceof Array||(e=[]),0<(this.vertices=e).length?this.calculateProperties():this.normal=this.w=Me};qt.prototype.calculateProperties=function(){var e=this.vertices[0],t=this.vertices[1],i=this.vertices[2],r=t.clone().subtract(e),a=i.clone().subtract(e);return this.normal=r.cross(a).normalize(),this.w=this.normal.clone().dot(e),this},qt.prototype.clone=function(){var e,t,i=new qt;for(e=0,t=this.vertices.length;e<t;e++)i.vertices.push(this.vertices[e].clone());return i.calculateProperties(),i},qt.prototype.flip=function(){var e,t=[];for(this.normal.multiplyScalar(-1),this.w*=-1,e=this.vertices.length-1;0<=e;e--)t.push(this.vertices[e]);return this.vertices=t,this},qt.prototype.classifyVertex=function(e){var t=this.normal.dot(e)-this.w;return t<-1e-5?2:1e-5<t?1:0},qt.prototype.classifySide=function(e){var t,i,r,a=0,n=0,o=e.vertices.length;for(t=0;t<o;t++)i=e.vertices[t],1===(r=this.classifyVertex(i))?a++:2===r&&n++;return 0<a&&0===n?1:0===a&&0<n?2:0===a&&0===n?0:3},qt.prototype.splitPolygon=function(e,t,i,r,a){var n=this.classifySide(e);if(0===n)(0<this.normal.dot(e.normal)?t:i).push(e);else if(1===n)r.push(e);else if(2===n)a.push(e);else{var o,s,l,h,c,u,f,p,d,m=[],g=[];for(s=0,o=e.vertices.length;s<o;s++)l=(s+1)%o,u=e.vertices[s],f=e.vertices[l],h=this.classifyVertex(u),c=this.classifyVertex(f),2!=h&&m.push(u),1!=h&&g.push(u),3==(h|c)&&(p=(this.w-this.normal.dot(u))/this.normal.dot(f.clone().subtract(u)),d=u.interpolate(f,p),m.push(d),g.push(d));3<=m.length&&r.push(new qt(m).calculateProperties()),3<=g.length&&a.push(new qt(g).calculateProperties())}},Se.CSG.Polygon=qt;var Zt=function(e,t,i,r,a,n){this.x=e,this.y=t,this.z=i,this.normal=r||new Q,this.uv=a||new pe,this.uv2=n||new pe};Zt.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},Zt.prototype.clone=function(){var e=new Zt(this.x,this.y,this.z,this.normal.clone(),this.uv.clone(),this.uv2.clone());return e.materialIndex=this.materialIndex,e},Zt.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},Zt.prototype.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},Zt.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},Zt.prototype.cross=function(e){var t=this.x,i=this.y,r=this.z;return this.x=i*e.z-r*e.y,this.y=r*e.x-t*e.z,this.z=t*e.y-i*e.x,this},Zt.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x/=e,this.y/=e,this.z/=e,this},Zt.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},Zt.prototype.lerp=function(e,t){return this.add(e.clone().subtract(this).multiplyScalar(t)),this.normal.add(e.normal.clone().sub(this.normal).multiplyScalar(t)),this.uv.add(e.uv.clone().sub(this.uv).multiplyScalar(t)),this.uv2.add(e.uv2.clone().sub(this.uv2).multiplyScalar(t)),this},Zt.prototype.interpolate=function(e,t){return this.clone().lerp(e,t)},Zt.prototype.applyMatrix4=function(e){var t=this.x,i=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*r+a[12],this.y=a[1]*t+a[5]*i+a[9]*r+a[13],this.z=a[2]*t+a[6]*i+a[10]*r+a[14],this},Se.CSG.Vertex=Zt;var Qt=function(e){var t,i,r=[],a=[];if(this.polygons=[],this.front=this.back=Me,e instanceof Array&&0!==e.length){for(this.divider=e[0].clone(),t=0,i=e.length;t<i;t++)this.divider.splitPolygon(e[t],this.polygons,this.polygons,r,a);0<r.length&&(this.front=new Qt(r)),0<a.length&&(this.back=new Qt(a))}};Qt.isConvex=function(e){var t,i;for(t=0;t<e.length;t++)for(i=0;i<e.length;i++)if(t!==i&&2!==e[t].classifySide(e[i]))return!1;return!0},Qt.prototype.build=function(e){var t,i,r=[],a=[];for(this.divider||(this.divider=e[0].clone()),t=0,i=e.length;t<i;t++)this.divider.splitPolygon(e[t],this.polygons,this.polygons,r,a);0<r.length&&(this.front||(this.front=new Qt),this.front.build(r)),0<a.length&&(this.back||(this.back=new Qt),this.back.build(a))},Qt.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},Qt.prototype.clone=function(){var e=new Qt;if(this.divider&&(e.divider=this.divider.clone()),e.polygons=this.polygons.map(function(e){return e.clone()}),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.materialSize=this.materialSize,e.material=new Se.ArrayMaterial,this.material)for(var t=0;t<this.material.materials.length;t++)e.material.materials.push(this.material.materials[t]);return e},Qt.prototype.invert=function(){var e,t,i;for(e=0,t=this.polygons.length;e<t;e++)this.polygons[e].flip();return this.divider&&this.divider.flip(),this.front&&this.front.invert(),this.back&&this.back.invert(),i=this.front,this.front=this.back,this.back=i,this},Qt.prototype.clipPolygons=function(e){var t,i,r,a;if(!this.divider)return e.slice();for(r=[],a=[],t=0,i=e.length;t<i;t++)this.divider.splitPolygon(e[t],r,a,r,a);return this.front&&(r=this.front.clipPolygons(r)),a=this.back?this.back.clipPolygons(a):[],r.concat(a)},Qt.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},Qt.prototype.sumMateriaSize=function(e){e.changeMaterialIndex(this.materialSize),this.materialSize=this.materialSize+e.materialSize;for(var t=0;t<e.material.materials.length;t++)this.material.materials.push(e.material.materials[t])},Qt.prototype.changeMaterialIndex=function(e){for(var t=0;t<this.polygons.length;t++)for(var i=this.polygons[t],r=0;r<i.vertices.length;r++){var a=i.vertices[r];a.materialIndex=a.materialIndex+e}this.front&&this.front.changeMaterialIndex(e),this.back&&this.back.changeMaterialIndex(e)},Se.CSG.Node=Qt,Se.XmlSerializer=function(e,t,i){this.dataBox=e,this.settings=t||new Se.SerializationSettings,this.filterFunction=i,this.ref=0,this.refMap={},this.idMap={},this.xmlString=""},Se.extend(Se.XmlSerializer,Object,{serialize:function(){return this.xmlString="<TGL version='"+Se.version+"' platform='html5'>\n",this.serializeBody(),this.xmlString+="</TGL>\n",this.xmlString},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable&&(this.xmlString+="<dataBox class='"+this.dataBox.getClassName()+"'>\n",this.dataBox.serializeXml(this,this.dataBox.newInstance()),this.xmlString+="</dataBox>\n"),this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(e){this.refMap[e.getId()]=this.ref++,e.getChildren().forEach(this.initRefs,this)},isSerializable:function(e){return!(!this.dataBox.contains(e)||this.filterFunction&&!this.filterFunction(e))},getPropertyType:function(e,t){var i=this.settings.getPropertyType(t);return i||e.__SizePropeties&&-1!=e.__SizePropeties.indexOf(t)&&(i="number"),i},serializeData:function(e){if(this.isSerializable(e)){var t=e.newInstance(),i=this.refMap[e.getId()];this.xmlString+="<data class='"+e.getClassName()+"' ref='"+i+"'",null!=this.settings.getPropertyType("id")&&(this.xmlString+=" id='"+e.getId()+"'"),this.xmlString+=">\n",e.serializeXml(this,t),this.xmlString+="</data>\n"}e.getChildren().forEach(this.serializeData,this)},serializePropertyXml:function(e,t,i){var r=this.getPropertyType(e,t);if(r){var a=Se.getValue(e,t,r),n=Se.getValue(i,t,r);a!==n&&this.serializeValue("p",t,a,n,r)}},serializeStyleXml:function(e,t,i){var r=this.settings.getStyleType(t);if(r){var a=e.getStyle(t),n=i.getStyle(t);a!=n&&this.serializeValue("s",t,a,n,r)}},serializeClientXml:function(e,t,i){var r=this.settings.getClientType(t);if(null!=r){var a=e.getClient(t),n=i.getClient(t);a!=n&&this.serializeValue("c",t,a,n,r)}},serializeValue:function(r,e,t,i,a){if("s"===r&&(t=this.flattenArray(t))instanceof Array&&"string"!==a&&"color"!==a&&"number"!==a&&(a="list."+a,t=new xe(t)),null==t)this.xmlString+="\t<"+r+" n='"+e+"' none=''/>\n";else if("cdata"===a)this.xmlString+="\t<"+r+" n='"+e+"'><![CDATA["+t+"]]></"+r+">\n";else if("data"===a){var n=this.refMap[t.getId()];null!=n&&(this.xmlString+="\t<"+r+" n='"+e+"' ref='"+n+"'/>\n")}else"vec2"===a?i&&t.x===i.x&&t.y===i.y||(this.xmlString+="\t<"+r+" n='"+e+"' x='"+t.x+"' y='"+t.y+"'/>\n"):"vec3"===a?i&&t.x===i.x&&t.y===i.y&&t.z==i.z||(this.xmlString+="\t<"+r+" n='"+e+"' x='"+t.x+"' y='"+t.y+"' z='"+t.z+"'/>\n"):"list.vec2"===a?(this.xmlString+="\t<"+r+" n='"+e+"'>\n",t instanceof Array&&(t=new xe(t)),t.forEach(function(e){if(e instanceof Array){this.xmlString+="\t<"+r+">\n";for(var t=0;t<e.length;t++){var i=e[t];this.xmlString+="\t\t<p x='"+i.x+"' y='"+i.y+"'/>\n"}this.xmlString+="\t</"+r+">\n"}else this.xmlString+="\t\t<p x='"+e.x+"' y='"+e.y+"'/>\n"},this),this.xmlString+="\t</"+r+">\n"):"list.vec3"===a?(this.xmlString+="\t<"+r+" n='"+e+"'>\n",t instanceof Array&&(t=new xe(t)),t.forEach(function(e){if(e instanceof Array){this.xmlString+="\t<"+r+">\n";for(var t=0;t<e.length;t++){var i=e[t];this.xmlString+="\t<"+r+"' x='"+i.x+"' y='"+i.y+"' z='"+i.z+"'/>\n"}this.xmlString+="\t</"+r+">\n"}else this.xmlString+="\t\t<"+r+"' x='"+e.x+"' y='"+e.y+"' z='"+e.z+"'/>\n"},this),this.xmlString+="\t</"+r+">\n"):"list.string"===a||"list.number"===a||"list.color"===a?(this.xmlString+="\t<"+r+" n='"+e+"'>\n",t.forEach(function(e){this.xmlString+="\t\t<s>"+e+"</s>\n"},this),this.xmlString+="\t</"+r+">\n"):this.xmlString+="\t<"+r+" n='"+e+"'>"+t+"</"+r+">\n"},flattenArray:function(e){if(e instanceof Array){for(var t=0;t<e.length-1;t++)if(e[t]!=e[t+1]){if(!e[t]||!e[t].equals)return e;if(!e[t].equals(e[t+1]))return e}return e[0]}return e},deserialize:function(e,t){Se.isDeserializing=!0,this.xmlString=e;var i=Se.xml(e).documentElement;this.refMap={},this.idMap={};var r,a,n,o=new xe,s=new xe,l=i.getElementsByTagName("data"),h=l.length;for(n=0;n<h;n++){var c=(a=l[n]).getAttribute("class"),u=this.settings.getPropertyType("id");if(u&&a.hasAttribute("id")){var f=null;if("string"===u)f=a.getAttribute("id");else if("int"===u)f=parseInt(a.getAttribute("id"));else{if("number"!==u)throw"Unsupported id type '"+u+"'";f=parseFloat(a.getAttribute("id"))}if("remove"===a.getAttribute("action")){this.dataBox.removeById(f);continue}(r=this.dataBox.getDataById(f))||(r=Se.newInstance(c,f))}else r=Se.newInstance(c);if(a.hasAttribute("ref")){var p=a.getAttribute("ref");this.refMap[p]=r}o.add(r),s.add(a),this.idMap[r.getId()]=r}for(this.dataBox.forEach(function(e){this.idMap[e.getId()]=e},this),h=o.size(),n=0;n<h;n++)r=o.get(n),this.dataBox.containsById(r.getId())||(t&&!r.getParent()&&r.setParent(t),this.dataBox.add(r));for(n=0;n<h;n++)r=o.get(n),a=s.get(n),r.deserializeXml(this,a);this.settings.isDataBoxSerializable&&1===i.getElementsByTagName("dataBox").length&&this.dataBox.deserializeXml(this,i.getElementsByTagName("dataBox")[0]),Se.isDeserializing=!1},deserializePropertyXml:function(e,t,i){var r=this.getPropertyType(e,i);r&&Se.setValue(e,i,this.deserializeValue(t,r))},deserializeStyleXml:function(e,t,i){var r=this.settings.getStyleType(i);r&&e.setStyle(i,this.deserializeValue(t,r))},deserializeClientXml:function(e,t,i){var r=this.settings.getClientType(i);r&&e.setClient(i,this.deserializeValue(t,r))},deserializePoint:function(e){var t=e.getAttribute("x")?parseFloat(e.getAttribute("x")):null,i=e.getAttribute("a")?parseFloat(e.getAttribute("a")):null;if(null!=t){var r=e.getAttribute("y")?parseFloat(e.getAttribute("y")):null,a=e.getAttribute("z")?parseFloat(e.getAttribute("z")):null,n=e.getAttribute("w")?parseFloat(e.getAttribute("w")):null;return null!=n?new Se.Vec4(t,r,a,n):null!=a?new Se.Vec3(t,r,a):new Se.Vec2(t,r)}if(null!=i){var o=e.getAttribute("b")?parseFloat(e.getAttribute("b")):null,s=e.getAttribute("c")?parseFloat(e.getAttribute("c")):null,l=e.getAttribute("d")?parseFloat(e.getAttribute("d")):null;return null!=l?new Se.Face4(i,o,s,l):new Se.Face3(i,o,s)}return null},arrayStyleValue:function(e,t){var i=[];if(e.indexOf(",")){if(i=e.split(","),"string"===t)return i;if("number"===t){for(var r=[],a=0;a<i.length;a++)r.push(parseFloat(i[a]));return r}if("color"===t){var n=[];for(a=0;a<i.length;a++)n.push(new Se.Color(i[a]));return n}}},deserializeValue:function(e,t,i){if(e.hasAttribute("@none"))return null;var r,a,n,o,s="s"===e.nodeName,l=s&&-1!==e.textContent.indexOf(",");if("string"===t)return l?this.arrayStyleValue(e.textContent,t):e.textContent;if("color"===t)return l?this.arrayStyleValue(e.textContent,t):e.textContent;if("number"===t)return l?this.arrayStyleValue(e.textContent,t):parseFloat(e.textContent);if("boolean"===t)return"true"===e.textContent;if("int"===t)return parseInt(e.textContent);if("point"===t)return this.deserializePoint(e);if("vec2"===t){var h=parseFloat(e.getAttribute("x")),c=parseFloat(e.getAttribute("y"));if(!isNaN(h)&&!isNaN(c)||!s)return new Se.Vec2(h,c);t="list.point"}if("vec3"===t){h=parseFloat(e.getAttribute("x")),c=parseFloat(e.getAttribute("y"));var u=parseFloat(e.getAttribute("z"));return new Se.Vec3(h,c,u)}if("data"===t){var f=e.getAttribute("ref");return this.refMap[f]||this.idMap[f]}if("list.point"===t){var p=new xe,d=e.getElementsByTagName("p");for(r=d.length,o=0;o<r;o++){var m=d[o];p.add(this.deserializePoint(m))}return s?p._as:p}if("list.string"===t){var g=new xe;for(r=(n=e.getElementsByTagName("s")).length,o=0;o<r;o++)g.add(n[o].textContent);return g}if("list.number"===t){for(a=new xe,r=(n=e.getElementsByTagName("s")).length,o=0;o<r;o++)a.add(parseFloat(n[o].textContent));return a}if("array.string"===t)return e.textContent.split(",");if("array.number"===t){for(r=(a=e.textContent.split(",")).length,o=0;o<r;o++)a[o]=parseFloat(a[o]);return a}return"rectangle"===t?{x:parseFloat(e.getAttribute("x")),y:parseFloat(e.getAttribute("y")),width:parseFloat(e.getAttribute("w")),height:parseFloat(e.getAttribute("h"))}:e.textContent}}),Se.addMethod(Se.Data,{serializeXml:function(e,t){var i,r;if(this.__SizePropeties&&this.__SizePropeties.length)for(i=0,r=this.__SizePropeties.length;i<r;i++)this.serializePropertyXml(e,this.__SizePropeties[i],t);else this.serializePropertyXml(e,"materialSize",t),this.vertices&&this.vertices.length&&this.serializePropertyXml(e,"vertices",t),this.faces&&this.faces.length&&this.serializePropertyXml(e,"faces",t),this.uvs&&this.uvs.length&&this.serializePropertyXml(e,"uvs",t);if(e.settings.isClientSerializable&&this._clientMap)for(var a in this._clientMap)this.serializeClientXml(e,a,t);this.serializePropertyXml(e,"name",t),this.serializePropertyXml(e,"parent",t)},serializePropertyXml:function(e,t,i){e.serializePropertyXml(this,t,i)},serializeClientXml:function(e,t,i){e.serializeClientXml(this,t,i)},deserializeXml:function(e,t){var i,r,a,n,o=t.getElementsByTagName("p"),s=o.length;for(i=0;i<s;i++)(r=o[i]).hasAttribute("n")&&this.deserializePropertyXml(e,r,r.getAttribute("n"));if(e.settings.isClientSerializable)for(s=(a=t.getElementsByTagName("c")).length,i=0;i<s;i++)(n=a[i]).hasAttribute("n")&&this.deserializeClientXml(e,n,n.getAttribute("n"))},deserializePropertyXml:function(e,t,i){e.deserializePropertyXml(this,t,i)},deserializeClientXml:function(e,t,i){e.deserializeClientXml(this,t,i)}}),Se.addMethod(Se.Element,{serializeXml:function(i,e){if(i.settings.isStyleSerializable&&this.styleMap)for(var t in this.styleMap)this.isSideStyle(t)||this.serializeStyleXml(i,t,e);this.serializePropertyXml(i,"position",e),this.serializePropertyXml(i,"rotation",e),this.serializePropertyXml(i,"scale",e),Se.Element.superClass.serializeXml.call(this,i,e),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===i.settings.getPropertyType("alarmState")&&(i.xmlString+="\t<p n='alarmState'>\n",Se.AlarmSeverity.forEach(function(e){var t=this.getNewAlarmCount(e);0<t&&(i.xmlString+="\t\t<n n='"+e.name+"' c='"+t+"'/>\n")},this._alarmState),Se.AlarmSeverity.forEach(function(e){var t=this.getAcknowledgedAlarmCount(e);0<t&&(i.xmlString+="\t\t<a n='"+e.name+"' c='"+t+"'/>\n")},this._alarmState),i.xmlString+="\t</p>\n")},serializeStyleXml:function(e,t,i){e.serializeStyleXml(this,t,i)},deserializeXml:function(e,t){if(Se.Element.superClass.deserializeXml.call(this,e,t),e.settings.isStyleSerializable){var i,r,a=t.getElementsByTagName("s"),n=a.length;for(i=0;i<n;i++)(r=a[i]).hasAttribute("n")&&this.deserializeStyleXml(e,r,r.getAttribute("n"))}},deserializeStyleXml:function(e,t,i){e.deserializeStyleXml(this,t,i)},deserializePropertyXml:function(e,t,i){if("alarmState"===i){if("alarmstate"===e.settings.getPropertyType("alarmState")){var r,a,n,o=t.getElementsByTagName("n");for(a=0;a<o.length;a++)n=o[a],r=mono.AlarmSeverity.getByName(n.getAttribute("n")),this._alarmState.setNewAlarmCount(r,parseInt(n.getAttribute("c")));for(o=t.getElementsByTagName("a"),a=0;a<o.length;a++)n=o[a],r=mono.AlarmSeverity.getByName(n.getAttribute("n")),this._alarmState.setAcknowledgedAlarmCount(r,parseInt(n.getAttribute("c")))}}else Se.Element.superClass.deserializePropertyXml.call(this,e,t,i)}}),Se.addMethod(Se.DataBox,{serializeXml:function(e,t){if(e.settings.isClientSerializable&&this._clientMap)for(var i in this._clientMap)this.serializeClientXml(e,i,t);this.serializePropertyXml(e,"name",t)},serializePropertyXml:function(e,t,i){e.serializePropertyXml(this,t,i)},serializeClientXml:function(e,t,i){e.serializeClientXml(this,t,i)},deserializeXml:function(e,t){var i,r,a,n,o=t.getElementsByTagName("p"),s=o.length;for(i=0;i<s;i++)(r=o[i]).hasAttribute("n")&&this.deserializePropertyXml(e,r,r.getAttribute("n"));if(e.settings.isClientSerializable)for(s=(a=t.getElementsByTagName("c")).length,i=0;i<s;i++)(n=a[i]).hasAttribute("n")&&this.deserializeClientXml(e,n,n.getAttribute("n"))},deserializePropertyXml:function(e,t,i){e.deserializePropertyXml(this,t,i)},deserializeClientXml:function(e,t,i){e.deserializeClientXml(this,t,i)}}),Se.JsonSerializer=function(e,t,i){this.dataBox=e,this.settings=t||new Se.SerializationSettings,this.filterFunction=i,this.ref=0,this.refMap={},this.idMap={},this.jsonObject={}},Se.extend(Se.JsonSerializer,Object,{constructor:Se.JsonSerializer,className:"TGL.JsonSerializer",serialize:function(){return this.jsonObject={v:Se.version,platform:"html5"},this.serializeBody(),JSON.stringify(this.jsonObject)},serializeBody:function(){if(this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable){var e={class:this.dataBox.getClassName(),p:{},s:{},c:{}};this.jsonObject.dataBox=e,this.dataBox.serializeJson(this,this.dataBox.newInstance(),e),je.isEmptyObject(e.p)&&delete e.p,je.isEmptyObject(e.s)&&delete e.s,je.isEmptyObject(e.c)&&delete e.c}this.jsonObject.datas=[],this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(e){if(this.refMap[e.getId()]=this.ref++,e.getChildren().forEach(this.initRefs,this),e instanceof Se.ComboNode)for(var t=0;t<e.combos.length;t++){var i=e.combos[t];this.refMap[i.getId()]||(this.refMap[i.getId()]=this.ref++)}},isSerializable:function(e){return!(!this.dataBox.contains(e)||this.filterFunction&&!this.filterFunction(e))},serializeData:function(e){if(this.isSerializable(e)){var t=e.newInstance(),i=this.refMap[e.getId()],r={class:e.getClassName(),ref:i,p:{},s:{},c:{}};this.settings.getPropertyType("id")&&(this.jsonObject.id=e.getId()),this.jsonObject.datas.push(r),e.serializeJson(this,t,r),je.isEmptyObject(r.p)&&delete r.p,je.isEmptyObject(r.s)&&delete r.s,je.isEmptyObject(r.c)&&delete r.c}e.getChildren().forEach(this.serializeData,this)},serializeDataValue:function(e){var t=e.newInstance(),i=this.refMap[e.getId()],r={class:e.getClassName(),ref:i,p:{},s:{},c:{}};return e.serializeJson(this,t,r),je.isEmptyObject(r.p)&&delete r.p,je.isEmptyObject(r.s)&&delete r.s,je.isEmptyObject(r.c)&&delete r.c,r},getPropertyType:function(e,t){var i=this.settings.getPropertyType(t);return i||(e.__bool&&-1!=e.__bool.indexOf(t)?i="boolean":e.__SizePropeties&&-1!=e.__SizePropeties.indexOf(t)&&(i="number")),i},getStyleType:function(e,t){return e.isSideStyle(t)&&(t=t.substr(t.indexOf(".")+1)),this.settings.getStyleType(t)},serializePropertyJson:function(e,t,i,r){var a=this.getPropertyType(e,t);if(a){var n=Se.getValue(e,t,a),o=Se.getValue(i,t,a);n!==o&&(n&&n.equals?!n.equals(o)&&this.serializeValue(t,n,o,a,r.p):this.serializeValue(t,n,o,a,r.p))}},serializeStyleJson:function(e,t,i,r){var a=this.getStyleType(e,t);if(a){var n=e.getStyle(t),o=i.getStyle(t);t.startsWith("m.")&&(n=this.flattenArray(n),o=this.flattenArray(o)),t.endsWith(".image")&&(n=this.encodeURI(n),o=this.encodeURI(o)),n!=o&&(n&&n.equals?!n.equals(o)&&this.serializeValue(t,n,o,a,r.s):this.serializeValue(t,n,o,a,r.s))}},serializeClientJson:function(e,t,i,r){var a=this.settings.getClientType(t);if(null!=a){var n=e.getClient(t),o=i.getClient(t);n!=o&&(n&&n.equals?!n.equals(o)&&this.serializeValue(t,n,o,a,r.c):this.serializeValue(t,n,o,a,r.c))}},serializeValue:function(e,t,i,r,a){if(null==t)a[e]=null;else if(t instanceof xe)a[e]=t._as;else if("data"===r){var n=this.refMap[t.getId()];null!=n&&(a[e]=n)}else if("data.list"===r){for(var o=[],s=0;s<t.length;s++)o.push(this.serializeDataValue(t[s]));a[e]=o}else if("serializeabe.list"===r){for(o=[],s=0;s<t.length;s++)o.push(t[s].serializeJsonValue());a[e]=o}else t.serializeJsonValue?a[e]=t.serializeJsonValue():a[e]=t},deserialize:function(e,t){Se.isDeserializing=!0,this.jsonObject=JSON.parse(e),this.refMap={},this.idMap={};var i,r=new xe,a=new xe,n=this.jsonObject.datas.length;null!=this.deserializeStartCreateData&&this.deserializeStartCreateData(n);for(var o=0;o<n;o++){var s=this.jsonObject.datas[o],l=s.class;if(this.settings.getPropertyType("id")&&null!=s.id){if("remove"===s.action){this.dataBox.removeById(s.id);continue}(i=this.dataBox.getDataById(s.id))||(i=Se.newInstance(l,s.id))}else i=Se.newInstance(l);null!=s.ref&&(this.refMap[s.ref]=i),r.add(i),a.add(s),this.idMap[i.getId()]=i,this.deserializeCreateData&&this.deserializeCreateData(o,n)}for(this.dataBox.forEach(function(e){this.idMap[e.getId()]=e},this),n=r.size(),this.deserializeStartFillData&&this.deserializeStartFillData(n),o=0;o<n;o++)(i=r.get(o)).deserializeJson(this,a.get(o)),this.deserializeFillData&&this.deserializeFillData(o,n);for(this.deserializeStartAddData&&this.deserializeStartAddData(n),o=0;o<n;o++)i=r.get(o),this.dataBox.containsById(i.getId())||(t&&!i.getParent()&&i.setParent(t),"TGL.Entity"===i.getClassName()&&(i.computed=!1,i.computeNodeData()),this.dataBox.add(i),this.deserializeAddData&&this.deserializeAddData(o,n));this.settings.isDataBoxSerializable&&this.jsonObject.dataBox&&this.dataBox.deserializeJson(this,this.jsonObject.dataBox),Se.isDeserializing=!1},deserializePropertyJson:function(e,t,i){var r=this.getPropertyType(e,i);r&&Se.setValue(e,i,this.deserializeValue(t,r))},deserializeStyleJson:function(e,t,i){var r=this.getStyleType(e,i);if(r){var a=this.deserializeValue(t,r);a._as&&(a=a._as),e.setStyle(i,a)}},deserializeClientJson:function(e,t,i){var r=this.settings.getClientType(i);r&&e.setClient(i,this.deserializeValue(t,r))},getClassName:function(e){if(null!=e)return e.class?e.class:e.w!==Me&&e.x!==Me&&e.y!==Me&&e.z!==Me?"TGL.Vec4":e.x!==Me&&e.y!==Me&&e.z!==Me?"TGL.Vec3":e.x!==Me&&e.y!==Me?"TGL.Vec2":e.a!==Me&&e.b!==Me&&e.c!==Me&&e.d!==Me?"TGL.Face4":e.a!==Me&&e.b!==Me&&e.c!==Me?"TGL.Face3":void 0},translateJson:function(e){if(null!=e){if(null!=this.getClassName(e)){var t=Se.newInstance(this.getClassName(e));if(t.deserializeJsonValue)t.deserializeJsonValue(e);else for(var i in e)t[i]=e[i];return t}if(e instanceof Array)for(var r=0;r<e.length;r++)e[r]=this.translateJson(e[r]);return e}},isChinese:function(e){return e=e||"",0<escape(e).indexOf("%u")},encodeURI:function(e){if(e instanceof Array){for(var t=0;t<e.length;t++)e[t]=this.encodeURI(e[t]);return e}return"string"==typeof e&&this.isChinese(e)?encodeURI(e):e},flattenArray:function(e){if(e instanceof Array){for(var t=0;t<e.length-1;t++)if(e[t]!=e[t+1]){if(!e[t]||!e[t].equals)return e;if(!e[t].equals(e[t+1]))return e}return e[0]}return e},deserializeValue:function(e,t){if("data"===t)return this.refMap[e]||this.idMap[e];if("data.list"===t){for(var i,r,a=[],n=0;n<e.length;n++)i=e[n],r=Se.newInstance(i.class),null!=i.ref&&(this.refMap[i.ref]=r),r.deserializeJson(this,i),a.push(r);return a}if("color"===t&&e.r!=Me){var o=new Se.Color;return o.setRGB(e.r,e.g,e.b),o}if("TGL.Path"===e.class){var s=new Se.Path;return s.deserializeJsonValue(e),s}if(e instanceof Array){for(n=0;n<e.length;n++)e[n]=this.translateJson(e[n]);return e}return null!=this.getClassName(e)?this.translateJson(e):e}}),Se.addMethod(Se.DataBox,{serializeJson:function(e,t,i){if(e.settings.isClientSerializable&&this._clientMap)for(var r in this._clientMap)this.serializeClientJson(e,r,t,i);this.serializePropertyJson(e,"name",t,i)},serializePropertyJson:function(e,t,i,r){e.serializePropertyJson(this,t,i,r)},serializeClientJson:function(e,t,i,r){e.serializeClientJson(this,t,i,r)},deserializeJson:function(e,t){var i;for(i in t.p)this.deserializePropertyJson(e,t.p[i],i);if(e.settings.isClientSerializable)for(i in t.c)this.deserializeClientJson(e,t.c[i],i)},deserializePropertyJson:function(e,t,i){e.deserializePropertyJson(this,t,i)},deserializeClientJson:function(e,t,i){e.deserializeClientJson(this,t,i)}}),Se.addMethod(Se.Data,{serializeJson:function(e,t,i){var r,a;if(!this.__SizePropeties||!this.__SizePropeties.length||this instanceof Se.Entity)this.materialSize&&this.serializePropertyJson(e,"materialSize",t,i),this instanceof Se.Entity&&(this.vertices&&this.vertices.length&&this.serializePropertyJson(e,"vertices",t,i),this.faces&&this.faces.length&&this.serializePropertyJson(e,"faces",t,i),this.uvs&&this.uvs.length&&this.serializePropertyJson(e,"uvs",t,i),this.uv2s&&this.uv2s.length&&this.serializePropertyJson(e,"uv2s",t,i));else for(r=0,a=this.__SizePropeties.length;r<a;r++)this.serializePropertyJson(e,this.__SizePropeties[r],t,i);if(e.settings.isClientSerializable&&this._clientMap)for(var n in this._clientMap)this.serializeClientJson(e,n,t,i);this.serializePropertyJson(e,"name",t,i),this.serializePropertyJson(e,"parent",t,i)},serializePropertyJson:function(e,t,i,r){e.serializePropertyJson(this,t,i,r)},serializeClientJson:function(e,t,i,r){e.serializeClientJson(this,t,i,r)},deserializeJson:function(e,t){var i;for(i in t.p)this.deserializePropertyJson(e,t.p[i],i);if(e.settings.isClientSerializable)for(i in t.c)this.deserializeClientJson(e,t.c[i],i)},deserializePropertyJson:function(e,t,i){e.deserializePropertyJson(this,t,i)},deserializeClientJson:function(e,t,i){e.deserializeClientJson(this,t,i)}}),Se.addMethod(Se.Element,{serializeJson:function(e,t,i){if(e.settings.isStyleSerializable&&this.styleMap)for(var r in this.styleMap)this.isSideStyle(r)||this.serializeStyleJson(e,r,t,i);if(Se.Element.superClass.serializeJson.call(this,e,t,i),this.serializePropertyJson(e,"position",t,i),this.serializePropertyJson(e,"rotation",t,i),this.serializePropertyJson(e,"scale",t,i),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===e.settings.getPropertyType("alarmState")){var a={n:{},a:{}};i.p.alarmState=a,Se.AlarmSeverity.forEach(function(e){var t=this.getNewAlarmCount(e);0<t&&(a.n[e.name]=t)},this._alarmState),Se.AlarmSeverity.forEach(function(e){var t=this.getAcknowledgedAlarmCount(e);0<t&&(a.a[e.name]=t)},this._alarmState),je.isEmptyObject(a.n)&&delete a.n,je.isEmptyObject(a.a)&&delete a.a,je.isEmptyObject(a)&&delete i.p.alarmState}},serializeStyleJson:function(e,t,i,r){e.serializeStyleJson(this,t,i,r)},deserializeJson:function(e,t){if(Se.Element.superClass.deserializeJson.call(this,e,t),e.settings.isStyleSerializable)for(var i in t.s)this.deserializeStyleJson(e,t.s[i],i)},deserializeStyleJson:function(e,t,i){e.deserializeStyleJson(this,t,i)},deserializePropertyJson:function(e,t,i){if("alarmState"===i){if("alarmstate"===e.settings.getPropertyType("alarmState")){var r;for(r in t.n)this._alarmState.setNewAlarmCount(mono.AlarmSeverity.getByName(r),t.n[r]);for(r in t.a)this._alarmState.setAcknowledgedAlarmCount(mono.AlarmSeverity.getByName(r),t.a[r])}}else Se.Element.superClass.deserializePropertyJson.call(this,e,t,i)}}),Se.addMethod(Se.Light,{serializeJson:function(e,t,i){if(Se.Light.superClass.serializeJson.call(this,e,t,i),this.serializePropertyJson(e,"color",t,i),this.serializePropertyJson(e,"ambient",t,i),this.serializePropertyJson(e,"diffuse",t,i),this.serializePropertyJson(e,"specular",t,i),this.serializePropertyJson(e,"castShadow",t,i),this.serializePropertyJson(e,"onlyShadow",t,i),t.__accessor&&t.__accessor.length)for(var r=0;r<t.__accessor.length;r++)this.serializePropertyJson(e,t.__accessor[r],t,i)}});var Kt=Se.Animate=function(e){var t=this;t.type=null==e.type?"number":e.type,t.delay=null==e.delay?0:e.delay,t.dur=null==e.dur?1e3:e.dur,t.interval=null==e.interval?0:e.interval,t.finish=null==e.finish?t.delay+t.dur+t.interval:e.finish,t.repeat=null==e.repeat?1:e.repeat,t.reverse=null==e.reverse||e.reverse,t.easing=null==e.easing?"easeNone":e.easing,t.onUpdate=e.onUpdate,t.onDone=e.onDone,t.onStop=e.onStop,t.onPlay=e.onPlay,t.attr=e.attr,t.source=e.source,t.filter=e.filter,t.from=e.from,t.to=e.to,t.start=null,t.time=0,t.total=0,t.count=0,t.started=!1,t.stopped=!1,t.id=$t++};Se.extend(Se.Animate,Object,{play:function(){return F(this)},stop:function(e){return U(this,e)},clone:function(){return new Kt(this)},chain:function(e){var t,i=this;return i.onDone?(t=i.onDone,i.onDone=function(){t.call(i),e.play()}):i.onDone=function(){e.play()},i}});var Jt={},$t=1,ei=!1;if(function e(t){requestAnimationFrame(e),ei&&(ei=!1,k(t))}(0),!q.make){var ti={},ii={},ri=[],ai={};(ni=q.make={}).Default={path:"./",resPath:"",getImagePath:function(e){return this.path+this.resPath+"res/images/"+(e||"")},register:function(e,t,i){(i=i||{}).name=i.name||e,i.modelDefaultParameters=i.modelDefaultParameters||{},i.description=i.description||i.name,ti[e]&&console.log(e," already exist"),ti[e]=t;var r=i.category||"",a=ii[r]||{};a[e]=t,ii[r]=a,ai[e]=i,-1==ri.indexOf(r)&&ri.push(r),this.checkModelDefaultParameters(i.modelDefaultParameters)},checkModelDefaultParameters:function(e){if(e)for(var t in e){var i=e[t];i instanceof Object||(i={value:i},e[t]=i),i.propertyName=t,i.hidden=!!i.hidden,i.propertyType=i.propertyType||ni.Default.PARAMETER_PROPERTY_TYPE_FIELD,i.type=i.type||ni.Default.PARAMETER_TYPE_STRING,i.category=i.category||ni.Default.PARAMETER_CATEGORY_DETAIL,i.editable=i.editable===Me||!!i.editable,i.index=i.index===Me?100:parseInt(i.index)}},remove:function(e){if(ti[e]){ti[e]=Me,delete ti[e];var t=ni.Default.getCategory(e),i=ii[t];delete i[e];var r=0;for(var a in i)a&&r++;if(0==r)for(a=0;a<ri.length;a++){var n=ri.indexOf(t);0<=n&&ri.splice(n,1)}delete ai[e]}else console.log(e," not exist")},getCategories:function(){return ri},getCreatorsForCategory:function(e){return ii[e]},getCreator:function(e){return ti[e]},getIds:function(e){var t=[];for(var i in ti)(!e||e&&e(this.getParameters(i)))&&t.push(i);return t},getModelDefaultParameters:function(e){return this.getParameters(e).modelDefaultParameters},getDescription:function(e){return this.getParameters(e).description},getName:function(e){return this.getParameters(e).name},getIcon:function(e){var t=this.getParameters(e);return this.path+t.icon},isAsync:function(e){return this.getParameters(e).async},isCombo:function(e){return this.getParameters(e).combo},getCategory:function(e){return this.getParameters(e).category},getOrder:function(e){return this.getParameters(e).order||0},getType:function(e){return this.getParameters(e).type},getOtherParameter:function(e,t){return this.getParameters(e)[t]},registerIcon:function(e,t){var i=this.getParameters(e);if(i)return i.icon=t,i.icon},registerDescription:function(e,t){var i=this.getParameters(e);return i.description=t,i.description},registerName:function(e,t){var i=this.getParameters(e);return i.name=t,i.name},registerOther:function(e,t,i){var r=a[t],a=this.getParameters(e);return a[t]=i,"modelDefaultParameters"===t&&(console.warn("rewrite modelDefaultParameters: id={0}, oldValue={}, newValue={}",e,r,i),this.checkModelDefaultParameters(i)),r},appendModelDefaultParameter:function(e,t,i,r,a,n,o){},getParameters:function(e){return ai[e]||{}},load:function(n,o,e){var t,i=(e=e||{}).isRelation;if(o){var r=o;o=function(e){i&&n instanceof Array&&1<n.length&&e instanceof Array&&1<e.length&&this._relation(n,e),r(e)}}if(n instanceof Array){var s={};if(o){for(a=s._total=0;a<n.length;a++)l=n[a],this.load(l,function(e){var t,i,r,a;s._total++,t=s,i=e,a=n.length,r=i,t.datas=t.datas||[],t.datas.push(r),t._total===a&&o(t.datas)});return null}t=[];for(var a=0;a<n.length;a++){var l=n[a],h=this.load(l);h&&t.push(h)}}else{var c={};"string"==typeof n?c.id=n:c=n,c=this.filterJson(c),o?this._load(c,o):t=this._load(c)}return i&&t instanceof Array&&1<t.length&&this._relation(n,t),t},_relation:function(e,t){var i={};t.forEach(function(e){e.getId&&(i[e.getId()]=e)}),e.forEach(function(e){e.objectId&&e.parentId&&i[e.objectId]&&i[e.parentId]&&i[e.objectId].setParent&&i[e.objectId].setParent(i[e.parentId])})},_load:function(e,t){var i=e.id,r=this.getCreator(i);if(!r)return console.log("unknown id: ",i),null;if(!t){var a=r(e);return ni.Default._setObjectClientId(a,i),a}r(e,function(e){ni.Default._setObjectClientId(e,i),t&&t(e)})},_setObjectClientId:function(e,t){e&&e.setClient&&e.setClient("id",t)},copyArray:function(e,t,i){if(t=[],e)for(var r,a=0,n=e.length;a<n;a++)r={},this.copyProperties(e[a],r),t.push(r);return t},copyProperties:function(e,t,i){if(e&&t)for(var r in e)i&&0<=i.indexOf(r)||0==r.indexOf("_")||(t[r]===Me&&(e[r]instanceof Array?t[r]=[]:e[r]instanceof Function?t[r]=e[r]:e[r]instanceof Object?t[r]={}:t[r]=e[r]),!(e[r]instanceof Function)&&e[r]instanceof Object&&t[r]instanceof Object&&ni.Default.copyProperties(e[r],t[r]))},getModelDefaultParametersValues:function(e,t){var i=this.getModelDefaultParameters(e),r={};for(var a in i){var n=i[a];t&&t(n)||(n.propertyType==ni.Default.PARAMETER_PROPERTY_TYPE_CLIENT?(r.client=r.client||{},r.client[a]=n.value):n.propertyType==ni.Default.PARAMETER_PROPERTY_TYPE_STYLE?(r.style=r.style||{},r.style[a]=n.value):r[a]=n.value)}return r},getModelDefaultParameterProperties:function(e,t){var i=this,r=[],a=this.getModelDefaultParameters(e);if(!a)return r;for(var n in t&&!a.id&&(a.id={propertyName:"id",name:"模型ID",category:ni.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:ni.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-2}),t&&!a.objectId&&(a.objectId={propertyName:"objectId",name:"实例ID",category:ni.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:ni.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-1}),a)r.push(a[n]);return r.sort(function(e,t){return e.index-t.index}),r.map(function(e){return i.modelParameterToProperty(e)})},_getNameFromPropertyName:function(e){for(var t=e.split("."),i="",r=0;r<t.length;r++)0<t[r].length&&(i+=t[r].substring(0,1).toUpperCase()+t[r].substring(1,t[r].length)),r<t.length-1&&(i+=" ");return i},modelParameterToProperty:function(e){var t=new twaver.Property;return t.setCategoryName(e.category),e.name||(e.name=this._getNameFromPropertyName(e.propertyName)),t.setName(e.name),t.setEditable(e.editable),t.setPropertyType(e.propertyType),t.setPropertyName(e.propertyName),t.setValueType(e.type),t.setEnumInfo(e.enumInfo),t.isVisible=function(){return!e.hidden},t},filterJson:function(e){var t=this.getModelDefaultParameters(e.id);for(var i in t){var r=t[i].propertyType||"client",a=t[i].value;r==ni.Default.PARAMETER_PROPERTY_TYPE_STYLE?e.style&&e.style[i]!==Me||(e.style=e.style||{},e.style[i]=a):r==ni.Default.PARAMETER_PROPERTY_TYPE_CLIENT?e.client&&e.client[i]!==Me||(e.client=e.client||{},e.client[i]=a):e[i]===Me&&(e[i]=a)}return e},UNIT_HEIGHT:4.445,EQUIPMENT_WIDTH:45.5,RACK_OFFSET_X:7.25,RACK_OFFSET_Y:6.655,RACK_WIDTH:60,getUnitHeight:function(){return this.UNIT_HEIGHT},getEquipmentWidth:function(){return this.EQUIPMENT_WIDTH},getEquipmentHeight:function(e){return 0<parseInt(e)||console.error("method getEquipmentHeight's first argument scale value is zero"),this.UNIT_HEIGHT*e},getRackWidth:function(){return this.RACK_WIDTH},getRackHeight:function(e){return 0<parseInt(e)||console.error("method getRackHeight's first argument scale value is zero"),this.RACK_OFFSET_Y+this.UNIT_HEIGHT*parseInt(e)+this.RACK_OFFSET_Y}},ni.Default.toJson=function(e,t){if(e&&e.getClient){var i=e.getClient("id"),r=ni.Default.getModelDefaultParameters(i),a={},n=null,o=null;for(var s in r)if(!1!==r[s].exportable){var l=r[s].propertyType;o=r[s].value;l==ni.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR?(n=e[_twaver.getter(s)](),ni.Default.equals(n,o)||(a[s]=n)):l==ni.Default.PARAMETER_PROPERTY_TYPE_FIELD?(n=e[s],ni.Default.equals(n,o)||(a[s]=n)):l==ni.Default.PARAMETER_PROPERTY_TYPE_STYLE?(n=e.getStyle(s),ni.Default.equals(n,o)||(a.style=a.style||{},a.style[s]=n)):l==ni.Default.PARAMETER_PROPERTY_TYPE_CLIENT&&(n=e.getClient(s),ni.Default.equals(n,o)||(a.client=a.client||{},a.client[s]=n))}return a.id=i,ni.Default.EXPORT_OBJECT_ID&&(a.objectId=e.getId()),t&&(a=t(a)),a}return t&&(e=t(e)),e},ni.Default.copy=function(e,t,i,r,a){!function(e,r,a,t,i){i=i||{};var n={},o={},s=ni.Default.getParameters(r);if(s=ni.Default.clone(s),ni.Default.copyProperties(s,o),t instanceof Function?n=t(o)||{}:ni.Default.copyProperties(t,n),i.copyDefaultParamCoverage&&delete o.modelDefaultParameters,i.copyParamCoverage||ni.Default.copyProperties(o,n),i.defaultValue&&n.modelDefaultParameters)for(var l in i.defaultValue)n.modelDefaultParameters[l]!==Me&&(n.modelDefaultParameters[l]instanceof Object?n.modelDefaultParameters[l].value=i.defaultValue[l]:n.modelDefaultParameters[l]=i.defaultValue[l]);ni.Default.register(e,function(e,t){var i={id:r};return a instanceof Function?a(e):ni.Default.copyProperties(a,i),ni.Default.copyProperties(e,i),ni.Default.load(i,t)},n)}(e,t,i,r,a)},ni.Default.PARAMETER_CATEGORY_BASIC="BASIC",ni.Default.PARAMETER_CATEGORY_DETAIL="Detail",ni.Default.PARAMETER_TYPE_STRING="string",ni.Default.PARAMETER_TYPE_BOOLEAN="boolean",ni.Default.PARAMETER_TYPE_COLOR="color",ni.Default.PARAMETER_TYPE_INT="int",ni.Default.PARAMETER_TYPE_NUMBER="number",ni.Default.PARAMETER_TYPE_IMAGE="image",ni.Default.PARAMETER_TYPE_ARRAY_STRING="array.string",ni.Default.PARAMETER_TYPE_ARRAY_NUMBER="array.number",ni.Default.PARAMETER_TYPE_ARRAY_INT="array.int",ni.Default.PARAMETER_PROPERTY_TYPE_FIELD="field",ni.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR="accessor",ni.Default.PARAMETER_PROPERTY_TYPE_STYLE="style",ni.Default.PARAMETER_PROPERTY_TYPE_CLIENT="client",String.prototype.replaceAll=function(e,t,i){return RegExp.prototype.isPrototypeOf(e)?this.replace(e,t):this.replace(new RegExp(e,i?"gi":"g"),t)},String.prototype.format=function(e){var i=this;if(1<arguments.length){for(var t=[],r=0;r<arguments.length;r++)t.push(arguments[r]);e=t}if(e)if(e instanceof Array)e.forEach(function(e,t){e instanceof Object&&(e=JSON.stringify(e)),i=i.replaceAll("{"+t+"}",e)});else{if(!(e instanceof Object))return i.replaceAll("{}",e);for(var a in e){var n=e[a];n instanceof Object&&(n=JSON.stringify(n)),i=i.replaceAll("{"+a+"}",n)}}return i},ni.Default.getId=function(e){return e.getClient("id")},ni.Default.objectWrapper=function(i,r,t,a){Object.defineProperty(i,r,{get:function(){var e=i["___"+r];return t&&(e=t.call(i,e,i,r)),e},set:function(e){var t=i[r];a&&(e=a.call(i,e,i,r)),t!==e&&(i["___"+r]=e,this.firePropertyChange&&this.firePropertyChange(r,t,e))}})},ni.Default.equals=function(e,t){return e instanceof Object&&t instanceof Object?JSON.stringify(e)==JSON.stringify(t):e==t},ni.Default.clone=function(t){try{return JSON.parse(JSON.stringify(t))}catch(e){throw console.error(e,t),e}},ni.Default.EXPORT_OBJECT_ID=!0}var ni=q.make;for(var wt in mono.Element.prototype.direction2=function(e){var t=e.applyMatrix4((new mono.Mat4).extractRotation(this.matrix));return t.normalize(),t},ni.Utils3D={positionFloor:"floor-top",_objMap:{},_objObject:{},_envMaps:{envmap:"envmap.jpg",envmap1:"envmap1.jpg",envmap2:"envmap2.jpg",envmap3:"envmap3.jpg",envmap4:"envmap4.jpg",envmap5:"envmap5.jpg",envmap6:"envmap6.jpg"},getEnvMap:function(e){var t=ni.Default.getImagePath()+ni.Default._envMaps[e];return[t,t,t,t,t,t]},getOBjPath:function(e){return e?0<=e.indexOf("http")?e:this.path+e:this.path+"obj/"},createFloorForWall:function(e){var t={type:"twaver.floor",data:e.getClient("data")};this.getCreator(t.type)&&this.loadData(t).setParent(e)},createCombo:function(e,t){var i,r=[],a=[],n=[],o=[];!e||e instanceof Array||(e=[e]);for(var s=0;s<e.length;s++){var l=e[s],h=l.op||"+",c=l.style,u=l.client,f=l.position||[0,0,0],p=l.rotation||[0,0,0],d=l.scale||[1,1,1],m=null;if("cube"===l.type&&(m=this.createCube(l)),"cylinder"===l.type&&(m=this.createCylinder(l)),"sphere"===l.type&&(m=this.createSphere(l)),"polygon"===l.type&&(m=this.createPolygon(l)),"torus"===l.type&&(m=this.createTorus(l)),"path"===l.type&&(m=this.createPathCube(l)),"pathNode"===l.type&&(m=this.createPathNode(l)),"shapeNode"===l.type&&(m=this.createShapeNode(l)),m){if(p&&!l.rotationAnchor&&m.setRotation(p[0],p[1],p[2]),l.rotationAnchor){var g=m.getPosition();f=[f[0]+g.x,f[1]+g.y,f[2]+g.z]}m.setPosition(f[0],f[1],f[2]),m.setScale(d[0],d[1],d[2]),c&&m.s(c),u&&m.c(u),l.op?(0<m.getChildren().size()&&(r=r.concat(m.getChildren().toArray())),r.push(m),0<m.getChildren().size()?m.getChildren().forEach(function(){n.push(h)}):1<r.length&&n.push(h),o.push(m.getId())):a.push(m)}}return 0<r.length?((i=t?new mono.ComboNode(r,n,!1,t):new mono.ComboNode(r,n)).setNames(o),i):1==a.length?a[0]:a},setMainObject:function(e){var t=null;if(e instanceof Array){for(i=0;i<e.length;i++)(r=e[i])instanceof mono.Entity&&(t=function(e,t){if(e){var i=e.getBoundingBox(),r=t.getBoundingBox(),a=i.min,n=i.max,o=r.min,s=r.max;(n.x-a.x<s.x-o.x||n.z-a.z<s.z-o.z)&&(e=t)}else e=t;return e}(t,r));for(var i=0;i<e.length;i++){var r=e[i];r instanceof mono.Entity&&t!=r&&e[i].setParent(t)}}else t=e;return t&&t.setClient("main",!0),t},createCube:function(e){var t,i,r,a=e.width,n=e.height,o=e.depth,s=e.color,l=(e.position,e.rotation||[0,0,0]),h=e.rotationAnchor,c=e.topColor||s,u=e.repeatX||1,f=e.repeatY||1,p=e.image,d=e.frontImage,m=e.wrapMode;(t=e.objectId?new mono.Cube({id:e.objectId,width:a,height:n,depth:o}):new mono.Cube(a,n,o),s&&t.s({"m.color":s,"m.ambient":s}),c&&t.s({"top.m.color":c,"top.m.ambient":c,"bottom.m.color":c,"bottom.m.ambient":c}),p&&t.s({"m.texture.image":p,"m.texture.repeat":new mono.Vec2(u,f),"m.texture.anisotropy":15}),d&&t.setStyle("front.m.texture.image",d),m&&t.setWrapMode(m),h)?("left"===h&&(i=new mono.Vec3(a/2,0,0),r=new mono.Vec3(0,1,0)),"right"===h&&(i=new mono.Vec3(-a/2,0,0),r=new mono.Vec3(0,1,0)),t.rotateFromAxis(r.clone(),i.clone(),l[1])):t.setRotation(l[0]/180*Math.PI,l[1]/180*Math.PI,l[2]/180*Math.PI);return ni.Default.setObject3dCSProps(t,e),t},createCylinder:function(e){var t=e.radius,i=e.topRadius||t,r=e.bottomRadius||t,a=e.height,n=e.color,o=e.image,s=new mono.Cylinder(i,r,a);return s.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":n,"m.ambient":n,"side.m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),o&&s.setStyle("m.texture.image",o),s},createSphere:function(e){var t=e.radius,i=e.color||"#F5F5F5",r=e.image,a=new mono.Sphere(t);return a.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":i,"m.ambient":i,"m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),r&&a.setStyle("m.texture.image",r),a},createPolygon:function(e){var t=e.radius||100,i=e.topRadius||t,r=e.bottomRadius||t,a=e.height||200,n=e.radialSegments||3,o=e.color||"#F5F5F5",s=e.topColor||o,l=e.smooth||!0,h=e.image,c=new mono.Cylinder(i,r,a,n,l);return c.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":o,"m.ambient":o,"top.m.color":s,"top.m.ambient":s,"bottom.m.color":s,"bottom.m.ambient":s,"side.m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),h&&c.setStyle("m.texture.image",h),c},createTorus:function(e){var t=e.radius||50,i=e.tube||30,r=e.tubularSegments||3,a=e.radialSegments||6,n=e.color||"#F5F5F5",o=e.image,s=new mono.Torus(t,i,r,a);return s.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":n,"m.ambient":n,"m.lightmap.image":this.getImagePath("outside_lightmap.jpg")}),o&&s.setStyle("m.texture.image",o),s},createBillboard:function(e){var t=e.position||[0,0,0],i=e.scale||[1,1,1],r=e.image||this.getImagePath("outside_lightmap.jpg"),a=new mono.Billboard;return a.s({"m.texture.image":r,"m.alignment":mono.BillboardAlignment.bottomCenter,"m.depthTest":!1}),a.setScale(i[0],i[1],i[2]),a.p(t[0],t[1],t[2]),a},createPathNodePath:function(e){var t;if(e[0]&&e[0]instanceof Array)for(r=0;r<e.length;r++){var i=e[r];t?"c"===i[0]?t.quadraticCurveTo(i[1],i[2],i[3],i[4],i[5],i[6]):t.lineTo(i[0],0,i[1]):(t=new mono.Path).moveTo(i[0],0,i[1])}else for(var r=0;r<e.length;r+=2)t?t.lineTo(e[r],0,e[r+1]):(t=new mono.Path).moveTo(e[r],0,e[r+1]);return t},createPathNode:function(e){var t,i=e.radius,r=e.pathImage,a=e.repeat||50,n=e.offset||new mono.Vec2(0,0),o=e.startCap||"plain",s=e.endCap||"plain",l=e.pathWidth,h=e.pathHeight,c=l/2,u=h/2,f=[{x:c,y:-u},{x:c,y:u},{x:-c,y:u},{x:-c,y:-u}],p=this.createPathNodePath(e.data),d=p.getLength();return l&&h?t=new mono.PathNode({path:p,shape:f,segments:10,segmentsR:5}):(p=mono.PathNode.prototype.adjustPath(p,i,2),t=new mono.PathNode({path:p,radius:i})),t.s({"m.texture.image":r,"m.texture.repeat":new mono.Vec2(d/a,1),"m.texture.offset":n}),o&&t.setStartCap(o),s&&t.setEndCap(s),ni.Default.setObject3dCSProps(t,e),t},createShapeNodePath:function(e){var t;if(e[0]&&e[0]instanceof Array)for(r=0;r<e.length;r++){var i=e[r];t?"c"===i[0]?t.quadraticCurveTo(i[1],-i[2],0,i[3],-i[4],0):t.lineTo(i[0],-i[1],0):(t=new mono.Path).moveTo(i[0],-i[1],0)}else for(var r=0;r<e.length;r+=2)t?t.lineTo(e[r],-e[r+1],0):(t=new mono.Path).moveTo(e[r],-e[r+1],0);return t},createShapeNode:function(e){var t=e.repeat||100,i=e.amount||2,r=!0;null===e.vertical&&e.vertical==Me||(r=e.vertical);var a,n=this.createShapeNodePath(e.data);return a=e.id?new mono.ShapeNode({id:e.id,path:n}):new mono.ShapeNode(n),e.curveSegments&&a.setCurveSegments(e.curveSegments),a.setAmount(i),a.setVertical(r),a.setRepeat(t),a},createPathCube:function(e){var t=e.width,i=e.height,r=e.data,a=e.insideColor,n=e.outsideColor,o=e.asideColor,s=e.zsideColor,l=e.topColor,h=e.bottomColor,c=e.insideImage||e.image,u=e.outsideImage||e.image,f=e.insideMap,p=e.outsideMap,d=e.repeat||e.height,m=e.closed,g=this.createShapeNodePath(r);m&&g.closePath();var y=new mono.PathCube(g,t,i);return y.s({"outside.m.color":n,"inside.m.type":"basic","inside.m.color":a,"aside.m.color":o||n,"zside.m.color":s||n,"top.m.color":l,"top.m.ambient":l,"bottom.m.color":h||l,"inside.m.lightmap.image":f,"outside.m.lightmap.image":p,"aside.m.lightmap.image":p,"zside.m.lightmap.image":p,"inside.m.texture.image":c,"outside.m.texture.image":u}),y.setRepeat(d),y},getPicInfo:function(e,t){var i={};"string"==typeof t&&(t=[t]);for(var r=0;r<t.length;r++){var a=t[r],n=a.substring(0,a.indexOf(".")).toLowerCase();a=e+a,i[n]=a}return i},getRByD:function(e){return e*Math.PI/180},getDByR:function(e){return 180*e/Math.PI},getRsByDs:function(e){var t;if(e&&0<e.length){t=[];for(var i=0;i<e.length;i++)t.push(ni.Default.getRByD(e[i]))}return t},setObject3dCSProps:function(e,t){t.client&&e.c(t.client),t.style&&e.s(t.style)},setObject3dCommonProps:function(e,t){var i=ni.Default.getRsByDs(t.rotation)||[0,0,0],r=t.scale||[1,1,1],a=t.position||[0,0,0];e.setRotation(i[0],i[1],i[2]),e.setScale(r[0],r[1],r[2]),e.setPosition(a[0],0,a[2]),ni.Default.setPositionY(e,a[1]),ni.Default.setObject3dCSProps(e,t)},cloneObjElement:function(e,t){var i=ni.Default.getRsByDs(e.rotation)||[0,0,0],r=e.scale||[1,1,1],a=e.position||[0,0,0];a[1]=parseFloat(a[1])||0;var n=this._objObject[e.name],o=n.getBoundingBoxWithChildren(),s=(o.max.y-o.min.y)/2,l=e.singleton?n:n.clonePrefab();if(e._id&&(l._id=e._id),e.client)for(var h in e.client)l.setClient(h,e.client[h]);return e.style&&l.s(e.style),l.setClient("type",e.name),l.setClient("showShadow",e.showShadow),e.showShadow&&(null!=e.shadowType?(l.setClient("shadowType",e.shadowType),l.setClient("shadowWeight",1)):e.showShadowImage&&l.setClient("shadowImage",e.shadowImage)),"function"==typeof e.interepter&&e.interepter.call(this,l),l.setClient("json",e),l.setScale(r[0],r[1],r[2]),l.setPosition(a[0],a[1]+s*r[1],a[2]),l.setRotation(i[0],i[1],i[2]),t&&t(l),l},setDefaultEnvMap:function(e){var t=this.getEnvMap("envmap5");return e.setStyle("m.envmap.image",t),e.getDescendants().forEach(function(e){e.setStyle("m.envmap.image",t)}),e},setShadowImage:function(e,t){e.setClient("shadowImage",t),twaver.Util.registerImageByUrl(t,t)},createObj:function(a,e){var t=this;if(this._objObject[a.name]){var i=this.getOBjPath(a.path),r=a.shadowImage=i+a.name+"S.png";return this.cloneObjElement(a,e)}if(this._objMap[a.name]){if(a.showShadow){i=this.getOBjPath(a.path),r=a.shadowImage=i+a.name+"S.png";null==a.shadowType&&twaver.Util.registerImageByUrl(r,r)}}else{this._objMap[a.name]=[];var n=(i=this.getOBjPath(a.path))+a.name+".obj",o=i+a.name+".mtl";a.scale,a.showShadow&&(r=a.shadowImage=i+a.name+"S.png",null==a.shadowType&&twaver.Util.registerImageByUrl(r,r)),(new mono.OBJMTLLoader).load(n,o,null,function(e){if(a.merged)e=mono.Utils.mergeElements(e.getDescendants());else if(a.envImages){var r=ni.Default.getEnvMap("envmap5");e.getDescendants().forEach(function(t){var i=t.getStyle("m.texture.image");i&&a.envImages.forEach(function(e){(0<=i.indexOf(e)||i instanceof Array&&0<=i[0].indexOf(e))&&t.setStyle("m.envmap.image",r)})})}t._objObject[a.name]=e,t._objMap[a.name].forEach(function(e){return t.cloneObjElement(e.json,e.callback)})})}this._objMap[a.name].push({json:a,callback:e})},getTextSize:function(e,t){var i=document.createElement("canvas").getContext("2d"),r=e.split("\n"),a=0;i.font=t;for(var n=0;n<r.length;n++){var o=r[n],s=i.measureText(o).width;a<s&&(a=s)}return{w:a,h:i.measureText("e").width*r.length*3+4}},generateTextCanvas:function(e,t,i,r,a,n){var o=document.createElement("canvas"),s=(i=i||"bold 80px 微软雅黑,sans-serif",o.getContext("2d")),l=e.split("\n"),h=ni.Default.getTextSize(e,i),c=h.w,u=h.h,f={width:c,height:u};o.height=mono.Utils.nextPowerOfTwo(h.h),o.width=mono.Utils.nextPowerOfTwo(h.w),r&&(s.save(),s.globalAlpha=1,s.fillStyle=a||"#FE642E",s.beginPath(),s.moveTo(0,0),s.lineTo(c,0),s.lineTo(c,u),s.lineTo(0,u),s.closePath(),s.fill()),s.restore(),s.fillStyle=t||"white",s.textBaseline="middle",s.textAlign="center",s.font=i,n||(s.shadowColor="#585858",s.shadowBlur=25,s.shadowOffsetX=10,s.shadowOffsetY=10);for(var p=2.5*s.measureText("o").width,d=0;d<l.length;d++){var m=c/2,g=p*d+p/2+(o.height-f.height);s.fillText(l[d],m,g)}return o.drawRect=f,o},generateShadowNode:function(e,t,i){var r=null,a=e.getDescendants();if(a&&0<a.length)for(var n=0;n<a.length;n++){var o=a[n];if(o instanceof mono.Entity&&o.getClient("type")&&"floor"==o.getClient("type")){r=o;break}}if(r){var s=r.getBoundingBox(),l=(s.max.z,s.min.z,s.max.x,s.min.x,e.getRotation());e.setRotation(0,0,0);var h=ni.Default.createShadowImage(e,r,t,i);return r.setStyle("top.m.lightmap.image",h),r.invalidateTexture(),ni.Default.newcanvas=ni.Default.newcanvas||h,e.setRotation(l),r}},_getWorldRotation:function(e){var t=(new mono.Mat4).extractRotation(e.worldMatrix),i=new mono.Vec3;return i.setEulerFromRotationMatrix(t),i},createShadowImage:function(e,t,i,r){var a=r&&r.shadowColor||"#000",n=(r&&r.shadowWeight,t.getBoundingBox()),o=n.max.z-n.min.z,s=n.max.x-n.min.x,l=Math.max(s,o),h=4096<l?Math.ceil(l/4096):1,c=ni.Default.canvas||document.createElement("canvas"),u=s/(le=s/h),f=o/(he=o/h);c.width=le,c.height=he;var p=c.getContext("2d");p.clearRect(0,0,le,he),p.fillStyle="white",p.fillRect(0,0,le,he),p.beginPath();for(var d,m=e.getPosition(),g=e?e.getBoundingBox():null,y=-(g.max.x+g.min.x)/2-m.x,v=-(g.max.z+g.min.z)/2-m.z,x=e.getDescendants(),A=0;A<x.length;A++)if((w=x[A]).getClient&&"wallCombos"==w.getClient("id")){d=w;break}d&&(b=d.getClient("combos")).forEach(function(e){if(e.getClient&&!e.getClient("resetPos")){var t=e.getPosition();e.p(t.x+parseFloat(m.x),t.y+parseFloat(m.y),t.z+parseFloat(m.z)),e.setClient("resetPos",!0)}x.push(e)});var _;for(A=0;A<x.length;A++){var w=x[A];if(w.getClient&&"columnCombos"==w.getClient("id")){_=w;break}}if(_){var b=_.getClient("combos");b.forEach(function(e){if(e.getClient&&!e.getClient("resetPos")){var t=e.getPosition();e.p(t.x+parseFloat(m.x),t.y+parseFloat(m.y),t.z+parseFloat(m.z)),e.setClient("resetPos",!0)}x.push(e)})}x.push(e);for(var M=0;M<x.length;M++){var S=x[M],P=S.getWorldPosition(),T=le/2+P.x/u,C=he/2+P.z/f,E=ni.Default._getWorldRotation(S),z=S.getClient("type");if(0!=(Y=S.getClient("showShadow"))&&(Y=!0),Y&&("wall"==z||"inner_wall"==z||"glass_wall"==z)){var D=S.getClient("data"),L=S.getClient("doorData"),R=.9*S.getClient("wallDepth");if(p.save(),p.translate(T,C),p.beginPath(),D[0]&&D[0]instanceof Array){for(N=0;N<D.length;N++)0==N?p.moveTo(D[N][0]/u+y/u,D[N][1]/f+v/f):p.lineTo(D[N][0]/u+y/u,D[N][1]/f+v/f);"wall"==z&&p.lineTo(D[0][0]/u+y/u,D[0][1]/f+v/f)}else{for(var N=0;N<D.length;N+=2)0==N?p.moveTo(D[N]/u+y/u,D[N+1]/f+v/f):p.lineTo(D[N]/u+y/u,D[N+1]/f+v/f);"wall"==z&&p.lineTo(D[0]/u+y/u,D[1]/f+v/f)}p.lineWidth=R/u,p.strokeStyle="#ccc",p.shadowColor=a;var B=Math.min(parseInt(s/15),300);p.shadowBlur=parseInt(B/u),"inner_wall"!=z&&"glass_wall"!=z||(p.lineWidth=R/u,p.shadowBlur=parseInt(B/u)),p.shadowOffsetX=0;for(var I=p.shadowOffsetY=0;I<3;I++)p.shadowBlur=4e3<=l?180+80*I:100+50*I,p.stroke(),0==I&&(p.shadowColor="#666",p.shadowBlur=4e3<=l?300:200,p.stroke(),p.shadowColor="#000",p.shadowBlur=10,p.stroke());if(L){for(p.save(),p.shadowBlur=100,p.shadowColor="#ffffff",A=0;A<L.length;A+=2){var F=(L[A][0]+y)/h,V=(L[A][1]+v)/h,U=(L[A+1][0]+y)/h,k=(L[A+1][1]+v)/h,O=50/h,X=200/h,G=p.createLinearGradient(F-O,V-X,F-O,V+X);F==U&&(G=p.createLinearGradient(F-X,V-O,F+X,V-O)),F==U?(V+=8/h,k-=8/h):V==k&&(F+=8/h,U-=8/h),G.addColorStop(0,"rgba(255,255,255,0)"),G.addColorStop(.5,"rgba(255,255,255,1)"),G.addColorStop(1,"rgba(255,255,255,0)"),p.fillStyle=G,p.beginPath(),F==U?(p.moveTo(F-X,V-O),p.lineTo(F,V),p.lineTo(F+X,V-O),p.lineTo(F+X,k+O),p.lineTo(U,k),p.lineTo(F-X,k+O)):V==k&&(p.moveTo(F-O,V-X),p.lineTo(U+O,V-X),p.lineTo(U,k),p.lineTo(U+O,k+X),p.lineTo(F-O,k+X),p.lineTo(F,V)),p.closePath(),p.fill()}p.restore()}p.restore()}var Y=S.getClient("showShadow");i&&(Y=Y&&i(S));var W=S.getClient("shadowImage"),j=S.getClient("shadowType")||0,H=S.getClient("shadowRatio")||.99,q=S.getClient("shadowWeight")||2;if(Y){var Z=S.getBoundingBox().size(),Q=Z.x/u*H;R=depth=Z.z/f*H;if(E.y%(Math.PI/2)==0&&(Q=Z.x/f*H,R=depth=Z.z/u*H),E.y%Math.PI==0&&(Q=Z.x/u*H,R=depth=Z.z/f*H),1==j){var K=Math.min(Z.x,Z.z);Q=K/u*H,R=depth=K/f*H,E.y%(Math.PI/2)==0&&(Q=K/f*H,R=depth=K/u*H),E.y%Math.PI==0&&(Q=K/u*H,R=depth=K/f*H)}if(W){E=S.getRotation();var J=twaver.Util.getImageAsset(W);if(!J)continue;p.save(),p.translate(T+y/u,C+v/f),p.rotate(-E.y);var $,ee,te,ie,re=.3*Math.max(Q,depth);E.y%(Math.PI/2)==0&&($=-Q/2-re/2,ee=-depth/2-re/2,te=Q+re,ie=depth+re),E.y%Math.PI==0&&($=-Q/2-re/2,ee=-depth/2-re/2,te=Q+re,ie=depth+re),p.drawImage(J.getImage(),$,ee,te,ie),p.restore()}else if(0==j){p.save(),p.translate(T+y/u,C+v/f),p.rotate(-E.y),p.beginPath(),p.moveTo(-Q/2,0),p.lineTo(Q/2,0),p.lineWidth=R,p.strokeStyle="gray",p.shadowColor="#333";var ae=Math.min(Q,depth);p.shadowBlur=2*ae,p.shadowOffsetX=0,p.shadowOffsetY=0,1==q?(p.shadowBlur=3*ae,p.stroke()):2==q&&(p.stroke(),p.stroke()),p.restore()}else if(1==j){T=T+y/u,C=C+v/f;var ne=S.getClient("shadowRadius");ne?ne/=f:ne=Math.sqrt(Q*Q+depth*depth)/2,p.save(),p.beginPath(),p.arc(T,C,ne,0,2*Math.PI,!1),p.fillStyle="gray",p.shadowColor=a,p.shadowBlur=2*ne,p.shadowOffsetX=0,p.shadowOffsetY=0,1==q?(p.shadowBlur=3*ne,p.fill()):2==q&&(p.fill(),p.fill()),p.restore()}}}ni.Default.canvas=ni.Default.canvas||c;var oe=(l=Math.max(2048,Math.max(s/h,o/h)))/2048,se=ni.Default.newcanvas||document.createElement("canvas"),le=mono.Utils.nextPowerOfTwo(s/oe),he=mono.Utils.nextPowerOfTwo(o/oe);se.width=le,se.height=he,se.style.width=le,se.style.height=he;var ce=se.getContext("2d");return ce.clearRect(0,0,le,he),ce.fillStyle="white",ce.fillRect(0,0,le,he),ce.drawImage(c,0,0,s/h,o/h,0,0,le,he),se},getRelativePosition:function(e,t){var i,r;return i=(new mono.Mat4).getInverse(e.worldMatrix.clone()),r=(new mono.Mat4).multiplyMatrices(i,t.worldMatrix.clone()),main.position=(new mono.Vec3).getPositionFromMatrix(r)},getPathBoundingBox:function(e){var t,i,r,a,n={},o={centerPoint:{x:0,y:0},min:{x:0,y:0},max:{x:0,y:0},size:{x:0,y:0}};if(0==e.length)return o;if(e[0]instanceof Array)for(t=e[0][0],i=e[0][0],r=-e[0][1],a=-e[0][1],s=1;s<e.length;s++)t=Math.min(t,e[s][0]),i=Math.max(i,e[s][0]),r=Math.min(r,-e[s][1]),a=Math.max(a,-e[s][1]);else{if(e.length<2)return o;t=e[0],i=e[0],r=-e[1],a=-e[1];for(var s=2;s<e.length;s+=2)t=Math.min(t,e[s]),i=Math.max(i,e[s]),r=Math.min(r,-e[s+1]),a=Math.max(a,-e[s+1])}return n.centerPoint={x:(t+i)/2,y:(r+a)/2},n.min={x:t,y:r},n.max={x:i,y:a},n.size={x:i-t,y:a-r},n},setPositionY:function(e,t){if("number"==typeof t)e.setPositionY(t);else if(t==ni.Default.positionFloor){var i=e.getBoundingBox().size();e.setPositionY(i.y/2)}},playAnimation:function(e,t,i){var r=t.split(":");if("move"===r[0]){var a=r[1],n=r[2],o=parseInt(r[3])||1e3,s=parseInt(r[4]||0),l=r[5];this.animateMove(e,a,n,o,s,l,i)}if("rotation"===r[0]){var h=r[1],c=r[2];o=parseInt(r[3])||1e3,s=parseInt(r[4]),l=r[5];this.animateRotate(e,h,c,o,s,l,i)}},animateMove:function(t,e,i,r,a,n,o){n=n||"easeInStrong";var s=t.getBoundingBox().size().multiply(t.getScale()),l=(i=i||.8,new mono.Vec3(0,0,1)),h=0;"right"===e&&(l=new mono.Vec3(1,0,0),h=s.x),"left"===e&&(l=new mono.Vec3(-1,0,0),h=s.x),"top"===e&&(l=new mono.Vec3(0,1,0),h=s.y),"bottom"===e&&(l=new mono.Vec3(0,-1,0),h=s.y),"front"===e&&(l=new mono.Vec3(0,0,1),h=s.z),"back"===e&&(l=new mono.Vec3(0,0,-1),h=s.z),h*=i,t.getClient("animated")&&(l=l.negate()),l=t.direction2(l);var c=t.getPosition().clone();t.setClient("animated",!t.getClient("animated")),new twaver.Animate({from:0,to:1,dur:r,easing:n,delay:a,onUpdate:function(e){t.setPosition(c.clone().add(l.clone().multiplyScalar(h*e)))},onDone:function(){o&&o()}}).play()},animateRotate:function(t,e,i,r,a,n,o){n=n||"easeInStrong";var s,l=t.getBoundingBox().size().multiply(t.getScale()),h=1;if(t.getClient("animated")&&(h=-1),t.setClient("animated",!t.getClient("animated")),"left"===e&&(s=new mono.Vec3(-l.x/2,0,0),c=new mono.Vec3(0,1,0)),"right"===e&&(s=new mono.Vec3(l.x/2,0,0),c=new mono.Vec3(0,1,0)),"center-z"===e){s=new mono.Vec3(0,0,0);var c=new mono.Vec3(0,0,1)}new twaver.Animate({from:0,to:h,dur:r,delay:a,easing:n,onUpdate:function(e){this.lastValue===Me&&(this.lastValue=0),t.rotateFromAxis(c.clone(),s.clone(),Math.PI/180*-i*(e-this.lastValue)),this.lastValue=e},onDone:function(){delete this.lastValue,o&&o()}}).play()},animateCameraPosition:function(n,o,e,t){var s=n.getPosition(),i=new twaver.Animate({from:0,to:1,dur:e,easing:"easeBoth",onUpdate:function(e){var t=s.x+(o.x-s.x)*e,i=s.y+(o.y-s.y)*e,r=s.z+(o.z-s.z)*e,a=new mono.Vec3(t,i,r);n.setPosition(a)}});return i.onDone=t,i},playCameraAnimation:function(o,s,l,e){var h=o.getTarget(),c=o.getPosition().sub(o.getTarget()),t=new twaver.Animate({from:0,to:1,dur:500,easing:"easeBoth",onUpdate:function(e){var t=h.x+(l.x-h.x)*e,i=h.y+(l.y-h.y)*e,r=h.z+(l.z-h.z)*e,a=new mono.Vec3(t,i,r);o.lookAt(a),s.target=a;var n=(new mono.Vec3).addVectors(c,a);o.setPosition(n)}});t.onDone=e,t.play()}},ni.Utils3D)ni.Default[wt]=ni.Utils3D[wt];ni.Default.register("twaver.cube",function(e,t){e.image&&e.image.indexOf("http")<0&&(e.image=ni.Default.path+e.image);var i=ni.Default.createCube(e);return 0==e.visible&&i.setStyle("m.visible",!1),ni.Default.setObject3dCommonProps(i,e),t&&t(i),i},{category:"基本模型",type:"mono.Element",name:"立方体",icon:"model/idc/icons/cube.png",description:"立方体是make里面提供的最基本的模型，可以用这种模型扩展出各种立方体形状的模型，比如箱子，柱子，盒子等。支持更改长，宽，高，贴图等基本参数",modelDefaultParameters:{width:{name:"宽",value:100,type:ni.Default.PARAMETER_TYPE_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:100,type:ni.Default.PARAMETER_TYPE_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},depth:{name:"深",value:100,type:ni.Default.PARAMETER_TYPE_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"white",type:ni.Default.PARAMETER_TYPE_COLOR,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:Me,type:ni.Default.PARAMETER_TYPE_IMAGE,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:ni.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:ni.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),ni.Default.register("twaver.cylinder",function(e,t){var i=ni.Default.createCylinder(e),r=e.position||[0,0,0];return i.p(r[0],0,r[2]),ni.Default.setPositionY(i,r[1]),t&&t(i),i},{category:"基本模型",type:"mono.Element",name:"圆柱体",icon:"model/idc/icons/cylinder.png",description:"圆柱体是make中提供的最基本模型，支持更改半径，高度的参数。可以更改这些参数扩展出各个圆柱体形状的模型，比如圆形柱子，桌子腿，瓶子，圆筒等",modelDefaultParameters:{topRadius:{name:"顶半径",value:60,type:ni.Default.PARAMETER_TYPE_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},bottomRadius:{name:"底半径",value:60,type:ni.Default.PARAMETER_TYPE_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:100,type:ni.Default.PARAMETER_TYPE_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"white",type:ni.Default.PARAMETER_TYPE_COLOR,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:Me,type:ni.Default.PARAMETER_TYPE_IMAGE,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:ni.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:ni.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),ni.Default.register("twaver.sphere",function(e,t){var i=ni.Default.createSphere(e),r=e.position||[0,0,0];return i.p(r[0],0,r[2]),i.setClient("showShadow",!0),i.setClient("shadowType",1),i.setClient("shadowRatio",.3),ni.Default.setPositionY(i,r[1]),t&&t(i),i},{category:"基本模型",type:"mono.Element",name:"球体",icon:"model/idc/icons/sphere.png",description:"球体是make中提供的最基本模型，支持更改半径的参数。可以更改这些参数扩展出各个球体形状的模型，比如圆球等",modelDefaultParameters:{radius:{name:"半径",value:80,type:ni.Default.PARAMETER_TYPE_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"#F5F5F5",type:ni.Default.PARAMETER_TYPE_COLOR,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:Me,type:ni.Default.PARAMETER_TYPE_IMAGE,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:ni.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:ni.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),ni.Default.register("twaver.polygon",function(e,t){var i=ni.Default.createPolygon(e),r=e.position||[0,0,0];return i.p(r[0],0,r[2]),ni.Default.setPositionY(i,r[1]),t&&t(i),i},{category:"基本模型",type:"mono.Element",name:"多边形",icon:"model/idc/icons/polygon.png",description:"多边形是make中提供的最基本模型，支持更改半径，高度，边数的参数。可以更改这些参数扩展出各个多边形状的模型，比如多边形柱子，多边形箱子，各种支架等",modelDefaultParameters:{color:{name:"颜色",value:"white",type:ni.Default.PARAMETER_TYPE_COLOR,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:Me,type:ni.Default.PARAMETER_TYPE_IMAGE,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},topRadius:{name:"顶半径",value:100,type:ni.Default.PARAMETER_TYPE_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},bottomRadius:{name:"底半径",value:100,type:ni.Default.PARAMETER_TYPE_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:200,type:ni.Default.PARAMETER_TYPE_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},radialSegments:{name:"边数",value:3,type:ni.Default.PARAMETER_TYPE_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:ni.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:ni.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),ni.Default.register("twaver.torus",function(e,t){var i=ni.Default.createTorus(e),r=e.position||[0,0,0];return i.p(r[0],0,r[2]),ni.Default.setPositionY(i,r[1]),t&&t(i),i},{category:"基本模型",type:"mono.Element",name:"圆环",icon:"model/idc/icons/torus.png",description:"圆环体是make中提供的最基本模型，支持更改半径，高度，扁平程度，管半径的参数。可以更改这些参数扩展出各个圆环体形状的模型，比如轮胎等",modelDefaultParameters:{color:{name:"颜色",value:"white",type:ni.Default.PARAMETER_TYPE_COLOR,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:Me,type:ni.Default.PARAMETER_TYPE_IMAGE,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},radius:{name:"半径",value:50,type:ni.Default.PARAMETER_TYPE_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},tube:{name:"内外径差",value:30,type:ni.Default.PARAMETER_TYPE_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},tubularSegments:{name:"扁平程度",value:3,type:ni.Default.PARAMETER_TYPE_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},radialSegments:{name:"边数",value:6,type:ni.Default.PARAMETER_TYPE_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:ni.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:ni.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:ni.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}});var oi=0;ni.Default.register("twaver.combo",function(e,t){var i="pack_"+oi++,r=e.data;if(r&&mono.Utils.isArray(r)){for(var a=null,n=null,o=[],s=[],l=0;l<r.length;l++){if(n=ni.Default.load(r[l]),a){var h=n.getClient("type");"inner_wall"==h||"glass_wall"==h?(o.push(n),0<n.getChildren().size()&&n.getChildren().forEachReverse(function(e){e.setParent(a)})):"column"==h?s.push(n):n.setParent(a)}else a=n;n.setClient?n.setClient("pack",i):(n.client=n.client||{},n.client.pack=i)}if(o&&0<o.length&&((c=new mono.ComboNode(o)).setClient("id","wallCombos"),c.setClient("combos",c.getCombos()),c.setParent(a)),s&&0<s.length){var c=new mono.ComboNode(s);c.setClient("id","columnCombos"),c.setClient("combos",c.getCombos()),c.setParent(a)}return t&&t(a),a}},{icon:"model/idc/icons/combo.png",category:"基本模型",type:"mono.Element",name:"组合模型",description:"组合模型，可以把多个不同的模型组合在一块，组成一个新的模型，传如参数是一个数组"}),ni.Default.registerObj=function(e,i,r,a,n,o,s,t,l,h,c){(a=a||{}).async=!0,ni.Default.register(e,function(e,t){return e.name=i,e.path=r,(e.showShadow=n)&&(e.showShadowImage=!0),e.shadowType=o,e.merged=s,e.envImages=h,e.singleton=c,l&&(e.style=l),null==e.merged&&(e.merged=!0),e.interepter=a.interepter,ni.Default.createObj(e,t)},a)},ni.Default.register("twaver.loader",function(e,t){return ni.Default.load(e.data,t)}),ni.Utils3D.getRectOfPoints=function(e){if(!e||e.length/2<2)return null;var i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,t=0,o=e.length,s=[],l=function(e,t){a=Math.min(a,e),n=Math.max(n,e),i=Math.min(i,t),r=Math.max(r,t),s.push({x:e,y:t})};if(0<o&&e[t]instanceof Array)for(;t<o;t++){var h=e[t];2==h.length?l(h[0],h[1]):5==h.length&&"c"==h[0]&&l(h[3],h[4])}else for(;t<o;t+=2)l(e[t],e[t+1]);return{min:{x:a,y:i},max:{x:n,y:r},center:function(){return{x:(a+n)/2,y:(i+r)/2}},width:n-a,height:r-i,points:s}}}(window);